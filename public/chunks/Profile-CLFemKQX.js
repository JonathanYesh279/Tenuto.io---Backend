import{j as e,u as Ie,V as He,C as xt,n as Ne}from"../assets/index-CoKafZFz.js";import{R as ht,r,u as ft,b as pt}from"./vendor-C9PcmKF2.js";import{a as R,t as Ye}from"./cascade-deletion-BvQll6O-.js";import{M as Ce,I as Xe,O as We,T as ze,U as De,f as ke,a2 as tt,c as fe,e as pe,s as Oe,r as st,d as qe,a as Me,X as ve,ad as yt,D as at,a0 as nt,h as rt,u as Ue,q as be,S as Te,g as ye,P as $e,ag as it,k as _e,B as Pe,i as bt,G as Je,W as Ze,ar as jt,A as Nt,aa as Ve,af as Ee,Y as vt,al as wt,a7 as St,K as Tt}from"./ui-DsxFGtGk.js";import{t as et}from"./theoryEnrollmentService-CyV7tbhP.js";import"./query-BdHdBeoH.js";import"./utils-x1PSU_OZ.js";function Ct({student:t,onEdit:b,onDelete:N,onViewDetails:v,onScheduleLesson:y,onUpdateLesson:l,onMarkAttendance:a,onAddNote:n,className:C=""}){const w=t.academicInfo?.instrumentProgress?.find(p=>p.isPrimary)||t.academicInfo?.instrumentProgress?.[0],E=w?.instrumentName||"×œ× ×”×•×’×“×¨",u=w?.currentStage||0,L=t.scheduleInfo||t.teacherAssignments?.[0],U=L?`${L.day} ${L.startTime||L.time}`:null,i=L?.duration||60,h=!!L,A=t.academicInfo?.isActive!==!1&&t.status!=="inactive",x=A?"text-green-800 bg-green-100":"text-red-800 bg-red-100",d=A?"×¤×¢×™×œ":"×œ× ×¤×¢×™×œ",j=A?qe:Me,O=h?"border-2 border-green-400 shadow-sm shadow-green-200":"border border-gray-200";return e.jsxs("div",{className:`bg-white ${O} rounded-lg hover:shadow-lg hover:border-indigo-300 transition-all duration-200 transform hover:-translate-y-1 group ${C}`,children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 font-reisinger-yonatan text-lg",children:t.personalInfo.fullName}),e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${x}`,children:[ht.createElement(j,{className:"w-3 h-3"}),d]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Ce,{className:"w-4 h-4 text-indigo-500"}),e.jsx("span",{className:"font-reisinger-yonatan font-medium",children:E}),u>0&&e.jsxs("span",{className:"text-xs bg-indigo-100 text-indigo-700 px-2 py-1 rounded-full font-reisinger-yonatan",children:["×©×œ×‘ ",u]})]})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[e.jsx("button",{onClick:()=>v(t.id),className:"p-1.5 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-all duration-200",title:"×¦×¤×” ×‘×¤×¨×˜×™× ××œ××™×",children:e.jsx(Xe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>b(t),className:"p-1.5 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-200",title:"×¢×¨×™×›×ª ×ª×œ××™×“",children:e.jsx(We,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>N(t.id),className:"p-1.5 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all duration-200",title:"××—×™×§×ª ×ª×œ××™×“",children:e.jsx(ze,{className:"w-4 h-4"})})]})]})}),e.jsxs("div",{className:"px-4 py-3 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"space-y-1",children:[t.personalInfo.age&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(De,{className:"w-3 h-3"}),e.jsxs("span",{className:"font-reisinger-yonatan",children:["×’×™×œ: ",t.personalInfo.age]})]}),t.personalInfo.class&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(ke,{className:"w-3 h-3"}),e.jsxs("span",{className:"font-reisinger-yonatan",children:["×›×™×ª×”: ",t.personalInfo.class]})]})]}),e.jsx("div",{className:"space-y-1",children:t.personalInfo.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",dir:"ltr",children:[e.jsx(tt,{className:"w-3 h-3"}),e.jsx("span",{className:"font-mono text-xs",children:t.personalInfo.phone})]})})]}),U&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-800 font-reisinger-yonatan",children:[e.jsx(fe,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"×©×™×¢×•×¨ ×§×‘×•×¢:"})]}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx("span",{className:"text-sm font-reisinger-yonatan text-blue-700",children:U}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-blue-600",children:[e.jsx(pe,{className:"w-3 h-3"}),e.jsxs("span",{children:[i," ×“×§'"]})]})]})]})]}),e.jsx("div",{className:"px-4 py-3 border-t border-gray-100 bg-gray-50",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:()=>v(t.id),className:"text-indigo-600 hover:text-indigo-800 hover:bg-indigo-100 px-3 py-1 rounded-lg text-sm font-medium font-reisinger-yonatan transition-all duration-200 flex items-center gap-1",children:[e.jsx(Xe,{className:"w-4 h-4"}),"×¤×¨×˜×™× ××œ××™×"]}),h&&l?e.jsxs("button",{onClick:()=>l(t),className:"text-blue-600 hover:text-blue-800 hover:bg-blue-100 px-3 py-1 rounded-lg text-sm font-medium font-reisinger-yonatan transition-all duration-200 flex items-center gap-1",children:[e.jsx(fe,{className:"w-4 h-4"}),"×¢×“×›×Ÿ ×©×™×¢×•×¨ ×§×‘×•×¢"]}):y&&!h?e.jsxs("button",{onClick:()=>y(t.id),className:"text-green-600 hover:text-green-800 hover:bg-green-100 px-3 py-1 rounded-lg text-sm font-medium font-reisinger-yonatan transition-all duration-200 flex items-center gap-1",children:[e.jsx(fe,{className:"w-4 h-4"}),"×ª×–××Ÿ ×©×™×¢×•×¨"]}):null,a&&e.jsxs("button",{onClick:()=>a(t.id),className:"text-blue-600 hover:text-blue-800 hover:bg-blue-100 px-3 py-1 rounded-lg text-sm font-medium font-reisinger-yonatan transition-all duration-200 flex items-center gap-1",children:[e.jsx(Oe,{className:"w-4 h-4"}),"× ×•×›×—×•×ª"]}),n&&e.jsxs("button",{onClick:()=>n(t.id),className:"text-yellow-600 hover:text-yellow-800 hover:bg-yellow-100 px-3 py-1 rounded-lg text-sm font-medium font-reisinger-yonatan transition-all duration-200 flex items-center gap-1",children:[e.jsx(st,{className:"w-4 h-4"}),"×”×¢×¨×”"]})]})})]})}function kt({student:t,teacherId:b,onClose:N,onSave:v}){const[y,l]=r.useState(new Date().toISOString().split("T")[0]),[a,n]=r.useState(null),[C,w]=r.useState(""),[E,u]=r.useState(!1),[L,U]=r.useState(!1),[i,h]=r.useState(!1),[A,x]=r.useState(null),[d,j]=r.useState([]),[O,p]=r.useState(!1),[M,c]=r.useState(!1),I=t.personalInfo?.fullName||t.fullName||`${t.firstName} ${t.lastName}`.trim(),B=t.academicInfo?.instrumentProgress?.find(S=>S.isPrimary)?.instrumentName||"×œ× ×¦×•×™×Ÿ",_=t.scheduleInfo;r.useEffect(()=>{Y(y)},[y]),r.useEffect(()=>{O&&d.length===0&&ne()},[O]);const Y=async S=>{u(!0),x(null);try{const Z=await R.attendance.getIndividualLessonAttendance({studentId:t.id,teacherId:b,date:S});Z?(n(Z.status),w(Z.notes||"")):(n(null),w(""))}catch(Z){console.error("Error loading attendance:",Z),n(null),w("")}finally{u(!1)}},ne=async()=>{c(!0);try{const S=await R.attendance.getStudentAttendanceHistory({studentId:t.id,teacherId:b,lessonType:"individual",limit:20});j(S)}catch(S){console.error("Error loading attendance history:",S),j([])}finally{c(!1)}},k=async()=>{if(!a){x("×™×© ×œ×‘×—×•×¨ ×¡×˜×˜×•×¡ × ×•×›×—×•×ª");return}U(!0),x(null);try{const S={studentId:t.id,teacherId:b,date:y,status:a,notes:C.trim(),lessonType:"individual",duration:_?.duration||45};await R.attendance.saveIndividualLessonAttendance(S),j(Z=>{const ae=Z.filter(me=>me.date!==y);return[{...S,_id:Date.now().toString(),createdAt:new Date().toISOString()},...ae]}),h(!0),setTimeout(()=>{h(!1),v&&v(),N()},1500)}catch(S){console.error("Error saving attendance:",S),x(S.message||"×©×’×™××” ×‘×©××™×¨×ª ×”× ×•×›×—×•×ª")}finally{U(!1)}},W=S=>{switch(S){case"present":return"bg-green-100 border-green-300 text-green-800 hover:bg-green-200";case"absent":return"bg-red-100 border-red-300 text-red-800 hover:bg-red-200"}},V=S=>{switch(S){case"present":return e.jsx(Ue,{className:"w-5 h-5"});case"absent":return e.jsx(ve,{className:"w-5 h-5"})}},H=S=>{switch(S){case"present":return"× ×•×›×—";case"absent":return"× ×¢×“×¨"}},K=S=>{const Z=new Date(y);Z.setDate(Z.getDate()+S),l(Z.toISOString().split("T")[0])},J=r.useMemo(()=>{const S=d.length,Z=d.filter(oe=>oe.status==="present").length,ae=d.filter(oe=>oe.status==="absent").length,me=S>0?Math.round(Z/S*100):0;return{total:S,present:Z,absent:ae,attendanceRate:me}},[d]);return i?e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
          @keyframes scaleIn {
            0% {
              transform: scale(0.7);
              opacity: 0;
            }
            50% {
              transform: scale(1.05);
            }
            100% {
              transform: scale(1);
              opacity: 1;
            }
          }
          @keyframes checkMark {
            0% {
              transform: scale(0) rotate(-45deg);
            }
            50% {
              transform: scale(1.2) rotate(-45deg);
            }
            100% {
              transform: scale(1) rotate(0deg);
            }
          }
          .animate-scale-in {
            animation: scaleIn 0.4s ease-out forwards;
          }
          .animate-check {
            animation: checkMark 0.6s ease-out 0.2s forwards;
          }
        `}),e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl p-8 max-w-md w-full text-center animate-scale-in",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 mb-4 animate-check",children:e.jsx(qe,{className:"h-10 w-10 text-green-600"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"×”× ×•×›×—×•×ª × ×©××¨×” ×‘×”×¦×œ×—×”!"}),e.jsxs("p",{className:"text-gray-600",children:[I," ×¡×•××Ÿ ×›",H(a)," ×‘-",new Date(y).toLocaleDateString("he-IL")]})]})})]}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:N,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto transform transition-all",onClick:S=>S.stopPropagation(),children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("button",{onClick:N,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"×¡×’×•×¨",children:e.jsx(ve,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"×¨×™×©×•× × ×•×›×—×•×ª - ×©×™×¢×•×¨ ××™×©×™"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-1 text-sm text-gray-600",children:[e.jsx(De,{className:"w-4 h-4"}),e.jsx("span",{children:I}),_&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:[_.day," ",_.startTime]})]})]})]}),e.jsx("button",{onClick:()=>p(!O),className:`p-2 rounded-lg transition-colors ${O?"bg-indigo-100 text-indigo-600":"text-gray-400 hover:text-gray-600 hover:bg-gray-100"}`,"aria-label":"×”×™×¡×˜×•×¨×™×”",title:"×”×™×¡×˜×•×¨×™×™×ª × ×•×›×—×•×ª",children:e.jsx(yt,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg p-3 mt-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-indigo-600 rounded-full flex items-center justify-center",children:e.jsx(Ce,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:B}),e.jsx("div",{className:"text-sm text-gray-600",children:t.personalInfo?.class&&`×›×™×ª×” ${t.personalInfo.class}`})]}),d.length>0&&e.jsxs("div",{className:"text-center px-3 py-1 bg-white rounded-lg border border-indigo-200",children:[e.jsxs("div",{className:"text-2xl font-bold text-indigo-600",children:[J.attendanceRate,"%"]}),e.jsx("div",{className:"text-xs text-gray-600",children:"× ×•×›×—×•×ª"})]})]})})]}),e.jsx("div",{className:"p-6",children:O?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"×”×™×¡×˜×•×¨×™×™×ª × ×•×›×—×•×ª"}),e.jsx("button",{onClick:()=>p(!1),className:"text-sm text-indigo-600 hover:text-indigo-700 font-medium",children:"×—×–×•×¨ ×œ×¨×™×©×•×"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:J.total}),e.jsx("div",{className:"text-xs text-gray-600",children:"×¡×”×´×›"})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:J.present}),e.jsx("div",{className:"text-xs text-gray-600",children:"× ×•×›×—"})]}),e.jsxs("div",{className:"bg-red-50 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:J.absent}),e.jsx("div",{className:"text-xs text-gray-600",children:"× ×¢×“×¨"})]})]}),M?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-3"}),e.jsx("div",{className:"text-gray-600",children:"×˜×•×¢×Ÿ ×”×™×¡×˜×•×¨×™×”..."})]}):d.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(st,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("h4",{className:"text-gray-900 font-medium mb-2",children:"××™×Ÿ ×”×™×¡×˜×•×¨×™×™×ª × ×•×›×—×•×ª"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"×”×ª×—×œ ×œ×¨×©×•× × ×•×›×—×•×ª ×›×“×™ ×œ×¨××•×ª ×”×™×¡×˜×•×¨×™×”"})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:d.map(S=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 hover:bg-gray-100 rounded-lg border border-gray-200 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${S.status==="present"?"bg-green-100":S.status==="absent"?"bg-red-100":S.status==="excused"?"bg-yellow-100":"bg-orange-100"}`,children:V(S.status)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:new Date(S.date).toLocaleDateString("he-IL",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),S.notes&&e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:S.notes})]})]}),e.jsx("div",{className:`px-3 py-1 rounded-full text-sm font-medium ${S.status==="present"?"bg-green-100 text-green-800":S.status==="absent"?"bg-red-100 text-red-800":S.status==="excused"?"bg-yellow-100 text-yellow-800":"bg-orange-100 text-orange-800"}`,children:H(S.status)})]},S._id))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"×ª××¨×™×š ×”×©×™×¢×•×¨"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>K(-7),className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",title:"×©×‘×•×¢ ×§×•×“×",children:e.jsx(at,{className:"w-5 h-5"})}),e.jsx("input",{type:"date",value:y,onChange:S=>l(S.target.value),max:new Date().toISOString().split("T")[0],className:"flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-center font-medium"}),e.jsx("button",{onClick:()=>K(7),disabled:y>=new Date().toISOString().split("T")[0],className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"×©×‘×•×¢ ×”×‘×",children:e.jsx(nt,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"text-center mt-2 text-sm text-gray-600",children:new Date(y).toLocaleDateString("he-IL",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"×¡×˜×˜×•×¡ × ×•×›×—×•×ª *"}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:["present","absent"].map(S=>e.jsxs("button",{onClick:()=>n(S),className:`flex items-center justify-center gap-3 p-5 rounded-xl border-2 transition-all transform ${a===S?W(S)+" scale-105 shadow-lg ring-2 ring-offset-2 "+(S==="present"?"ring-green-500":"ring-red-500"):"bg-white border-gray-200 hover:border-gray-300 hover:shadow-md"}`,children:[V(S),e.jsx("span",{className:"font-semibold text-lg",children:H(S)})]},S))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×”×¢×¨×•×ª (××•×¤×¦×™×•× ×œ×™)"}),e.jsx("textarea",{value:C,onChange:S=>w(S.target.value),placeholder:"×”×•×¡×£ ×”×¢×¨×•×ª ×¢×œ ×”×©×™×¢×•×¨, ×”×”×ª×§×“××•×ª ××• × ×•×©××™× ×œ×ª×¨×’×•×œ...",rows:3,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-none"})]}),A&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(Me,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-red-900",children:"×©×’×™××”"}),e.jsx("div",{className:"text-red-700 text-sm",children:A})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{onClick:k,disabled:!a||L||E,className:`flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-indigo-600 text-white rounded-lg font-semibold transition-all ${!a||L||E?"opacity-50 cursor-not-allowed":"hover:bg-indigo-700 hover:shadow-lg transform hover:scale-105"}`,children:L?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.jsx("span",{children:"×©×•××¨..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(rt,{className:"w-5 h-5"}),e.jsx("span",{children:"×©××•×¨ × ×•×›×—×•×ª"})]})}),e.jsx("button",{onClick:N,disabled:L,className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"×‘×™×˜×•×œ"})]})]})})]})})}const It=[30,45,60];function Lt({action:t}={}){const{user:b}=Ie(),[N,v]=r.useState([]),[y,l]=r.useState(!0),[a,n]=r.useState("");r.useState(!1),r.useState(null);const[C,w]=r.useState(null),[E,u]=r.useState(0);r.useState(!1);const[L,U]=r.useState({status:"all",instrument:"all",hasSchedule:"all",bagrutStatus:"all"});r.useState("cards"),r.useState(new Set),r.useState(!1);const[i,h]=r.useState(!1),[A,x]=r.useState([]),[d,j]=r.useState(!1),[O,p]=r.useState(!1),[M,c]=r.useState(!1),[I,B]=r.useState(null),[_,Y]=r.useState([]),[ne,k]=r.useState(!1),[W,V]=r.useState(null);r.useEffect(()=>{H()},[b]),r.useEffect(()=>{t==="addStudent"&&!y&&(h(!0),K())},[t,y]);const H=async(f=!0)=>{if(b?._id)try{f&&l(!0),w(null);const F=b._id,D=await R.teachers.getTeacher(F);if(!D)throw new Error("×œ× × ××¦× ×¤×¨×•×¤×™×œ ××•×¨×”");const $=D?.teaching?.studentIds||[];try{const g=await R.teacherSchedule.getTimeBlocks(F);let q=[];Array.isArray(g)?q=g:g?.data&&Array.isArray(g.data)&&(q=g.data),Y(q.filter(z=>z._id&&z._id!=="undefined"))}catch(g){console.warn("Failed to load teaching days:",g),Y([])}if($.length===0){console.log("No students assigned to teacher"),v([]),u(0);return}const G=await R.students.getBatchStudents($);if(!Array.isArray(G))throw new Error("×ª×’×•×‘×” ×œ× ×ª×§×™× ×” ××”×©×¨×ª");const se=G.filter(g=>$.includes(g._id)||$.includes(g.id));se.length!==G.length&&console.warn(`ğŸ”§ Component-level filtering: ${se.length}/${G.length} students match teacher's student IDs`);const s=se.map(g=>{const q=g.personalInfo?.fullName||"",z=q.split(" ");return{id:g._id,firstName:g.personalInfo?.firstName||z[0]||"",lastName:g.personalInfo?.lastName||z.slice(1).join(" ")||"",fullName:q,email:g.personalInfo?.email||g.contactInfo?.email||"",phone:g.personalInfo?.phone||g.contactInfo?.phone||"",instrument:g.academicInfo?.primaryInstrument||g.primaryInstrument||"",grade:g.academicInfo?.gradeLevel||"",status:g.academicInfo?.isActive!==!1?"active":"inactive",joinDate:g.createdAt,personalInfo:{fullName:q,phone:g.personalInfo?.phone||g.contactInfo?.phone,age:g.personalInfo?.age,class:g.personalInfo?.class||g.academicInfo?.class},academicInfo:{instrumentProgress:g.academicInfo?.instrumentProgress||[],isActive:g.academicInfo?.isActive!==!1},teacherAssignments:g.teacherAssignments||[],scheduleInfo:g.scheduleInfo}});v(s),u(0)}catch(F){console.error("Error loading teacher students:",F),w("×©×’×™××” ×‘×˜×¢×™× ×ª ×¨×©×™××ª ×”×ª×œ××™×“×™×. ×‘×“×•×§ ××ª ×”×—×™×‘×•×¨ ×œ××™× ×˜×¨× ×˜ ×•× ×¡×” ×©×•×‘."),u(D=>D+1)}finally{f&&l(!1)}},K=async()=>{try{j(!0);const f=await R.students.getStudents();if(!f||!Array.isArray(f)){console.error("Invalid response from getStudents"),x([]);return}const F=b?._id,$=(await R.teachers.getTeacher(F))?.teaching?.studentIds||[],G=f.filter(se=>!$.includes(se._id)&&!$.includes(se.id));x(G)}catch(f){console.error("Error loading all students:",f),x([])}finally{j(!1)}},J=N.filter(f=>{const F=a===""||`${f.firstName} ${f.lastName}`.toLowerCase().includes(a.toLowerCase())||f.instrument?.toLowerCase().includes(a.toLowerCase())||f.email?.toLowerCase().includes(a.toLowerCase()),D=L.status==="all"||f.status===L.status,$=L.instrument==="all"||f.instrument===L.instrument,G=f.scheduleInfo||f.teacherAssignments?.length>0,se=L.hasSchedule==="all"||L.hasSchedule==="yes"&&G||L.hasSchedule==="no"&&!G,s=f.academicInfo?.isBagrutStudent||f.academicInfo?.instrumentProgress?.some(q=>q.currentStage>=4),g=L.bagrutStatus==="all"||L.bagrutStatus==="yes"&&s||L.bagrutStatus==="no"&&!s;return F&&D&&$&&se&&g}),S=async f=>{const F=N.find($=>$.id===f),D=F?.personalInfo?.fullName||F?.fullName||"×”×ª×œ××™×“";if(window.confirm(`×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ${D}?

×¤×¢×•×œ×” ×–×• ×ª××—×§ ××ª ×›×œ ×”× ×ª×•× ×™× ×”×§×©×•×¨×™× ×œ×ª×œ××™×“ ×•×œ× × ×™×ª× ×ª ×œ×‘×™×˜×•×œ.`))try{await R.students.deleteStudent(f),v(G=>G.filter(se=>se.id!==f));const $=document.createElement("div");$.className="fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg z-50",$.innerHTML=`<div class="flex items-center gap-2 font-reisinger-yonatan"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>${D} × ××—×§ ×‘×”×¦×œ×—×”</div>`,document.body.appendChild($),setTimeout(()=>$.remove(),3e3)}catch($){console.error("Error deleting student:",$);const G=document.createElement("div");G.className="fixed top-4 left-1/2 transform -translate-x-1/2 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg z-50",G.innerHTML=`<div class="flex items-center gap-2 font-reisinger-yonatan"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg>×©×’×™××” ×‘××—×™×§×ª ${D}</div>`,document.body.appendChild(G),setTimeout(()=>G.remove(),5e3)}},Z=f=>{window.location.href=`/students/${f}`},ae=f=>{const F=N.find(D=>D.id===f);F&&(B(F),p(!0))},me=f=>{B(f),c(!0)},oe=f=>{const F=N.find(D=>D.id===f);F&&(V(F),k(!0))},ge=f=>{const F=N.find(D=>D.id===f);if(F){const D=prompt(`×”×•×¡×£ ×”×¢×¨×” ×¢×‘×•×¨ ${F.personalInfo?.fullName}:`);D&&D.trim()&&de(`×”×¢×¨×” × ×•×¡×¤×” ×¢×‘×•×¨ ${F.personalInfo?.fullName}`,"success")}},de=(f,F)=>{const D=document.createElement("div");D.className=`fixed top-4 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-lg shadow-lg z-50 ${F==="success"?"bg-green-500 text-white":F==="error"?"bg-red-500 text-white":"bg-blue-500 text-white"}`,D.innerHTML=`<div class="flex items-center gap-2 font-reisinger-yonatan">
      ${F==="success"?"âœ…":F==="error"?"âŒ":"â„¹ï¸"} ${f}
    </div>`,document.body.appendChild(D),setTimeout(()=>D.remove(),3e3)},o=async(f,F)=>{try{const D=b?._id,$=await R.students.getStudent(f._id),G=($.teacherAssignments||[]).findIndex(g=>g.teacherId===D),se={teacherId:D,day:F.lessonDay,time:F.lessonTime,duration:F.lessonDuration||45,location:F.lessonLocation||"",isActive:!0};let s;G>=0?(s=[...$.teacherAssignments||[]],s[G]={...s[G],...se}):s=[...$.teacherAssignments||[],se],await R.students.updateStudent(f._id,{teacherAssignments:s}),await H(),de(`${f.personalInfo?.fullName} ×”×•×§×¦×” ×‘×”×¦×œ×—×”`,"success"),h(!1)}catch(D){console.error("Error assigning student:",D),de("×©×’×™××” ×‘×”×§×¦××ª ×”×ª×œ××™×“","error")}};return y?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"×˜×•×¢×Ÿ ×¨×©×™××ª ×ª×œ××™×“×™×..."})]})}):C?e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-red-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.728-.833-2.498 0L4.316 15.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-red-800 font-semibold font-reisinger-yonatan",children:"×©×’×™××” ×‘×˜×¢×™× ×ª ×”× ×ª×•× ×™×"}),e.jsx("p",{className:"text-red-700 text-sm font-reisinger-yonatan mt-1",children:C})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>H(),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm font-reisinger-yonatan",children:"× ×¡×” ×©×•×‘"}),E>2&&e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors text-sm font-reisinger-yonatan",children:"×¨×¢× ×Ÿ ×“×£"})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-yonatan",children:"×”×ª×œ××™×“×™× ×©×œ×™"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[N.length," ×ª×œ××™×“×™× ×¨×©×•××™×"]})]}),e.jsxs("button",{onClick:()=>{h(!0),K()},className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[e.jsx(be,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"×”×•×¡×£ ×ª×œ××™×“"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Te,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"×—×™×¤×•×© ×ª×œ××™×“×™×...",value:a,onChange:f=>n(f.target.value),className:"w-full pl-4 pr-12 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"rtl"})]}),J.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(be,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2 font-reisinger-yonatan",children:a?"×œ× × ××¦××• ×ª×œ××™×“×™×":"××™×Ÿ ×ª×œ××™×“×™× ×¨×©×•××™×"}),e.jsx("p",{className:"text-gray-600 font-reisinger-yonatan",children:a?"× ×¡×” ××™×œ×•×ª ×—×™×¤×•×© ××—×¨×•×ª":"×”×ª×—×œ ×‘×”×•×¡×¤×ª ×”×ª×œ××™×“ ×”×¨××©×•×Ÿ ×©×œ×š"}),!a&&e.jsxs("button",{onClick:()=>{h(!0),K()},className:"mt-4 inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-reisinger-yonatan",children:[e.jsx(be,{className:"w-4 h-4"}),"×”×•×¡×£ ×ª×œ××™×“ ×¨××©×•×Ÿ"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-900 font-reisinger-yonatan",children:"×¡×”×´×› ×ª×œ××™×“×™×"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-900 mt-1",children:N.length})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"font-medium text-green-900 font-reisinger-yonatan",children:"×¤×¢×™×œ×™×"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-900 mt-1",children:N.filter(f=>f.status==="active").length})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"font-medium text-purple-900 font-reisinger-yonatan",children:"×¢× ×©×™×¢×•×¨×™×"})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-900 mt-1",children:N.filter(f=>f.scheduleInfo||f.teacherAssignments?.length>0).length})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:J.map(f=>e.jsx(Ct,{student:f,onEdit:F=>{alert("×¢×¨×™×›×ª ×ª×œ××™×“ ×–××™× ×” ×¨×§ ×œ×× ×”×œ×™×")},onDelete:S,onViewDetails:Z,onScheduleLesson:ae,onUpdateLesson:me,onMarkAttendance:oe,onAddNote:ge},f.id))})]}),i&&e.jsx(Dt,{allStudents:A,loading:d,onClose:()=>{h(!1),x([])},onSubmit:o}),O&&I&&e.jsx($t,{student:I,teacherId:b?._id||"",teachingDays:_,onClose:()=>{p(!1),B(null)},onSave:()=>{p(!1),B(null),H(!1)},showNotification:de}),M&&I&&e.jsx(Mt,{student:I,teacherId:b?._id||"",teachingDays:_,onClose:()=>{c(!1),B(null)},onSave:()=>{c(!1),B(null),H(!1)},showNotification:de}),ne&&W&&e.jsx(kt,{student:W,teacherId:b?._id||"",onClose:()=>{k(!1),V(null)},onSave:()=>{H(!1)}})]})}function Dt({allStudents:t,loading:b,onClose:N,onSubmit:v}){const{user:y}=Ie(),[l,a]=r.useState(""),[n,C]=r.useState(null),[w,E]=r.useState({lessonDay:"",lessonTime:"",lessonDuration:45,lessonLocation:"",instrument:""}),[u,L]=r.useState(!1),[U,i]=r.useState([]),[h,A]=r.useState(!1),[x,d]=r.useState(null),j=t.filter(c=>{const I=l.toLowerCase().trim();if(!I)return!0;const B=c.personalInfo?.fullName||`${c.personalInfo?.firstName||""} ${c.personalInfo?.lastName||""}`.trim(),_=c.personalInfo?.class||c.academicInfo?.class||"",Y=[c.academicInfo?.primaryInstrument,...c.academicInfo?.instrumentProgress?.map(W=>W.instrumentName)||[]].filter(Boolean).join(" "),ne=`${B} ${_} ${Y}`.toLowerCase();return I.split(/\s+/).filter(W=>W.length>0).every(W=>ne.includes(W))});r.useEffect(()=>{n&&y?._id&&O()},[n,y?._id]);const O=async()=>{if(y?._id){A(!0);try{const c=await R.teachers.getTeacher(y._id);console.log("Teacher data for slots:",c);const I=c.teaching?.timeBlocks?.filter(_=>_.isActive!==!1)||[];console.log("Time blocks found:",I);const B=[];I.forEach(_=>{const Y=_.startTime,ne=_.endTime,k=_.day,[W,V]=Y.split(":").map(Number),[H,K]=ne.split(":").map(Number),J=W*60+V,Z=H*60+K-J;It.forEach(ae=>{const me=Math.floor(Z/ae);for(let oe=0;oe<me;oe++){const ge=J+oe*ae,de=ge+ae,o=Math.floor(ge/60),f=ge%60,F=Math.floor(de/60),D=de%60,$=`${o.toString().padStart(2,"0")}:${f.toString().padStart(2,"0")}`,G=`${F.toString().padStart(2,"0")}:${D.toString().padStart(2,"0")}`;c.teaching?.timeBlocks?.some(s=>s.day===k&&(s.assignedLessons||[]).some(g=>g.startTime===$&&g.duration===ae&&g.isActive!==!1))||!1||B.push({_id:`${_._id||_.day}-${ae}-${oe}`,day:k,startTime:$,endTime:G,duration:ae,isAvailable:!0,location:_.location,teacherName:c.personalInfo?.fullName,teacherId:c._id,instrument:c.professionalInfo?.instrument||c.teaching?.instrument})}})}),console.log("Generated available slots:",B),i(B)}catch(c){console.error("Error fetching teacher slots:",c),i([])}finally{A(!1)}}},p=c=>{d(c),E({lessonDay:c.day,lessonTime:c.startTime,lessonDuration:c.duration,lessonLocation:c.location||"",instrument:c.instrument||""})},M=async c=>{if(c.preventDefault(),!n){alert("×× × ×‘×—×¨ ×ª×œ××™×“");return}if(!x){alert("×× × ×‘×—×¨ ×–××Ÿ ×©×™×¢×•×¨");return}L(!0);try{await v(n,w)}catch(I){console.error("Error submitting assignment:",I)}finally{L(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto flex flex-col",dir:"rtl",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:"×”×•×¡×£ ×ª×œ××™×“"}),b?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"}),e.jsx("span",{className:"mr-3 text-gray-600",children:"×˜×•×¢×Ÿ ×¨×©×™××ª ×ª×œ××™×“×™×..."})]}):e.jsxs("form",{onSubmit:M,className:"flex flex-col flex-1 overflow-hidden",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"×—×¤×© ×ª×œ××™×“ ×‘××¢×¨×›×ª"}),e.jsxs("div",{className:"relative",children:[e.jsx(Te,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"×—×¤×© ×œ×¤×™ ×©×, ×›×™×ª×” ××• ×›×œ×™ × ×’×™× ×”...",value:l,onChange:c=>a(c.target.value),className:"w-full pl-4 pr-12 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"rtl"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto mb-4 border border-gray-200 rounded-lg",children:j.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:l?"×œ× × ××¦××• ×ª×œ××™×“×™× ×”×ª×•×××™× ××ª ×”×—×™×¤×•×©":"××™×Ÿ ×ª×œ××™×“×™× ×–××™× ×™× ×œ×”×§×¦××”"}):e.jsx("div",{className:"divide-y divide-gray-200",children:j.map(c=>{const I=c.personalInfo?.fullName||`${c.personalInfo?.firstName||""} ${c.personalInfo?.lastName||""}`.trim(),B=c.personalInfo?.class||c.academicInfo?.class||"",_=c.academicInfo?.primaryInstrument||"",Y=n?._id===c._id;return e.jsx("div",{onClick:()=>C(c),className:`p-3 cursor-pointer transition-colors ${Y?"bg-indigo-50 border-r-4 border-indigo-600":"hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:I}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[B&&e.jsxs("span",{children:["×›×™×ª×” ",B]}),_&&e.jsxs(e.Fragment,{children:[B&&" â€¢ ",e.jsx("span",{children:_})]})]})]}),Y&&e.jsx("div",{className:"w-6 h-6 bg-indigo-600 rounded-full flex items-center justify-center",children:e.jsx(Oe,{className:"w-4 h-4 text-white"})})]})},c._id)})})}),n&&e.jsxs("div",{className:"space-y-4 border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:["×‘×—×¨ ×–××Ÿ ×©×™×¢×•×¨ ×¢×‘×•×¨ ",n.personalInfo?.fullName]}),x&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600 bg-green-50 px-3 py-1 rounded-lg",children:[e.jsx(Oe,{className:"w-4 h-4"}),e.jsxs("span",{children:["× ×‘×—×¨: ",x.day," ",x.startTime]})]})]}),h?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"}),e.jsx("span",{className:"mr-3 text-gray-600",children:"×˜×•×¢×Ÿ ×–×× ×™× ×¤× ×•×™×™×..."})]}):U.length>0?e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"×‘×—×¨ ×–××Ÿ ×•××©×š ×©×™×¢×•×¨ ××”××¤×©×¨×•×™×•×ª ×”×–××™× ×•×ª:"}),(()=>{const c=U.reduce((I,B)=>(I[B.day]||(I[B.day]=[]),I[B.day].push(B),I),{});return Object.entries(c).map(([I,B])=>e.jsxs("div",{className:"mb-4",children:[e.jsxs("h5",{className:"text-sm font-medium text-gray-600 mb-2 flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4"}),"×™×•× ",I]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 pr-1",children:B.sort((_,Y)=>_.startTime.localeCompare(Y.startTime)).map(_=>{const Y=x?._id===_._id;return e.jsx("button",{type:"button",onClick:()=>p(_),className:`p-3 border rounded-lg transition-all text-right ${Y?"border-indigo-600 bg-indigo-50 ring-2 ring-indigo-600":_.duration===30?"border-green-300 bg-green-50 hover:border-green-500 hover:bg-green-100":_.duration===45?"border-blue-300 bg-blue-50 hover:border-blue-500 hover:bg-blue-100":"border-purple-300 bg-purple-50 hover:border-purple-500 hover:bg-purple-100"}`,children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(pe,{className:"w-3 h-3"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[_.startTime,"-",_.endTime]})]}),e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${_.duration===30?"bg-green-100 text-green-800":_.duration===45?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"}`,children:[_.duration," ×“×§×³"]})]}),_.location&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(ke,{className:"w-3 h-3"}),_.location]}),_.instrument&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-600",children:[e.jsx(Ce,{className:"w-3 h-3"}),_.instrument]}),Y&&e.jsx("div",{className:"flex justify-center mt-2",children:e.jsx(Oe,{className:"w-5 h-5 text-indigo-600"})})]})},_._id)})})]},I))})()]}):e.jsxs("div",{className:"text-center py-6 bg-gray-50 rounded-lg",children:[e.jsx(pe,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-gray-500 text-sm mb-2",children:"××™×Ÿ ×–×× ×™× ×¤× ×•×™×™×"}),e.jsx("p",{className:"text-xs text-gray-400",children:"×™×™×ª×›×Ÿ ×©×›×œ ×”×–×× ×™× ×”×¤× ×•×™×™× ×›×‘×¨ ×ª×¤×•×¡×™× ××• ×©×œ× ×”×•×’×“×¨×• ×–×× ×™ ×”×•×¨××”"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6 pt-4 border-t",children:[e.jsx("button",{type:"submit",disabled:!n||!x||u,className:"flex-1 bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 font-reisinger-yonatan flex items-center justify-center gap-2",children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"××§×¦×”..."]}):e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"w-4 h-4"}),"×”×•×¡×£ ×ª×œ××™×“"]})}),e.jsxs("button",{type:"button",onClick:N,disabled:u,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 font-reisinger-yonatan flex items-center justify-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4"}),"×‘×™×˜×•×œ"]})]})]})]})})}function $t({student:t,teacherId:b,teachingDays:N,onClose:v,onSave:y,showNotification:l}){const[a,n]=r.useState({day:"",startTime:"",endTime:"",duration:45,location:"",notes:""}),[C,w]=r.useState(!1),E=["×¨××©×•×Ÿ","×©× ×™","×©×œ×™×©×™","×¨×‘×™×¢×™","×—××™×©×™","×©×™×©×™"],u=[30,45,60],L=i=>{if(!a.startTime)return;const[h,A]=a.startTime.split(":").map(Number),x=h*60+A+i,d=Math.floor(x/60),j=x%60;n(O=>({...O,duration:i,endTime:`${String(d).padStart(2,"0")}:${String(j).padStart(2,"0")}`}))},U=async i=>{if(i.preventDefault(),!a.day||!a.startTime||!a.endTime){l("×™×© ×œ××œ× ××ª ×›×œ ×”×©×“×•×ª ×”× ×“×¨×©×™×","error");return}try{w(!0);const h={day:a.day,startTime:a.startTime,endTime:a.endTime,location:a.location||"×—×“×¨ ××•×–×™×§×”",duration:a.duration,notes:a.notes,studentId:t.id,studentName:t.personalInfo?.fullName||t.fullName,teacherId:b,recurring:{isRecurring:!0,excludeDates:[]}};await R.teacherSchedule.createTimeBlock(b,h),l("×”×©×™×¢×•×¨ ×”×§×‘×•×¢ × ×•×¦×¨ ×‘×”×¦×œ×—×”","success"),y()}catch(h){console.error("Error creating lesson:",h),l(h.message||"×©×’×™××” ×‘×™×¦×™×¨×ª ×”×©×™×¢×•×¨","error")}finally{w(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",dir:"rtl",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:["×ª×–××Ÿ ×©×™×¢×•×¨ ×§×‘×•×¢ - ",t.personalInfo?.fullName||t.fullName]}),e.jsxs("form",{onSubmit:U,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"×™×•×"}),e.jsxs("select",{value:a.day,onChange:i=>n(h=>({...h,day:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent font-reisinger-yonatan",required:!0,children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×™×•×"}),E.map(i=>e.jsx("option",{value:i,children:i},i))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"×©×¢×ª ×”×ª×—×œ×”"}),e.jsx("input",{type:"time",value:a.startTime,onChange:i=>{n(h=>({...h,startTime:i.target.value})),a.duration&&L(a.duration)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"××©×š (×“×§×•×ª)"}),e.jsx("select",{value:a.duration,onChange:i=>L(Number(i.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent font-reisinger-yonatan",children:u.map(i=>e.jsxs("option",{value:i,children:[i," ×“×§'"]},i))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"××™×§×•×"}),e.jsxs("select",{value:a.location,onChange:i=>n(h=>({...h,location:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent font-reisinger-yonatan",children:[e.jsx("option",{value:"",children:"×‘×—×¨ ××™×§×•×"}),He.map(i=>e.jsx("option",{value:i,children:i},i))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"×”×¢×¨×•×ª"}),e.jsx("textarea",{value:a.notes,onChange:i=>n(h=>({...h,notes:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent font-reisinger-yonatan",rows:3,placeholder:"×”×¢×¨×•×ª × ×•×¡×¤×•×ª..."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",disabled:C,className:"flex-1 bg-indigo-600 text-white py-2.5 px-4 rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 font-reisinger-yonatan font-medium",children:C?"×©×•××¨...":"×©××•×¨"}),e.jsx("button",{type:"button",onClick:v,disabled:C,className:"flex-1 bg-gray-200 text-gray-700 py-2.5 px-4 rounded-lg hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 font-reisinger-yonatan font-medium",children:"×‘×™×˜×•×œ"})]})]})]})})}function Mt({student:t,teacherId:b,teachingDays:N,onClose:v,onSave:y,showNotification:l}){const a=t.scheduleInfo||t.teacherAssignments?.[0],[n,C]=r.useState({day:a?.day||"",startTime:a?.startTime||a?.time||"",duration:a?.duration||45,endTime:a?.endTime||"",location:"",notes:""}),[w,E]=r.useState(!1),[u,L]=r.useState(null),U=["×¨××©×•×Ÿ","×©× ×™","×©×œ×™×©×™","×¨×‘×™×¢×™","×—××™×©×™","×©×™×©×™"],i=[30,45,60];r.useEffect(()=>{h()},[]);const h=async()=>{try{const d=await R.teacherSchedule.getTimeBlocks(b);let j=[];Array.isArray(d)?j=d:d?.data&&Array.isArray(d.data)&&(j=d.data);const O=j.find(p=>p.studentId===t.id);O&&(L(O._id),C({day:O.day,startTime:O.startTime,endTime:O.endTime,duration:O.duration||45,location:O.location||"",notes:O.notes||""}))}catch(d){console.error("Error loading time block:",d)}},A=d=>{if(!n.startTime)return;const[j,O]=n.startTime.split(":").map(Number),p=j*60+O+d,M=Math.floor(p/60),c=p%60;C(I=>({...I,duration:d,endTime:`${String(M).padStart(2,"0")}:${String(c).padStart(2,"0")}`}))},x=async d=>{if(d.preventDefault(),!u){l("×œ× × ××¦× ×©×™×¢×•×¨ ×§×‘×•×¢ ×œ×¢×“×›×•×Ÿ","error");return}if(!n.day||!n.startTime||!n.endTime){l("×™×© ×œ××œ× ××ª ×›×œ ×”×©×“×•×ª ×”× ×“×¨×©×™×","error");return}try{E(!0);const j={day:n.day,startTime:n.startTime,endTime:n.endTime,location:n.location||"×—×“×¨ ××•×–×™×§×”",duration:n.duration,notes:n.notes};await R.teacherSchedule.updateTimeBlock(b,u,j),l("×”×©×™×¢×•×¨ ×”×§×‘×•×¢ ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”","success"),y()}catch(j){console.error("Error updating lesson:",j),l(j.message||"×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”×©×™×¢×•×¨","error")}finally{E(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",dir:"rtl",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:["×¢×“×›×Ÿ ×©×™×¢×•×¨ ×§×‘×•×¢ - ",t.personalInfo?.fullName||t.fullName]}),e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"×™×•×"}),e.jsxs("select",{value:n.day,onChange:d=>C(j=>({...j,day:d.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent font-reisinger-yonatan",required:!0,children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×™×•×"}),U.map(d=>e.jsx("option",{value:d,children:d},d))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"×©×¢×ª ×”×ª×—×œ×”"}),e.jsx("input",{type:"time",value:n.startTime,onChange:d=>{C(j=>({...j,startTime:d.target.value})),n.duration&&A(n.duration)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"××©×š (×“×§×•×ª)"}),e.jsx("select",{value:n.duration,onChange:d=>A(Number(d.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent font-reisinger-yonatan",children:i.map(d=>e.jsxs("option",{value:d,children:[d," ×“×§'"]},d))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"××™×§×•×"}),e.jsxs("select",{value:n.location,onChange:d=>C(j=>({...j,location:d.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent font-reisinger-yonatan",children:[e.jsx("option",{value:"",children:"×‘×—×¨ ××™×§×•×"}),He.map(d=>e.jsx("option",{value:d,children:d},d))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"×”×¢×¨×•×ª"}),e.jsx("textarea",{value:n.notes,onChange:d=>C(j=>({...j,notes:d.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent font-reisinger-yonatan",rows:3,placeholder:"×”×¢×¨×•×ª × ×•×¡×¤×•×ª..."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",disabled:w,className:"flex-1 bg-indigo-600 text-white py-2.5 px-4 rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 font-reisinger-yonatan font-medium",children:w?"××¢×“×›×Ÿ...":"×¢×“×›×Ÿ"}),e.jsx("button",{type:"button",onClick:v,disabled:w,className:"flex-1 bg-gray-200 text-gray-700 py-2.5 px-4 rounded-lg hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 font-reisinger-yonatan font-medium",children:"×‘×™×˜×•×œ"})]})]})]})})}function At({isOpen:t,onClose:b,orchestraId:N,orchestraName:v,onSave:y}){const[l,a]=r.useState({date:"",startTime:"19:00",endTime:"21:00",location:"××•×œ× ××•×–×™×§×”",notes:"",recurring:!1,recurrencePattern:"weekly",endRecurrence:""}),[n,C]=r.useState({}),[w,E]=r.useState(!1);r.useEffect(()=>{if(t){const i=new Date;i.setDate(i.getDate()+1),a(h=>({...h,date:i.toISOString().split("T")[0]}))}},[t]);const u=()=>{const i={};if(!l.date)i.date="×™×© ×œ×‘×—×•×¨ ×ª××¨×™×š";else{const h=new Date(l.date),A=new Date;A.setHours(0,0,0,0),h<A&&(i.date="×œ× × ×™×ª×Ÿ ×œ×§×‘×•×¢ ×—×–×¨×” ×‘×¢×‘×¨")}if(l.startTime||(i.startTime="×™×© ×œ×‘×—×•×¨ ×©×¢×ª ×”×ª×—×œ×”"),l.endTime||(i.endTime="×™×© ×œ×‘×—×•×¨ ×©×¢×ª ×¡×™×•×"),l.startTime&&l.endTime){const h=new Date(`2000-01-01T${l.startTime}`);new Date(`2000-01-01T${l.endTime}`)<=h&&(i.endTime="×©×¢×ª ×”×¡×™×•× ×—×™×™×‘×ª ×œ×”×™×•×ª ××—×¨×™ ×©×¢×ª ×”×”×ª×—×œ×”")}return l.location.trim()||(i.location="×™×© ×œ×¦×™×™×Ÿ ××§×•×"),l.recurring&&!l.endRecurrence&&(i.endRecurrence="×™×© ×œ×¦×™×™×Ÿ ×ª××¨×™×š ×¡×™×•× ×œ×—×–×¨×•×ª ×§×‘×•×¢×•×ª"),C(i),Object.keys(i).length===0},L=async i=>{if(i.preventDefault(),!!u()){E(!0);try{await y(l),b(),a({date:"",startTime:"19:00",endTime:"21:00",location:"××•×œ× ××•×–×™×§×”",notes:"",recurring:!1,recurrencePattern:"weekly",endRecurrence:""})}catch(h){console.error("Error saving rehearsal:",h)}finally{E(!1)}}},U=()=>{if(!l.startTime||!l.endTime)return"";const i=new Date(`2000-01-01T${l.startTime}`),A=(new Date(`2000-01-01T${l.endTime}`).getTime()-i.getTime())/(1e3*60);if(A<=0)return"";const x=Math.floor(A/60),d=A%60;return x===0?`${d} ×“×§×•×ª`:d===0?`${x} ×©×¢×•×ª`:`${x} ×©×¢×•×ª ×•-${d} ×“×§×•×ª`};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×§×‘×™×¢×ª ×—×–×¨×” ×—×“×©×”"}),e.jsx("button",{onClick:b,className:"p-1 text-gray-400 hover:text-gray-600 rounded",children:e.jsx(ve,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-blue-800",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsxs("span",{className:"font-medium font-reisinger-yonatan",children:["×ª×–××•×¨×ª: ",v]})]})}),e.jsxs("form",{onSubmit:L,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×ª××¨×™×š ×”×—×–×¨×” *"}),e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"date",required:!0,value:l.date,onChange:i=>a(h=>({...h,date:i.target.value})),className:`w-full pl-3 pr-10 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 ${n.date?"border-red-300":"border-gray-300"}`})]}),n.date&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-reisinger-yonatan",children:n.date})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×©×¢×ª ×”×ª×—×œ×” *"}),e.jsxs("div",{className:"relative",children:[e.jsx(pe,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"time",required:!0,value:l.startTime,onChange:i=>a(h=>({...h,startTime:i.target.value})),className:`w-full pl-3 pr-10 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 ${n.startTime?"border-red-300":"border-gray-300"}`})]}),n.startTime&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-reisinger-yonatan",children:n.startTime})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×©×¢×ª ×¡×™×•× *"}),e.jsxs("div",{className:"relative",children:[e.jsx(pe,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"time",required:!0,value:l.endTime,onChange:i=>a(h=>({...h,endTime:i.target.value})),className:`w-full pl-3 pr-10 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 ${n.endTime?"border-red-300":"border-gray-300"}`})]}),n.endTime&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-reisinger-yonatan",children:n.endTime})]})]}),U()&&e.jsxs("div",{className:"text-sm text-gray-600 bg-gray-50 p-2 rounded font-reisinger-yonatan",children:["××©×š ×”×—×–×¨×”: ",U()]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"××§×•× ×”×—×–×¨×” *"}),e.jsxs("div",{className:"relative",children:[e.jsx(ke,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",required:!0,value:l.location,onChange:i=>a(h=>({...h,location:i.target.value})),className:`w-full pl-3 pr-10 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 ${n.location?"border-red-300":"border-gray-300"}`,placeholder:"×œ××©×œ: ××•×œ× ××•×–×™×§×”, ×—×“×¨ 101"})]}),n.location&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-reisinger-yonatan",children:n.location})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×”×¢×¨×•×ª"}),e.jsx("textarea",{value:l.notes,onChange:i=>a(h=>({...h,notes:i.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",placeholder:"×”×¢×¨×•×ª × ×•×¡×¤×•×ª ×¢×œ ×”×—×–×¨×” (××•×¤×¦×™×•× ×œ×™)"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"recurring",type:"checkbox",checked:l.recurring,onChange:i=>a(h=>({...h,recurring:i.target.checked})),className:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),e.jsx("label",{htmlFor:"recurring",className:"mr-2 text-sm text-gray-700 font-reisinger-yonatan",children:"×—×–×¨×” ×§×‘×•×¢×” (×—×•×–×¨×ª)"})]}),l.recurring&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×ª×“×™×¨×•×ª"}),e.jsxs("select",{value:l.recurrencePattern,onChange:i=>a(h=>({...h,recurrencePattern:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"weekly",children:"×©×‘×•×¢×™"}),e.jsx("option",{value:"biweekly",children:"×“×•-×©×‘×•×¢×™"}),e.jsx("option",{value:"monthly",children:"×—×•×“×©×™"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×ª××¨×™×š ×¡×™×•× ×”×—×–×¨×•×ª ×”×§×‘×•×¢×•×ª *"}),e.jsx("input",{type:"date",required:l.recurring,value:l.endRecurrence,onChange:i=>a(h=>({...h,endRecurrence:i.target.value})),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 ${n.endRecurrence?"border-red-300":"border-gray-300"}`}),n.endRecurrence&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-reisinger-yonatan",children:n.endRecurrence})]}),e.jsxs("div",{className:"text-xs text-amber-600 bg-amber-50 p-2 rounded flex items-start gap-2",children:[e.jsx(Me,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"×—×–×¨×•×ª ×§×‘×•×¢×•×ª ×™×™×•×•×¦×¨×• ××•×˜×•××˜×™×ª ×¢×“ ×”×ª××¨×™×š ×©×¦×•×™×Ÿ"})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",disabled:w,className:"flex-1 bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 disabled:opacity-50 transition-colors font-reisinger-yonatan",children:w?"×§×•×‘×¢ ×—×–×¨×”...":"×§×‘×¢ ×—×–×¨×”"}),e.jsx("button",{type:"button",onClick:b,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors font-reisinger-yonatan",children:"×‘×™×˜×•×œ"})]})]})]})}):null}function Et(){const{user:t}=Ie(),[b,N]=r.useState([]),[v,y]=r.useState(!0),[l,a]=r.useState(""),[n,C]=r.useState(!1),[w,E]=r.useState(null),[u,L]=r.useState(null),[U,i]=r.useState([]),[h,A]=r.useState(null),[x,d]=r.useState("members");r.useState(!1);const[j,O]=r.useState(!1),[p,M]=r.useState([]),[c,I]=r.useState([]),[B,_]=r.useState(""),[Y,ne]=r.useState(""),[k,W]=r.useState(!1),[V,H]=r.useState(null),[K,J]=r.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}});r.useEffect(()=>{S()},[t]),r.useEffect(()=>{u&&x==="enrollment"&&ae()},[u,x]);const S=async()=>{if(t?._id)try{y(!0);const s=t._id,g=await R.teachers.getTeacher(s);if(!g)throw new Error("×œ× × ××¦× ×¤×¨×•×¤×™×œ ×× ×¦×—");const q=g?.conducting?.orchestraIds||[];if(q.length===0){console.log("No orchestras assigned to conductor"),N([]);return}const z=await R.orchestras.getBatchOrchestras(q);if(!Array.isArray(z))throw new Error("×ª×’×•×‘×” ×œ× ×ª×§×™× ×” ××”×©×¨×ª");const ee=z.map(X=>({id:X._id,name:X.name,description:X.description,type:X.type,level:X.level,memberCount:X.memberCount||0,status:X.status||"active",rehearsalDay:X.rehearsalSchedule?.day,rehearsalTime:X.rehearsalSchedule?.time,venue:X.venue}));N(ee)}catch(s){console.error("Error loading conductor orchestras:",s),A("×©×’×™××” ×‘×˜×¢×™× ×ª ×¨×©×™××ª ×”×ª×–××•×¨×•×ª")}finally{y(!1)}},Z=async s=>{try{const z=((await R.orchestras.getOrchestra(s)).memberDetails||[]).map(ee=>{const X=ee.personalInfo?.fullName||"",we=X.trim().split(/\s+/),m=we[0]||"",T=we.slice(1).join(" ")||"",P=ee.academicInfo?.instrumentProgress?.find(ie=>ie.isPrimary),re=P?.instrumentName||ee.primaryInstrument||"×œ× ×¦×•×™×Ÿ",xe=P?.currentStage||0;return{id:ee._id,fullName:X,firstName:m,lastName:T,instrument:re,currentStage:xe,section:ee.section||"×›×œ×œ×™",status:ee.status||"active",enrollmentDate:ee.enrollmentDate||new Date().toISOString(),performanceLevel:ee.performanceLevel||"intermediate",attendanceRate:ee.attendanceRate||null}});i(z)}catch(g){console.error("Error loading orchestra members:",g)}},ae=async()=>{if(u)try{W(!0),console.log("ğŸ” Loading available students for orchestra:",u);const s=await R.students.getStudents({status:"active",limit:500});console.log("ğŸ“‹ Raw API response:",s);let g=[];Array.isArray(s)?g=s:s&&Array.isArray(s.data)?g=s.data:s&&s.students&&Array.isArray(s.students)?g=s.students:(console.error("âŒ Unexpected response structure:",s),g=[]),console.log("ğŸ“‹ Total active students fetched:",g.length);const z=(await R.orchestras.getOrchestra(u)).memberIds||[];console.log("ğŸ‘¥ Current orchestra members:",z.length);const ee=g.filter(X=>!z.includes(X._id)&&X.isActive!==!1);console.log("âœ… Available students for enrollment:",ee.length),M(ee)}catch(s){console.error("âŒ Error loading available students:",s),M([])}finally{W(!1)}},me=async s=>{try{const q=(await R.rehearsals.getRehearsals({groupId:s,limit:20})).map(z=>{const ee=z.scheduledDate||z.date||z.rehearsalDate;let X="×ª××¨×™×š ×œ× ×–××™×Ÿ";if(ee)try{const we=new Date(ee);isNaN(we.getTime())||(X=we.toLocaleDateString("he-IL",{year:"numeric",month:"2-digit",day:"2-digit"}))}catch{console.warn("Failed to parse rehearsal date:",ee)}return{id:z._id,date:X,time:z.startTime||"19:00",location:z.location||"××•×œ× ××•×–×™×§×”",duration:z.duration||120,status:z.status||"scheduled",attendanceCount:z.attendanceList?.length||0,totalMembers:U.length}});I(q)}catch(g){console.error("Error loading orchestra rehearsals:",g),I([])}},oe=async s=>{if(u)try{await R.orchestras.addMember(u,s);try{const g=await R.students.getStudent(s),q=g?.enrollments?.orchestraIds||[];q.includes(u)||(await R.students.updateStudent(s,{enrollments:{...g?.enrollments,orchestraIds:[...q,u]}}),console.log(`âœ… Updated student ${s} orchestraIds with ${u}`))}catch(g){console.error("Error syncing student orchestraIds:",g)}await Z(u),await ae(),H({type:"success",message:"×”×ª×œ××™×“ × ×•×¡×£ ×‘×”×¦×œ×—×” ×œ×ª×–××•×¨×ª"}),setTimeout(()=>H(null),3e3)}catch(g){console.error("Error adding member:",g),H({type:"error",message:"×©×’×™××” ×‘×”×•×¡×¤×ª ×”×ª×œ××™×“ ×œ×ª×–××•×¨×ª"}),setTimeout(()=>H(null),3e3)}},ge=async s=>{u&&J({isOpen:!0,title:"×”×¡×¨×ª ×ª×œ××™×“ ××”×ª×–××•×¨×ª",message:"×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×”×¡×™×¨ ××ª ×”×ª×œ××™×“ ××”×ª×–××•×¨×ª?",onConfirm:async()=>{J({...K,isOpen:!1});try{await R.orchestras.removeMember(u,s);try{const g=await R.students.getStudent(s),q=g?.enrollments?.orchestraIds||[],z=q.filter(ee=>ee!==u);z.length!==q.length&&(await R.students.updateStudent(s,{enrollments:{...g?.enrollments,orchestraIds:z}}),console.log(`âœ… Removed orchestraId ${u} from student ${s} enrollments`))}catch(g){console.error("Error syncing student orchestraIds on remove:",g)}await Z(u),await ae(),H({type:"success",message:"×”×ª×œ××™×“ ×”×•×¡×¨ ×‘×”×¦×œ×—×” ××”×ª×–××•×¨×ª"}),setTimeout(()=>H(null),3e3)}catch(g){console.error("Error removing member:",g),H({type:"error",message:"×©×’×™××” ×‘×”×¡×¨×ª ×”×ª×œ××™×“ ××”×ª×–××•×¨×ª"}),setTimeout(()=>H(null),3e3)}}})},de=async s=>{if(u)try{const g={groupId:u,groupType:"orchestra",scheduledDate:new Date(s.date).toISOString(),startTime:s.startTime,endTime:s.endTime,duration:o(s.startTime,s.endTime),location:s.location,notes:s.notes,status:"scheduled"};if(s.recurring){const q=f(g,s);await Promise.all(q.map(z=>R.rehearsals.createRehearsal(z))),H({type:"success",message:`${q.length} ×—×–×¨×•×ª × ×•×¦×¨×• ×‘×”×¦×œ×—×”`})}else await R.rehearsals.createRehearsal(g),H({type:"success",message:"×—×–×¨×” × ×•×¦×¨×” ×‘×”×¦×œ×—×”"});await me(u),O(!1),setTimeout(()=>H(null),3e3)}catch(g){console.error("Error scheduling rehearsal:",g),H({type:"error",message:"×©×’×™××” ×‘×™×¦×™×¨×ª ×”×—×–×¨×”"}),setTimeout(()=>H(null),3e3)}},o=(s,g)=>{const q=new Date(`2000-01-01T${s}`),z=new Date(`2000-01-01T${g}`);return Math.round((z.getTime()-q.getTime())/(1e3*60))},f=(s,g)=>{const q=[],z=new Date(g.date),ee=new Date(g.endRecurrence);let X=new Date(z);for(;X<=ee;)switch(q.push({...s,scheduledDate:new Date(X).toISOString()}),g.recurrencePattern){case"weekly":X.setDate(X.getDate()+7);break;case"biweekly":X.setDate(X.getDate()+14);break;case"monthly":X.setMonth(X.getMonth()+1);break}return q},F=b.filter(s=>l===""||s.name.toLowerCase().includes(l.toLowerCase())||s.type.toLowerCase().includes(l.toLowerCase())||s.description?.toLowerCase().includes(l.toLowerCase())),D=async s=>{J({isOpen:!0,title:"××—×™×§×ª ×ª×–××•×¨×ª",message:"×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ×ª×–××•×¨×ª ×–×•? ×¤×¢×•×œ×” ×–×• ××™× ×” × ×™×ª× ×ª ×œ×‘×™×˜×•×œ.",onConfirm:async()=>{J({...K,isOpen:!1});try{await R.orchestras.deleteOrchestra(s),N(g=>g.filter(q=>q.id!==s)),u===s&&(L(null),i([])),H({type:"success",message:"×”×ª×–××•×¨×ª × ××—×§×” ×‘×”×¦×œ×—×”"}),setTimeout(()=>H(null),3e3)}catch(g){console.error("Error deleting orchestra:",g),H({type:"error",message:"×©×’×™××” ×‘××—×™×§×ª ×”×ª×–××•×¨×ª"}),setTimeout(()=>H(null),3e3)}}})},$=async s=>{try{if(w){const g={name:s.name,description:s.description,type:s.type,level:s.level,status:s.status,rehearsalSchedule:{day:s.rehearsalDay,time:s.rehearsalTime},venue:s.venue},q=await R.orchestras.updateOrchestra(w.id,g),z={id:q._id,name:q.name,description:q.description,type:q.type,level:q.level,memberCount:q.memberCount||0,status:q.status||"active",rehearsalDay:q.rehearsalSchedule?.day,rehearsalTime:q.rehearsalSchedule?.time,venue:q.venue};N(ee=>ee.map(X=>X.id===w.id?z:X))}else{const g=t?._id,q={name:s.name,description:s.description,type:s.type,level:s.level,status:s.status,rehearsalSchedule:{day:s.rehearsalDay,time:s.rehearsalTime},venue:s.venue,conductorId:g},z=await R.orchestras.createOrchestra(q),ee={id:z._id,name:z.name,description:z.description,type:z.type,level:z.level,memberCount:z.memberCount||0,status:z.status||"active",rehearsalDay:z.rehearsalSchedule?.day,rehearsalTime:z.rehearsalSchedule?.time,venue:z.venue};N(X=>[...X,ee])}C(!1),E(null),H({type:"success",message:w?"×”×ª×–××•×¨×ª ×¢×•×“×›× ×” ×‘×”×¦×œ×—×”":"×”×ª×–××•×¨×ª × ×•×¦×¨×” ×‘×”×¦×œ×—×”"}),setTimeout(()=>H(null),3e3)}catch(g){console.error("Error saving orchestra:",g),H({type:"error",message:"×©×’×™××” ×‘×©××™×¨×ª ×¤×¨×˜×™ ×”×ª×–××•×¨×ª"}),setTimeout(()=>H(null),3e3)}},G=s=>{switch(s){case"youth":return"×ª×–××•×¨×ª × ×•×¢×¨";case"adult":return"×ª×–××•×¨×ª ××‘×•×’×¨×™×";case"chamber":return"×ª×–××•×¨×ª ×§×××¨×™×ª";case"symphony":return"×ª×–××•×¨×ª ×¡×™××¤×•× ×™×ª";default:return s}},se=s=>{switch(s){case"beginner":return"××ª×—×™×œ×™×";case"intermediate":return"×‘×™× ×•× ×™×™×";case"advanced":return"××ª×§×“××™×";default:return s}};return v?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"×˜×•×¢×Ÿ ×¨×©×™××ª ×ª×–××•×¨×•×ª..."})]})}):h?e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("div",{className:"text-red-800 font-reisinger-yonatan",children:h})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-yonatan",children:"×ª×–××•×¨×•×ª ×©×× ×™ ×× ×¦×—"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[b.length," ×ª×–××•×¨×•×ª"]})]}),e.jsxs("button",{onClick:()=>C(!0),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[e.jsx($e,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"×”×•×¡×£ ×ª×–××•×¨×ª"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Te,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"×—×™×¤×•×© ×ª×–××•×¨×•×ª...",value:l,onChange:s=>a(s.target.value),className:"w-full pl-4 pr-12 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"rtl"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"space-y-4",children:F.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ce,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2 font-reisinger-yonatan",children:l?"×œ× × ××¦××• ×ª×–××•×¨×•×ª":"××™×Ÿ ×ª×–××•×¨×•×ª ×¨×©×•××•×ª"}),e.jsx("p",{className:"text-gray-600 font-reisinger-yonatan",children:l?"× ×¡×” ××™×œ×•×ª ×—×™×¤×•×© ××—×¨×•×ª":"×”×ª×—×œ ×‘×”×•×¡×¤×ª ×”×ª×–××•×¨×ª ×”×¨××©×•× ×” ×©×œ×š"})]}):F.map(s=>e.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg p-4 hover:shadow-lg hover:border-indigo-300 transition-all duration-200 cursor-pointer transform hover:-translate-y-1 group ${u===s.id?"ring-2 ring-indigo-500 bg-indigo-50":""}`,onClick:()=>{L(s.id),Z(s.id),me(s.id),d("members")},children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 font-reisinger-yonatan",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600 font-reisinger-yonatan",children:[G(s.type)," â€¢ ",se(s.level)]}),s.description&&e.jsx("p",{className:"text-sm text-gray-500 mt-1 font-reisinger-yonatan",children:s.description})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[e.jsx("button",{onClick:g=>{g.stopPropagation(),E(s),C(!0)},className:"p-2 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-all duration-200",title:"×¢×¨×™×›×ª ×ª×–××•×¨×ª",children:e.jsx(We,{className:"w-4 h-4"})}),e.jsx("button",{onClick:g=>{g.stopPropagation(),D(s.id)},className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all duration-200",title:"××—×™×§×ª ×ª×–××•×¨×ª",children:e.jsx(ze,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.memberCount||0," ×—×‘×¨×™×"]})]}),s.rehearsalDay&&e.jsxs("span",{children:["×—×–×¨×•×ª: ",s.rehearsalDay]})]}),e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${s.status==="active"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:s.status==="active"?"×¤×¢×™×œ":"×œ× ×¤×¢×™×œ"})]})]},s.id))}),u&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex gap-1 p-1",children:[e.jsxs("button",{onClick:()=>d("members"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${x==="members"?"bg-indigo-100 text-indigo-700":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx(ye,{className:"w-4 h-4 inline mr-2"}),"×—×‘×¨×™ ×”×ª×–××•×¨×ª"]}),e.jsxs("button",{onClick:()=>{d("enrollment"),ae()},className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${x==="enrollment"?"bg-indigo-100 text-indigo-700":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx(be,{className:"w-4 h-4 inline mr-2"}),"×¨×™×©×•× ×—×‘×¨×™×"]}),e.jsxs("button",{onClick:()=>d("rehearsals"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${x==="rehearsals"?"bg-indigo-100 text-indigo-700":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx(fe,{className:"w-4 h-4 inline mr-2"}),"×—×–×¨×•×ª"]})]})}),e.jsxs("div",{className:"p-4",children:[x==="members"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 font-reisinger-yonatan",children:["×—×‘×¨×™ ×”×ª×–××•×¨×ª (",U.length,")"]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(Te,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"×—×™×¤×•×© ×—×‘×¨×™×...",value:Y,onChange:s=>ne(s.target.value),className:"pl-4 pr-10 py-1.5 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-indigo-500",dir:"rtl"})]})})]}),U.filter(s=>Y===""||`${s.firstName} ${s.lastName}`.toLowerCase().includes(Y.toLowerCase())||s.instrument.toLowerCase().includes(Y.toLowerCase())).length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ye,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 font-reisinger-yonatan",children:Y?"×œ× × ××¦××• ×—×‘×¨×™×":"××™×Ÿ ×—×‘×¨×™× ×¨×©×•××™× ×‘×ª×–××•×¨×ª"})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:U.filter(s=>Y===""||`${s.firstName} ${s.lastName}`.toLowerCase().includes(Y.toLowerCase())||s.instrument.toLowerCase().includes(Y.toLowerCase())).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg transition-colors border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${s.status==="active"?"bg-green-500":"bg-gray-400"}`}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm font-reisinger-yonatan",children:s.fullName||`${s.firstName} ${s.lastName}`.trim()}),e.jsxs("div",{className:"text-xs text-gray-500 font-reisinger-yonatan",children:[s.instrument,s.currentStage?` - ×©×œ×‘ ${s.currentStage}`:""]}),s.attendanceRate!==null&&s.attendanceRate!==void 0&&e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["× ×•×›×—×•×ª: ",s.attendanceRate,"%"]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>ge(s.id),className:"p-1.5 text-red-400 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"×”×¡×¨ ××”×ª×–××•×¨×ª",children:e.jsx(it,{className:"w-4 h-4"})})})]},s.id))})]}),x==="enrollment"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 font-reisinger-yonatan",children:["×¨×™×©×•× ×—×‘×¨×™× ",!k&&`(${p.length} ×–××™× ×™×)`]}),e.jsxs("div",{className:"relative",children:[e.jsx(Te,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"×—×™×¤×•×© ×ª×œ××™×“×™×...",value:B,onChange:s=>_(s.target.value),className:"pl-4 pr-10 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500",dir:"rtl",disabled:k})]})]}),k?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-reisinger-yonatan",children:"×˜×•×¢×Ÿ ×¨×©×™××ª ×ª×œ××™×“×™×..."})]}):p.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(be,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 font-reisinger-yonatan",children:"×›×œ ×”×ª×œ××™×“×™× ×›×‘×¨ ×¨×©×•××™× ×œ×ª×–××•×¨×ª"})]}):e.jsx("div",{children:p.filter(s=>B===""||s.personalInfo?.fullName?.toLowerCase().includes(B.toLowerCase())||s.academicInfo?.primaryInstrument?.toLowerCase().includes(B.toLowerCase())).length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(be,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 font-reisinger-yonatan",children:"×œ× × ××¦××• ×ª×œ××™×“×™× ×ª×•×××™×"})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:p.filter(s=>B===""||s.personalInfo?.fullName?.toLowerCase().includes(B.toLowerCase())||s.academicInfo?.primaryInstrument?.toLowerCase().includes(B.toLowerCase())).map(s=>{const g=s.academicInfo?.instrumentProgress?.find(ee=>ee.isPrimary),q=g?.instrumentName||s.academicInfo?.primaryInstrument||"×œ× ×¦×•×™×Ÿ ×›×œ×™",z=g?.currentStage;return e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg transition-colors border border-gray-200",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm font-reisinger-yonatan",children:s.personalInfo?.fullName}),e.jsxs("div",{className:"text-xs text-gray-500 font-reisinger-yonatan",children:[q,z?` - ×©×œ×‘ ${z}`:""]})]}),e.jsxs("button",{onClick:()=>oe(s._id),className:"flex items-center gap-1 px-3 py-1.5 bg-indigo-600 text-white text-sm rounded hover:bg-indigo-700 transition-colors",children:[e.jsx(be,{className:"w-4 h-4"}),"×”×•×¡×£"]})]},s._id)})})})]}),x==="rehearsals"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 font-reisinger-yonatan",children:"×—×–×¨×•×ª ×”×ª×–××•×¨×ª"}),e.jsxs("button",{onClick:()=>O(!0),className:"flex items-center gap-2 px-3 py-1.5 bg-indigo-600 text-white text-sm rounded hover:bg-indigo-700 transition-colors",children:[e.jsx($e,{className:"w-4 h-4"}),"×§×‘×¢ ×—×–×¨×”"]})]}),c.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(fe,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 font-reisinger-yonatan",children:"××™×Ÿ ×—×–×¨×•×ª ××ª×•×›× × ×•×ª"})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:c.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg transition-colors border border-gray-200",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-sm font-reisinger-yonatan",children:[s.date," â€¢ ",s.time]}),e.jsxs("div",{className:"text-xs text-gray-500 font-reisinger-yonatan flex items-center gap-2 mt-1",children:[e.jsx(ke,{className:"w-3 h-3"}),s.location,e.jsx(pe,{className:"w-3 h-3 mr-1"}),s.duration," ×“×§×•×ª"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[s.attendanceCount,"/",s.totalMembers]}),e.jsx("div",{className:"text-xs text-gray-500",children:"× ×•×›×—×•×ª"})]})]},s.id))})]})]})]})]}),n&&e.jsx(_t,{orchestra:w,onClose:()=>{C(!1),E(null)},onSubmit:$}),j&&u&&e.jsx(At,{isOpen:j,onClose:()=>O(!1),orchestraId:u,orchestraName:b.find(s=>s.id===u)?.name||"",onSave:de}),e.jsx(xt,{isOpen:K.isOpen,title:K.title,message:K.message,onConfirm:K.onConfirm,onCancel:()=>J({...K,isOpen:!1}),variant:"danger",confirmText:"××™×©×•×¨",cancelText:"×‘×™×˜×•×œ"}),V&&e.jsx("div",{className:"fixed bottom-4 left-1/2 transform -translate-x-1/2 z-50 animate-fade-in",dir:"rtl",children:e.jsxs("div",{className:`flex items-center gap-3 px-6 py-4 rounded-lg shadow-lg ${V.type==="success"?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:[V.type==="success"?e.jsx(qe,{className:"w-5 h-5 text-green-600 flex-shrink-0"}):e.jsx(_e,{className:"w-5 h-5 text-red-600 flex-shrink-0"}),e.jsx("span",{className:`font-medium font-reisinger-yonatan ${V.type==="success"?"text-green-800":"text-red-800"}`,children:V.message})]})})]})}function _t({orchestra:t,onClose:b,onSubmit:N}){const[v,y]=r.useState({name:t?.name||"",description:t?.description||"",type:t?.type||"youth",level:t?.level||"beginner",status:t?.status||"active",rehearsalDay:t?.rehearsalDay||"",rehearsalTime:t?.rehearsalTime||"",venue:t?.venue||""}),l=a=>{a.preventDefault(),N(v)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:t?"×¢×¨×™×›×ª ×ª×–××•×¨×ª":"×”×•×¡×¤×ª ×ª×–××•×¨×ª ×—×“×©×”"}),e.jsxs("form",{onSubmit:l,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×©× ×”×ª×–××•×¨×ª *"}),e.jsx("input",{type:"text",required:!0,value:v.name,onChange:a=>y(n=>({...n,name:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×ª×™××•×¨"}),e.jsx("textarea",{value:v.description,onChange:a=>y(n=>({...n,description:a.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×¡×•×’ ×ª×–××•×¨×ª *"}),e.jsxs("select",{required:!0,value:v.type,onChange:a=>y(n=>({...n,type:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"youth",children:"×ª×–××•×¨×ª × ×•×¢×¨"}),e.jsx("option",{value:"adult",children:"×ª×–××•×¨×ª ××‘×•×’×¨×™×"}),e.jsx("option",{value:"chamber",children:"×ª×–××•×¨×ª ×§×××¨×™×ª"}),e.jsx("option",{value:"symphony",children:"×ª×–××•×¨×ª ×¡×™××¤×•× ×™×ª"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×¨××” *"}),e.jsxs("select",{required:!0,value:v.level,onChange:a=>y(n=>({...n,level:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"beginner",children:"××ª×—×™×œ×™×"}),e.jsx("option",{value:"intermediate",children:"×‘×™× ×•× ×™×™×"}),e.jsx("option",{value:"advanced",children:"××ª×§×“××™×"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×™×•× ×—×–×¨×•×ª"}),e.jsx("input",{type:"text",value:v.rehearsalDay,onChange:a=>y(n=>({...n,rehearsalDay:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",placeholder:"×›×œ×•××¨: ×™×•× ×¨××©×•×Ÿ"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×©×¢×ª ×—×–×¨×•×ª"}),e.jsx("input",{type:"time",value:v.rehearsalTime,onChange:a=>y(n=>({...n,rehearsalTime:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"××§×•× ×—×–×¨×•×ª"}),e.jsx("input",{type:"text",value:v.venue,onChange:a=>y(n=>({...n,venue:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×¡×˜×˜×•×¡"}),e.jsxs("select",{value:v.status,onChange:a=>y(n=>({...n,status:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"active",children:"×¤×¢×™×œ"}),e.jsx("option",{value:"inactive",children:"×œ× ×¤×¢×™×œ"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors font-reisinger-yonatan",children:t?"×¢×“×›×Ÿ":"×”×•×¡×£"}),e.jsx("button",{type:"button",onClick:b,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors font-reisinger-yonatan",children:"×‘×™×˜×•×œ"})]})]})]})})}function Ot(){const{user:t}=Ie(),[b,N]=r.useState(new Date),[v,y]=r.useState(null),[l,a]=r.useState([]),[n,C]=r.useState([]),[w,E]=r.useState(!0),[u,L]=r.useState(null),[U,i]=r.useState(!1),[h,A]=r.useState(null),[x,d]=r.useState(""),[j,O]=r.useState(!1),[p,M]=r.useState(null),[c,I]=r.useState(!1),[B,_]=r.useState(null),[Y,ne]=r.useState(!1),[k,W]=r.useState(null),[V,H]=r.useState(!1),[K,J]=r.useState("");r.useEffect(()=>{S()},[b,t]);const S=async()=>{if(t?._id)try{E(!0);const m=t._id,T=await R.teacherSchedule.getTimeBlocks(m);console.log("Raw API Response:",T);let P=[];try{if(Array.isArray(T))P=T;else if(T?.data&&Array.isArray(T.data))P=T.data;else if(T?.timeBlocks&&Array.isArray(T.timeBlocks))P=T.timeBlocks;else if(T&&typeof T=="object"){const Q=Object.values(T).find(le=>Array.isArray(le));Q?P=Q:(console.warn("No array found in response, using empty array"),P=[])}else console.warn("Unexpected timeBlocks format:",T),P=[]}catch(Q){console.error("Error parsing timeBlocks response:",Q),P=[]}console.log("Parsed timeBlocks:",P),console.log("Time block IDs:",P.map(Q=>({_id:Q._id,day:Q.day,time:`${Q.startTime}-${Q.endTime}`,location:Q.location})));const re=P.filter(Q=>Q._id&&Q._id!=="undefined");console.log("Valid timeBlocks after filtering:",re),C(re);const xe=await R.teachers.getTeacher(m);console.log("Teacher profile:",xe);let ie=[];if(xe?.teaching?.studentIds?.length>0)try{ie=await R.students.getBatchStudents(xe.teaching.studentIds),console.log("Students loaded:",ie)}catch(Q){console.warn("Failed to load students:",Q)}else console.log("No student IDs found in teacher profile");console.log("Creating lesson blocks from student assignments...");const te=[];ie.forEach(Q=>{console.log("Processing student:",Q.personalInfo?.fullName),console.log("Student assignments:",Q.teacherAssignments),Q.teacherAssignments&&Q.teacherAssignments.forEach(le=>{if(le.teacherId===m){console.log("Creating lesson from assignment:",le);const Le=le.time||le.startTime,Ge=le.duration||45,Qe=(Ae,dt)=>{const[ct,mt]=Ae.split(":").map(Number),Ke=ct*60+mt+dt,ut=Math.floor(Ke/60),gt=Ke%60;return`${ut.toString().padStart(2,"0")}:${gt.toString().padStart(2,"0")}`},Se=le.endTime||Qe(Le,Ge),lt=n.find(Ae=>Ae.day===le.day)?.location||"",ot={_id:`${Q._id}-${le.day}-${le.time}`,day:le.day,startTime:Le,endTime:Se,totalDuration:Ge,studentId:Q._id,studentName:Q.personalInfo?.fullName,teacherId:m,instrument:Q.academicInfo?.instrumentProgress?.find(Ae=>Ae.isPrimary)?.instrumentName,location:le.location||lt,type:"lesson"};console.log(`Creating lesson: Student="${Q.personalInfo?.fullName}", Day="${le.day}", Time="${Le}-${Se}"`),te.push(ot)}})}),console.log("Converted lessons from assignments:",te);const ue=te.map(Q=>{const le=ie.find(Se=>Se.teacherAssignments?.some(Be=>Be.teacherId===m&&Be.day===Q.day&&Be.time===Q.startTime)),Le=le?.academicInfo?.instrumentProgress?.find(Se=>Se.isPrimary)||le?.academicInfo?.instrumentProgress?.[0],Qe=n.find(Se=>Se.day===Q.day)?.location||"";return{id:Q._id||Q.id||`${Q.day}-${Q.startTime}`,day:Q.day,startTime:Q.startTime,endTime:Q.endTime,studentName:le?le.personalInfo?.fullName:Q.studentName,studentId:le?._id||Q.studentId,instrument:Le?.instrumentName||Q.instrument,location:Q.location||Qe,notes:Q.notes,recurring:Q.recurring||{isRecurring:!0,excludeDates:[]},totalDuration:Q.totalDuration||ae(Q.startTime,Q.endTime),studentClass:le?.personalInfo?.class||le?.academicInfo?.class,studentPhone:le?.personalInfo?.phone,studentStage:Le?.currentStage}});a(ue);const he=me(b),je=oe(b),Re=Z(he,ue);console.log("Generated calendar days:",Re),console.log("Calendar week range:",{weekStart:he,weekEnd:je}),console.log("Mapped lesson days for calendar:",ue),y({weekStart:he,weekEnd:je,days:Re})}catch(m){console.error("Error loading schedule:",m),L("×©×’×™××” ×‘×˜×¢×™× ×ª ×œ×•×— ×”×–×× ×™×")}finally{E(!1)}},Z=(m,T)=>{const P=[],re=["×¨××©×•×Ÿ","×©× ×™","×©×œ×™×©×™","×¨×‘×™×¢×™","×—××™×©×™","×©×™×©×™","×©×‘×ª"],xe=new Map;re.forEach((te,ce)=>{xe.set(te,ce)}),console.log("=== GENERATING CALENDAR ==="),console.log("weekStart:",m,"Day:",m.getDay()),console.log("lessons input:",T),console.log("Day name mapping:",Array.from(xe.entries()));const ie=new Map;T.forEach(te=>{ie.has(te.day)||ie.set(te.day,[]),ie.get(te.day).push(te)}),console.log("Lessons grouped by day:",Array.from(ie.keys()));for(let te=0;te<7;te++){const ce=new Date(m);ce.setDate(m.getDate()+te);const ue=re[te],he=ie.get(ue)||[];console.log(`Day ${te} (${ue}): found ${he.length} lessons`,he.map(je=>({day:je.day,time:je.startTime,student:je.studentName}))),P.push({date:ce.toISOString().split("T")[0],dayName:ue,lessons:he})}return console.log("Generated calendar days with lessons:",P.map(te=>({dayName:te.dayName,lessonCount:te.lessons.length}))),P},ae=(m,T)=>{const[P,re]=m.split(":").map(Number),[xe,ie]=T.split(":").map(Number);return xe*60+ie-(P*60+re)},me=m=>{const T=new Date(m),P=T.getDay(),re=T.getDate()-P;return T.setDate(re),T.setHours(0,0,0,0),console.log("getWeekStart: input date:",m,"weekStart (Sunday):",T,"day:",T.getDay()),T},oe=m=>{const T=me(m);return T.setDate(T.getDate()+6),T},ge=m=>{const T=new Date(b);T.setDate(b.getDate()+(m==="next"?7:-7)),N(T)},de=m=>m.slice(0,5),o=m=>new Date(m).toLocaleDateString("he-IL",{day:"numeric",month:"short"}),f=()=>{A(null),i(!0)},F=m=>{console.log("handleEditLessonDay called with:",{studentId:m.studentId,studentName:m.studentName,id:m.id,_id:m._id,type:m.type}),m.studentId&&m.studentName?(console.log("Opening EditLessonModal for student lesson"),_(m),I(!0)):(console.log("Opening LessonDayModal for teaching day/availability block"),A(m),i(!0))},D=m=>{console.log("handleEditTeachingDay called with:",{_id:m._id,id:m.id,day:m.day,startTime:m.startTime,hasStudentId:!!m.studentId,fullData:m});const T={id:m._id||m.id,day:m.day,startTime:m.startTime,endTime:m.endTime,location:m.location||"×—×“×¨ ××•×–×™×§×”",notes:m.notes||"",recurring:m.recurring||{isRecurring:!0,excludeDates:[]},totalDuration:ae(m.startTime,m.endTime)};console.log("Opening LessonDayModal with lessonDay:",T),A(T),i(!0)},$=async m=>{W({message:"×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ×™×•× ×œ×™××•×“ ×–×”? ×¤×¢×•×œ×” ×–×• ×ª×‘×˜×œ ××ª ×”×–××™× ×•×ª ×©×œ×š ×‘×–××Ÿ ×–×”.",onConfirm:async()=>{try{await R.teacherSchedule.deleteTimeBlock(t?._id,m._id||m.id),G("×™×•× ×”×œ×™××•×“ × ××—×§ ×‘×”×¦×œ×—×”","success"),S()}catch(T){console.error("Error deleting teaching day:",T),G("×©×’×™××” ×‘××—×™×§×ª ×™×•× ×”×œ×™××•×“","error")}}}),ne(!0)},G=(m,T)=>{const P=document.createElement("div");P.className=`fixed top-4 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-lg shadow-lg z-50 ${T==="success"?"bg-green-500 text-white":T==="error"?"bg-red-500 text-white":"bg-blue-500 text-white"}`,P.innerHTML=`<div class="flex items-center gap-2 font-reisinger-yonatan">
      ${T==="success"?"âœ…":T==="error"?"âŒ":"â„¹ï¸"} ${m}
    </div>`,document.body.appendChild(P),setTimeout(()=>P.remove(),3e3)},se=m=>{J(m),H(!0)},s=()=>{const m=[];for(let T=7;T<=21;T++)m.push(`${T.toString().padStart(2,"0")}:00`),m.push(`${T.toString().padStart(2,"0")}:30`);return m},g=(m,T)=>{const P=v?.days.find(ie=>ie.date===m),re=ie=>{const[te,ce]=ie.split(":").map(Number);return te*60+ce};return P?.lessons.find(ie=>{const te=re(T),ce=te+30,ue=re(ie.startTime),he=re(ie.endTime),je=ue>=te&&ue<ce,Re=te>=ue&&te<he;return je||Re})},q=m=>{const T=ae(m.startTime,m.endTime);return Math.ceil(T/30)*60},z=(m,T)=>{const P=m.startTime,re=T,xe=ue=>{const[he,je]=ue.split(":").map(Number);return he*60+je},ie=xe(P),te=xe(re),ce=te+30;return ie>=te&&ie<ce},ee=(m,T)=>{const P=ce=>{const[ue,he]=ce.split(":").map(Number);return ue*60+he},re=P(T),xe=re+30;return n.some(ce=>{if(ce.day!==m)return!1;const ue=P(ce.startTime),he=P(ce.endTime);return re>=ue&&xe<=he})?!l.some(ce=>{if(ce.day!==m)return!1;const ue=P(ce.startTime),he=P(ce.endTime);return re<he&&xe>ue}):!1},X=(m,T,P)=>{ee(P,T)&&(M({date:m,time:T,dayName:P}),O(!0))};if(l.filter(m=>{if(!x)return!0;const T=x.toLowerCase();return m.studentName?.toLowerCase().includes(T)||m.instrument?.toLowerCase().includes(T)||m.location?.toLowerCase().includes(T)||m.day.toLowerCase().includes(T)}),w)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"×˜×•×¢×Ÿ ×œ×•×— ×–×× ×™×..."})]})});if(u&&!v)return e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("div",{className:"text-red-800 font-reisinger-yonatan",children:u})});const we=s();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-yonatan",children:"×œ×•×— ×–×× ×™× ×©×‘×•×¢×™"}),e.jsx("p",{className:"text-gray-600 mt-1",children:v&&`${o(v.weekStart.toISOString().split("T")[0])} - ${o(v.weekEnd.toISOString().split("T")[0])}`})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>ge("prev"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(at,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>N(new Date),className:"px-3 py-1 text-sm bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 transition-colors font-reisinger-yonatan",children:"×”×©×‘×•×¢"}),e.jsx("button",{onClick:()=>ge("next"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(nt,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-8 border-b border-gray-200",children:[e.jsx("div",{className:"p-3 bg-gray-50 font-medium text-gray-700 font-reisinger-yonatan",children:"×©×¢×”"}),v?.days.map(m=>e.jsxs("div",{className:"p-3 bg-gray-50 text-center",children:[e.jsx("div",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:m.dayName}),e.jsx("div",{className:"text-sm text-gray-500 font-reisinger-yonatan",children:o(m.date)})]},m.date))]}),e.jsx("div",{className:"max-h-96 overflow-y-auto relative",children:we.map(m=>e.jsxs("div",{className:"grid grid-cols-8 border-b border-gray-100",style:{height:"60px"},children:[e.jsx("div",{className:"p-3 bg-gray-50 text-sm font-medium text-gray-600 font-reisinger-yonatan flex items-center",children:de(m)}),v?.days.map(T=>{const P=g(T.date,m),re=!P&&ee(T.dayName,m);return e.jsxs("div",{className:`border-l border-gray-100 relative transition-all duration-300 group ${re?"bg-blue-50/30 hover:bg-blue-100/50 cursor-pointer border-2 border-transparent hover:border-blue-200":"cursor-default"}`,style:{height:"60px"},onClick:()=>!P&&X(T.date,m,T.dayName),title:re?"×œ×—×¥ ×œ×”×•×¡×¤×ª ×©×™×¢×•×¨ ×—×“×©":"",children:[re&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center opacity-30 group-hover:opacity-100 transition-all duration-300 group-hover:scale-110",children:[e.jsx($e,{className:"w-6 h-6 text-blue-500"}),e.jsx("span",{className:"text-[10px] text-blue-600 font-medium mt-1 opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:"×”×•×¡×£ ×©×™×¢×•×¨"})]})}),P&&z(P,m)&&e.jsx("div",{className:"absolute left-1 right-1 top-1 p-2.5 rounded text-xs font-reisinger-yonatan bg-blue-100 text-blue-800 hover:bg-blue-200 border border-blue-300 shadow-sm cursor-pointer transition-all hover:scale-[1.02] z-10 overflow-hidden",style:{height:`${q(P)-2}px`,minHeight:"82px"},onClick:()=>F(P),title:`${P.studentName||"×ª×œ××™×“"} - ${P.instrument||""}`,children:e.jsx("div",{className:"flex flex-col h-full justify-between",children:e.jsxs("div",{className:"flex-shrink-0 space-y-1",children:[e.jsxs("div",{className:"font-medium truncate flex items-center gap-1",children:[e.jsx(De,{className:"w-3 h-3 opacity-60"}),P.studentName||"×ª×œ××™×“"]}),e.jsxs("div",{className:"text-[10px] opacity-75",children:[de(P.startTime),"-",de(P.endTime)]}),e.jsx("div",{className:"flex items-center gap-1 text-[10px] opacity-80 h-4",children:P.instrument?e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"w-2.5 h-2.5"}),e.jsx("span",{className:"truncate",children:P.instrument})]}):e.jsx("span",{className:"invisible",children:"placeholder"})}),e.jsx("div",{className:"flex items-center gap-1 text-[10px] opacity-70 h-4",children:P.location?e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"w-2.5 h-2.5"}),e.jsx("span",{className:"truncate",children:P.location})]}):e.jsx("span",{className:"invisible",children:"placeholder"})})]})})})]},`${T.date}-${m}`)})]},m))})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×™××™ ×œ×™××•×“ - ×–××™× ×•×ª ×”××•×¨×”"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"×”×’×“×¨ ××ª ×”×™××™× ×•×”×©×¢×•×ª ×©×‘×”× ××ª×” ×–××™×Ÿ ×œ×”×•×¨××”"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("button",{onClick:f,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[e.jsx($e,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"×”×•×¡×£ ×™×•× ×œ×™××•×“"})]})})]}),n.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[e.jsx(Pe,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-reisinger-yonatan text-lg",children:"××™×Ÿ ×™××™ ×œ×™××•×“ ××•×’×“×¨×™×"}),e.jsx("button",{onClick:f,className:"mt-4 text-indigo-600 hover:text-indigo-700 font-medium",children:"×”×•×¡×£ ×™×•× ×œ×™××•×“ ×¨××©×•×Ÿ"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:n.map(m=>e.jsx(Pt,{teachingDay:m,onEdit:()=>D(m),onDelete:()=>$(m)},m._id||m.id))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-900 font-reisinger-yonatan",children:"×™××™ ×œ×™××•×“"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-900 mt-2 font-reisinger-yonatan",children:n.length}),e.jsx("div",{className:"text-xs text-blue-700 mt-1",children:"×™××™ ×–××™× ×•×ª ×œ×”×•×¨××”"})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"font-medium text-green-900 font-reisinger-yonatan",children:"×©×¢×•×ª ×–××™× ×•×ª"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-900 mt-2 font-reisinger-yonatan",children:(n.reduce((m,T)=>{const P=ae(T.startTime,T.endTime);return m+P},0)/60).toFixed(1)}),e.jsx("div",{className:"text-xs text-green-700 mt-1",children:"×©×¢×•×ª ×©×‘×•×¢×™×•×ª ×–××™× ×•×ª"})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"font-medium text-purple-900 font-reisinger-yonatan",children:"×ª×œ××™×“×™×"})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-900 mt-2 font-reisinger-yonatan",children:new Set(l.map(m=>m.studentId).filter(Boolean)).size}),e.jsx("div",{className:"text-xs text-purple-700 mt-1",children:"×ª×œ××™×“×™× ×¤×¢×™×œ×™×"})]}),e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"w-5 h-5 text-orange-600"}),e.jsx("span",{className:"font-medium text-orange-900 font-reisinger-yonatan",children:"×©×™×¢×•×¨×™×"})]}),e.jsx("div",{className:"text-2xl font-bold text-orange-900 mt-2 font-reisinger-yonatan",children:l.length}),e.jsx("div",{className:"text-xs text-orange-700 mt-1",children:"×©×™×¢×•×¨×™× ×§×‘×•×¢×™×"})]})]}),j&&p&&e.jsx(Bt,{timeSlot:p,teacherId:t?._id||"",teachingDays:n,onClose:()=>{O(!1),M(null)},onSave:()=>{O(!1),M(null),S()},showNotification:G}),U&&e.jsx(Rt,{lessonDay:h,teacherId:t?._id||"",onClose:()=>{i(!1),A(null)},onSave:()=>{i(!1),A(null),S()},showAlert:se}),c&&B&&e.jsx(Wt,{lesson:B,teacherId:t?._id||"",teachingDays:n,onClose:()=>{I(!1),_(null)},onSave:()=>{I(!1),_(null),S()},showAlert:se}),Y&&k&&e.jsx(Ft,{message:k.message,onConfirm:()=>{k.onConfirm(),ne(!1),W(null)},onCancel:()=>{ne(!1),W(null)}}),V&&e.jsx(Ht,{message:K,onClose:()=>{H(!1),J("")}})]})}function Pt({teachingDay:t,onEdit:b,onDelete:N}){return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(fe,{className:"w-4 h-4 text-green-600"})}),e.jsxs("div",{children:[e.jsxs("h5",{className:"font-bold text-gray-900 font-reisinger-yonatan",children:["×™×•× ",t.day]}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"×–××™× ×•×ª ×œ×”×•×¨××”"})]})]}),t.isRecurring!==!1&&e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded-full font-reisinger-yonatan",children:"×©×‘×•×¢×™"})]}),e.jsx("div",{className:"mb-3 pb-3 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx(pe,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"font-medium",children:[t.startTime," - ",t.endTime]})]})}),t.location&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-3",children:[e.jsx(ke,{className:"w-3.5 h-3.5 text-gray-400"}),e.jsx("span",{children:t.location})]}),e.jsx("div",{className:"p-2 bg-gray-50 rounded text-xs text-gray-600 mb-3",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ye,{className:"w-3 h-3"}),e.jsx("span",{children:"×–××™×Ÿ ×œ×§×‘×™×¢×ª ×©×™×¢×•×¨×™× ×‘×–××Ÿ ×–×”"})]})}),t.notes&&e.jsx("div",{className:"p-2 bg-gray-50 rounded text-xs text-gray-600 mb-3",children:t.notes}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:b,className:"flex-1 flex items-center justify-center gap-1.5 px-3 py-1.5 bg-indigo-100 text-indigo-700 rounded hover:bg-indigo-200 transition-colors text-sm",children:[e.jsx(We,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"×¢×¨×•×š"})]}),e.jsx("button",{onClick:N,className:"flex items-center justify-center p-1.5 bg-red-100 text-red-700 rounded hover:bg-red-200 transition-colors",title:"××—×§ ×™×•× ×œ×™××•×“",children:e.jsx(ze,{className:"w-3.5 h-3.5"})})]})]})}function Rt({lessonDay:t,teacherId:b,onClose:N,onSave:v,showAlert:y}){const[l,a]=r.useState({day:t?.day||"×¨××©×•×Ÿ",startTime:t?.startTime||"14:00",endTime:t?.endTime||"18:00",location:t?.location||"×—×“×¨ ××•×–×™×§×”",notes:t?.notes||"",recurring:t?.recurring||{isRecurring:!0,excludeDates:[]}}),[n,C]=r.useState(!1),w=async u=>{if(u.preventDefault(),t?.studentId){y("×œ× × ×™×ª×Ÿ ×œ×¢×¨×•×š ×©×™×¢×•×¨ ×ª×œ××™×“ ××›××Ÿ. ×× × ×”×©×ª××© ×‘××¤×©×¨×•×ª ×”×¢×¨×™×›×” ×‘×›×¨×˜×™×¡ ×”×©×™×¢×•×¨.");return}if(!l.day||!l.startTime||!l.endTime){y("×™×© ×œ××œ× ××ª ×›×œ ×”×©×“×•×ª ×”× ×“×¨×©×™×");return}try{C(!0);const L={day:l.day,startTime:l.startTime,endTime:l.endTime,location:l.location||null,notes:l.notes||null,recurring:l.recurring||{isRecurring:!0,excludeDates:[]}};t?.id&&/^[0-9a-fA-F]{24}$/.test(t.id)?await R.teacherSchedule.updateTimeBlock(b,t.id,L):await R.teacherSchedule.createTimeBlock(b,L),v()}catch(L){console.error("Error saving lesson day:",L),L?.message?.includes("not found")||L?.message?.includes("Resource not found")?(y("×™×•× ×”×œ×™××•×“ ×”×–×” ×›×‘×¨ ×œ× ×§×™×™× ×‘××¢×¨×›×ª. ×”×•× ×™×•×¡×¨ ××”×ª×¦×•×’×”."),N(),v()):y("×©×’×™××” ×‘×©××™×¨×ª ×™×•× ×”×œ×™××•×“")}finally{C(!1)}},E=()=>["×¨××©×•×Ÿ","×©× ×™","×©×œ×™×©×™","×¨×‘×™×¢×™","×—××™×©×™","×©×™×©×™","×©×‘×ª"];return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-yonatan",children:t?"×¢×¨×™×›×ª ×™×•× ×œ×™××•×“":"×”×•×¡×¤×ª ×™×•× ×œ×™××•×“ ×—×“×©"}),e.jsx("button",{onClick:N,className:"p-2 text-gray-400 hover:text-gray-600",children:e.jsx(ve,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:w,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×™×•× ×‘×©×‘×•×¢ *"}),e.jsx("select",{value:l.day,onChange:u=>a(L=>({...L,day:u.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",required:!0,children:E().map(u=>e.jsx("option",{value:u,children:u},u))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×©×¢×ª ×”×ª×—×œ×” *"}),e.jsx("input",{type:"time",value:l.startTime,onChange:u=>a(L=>({...L,startTime:u.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×©×¢×ª ×¡×™×•× *"}),e.jsx("input",{type:"time",value:l.endTime,onChange:u=>a(L=>({...L,endTime:u.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"××™×§×•× / ×—×“×¨"}),e.jsxs("select",{value:l.location||"",onChange:u=>a(L=>({...L,location:u.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×—×“×¨"}),He.map(u=>e.jsx("option",{value:u,children:u},u))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×”×¢×¨×•×ª"}),e.jsx("textarea",{value:l.notes||"",onChange:u=>a(L=>({...L,notes:u.target.value})),rows:3,placeholder:"×”×¢×¨×•×ª × ×•×¡×¤×•×ª ×œ×’×‘×™ ×”×©×™×¢×•×¨...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:l.recurring?.isRecurring!==!1,onChange:u=>a(L=>({...L,recurring:{isRecurring:u.target.checked,excludeDates:L.recurring?.excludeDates||[]}})),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"×©×™×¢×•×¨ ×§×‘×•×¢ (×—×•×–×¨ ×©×‘×•×¢×™×ª)"})]}),l.recurring?.isRecurring&&e.jsx("p",{className:"text-xs text-gray-500 mr-6 mt-1",children:"×”×©×™×¢×•×¨ ×™×•×¤×™×¢ ×‘××•×¤×Ÿ ×§×‘×•×¢ ×‘×›×œ ×©×‘×•×¢ ×‘×™×•× ×•×‘×©×¢×” ×©×”×•×’×“×¨×•"})]}),e.jsxs("div",{className:"flex gap-3 pt-6 border-t",children:[e.jsx("button",{type:"submit",disabled:n,className:"flex-1 bg-indigo-600 text-white py-3 px-4 rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed font-reisinger-yonatan flex items-center justify-center gap-2",children:n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"×©×•××¨..."]}):e.jsx(e.Fragment,{children:t?e.jsxs(e.Fragment,{children:[e.jsx(Ue,{className:"w-4 h-4"}),"×¢×“×›×Ÿ ×™×•× ×œ×™××•×“"]}):e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"w-4 h-4"}),"×”×•×¡×£ ×™×•× ×œ×™××•×“"]})})}),e.jsx("button",{type:"button",onClick:N,disabled:n,className:"flex-1 bg-gray-300 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed font-reisinger-yonatan",children:"×‘×™×˜×•×œ"})]})]})]})})}function Bt({timeSlot:t,teacherId:b,teachingDays:N,onClose:v,onSave:y,showNotification:l}){const[a,n]=r.useState(""),[C,w]=r.useState(45),[E,u]=r.useState([]),[L,U]=r.useState(!1),[i,h]=r.useState(!1),[A,x]=r.useState(0),[d,j]=r.useState(""),[O,p]=r.useState(!1);r.useEffect(()=>{M()},[]),r.useEffect(()=>{const k=W=>{W.target.closest(".student-search-dropdown")||p(!1)};return O&&document.addEventListener("mousedown",k),()=>{document.removeEventListener("mousedown",k)}},[O]);const M=async()=>{try{U(!0);const W=(await R.students.getStudents()).map(V=>{const H=V.academicInfo?.instrumentProgress?.find(K=>K.isPrimary)||V.academicInfo?.instrumentProgress?.[0];return{id:V._id,firstName:V.personalInfo?.firstName||V.personalInfo?.fullName?.split(" ")[0]||"",lastName:V.personalInfo?.lastName||V.personalInfo?.fullName?.split(" ").slice(1).join(" ")||"",instrument:H?.instrumentName||"",class:V.personalInfo?.class||V.academicInfo?.class,stage:H?.currentStage}});u(W)}catch(k){console.error("Error loading students:",k)}finally{U(!1)}},c=E.filter(k=>{if(!d)return!0;const W=d.toLowerCase();return`${k.firstName} ${k.lastName}`.toLowerCase().includes(W)||k.instrument?.toLowerCase().includes(W)||k.class?.toLowerCase().includes(W)}),I=(k,W)=>{const[V,H]=k.split(":").map(Number),K=V*60+H+W,J=Math.floor(K/60),S=K%60;return`${J.toString().padStart(2,"0")}:${S.toString().padStart(2,"0")}`},B=()=>{const[k]=t.time.split(":").map(Number),W=A;return`${k.toString().padStart(2,"0")}:${W.toString().padStart(2,"0")}`},_=[0,5,10,15,20,25,30,35,40,45,50,55],Y=async k=>{if(k.preventDefault(),!a){l("×™×© ×œ×‘×—×•×¨ ×ª×œ××™×“","error");return}try{h(!0);const W=E.find(de=>de.id===a),V=B(),H=I(V,C);console.log("ğŸ“ Creating lesson for student:",W),console.log("ğŸ“… Lesson details:",{day:t.dayName,time:V,duration:C});const J=N.find(de=>de.day===t.dayName)?.location||"",S={teacherId:b,day:t.dayName,time:V,endTime:H,duration:C,location:J,isActive:!0,startDate:new Date().toISOString(),isRecurring:!0};console.log("ğŸ“– Fetching student data...");const ae=[...(await R.students.getStudent(a)).teacherAssignments||[],S];console.log("ğŸ’¾ Updating student with teacher assignment..."),await R.students.updateStudent(a,{teacherAssignments:ae}),console.log("ğŸ‘¨â€ğŸ« Updating teacher student list...");const me=await R.teachers.getTeacher(b),oe=me.teaching?.studentIds||[];oe.includes(a)||await R.teachers.updateTeacher(b,{teaching:{...me.teaching,studentIds:[...oe,a]}});const ge={day:t.dayName,startTime:V,endTime:H,studentId:a,studentName:W?`${W.firstName} ${W.lastName}`:"",instrument:W?.instrument||"",location:J,notes:`×©×™×¢×•×¨ ×§×‘×•×¢ ×©×‘×•×¢×™ - × ×•×¦×¨ ×‘-${new Date().toLocaleDateString("he-IL")}`,recurring:{isRecurring:!0,excludeDates:[]},isRecurring:!0,totalDuration:C};console.log("ğŸ“‹ Creating time block for teacher schedule..."),await R.teacherSchedule.createTimeBlock(b,ge),console.log("âœ… Lesson created successfully!"),l("×”×©×™×¢×•×¨ × ×•×¦×¨ ×‘×”×¦×œ×—×”!","success"),y()}catch(W){console.error("âŒ Error creating weekly lesson assignment:",W),l(`×©×’×™××” ×‘×™×¦×™×¨×ª ×”×©×™×¢×•×¨ ×”×©×‘×•×¢×™: ${W.message||"×©×’×™××” ×œ× ×™×“×•×¢×”"}`,"error")}finally{h(!1)}},ne=k=>k.slice(0,5);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-yonatan",children:"×”×•×¡×¤×ª ×©×™×¢×•×¨ ×—×“×©"}),e.jsx("button",{onClick:v,className:"p-2 text-gray-400 hover:text-gray-600",children:e.jsx(ve,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-800 mb-2",children:[e.jsx(fe,{className:"w-4 h-4"}),e.jsxs("span",{className:"font-medium",children:["×©×™×¢×•×¨ ×§×‘×•×¢ ×©×‘×•×¢×™ - ×™×•× ",t.dayName]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-blue-700",children:[e.jsx(pe,{className:"w-4 h-4"}),e.jsxs("span",{children:[ne(B())," - ",ne(I(B(),C))," (",C," ×“×§×•×ª)"]})]}),e.jsxs("div",{className:"text-xs text-blue-600 mt-1",children:["×”×©×™×¢×•×¨ ×™×ª×§×™×™× ×›×œ ×©×‘×•×¢ ×‘×™×•× ",t.dayName," ×‘××•×ª×” ×©×¢×”"]})]}),e.jsxs("form",{onSubmit:Y,className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×‘×—×¨ ×ª×œ××™×“ *"}),L?e.jsx("div",{className:"text-center py-2 text-gray-500",children:"×˜×•×¢×Ÿ ×¨×©×™××ª ×ª×œ××™×“×™×..."}):e.jsxs("div",{className:"relative student-search-dropdown",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Te,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:d,onChange:k=>{j(k.target.value),p(!0)},onFocus:()=>p(!0),placeholder:"×—×¤×© ×ª×œ××™×“ ×œ×¤×™ ×©×, ×›×œ×™ × ×’×™× ×” ××• ×›×™×ª×”...",className:"w-full pr-10 pl-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),a&&!O&&e.jsx("div",{className:"mt-2 p-2 bg-indigo-50 border border-indigo-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm",children:[e.jsxs("span",{className:"font-medium text-indigo-900",children:[E.find(k=>k.id===a)?.firstName," ",E.find(k=>k.id===a)?.lastName]}),E.find(k=>k.id===a)?.instrument&&e.jsxs("span",{className:"text-indigo-700",children:[" - ",E.find(k=>k.id===a)?.instrument]})]}),e.jsx("button",{type:"button",onClick:()=>{n(""),j(""),p(!0)},className:"text-indigo-600 hover:text-indigo-800",children:e.jsx(ve,{className:"w-4 h-4"})})]})}),O&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:c.length>0?c.map(k=>e.jsxs("button",{type:"button",onClick:()=>{n(k.id),j(`${k.firstName} ${k.lastName}`),p(!1)},className:`w-full text-right px-3 py-2 hover:bg-indigo-50 transition-colors border-b border-gray-100 last:border-b-0 ${a===k.id?"bg-indigo-100":""}`,children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[k.firstName," ",k.lastName]}),e.jsxs("div",{className:"text-xs text-gray-600 mt-0.5",children:[k.instrument&&`${k.instrument}`,k.class&&` â€¢ ×›×™×ª×” ${k.class}`,k.stage&&` â€¢ ×©×œ×‘ ${k.stage}`]})]},k.id)):e.jsx("div",{className:"px-3 py-4 text-center text-gray-500",children:"×œ× × ××¦××• ×ª×œ××™×“×™× ××ª××™××™×"})})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:["×–××Ÿ ×”×ª×—×œ×” ××“×•×™×§ (×©×¢×” ",t.time.split(":")[0],":__)"]}),e.jsx("div",{className:"grid grid-cols-6 gap-2",children:_.map(k=>e.jsxs("button",{type:"button",onClick:()=>x(k),className:`px-3 py-2 rounded-lg border-2 transition-all font-medium ${A===k?"border-indigo-600 bg-indigo-50 text-indigo-700":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:[":",k.toString().padStart(2,"0")]},k))}),e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:["×©×¢×ª ×”×ª×—×œ×”: ",B()]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"××©×š ×”×©×™×¢×•×¨ (×“×§×•×ª)"}),e.jsxs("select",{value:C,onChange:k=>w(Number(k.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:30,children:"30 ×“×§×•×ª"}),e.jsx("option",{value:45,children:"45 ×“×§×•×ª"}),e.jsx("option",{value:60,children:"60 ×“×§×•×ª"}),e.jsx("option",{value:90,children:"90 ×“×§×•×ª"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",disabled:i||!a,className:"flex-1 bg-indigo-600 text-white py-3 px-4 rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed font-reisinger-yonatan flex items-center justify-center gap-2",children:i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"×™×•×¦×¨ ×©×™×¢×•×¨ ×©×‘×•×¢×™..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ue,{className:"w-4 h-4"}),"×¦×•×¨ ×©×™×¢×•×¨ ×©×‘×•×¢×™"]})}),e.jsx("button",{type:"button",onClick:v,disabled:i,className:"flex-1 bg-gray-300 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed font-reisinger-yonatan",children:"×‘×™×˜×•×œ"})]})]})]})})}function Ft({message:t,onConfirm:b,onCancel:N}){return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",dir:"rtl",children:[e.jsx("div",{className:"flex items-center justify-center mb-6",children:e.jsx("div",{className:"p-3 bg-orange-100 rounded-full",children:e.jsx(Me,{className:"w-8 h-8 text-orange-600"})})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 text-center mb-4 font-reisinger-yonatan",children:t}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:b,className:"flex-1 bg-red-600 text-white py-2.5 px-4 rounded-lg hover:bg-red-700 transition-colors font-reisinger-yonatan font-medium",children:"××™×©×•×¨"}),e.jsx("button",{onClick:N,className:"flex-1 bg-gray-200 text-gray-700 py-2.5 px-4 rounded-lg hover:bg-gray-300 transition-colors font-reisinger-yonatan font-medium",children:"×‘×™×˜×•×œ"})]})]})})}function Ht({message:t,onClose:b}){return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",dir:"rtl",children:[e.jsx("div",{className:"flex items-center justify-center mb-6",children:e.jsx("div",{className:"p-3 bg-blue-100 rounded-full",children:e.jsx(Me,{className:"w-8 h-8 text-blue-600"})})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 text-center mb-6 font-reisinger-yonatan",children:t}),e.jsx("button",{onClick:b,className:"w-full bg-indigo-600 text-white py-2.5 px-4 rounded-lg hover:bg-indigo-700 transition-colors font-reisinger-yonatan font-medium",children:"×”×‘× ×ª×™"})]})})}function Wt({lesson:t,teacherId:b,teachingDays:N,onClose:v,onSave:y,showAlert:l}){const a=(p,M)=>{const[c,I]=p.split(":").map(Number),[B,_]=M.split(":").map(Number);return B*60+_-(c*60+I)},C=N.find(p=>p.day===t.day)?.location||"",[w,E]=r.useState({day:t.day,startTime:t.startTime,endTime:t.endTime,location:t.location||C,notes:t.notes||""}),[u,L]=r.useState(!1),[U,i]=r.useState(a(t.startTime,t.endTime)),[h,A]=r.useState([]);r.useState(""),r.useEffect(()=>{if(!w.day||!U)return;const p=N.filter(c=>c.day===w.day),M=[];p.forEach(c=>{const[I,B]=c.startTime.split(":").map(Number),[_,Y]=c.endTime.split(":").map(Number),ne=I*60+B,W=_*60+Y-ne,V=Math.floor(W/U);for(let H=0;H<V;H++){const K=ne+H*U,J=K+U,S=Math.floor(K/60),Z=K%60,ae=Math.floor(J/60),me=J%60,oe=`${S.toString().padStart(2,"0")}:${Z.toString().padStart(2,"0")}`,ge=`${ae.toString().padStart(2,"0")}:${me.toString().padStart(2,"0")}`;M.push({id:`${c._id||c.id}-${U}-${H}`,startTime:oe,endTime:ge,duration:U})}}),A(M)},[w.day,U,N]);const x=p=>{E(M=>({...M,startTime:p.startTime,endTime:p.endTime}))},d=async p=>{if(p.preventDefault(),!w.day||!w.startTime||!w.endTime){l("×™×© ×œ××œ× ××ª ×›×œ ×”×©×“×•×ª ×”× ×“×¨×©×™×");return}const M=a(w.startTime,w.endTime);if(M<=0){l("×–××Ÿ ×”×¡×™×•× ×—×™×™×‘ ×œ×”×™×•×ª ×œ××—×¨ ×–××Ÿ ×”×”×ª×—×œ×”");return}try{if(L(!0),t.studentId){const c={teacherId:b,day:w.day,time:w.startTime,startTime:w.startTime,endTime:w.endTime,duration:M,location:w.location,isActive:!0};await R.students.updateTeacherAssignment(t.studentId,b,c)}j("×”×©×™×¢×•×¨ ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”","success"),y()}catch(c){console.error("Error updating lesson:",c),j("×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”×©×™×¢×•×¨","error")}finally{L(!1)}},j=(p,M)=>{const c=document.createElement("div");c.className=`fixed top-4 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-lg shadow-lg z-50 ${M==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,c.innerHTML=`<div class="flex items-center gap-2 font-reisinger-yonatan">
      ${M==="success"?"âœ…":"âŒ"} ${p}
    </div>`,document.body.appendChild(c),setTimeout(()=>c.remove(),3e3)},O=()=>{const p=Array.from(new Set(N.map(M=>M.day)));return p.length===0?["×¨××©×•×Ÿ","×©× ×™","×©×œ×™×©×™","×¨×‘×™×¢×™","×—××™×©×™","×©×™×©×™","×©×‘×ª"]:p};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-yonatan",children:"×¢×¨×™×›×ª ×©×™×¢×•×¨"}),e.jsx("button",{onClick:v,className:"p-2 text-gray-400 hover:text-gray-600",children:e.jsx(ve,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2 font-reisinger-yonatan",children:"×¤×¨×˜×™ ×”×ª×œ××™×“"}),e.jsxs("div",{className:"space-y-1 text-sm text-blue-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4"}),e.jsx("strong",{children:"×ª×œ××™×“:"})," ",t.studentName||"×œ× ×¦×•×™×Ÿ"]}),t.instrument&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4"}),e.jsx("strong",{children:"×›×œ×™ × ×’×™× ×”:"})," ",t.instrument]}),t.studentClass&&e.jsxs("div",{children:[e.jsx("strong",{children:"×›×™×ª×”:"})," ",t.studentClass]}),t.studentStage&&e.jsxs("div",{children:[e.jsx("strong",{children:"×©×œ×‘:"})," ",t.studentStage]})]})]}),e.jsxs("form",{onSubmit:d,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×™×•× ×‘×©×‘×•×¢ *"}),e.jsx("select",{value:w.day,onChange:p=>{const M=p.target.value,c=N.find(I=>I.day===M);E(I=>({...I,day:M,location:(!I.location||I.location==="")&&c?.location?c.location:I.location}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",required:!0,children:O().map(p=>e.jsx("option",{value:p,children:p},p))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"××©×š ×”×©×™×¢×•×¨ (×“×§×•×ª) *"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:[30,45,60].map(p=>e.jsxs("button",{type:"button",onClick:()=>i(p),className:`px-4 py-2 rounded-lg border-2 transition-all ${U===p?"border-indigo-600 bg-indigo-50 text-indigo-700 font-semibold":"border-gray-300 bg-white text-gray-700 hover:border-indigo-300"}`,children:[p," ×“×§×³"]},p))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"×‘×—×¨ ×–××Ÿ ×©×™×¢×•×¨ ×–××™×Ÿ *"}),h.length===0?e.jsxs("div",{className:"text-center py-6 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx(pe,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm text-gray-500",children:"××™×Ÿ ×–×× ×™× ×–××™× ×™× ×œ×™×•× ×•××©×š ×©×™×¢×•×¨ ×©× ×‘×—×¨×•"})]}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 max-h-64 overflow-y-auto p-2 bg-gray-50 rounded-lg border border-gray-200",children:h.map(p=>{const M=w.startTime===p.startTime&&w.endTime===p.endTime;return e.jsxs("button",{type:"button",onClick:()=>x(p),className:`p-3 rounded-lg border-2 transition-all text-sm ${M?"border-green-600 bg-green-50 text-green-800 font-semibold shadow-md":p.duration===30?"border-green-300 bg-green-50 text-green-800 hover:border-green-500":p.duration===45?"border-blue-300 bg-blue-50 text-blue-800 hover:border-blue-500":"border-purple-300 bg-purple-50 text-purple-800 hover:border-purple-500"}`,children:[e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(pe,{className:"w-3 h-3"}),e.jsxs("span",{className:"font-medium",children:[p.startTime,"-",p.endTime]})]}),e.jsxs("div",{className:"text-xs mt-1 opacity-75",children:[p.duration," ×“×§×•×ª"]})]},p.id)})})]}),w.startTime&&w.endTime&&e.jsx("div",{className:"p-3 bg-indigo-50 rounded-lg border border-indigo-200",children:e.jsxs("div",{className:"flex items-center gap-2 text-indigo-800",children:[e.jsx(pe,{className:"w-4 h-4"}),e.jsxs("span",{className:"font-reisinger-yonatan font-medium",children:["×–××Ÿ ×©×™×¢×•×¨ × ×‘×—×¨: ",w.startTime," - ",w.endTime," (",a(w.startTime,w.endTime)," ×“×§×•×ª)"]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"××™×§×•× / ×—×“×¨"}),e.jsxs("select",{value:w.location||"",onChange:p=>E(M=>({...M,location:p.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×—×“×¨"}),He.map(p=>e.jsx("option",{value:p,children:p},p))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×”×¢×¨×•×ª"}),e.jsx("textarea",{value:w.notes,onChange:p=>E(M=>({...M,notes:p.target.value})),rows:3,placeholder:"×”×¢×¨×•×ª × ×•×¡×¤×•×ª ×œ×’×‘×™ ×”×©×™×¢×•×¨...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"flex gap-3 pt-6 border-t",children:[e.jsx("button",{type:"submit",disabled:u||!w.startTime||!w.endTime,className:"flex-1 bg-indigo-600 text-white py-3 px-4 rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed font-reisinger-yonatan flex items-center justify-center gap-2",children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"×©×•××¨..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ue,{className:"w-4 h-4"}),"×¢×“×›×Ÿ ×©×™×¢×•×¨"]})}),e.jsx("button",{type:"button",onClick:v,disabled:u,className:"flex-1 bg-gray-300 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed font-reisinger-yonatan",children:"×‘×™×˜×•×œ"})]})]})]})})}function zt(){const{user:t}=Ie(),[b,N]=r.useState([]),[v,y]=r.useState(!0),[l,a]=r.useState(""),[n,C]=r.useState(!1),[w,E]=r.useState(null),[u,L]=r.useState(null),[U,i]=r.useState([]),[h,A]=r.useState(null),[x,d]=r.useState(!1),[j,O]=r.useState(!1),[p,M]=r.useState(!1),[c,I]=r.useState([]),[B,_]=r.useState(null),[Y,ne]=r.useState("lessons");r.useEffect(()=>{k()},[t]);const k=async()=>{if(t?._id)try{y(!0);const o=t._id,D=(await R.theory.getTheoryLessons()).filter($=>$.teacherId===o).map($=>({id:$._id,name:$.name,description:$.description,level:$.level,duration:$.duration,capacity:$.capacity,enrolledCount:$.enrolledStudentIds?.length||0,schedule:{dayOfWeek:$.dayOfWeek,startTime:$.startTime,endTime:$.endTime},status:$.isActive?"active":"inactive",venue:$.location,materials:$.materials||[]}));N(D)}catch(o){console.error("Error loading theory lessons:",o),A("×©×’×™××” ×‘×˜×¢×™× ×ª ×¨×©×™××ª ×©×™×¢×•×¨×™ ×”×ª×™××•×¨×™×”")}finally{y(!1)}},W=async o=>{try{const F=(await R.theory.getTheoryLesson(o)).enrolledStudentIds||[];if(F.length===0){i([]);return}const $=(await R.students.getStudents({ids:F.join(",")})).map(G=>({id:G._id,firstName:G.personalInfo?.firstName||"",lastName:G.personalInfo?.lastName||"",grade:G.academicInfo?.gradeLevel,instrument:G.primaryInstrument,enrollmentDate:G.createdAt||new Date().toISOString(),attendance:{total:0,present:0,absent:0}}));i($)}catch(f){console.error("Error loading lesson students:",f)}},V=b.filter(o=>l===""||o.name.toLowerCase().includes(l.toLowerCase())||o.level.toLowerCase().includes(l.toLowerCase())||o.description?.toLowerCase().includes(l.toLowerCase())),H=async o=>{if(window.confirm("×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ×©×™×¢×•×¨ ×–×”?"))try{await R.theory.deleteTheoryLesson(o),N(f=>f.filter(F=>F.id!==o)),u===o&&(L(null),i([]))}catch(f){console.error("Error deleting lesson:",f),alert("×©×’×™××” ×‘××—×™×§×ª ×”×©×™×¢×•×¨")}},K=async o=>{try{const f=await J(o);if(f.hasConflict){_(f),M(!0);return}if(w){const F={name:o.name,description:o.description,level:o.level,duration:o.duration,capacity:o.capacity,dayOfWeek:o.schedule?.dayOfWeek,startTime:o.schedule?.startTime,endTime:o.schedule?.endTime,isActive:o.status==="active",location:o.venue},D=await R.theory.updateTheoryLesson(w.id,F),$={id:D._id,name:D.name,description:D.description,level:D.level,duration:D.duration,capacity:D.capacity,enrolledCount:D.enrolledStudentIds?.length||0,schedule:{dayOfWeek:D.dayOfWeek,startTime:D.startTime,endTime:D.endTime},status:D.isActive?"active":"inactive",venue:D.location,materials:D.materials||[]};N(G=>G.map(se=>se.id===w.id?$:se))}else{const F=t?._id,D={name:o.name,description:o.description,level:o.level,duration:o.duration,capacity:o.capacity,dayOfWeek:o.schedule?.dayOfWeek,startTime:o.schedule?.startTime,endTime:o.schedule?.endTime,isActive:o.status==="active",location:o.venue,teacherId:F},$=await R.theory.createTheoryLesson(D),G={id:$._id,name:$.name,description:$.description,level:$.level,duration:$.duration,capacity:$.capacity,enrolledCount:$.enrolledStudentIds?.length||0,schedule:{dayOfWeek:$.dayOfWeek,startTime:$.startTime,endTime:$.endTime},status:$.isActive?"active":"inactive",venue:$.location,materials:$.materials||[]};N(se=>[...se,G])}C(!1),E(null)}catch(f){console.error("Error saving lesson:",f),alert("×©×’×™××” ×‘×©××™×¨×ª ×¤×¨×˜×™ ×”×©×™×¢×•×¨")}},J=async o=>{try{const f=b.filter(G=>G.id!==w?.id&&G.schedule.dayOfWeek===o.schedule?.dayOfWeek),F=o.schedule?.startTime,D=o.schedule?.endTime,$=f.filter(G=>{const se=G.schedule.startTime,s=G.schedule.endTime;return F&&D&&se&&s&&(F>=se&&F<s||D>se&&D<=s||F<=se&&D>=s)});return $.length>0?{hasConflict:!0,conflictDetails:`×”×ª× ×’×©×•×ª ×¢× ${$[0].name} ×‘${de($[0].schedule.dayOfWeek)} ${$[0].schedule.startTime}-${$[0].schedule.endTime}`,suggestions:["×©× ×” ××ª ×©×¢×ª ×”×©×™×¢×•×¨","×”×¢×‘×¨ ×œ×™×•× ××—×¨","×§×¦×¨ ××ª ××©×š ×”×©×™×¢×•×¨"]}:{hasConflict:!1}}catch(f){return console.error("Error checking conflicts:",f),{hasConflict:!1}}},S=async()=>{try{const o=await R.students.getStudents(),f=U.map(D=>D.id),F=o.filter(D=>!f.includes(D._id)).map(D=>({id:D._id,firstName:D.personalInfo?.firstName||"",lastName:D.personalInfo?.lastName||"",grade:D.academicInfo?.gradeLevel,instrument:D.primaryInstrument,enrollmentDate:new Date().toISOString(),attendance:{total:0,present:0,absent:0}}));I(F)}catch(o){console.error("Error loading available students:",o)}},Z=async o=>{if(u)try{await et.enrollStudent(u,o,{method:"manual",performedBy:"teacher",reason:"Teacher enrollment"}),await W(u),await S()}catch(f){console.error("Error enrolling student:",f),alert("×©×’×™××” ×‘×¨×™×©×•× ×”×ª×œ××™×“")}},ae=async o=>{if(u)try{await et.unenrollStudent(u,o,{reason:"Teacher unenrollment"}),await W(u),await S()}catch(f){console.error("Error unenrolling student:",f),alert("×©×’×™××” ×‘×‘×™×˜×•×œ ×¨×™×©×•× ×”×ª×œ××™×“")}},me=async o=>{try{const f={...o,name:`${o.name} - ×¢×•×ª×§`,id:void 0};await K(f)}catch(f){console.error("Error duplicating lesson:",f),alert("×©×’×™××” ×‘×©×›×¤×•×œ ×”×©×™×¢×•×¨")}},oe=o=>{switch(o){case"beginner":return"××ª×—×™×œ×™×";case"intermediate":return"×‘×™× ×•× ×™×™×";case"advanced":return"××ª×§×“××™×";default:return o}},ge=o=>o.substring(0,5),de=o=>({sunday:"×™×•× ×¨××©×•×Ÿ",monday:"×™×•× ×©× ×™",tuesday:"×™×•× ×©×œ×™×©×™",wednesday:"×™×•× ×¨×‘×™×¢×™",thursday:"×™×•× ×—××™×©×™",friday:"×™×•× ×©×™×©×™",saturday:"×™×•× ×©×‘×ª"})[o.toLowerCase()]||o;return v?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"×˜×•×¢×Ÿ ×¨×©×™××ª ×©×™×¢×•×¨×™×..."})]})}):h?e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("div",{className:"text-red-800 font-reisinger-yonatan",children:h})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-yonatan",children:"× ×™×”×•×œ ×ª×™××•×¨×™×” ××ª×§×“×"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[b.length," ×©×™×¢×•×¨×™× ×¤×¢×™×œ×™×"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>d(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(bt,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"× ×”×œ ×§×‘×•×¦×•×ª"})]}),e.jsxs("button",{onClick:()=>C(!0),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[e.jsx($e,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"×”×•×¡×£ ×©×™×¢×•×¨"})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex space-x-8 px-6",dir:"rtl",children:[{id:"lessons",label:"×©×™×¢×•×¨×™×",icon:Pe},{id:"groups",label:"×§×‘×•×¦×•×ª",icon:ye},{id:"curriculum",label:"×ª×›× ×™×ª ×œ×™××•×“×™×",icon:Je},{id:"grades",label:"×¦×™×•× ×™×",icon:Ze}].map(o=>{const f=o.icon;return e.jsxs("button",{onClick:()=>ne(o.id),className:`py-4 px-1 border-b-2 font-medium text-sm transition-colors flex items-center gap-2 font-reisinger-yonatan ${Y===o.id?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(f,{className:"w-4 h-4"}),o.label]},o.id)})})}),e.jsxs("div",{className:"p-6",children:[Y==="lessons"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx(Te,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"×—×™×¤×•×© ×©×™×¢×•×¨×™×...",value:l,onChange:o=>a(o.target.value),className:"w-full pl-4 pr-12 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"rtl"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"space-y-4",children:V.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Pe,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2 font-reisinger-yonatan",children:l?"×œ× × ××¦××• ×©×™×¢×•×¨×™×":"××™×Ÿ ×©×™×¢×•×¨×™× ×¨×©×•××™×"}),e.jsx("p",{className:"text-gray-600 font-reisinger-yonatan",children:l?"× ×¡×” ××™×œ×•×ª ×—×™×¤×•×© ××—×¨×•×ª":"×”×ª×—×œ ×‘×”×•×¡×¤×ª ×”×©×™×¢×•×¨ ×”×¨××©×•×Ÿ ×©×œ×š"})]}):V.map(o=>e.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-all cursor-pointer ${u===o.id?"ring-2 ring-indigo-500 bg-indigo-50":""}`,onClick:()=>{L(o.id),W(o.id)},children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 font-reisinger-yonatan",children:o.name}),e.jsxs("p",{className:"text-sm text-gray-600 font-reisinger-yonatan",children:[oe(o.level)," â€¢ ",o.duration," ×“×§×•×ª"]}),o.description&&e.jsx("p",{className:"text-sm text-gray-500 mt-1 font-reisinger-yonatan",children:o.description})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:f=>{f.stopPropagation(),me(o)},className:"p-1 text-gray-400 hover:text-blue-600 transition-colors",title:"×©×›×¤×œ ×©×™×¢×•×¨",children:e.jsx(jt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:f=>{f.stopPropagation(),E(o),C(!0)},className:"p-1 text-gray-400 hover:text-indigo-600 transition-colors",title:"×¢×¨×•×š ×©×™×¢×•×¨",children:e.jsx(We,{className:"w-4 h-4"})}),e.jsx("button",{onClick:f=>{f.stopPropagation(),H(o.id)},className:"p-1 text-gray-400 hover:text-red-600 transition-colors",title:"××—×§ ×©×™×¢×•×¨",children:e.jsx(ze,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-600 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(fe,{className:"w-4 h-4"}),e.jsx("span",{children:de(o.schedule.dayOfWeek)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(pe,{className:"w-4 h-4"}),e.jsxs("span",{children:[ge(o.schedule.startTime)," - ",ge(o.schedule.endTime)]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsxs("span",{children:[o.enrolledCount||0,"/",o.capacity]})]}),o.venue&&e.jsx("span",{children:o.venue})]}),e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${o.status==="active"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:o.status==="active"?"×¤×¢×™×œ":"×œ× ×¤×¢×™×œ"})]})]},o.id))}),u&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 font-reisinger-yonatan",children:"×ª×œ××™×“×™ ×”×©×™×¢×•×¨"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:()=>{O(!0),S()},className:"flex items-center gap-1 text-indigo-600 hover:text-indigo-800 text-sm font-medium font-reisinger-yonatan",children:[e.jsx(be,{className:"w-4 h-4"}),"×”×•×¡×£ ×ª×œ××™×“"]})})]}),U.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ye,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500 text-sm font-reisinger-yonatan",children:"××™×Ÿ ×ª×œ××™×“×™× ×¨×©×•××™× ×œ×©×™×¢×•×¨"})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:U.map(o=>e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 rounded border",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-sm font-reisinger-yonatan",children:[o.firstName," ",o.lastName]}),e.jsxs("div",{className:"text-xs text-gray-500 font-reisinger-yonatan",children:[o.instrument&&`${o.instrument} â€¢ `,o.grade&&`×›×™×ª×” ${o.grade} â€¢ `,"×¨×™×©×•×: ",new Date(o.enrollmentDate).toLocaleDateString("he-IL")]}),o.attendance&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1 font-reisinger-yonatan",children:["× ×•×›×—×•×ª: ",o.attendance.present,"/",o.attendance.total," ×©×™×¢×•×¨×™×",e.jsxs("span",{className:`ml-2 ${o.attendance.present/o.attendance.total>=.8?"text-green-600":"text-red-600"}`,children:["(",Math.round(o.attendance.present/o.attendance.total*100),"%)"]})]})]}),e.jsx("button",{onClick:()=>ae(o.id),className:"text-red-600 hover:text-red-800 p-1",title:"×”×¡×¨ ×ª×œ××™×“",children:e.jsx(it,{className:"w-4 h-4"})})]},o.id))})]})]})]}),Y==="groups"&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ye,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2 font-reisinger-yonatan",children:"× ×™×”×•×œ ×§×‘×•×¦×•×ª ×ª×™××•×¨×™×”"}),e.jsx("p",{className:"text-gray-600 font-reisinger-yonatan",children:"×ª×›×•× ×” ×–×• ×ª×”×™×” ×–××™× ×” ×‘×§×¨×•×‘"})]}),Y==="curriculum"&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Je,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2 font-reisinger-yonatan",children:"×ª×›× ×™×ª ×œ×™××•×“×™×"}),e.jsx("p",{className:"text-gray-600 font-reisinger-yonatan",children:"×ª×›×•× ×” ×–×• ×ª×”×™×” ×–××™× ×” ×‘×§×¨×•×‘"})]}),Y==="grades"&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ze,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2 font-reisinger-yonatan",children:"× ×™×”×•×œ ×¦×™×•× ×™×"}),e.jsx("p",{className:"text-gray-600 font-reisinger-yonatan",children:"×ª×›×•× ×” ×–×• ×ª×”×™×” ×–××™× ×” ×‘×§×¨×•×‘"})]})]})]}),n&&e.jsx(qt,{lesson:w,onClose:()=>{C(!1),E(null)},onSubmit:K}),j&&e.jsx(Ut,{availableStudents:c,onClose:()=>O(!1),onEnroll:Z}),p&&B&&e.jsx(Gt,{conflict:B,onClose:()=>M(!1),onResolve:()=>{M(!1),C(!0)}})]})}function qt({lesson:t,onClose:b,onSubmit:N}){const[v,y]=r.useState({name:t?.name||"",description:t?.description||"",level:t?.level||"beginner",duration:t?.duration||60,capacity:t?.capacity||15,status:t?.status||"active",venue:t?.venue||"",schedule:{dayOfWeek:t?.schedule?.dayOfWeek||"sunday",startTime:t?.schedule?.startTime||"09:00",endTime:t?.schedule?.endTime||"10:00"}}),l=n=>{n.preventDefault(),N(v)},a=(n,C)=>{y(w=>({...w,schedule:{...w.schedule,[n]:C}}))};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:t?"×¢×¨×™×›×ª ×©×™×¢×•×¨ ×ª×™××•×¨×™×”":"×”×•×¡×¤×ª ×©×™×¢×•×¨ ×ª×™××•×¨×™×” ×—×“×©"}),e.jsxs("form",{onSubmit:l,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×©× ×”×©×™×¢×•×¨ *"}),e.jsx("input",{type:"text",required:!0,value:v.name,onChange:n=>y(C=>({...C,name:n.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×ª×™××•×¨ ×”×©×™×¢×•×¨"}),e.jsx("textarea",{value:v.description,onChange:n=>y(C=>({...C,description:n.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×¨××” *"}),e.jsxs("select",{required:!0,value:v.level,onChange:n=>y(C=>({...C,level:n.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"beginner",children:"××ª×—×™×œ×™×"}),e.jsx("option",{value:"intermediate",children:"×‘×™× ×•× ×™×™×"}),e.jsx("option",{value:"advanced",children:"××ª×§×“××™×"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"××©×š ×”×©×™×¢×•×¨ (×“×§×•×ª) *"}),e.jsx("input",{type:"number",required:!0,min:"30",max:"180",step:"15",value:v.duration,onChange:n=>y(C=>({...C,duration:parseInt(n.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×§×™×‘×•×œ×ª ×ª×œ××™×“×™× *"}),e.jsx("input",{type:"number",required:!0,min:"1",max:"50",value:v.capacity,onChange:n=>y(C=>({...C,capacity:parseInt(n.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×¡×˜×˜×•×¡"}),e.jsxs("select",{value:v.status,onChange:n=>y(C=>({...C,status:n.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"active",children:"×¤×¢×™×œ"}),e.jsx("option",{value:"inactive",children:"×œ× ×¤×¢×™×œ"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×™×•× ×”×©×™×¢×•×¨ *"}),e.jsxs("select",{required:!0,value:v.schedule.dayOfWeek,onChange:n=>a("dayOfWeek",n.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"sunday",children:"×™×•× ×¨××©×•×Ÿ"}),e.jsx("option",{value:"monday",children:"×™×•× ×©× ×™"}),e.jsx("option",{value:"tuesday",children:"×™×•× ×©×œ×™×©×™"}),e.jsx("option",{value:"wednesday",children:"×™×•× ×¨×‘×™×¢×™"}),e.jsx("option",{value:"thursday",children:"×™×•× ×—××™×©×™"}),e.jsx("option",{value:"friday",children:"×™×•× ×©×™×©×™"}),e.jsx("option",{value:"saturday",children:"×™×•× ×©×‘×ª"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×©×¢×ª ×”×ª×—×œ×” *"}),e.jsx("input",{type:"time",required:!0,value:v.schedule.startTime,onChange:n=>a("startTime",n.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×©×¢×ª ×¡×™×•× *"}),e.jsx("input",{type:"time",required:!0,value:v.schedule.endTime,onChange:n=>a("endTime",n.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"××§×•× ×”×©×™×¢×•×¨"}),e.jsx("input",{type:"text",value:v.venue,onChange:n=>y(C=>({...C,venue:n.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors font-reisinger-yonatan",children:t?"×¢×“×›×Ÿ":"×”×•×¡×£"}),e.jsx("button",{type:"button",onClick:b,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors font-reisinger-yonatan",children:"×‘×™×˜×•×œ"})]})]})]})})}function Ut({availableStudents:t,onClose:b,onEnroll:N}){const[v,y]=r.useState(""),l=t.filter(a=>`${a.firstName} ${a.lastName}`.toLowerCase().includes(v.toLowerCase())||a.instrument?.toLowerCase().includes(v.toLowerCase()));return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4 max-h-[80vh] overflow-y-auto",dir:"rtl",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:"×”×•×¡×£ ×ª×œ××™×“ ×œ×©×™×¢×•×¨"}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(Te,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"×—×™×¤×•×© ×ª×œ××™×“×™×...",value:v,onChange:a=>y(a.target.value),className:"w-full pl-4 pr-10 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:l.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ye,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"××™×Ÿ ×ª×œ××™×“×™× ×–××™× ×™×"})]}):l.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:[a.firstName," ",a.lastName]}),e.jsxs("div",{className:"text-sm text-gray-600 font-reisinger-yonatan",children:[a.instrument&&`${a.instrument} â€¢ `,a.grade&&`×›×™×ª×” ${a.grade}`]})]}),e.jsxs("button",{onClick:()=>N(a.id),className:"flex items-center gap-1 px-3 py-1 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm font-reisinger-yonatan",children:[e.jsx(be,{className:"w-4 h-4"}),"×”×•×¡×£"]})]},a.id))}),e.jsx("div",{className:"flex gap-3 mt-6",children:e.jsx("button",{onClick:b,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors font-reisinger-yonatan",children:"×¡×’×•×¨"})})]})})}function Gt({conflict:t,onClose:b,onResolve:N}){return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Nt,{className:"w-8 h-8 text-yellow-600"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×”×ª× ×’×©×•×ª ×‘×œ×•×— ×”×–×× ×™×"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-gray-700 font-reisinger-yonatan mb-3",children:t.conflictDetails}),t.suggestions&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 mb-2 font-reisinger-yonatan",children:"×”×¦×¢×•×ª ×œ×¤×ª×¨×•×Ÿ:"}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-gray-600",children:t.suggestions.map((v,y)=>e.jsx("li",{className:"font-reisinger-yonatan",children:v},y))})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:N,className:"flex-1 bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors font-reisinger-yonatan",children:"×¢×¨×•×š ×©×™×¢×•×¨"}),e.jsx("button",{onClick:b,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors font-reisinger-yonatan",children:"×‘×™×˜×•×œ"})]})]})})}function Qt(){const{user:t}=Ie(),[b,N]=r.useState([]),[v,y]=r.useState(!0),[l,a]=r.useState(new Date().toISOString().split("T")[0]),[n,C]=r.useState({totalStudents:0,markedToday:0,presentToday:0,absentToday:0});r.useEffect(()=>{w()},[l]);const w=async()=>{try{y(!0);const i=t?._id||t?.teacherId||t?.id;if(!i){Ne.error("×œ× × ××¦× ××–×”×” ××•×¨×”");return}const h=t?.teaching?.studentIds||[];if(h.length===0){N([]),C({totalStudents:0,markedToday:0,presentToday:0,absentToday:0}),y(!1);return}const x=(await R.students.getBatchStudents(h)).map(async M=>{try{const c=await R.attendance.getIndividualLessonAttendance({studentId:M._id||M.id,teacherId:i,date:l});return{...M,attendanceStatus:c?.status||null,isMarking:!1}}catch{return{...M,attendanceStatus:null,isMarking:!1}}}),d=await Promise.all(x);N(d);const j=d.filter(M=>M.attendanceStatus!==null),O=d.filter(M=>M.attendanceStatus==="present"),p=d.filter(M=>M.attendanceStatus==="absent");C({totalStudents:d.length,markedToday:j.length,presentToday:O.length,absentToday:p.length})}catch(i){console.error("Error loading students and attendance:",i),Ne.error("×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™ × ×•×›×—×•×ª")}finally{y(!1)}},E=async(i,h)=>{const A=t?._id||t?.teacherId||t?.id;if(!A){Ne.error("×œ× × ××¦× ××–×”×” ××•×¨×”");return}N(x=>x.map(d=>(d._id||d.id)===i?{...d,isMarking:!0}:d));try{const x={studentId:i,teacherId:A,date:l,status:h,lessonType:"individual"};await R.attendance.saveIndividualLessonAttendance(x),N(j=>j.map(O=>(O._id||O.id)===i?{...O,attendanceStatus:h,isMarking:!1}:O)),C(j=>{const O=b.find(M=>(M._id||M.id)===i)?.attendanceStatus!==null,p=b.find(M=>(M._id||M.id)===i)?.attendanceStatus==="present";return{...j,markedToday:O?j.markedToday:j.markedToday+1,presentToday:h==="present"?p?j.presentToday:j.presentToday+1:p?j.presentToday-1:j.presentToday,absentToday:h==="absent"?!p&&O?j.absentToday:j.absentToday+1:O&&!p?j.absentToday-1:j.absentToday}});const d=b.find(j=>(j._id||j.id)===i)?.personalInfo?.fullName||"×”×ª×œ××™×“";Ne.success(h==="present"?`${d} ×¡×•××Ÿ ×›× ×•×›×— âœ“`:`${d} ×¡×•××Ÿ ×›× ×¢×“×¨`,{duration:2e3})}catch(x){console.error("Error marking attendance:",x),Ne.error("×©×’×™××” ×‘×¡×™××•×Ÿ × ×•×›×—×•×ª"),N(d=>d.map(j=>(j._id||j.id)===i?{...j,isMarking:!1}:j))}},u=async i=>{const h=b.filter(d=>d.attendanceStatus===null);if(h.length===0){Ne("×›×œ ×”×ª×œ××™×“×™× ×›×‘×¨ ×¡×•×× ×•",{icon:"â„¹ï¸"});return}N(d=>d.map(j=>j.attendanceStatus===null?{...j,isMarking:!0}:j));const A=i==="present"?"× ×•×›×—×™×":"× ×¢×“×¨×™×",x=Ne.loading(`××¡××Ÿ ${h.length} ×ª×œ××™×“×™× ×›${A}...`);try{const d=h.map(j=>E(j._id||j.id,i));await Promise.all(d),Ne.success(`×›×œ ×”×ª×œ××™×“×™× ×¡×•×× ×• ×›${A} âœ“`,{id:x})}catch{Ne.error("×©×’×™××” ×‘×¡×™××•×Ÿ × ×•×›×—×•×ª ×”××•× ×™×ª",{id:x}),N(j=>j.map(O=>({...O,isMarking:!1})))}},L=()=>new Date().toLocaleDateString("he-IL",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),U=l===new Date().toISOString().split("T")[0];return v?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ve,{className:"w-8 h-8 text-indigo-600 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"×˜×•×¢×Ÿ × ×ª×•× ×™ × ×•×›×—×•×ª..."})]})}):b.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ye,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"××™×Ÿ ×ª×œ××™×“×™×"}),e.jsx("p",{className:"text-gray-600",children:"×˜×¨× ×”×•×§×¦×• ×œ×š ×ª×œ××™×“×™×"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(fe,{className:"w-5 h-5 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×ª××¨×™×š"}),e.jsx("input",{type:"date",value:l,onChange:i=>a(i.target.value),max:new Date().toISOString().split("T")[0],className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]})]}),U&&e.jsx("div",{className:"text-sm text-gray-600 font-medium",children:L()})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-blue-50 rounded-lg border border-blue-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-600",children:"×¡×”×´×› ×ª×œ××™×“×™×"}),e.jsx("p",{className:"text-2xl font-bold text-blue-700 mt-1",children:n.totalStudents})]}),e.jsx(ye,{className:"w-8 h-8 text-blue-400"})]})}),e.jsx("div",{className:"bg-green-50 rounded-lg border border-green-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:"× ×•×›×—×™×"}),e.jsx("p",{className:"text-2xl font-bold text-green-700 mt-1",children:n.presentToday})]}),e.jsx(Ee,{className:"w-8 h-8 text-green-400"})]})}),e.jsx("div",{className:"bg-red-50 rounded-lg border border-red-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-600",children:"× ×¢×“×¨×™×"}),e.jsx("p",{className:"text-2xl font-bold text-red-700 mt-1",children:n.absentToday})]}),e.jsx(_e,{className:"w-8 h-8 text-red-400"})]})}),e.jsx("div",{className:"bg-purple-50 rounded-lg border border-purple-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-purple-600",children:"××—×•×– × ×•×›×—×•×ª"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 mt-1",children:[n.markedToday>0?Math.round(n.presentToday/n.markedToday*100):0,"%"]})]}),e.jsx(vt,{className:"w-8 h-8 text-purple-400"})]})})]}),n.markedToday<n.totalStudents&&e.jsx("div",{className:"bg-indigo-50 rounded-lg border border-indigo-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5 text-indigo-600"}),e.jsx("span",{className:"text-sm font-medium text-indigo-900",children:"×¡××Ÿ ××ª ×›×œ ×”×ª×œ××™×“×™× ×©×˜×¨× ×¡×•×× ×•:"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>u("present"),className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium",children:[e.jsx(Ee,{className:"w-4 h-4"}),"×¡××Ÿ ×”×›×œ ×›× ×•×›×—×™×"]}),e.jsxs("button",{onClick:()=>u("absent"),className:"flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm font-medium",children:[e.jsx(_e,{className:"w-4 h-4"}),"×¡××Ÿ ×”×›×œ ×›× ×¢×“×¨×™×"]})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-6 py-3 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"×¨×©×™××ª ×ª×œ××™×“×™×"})}),e.jsx("div",{className:"divide-y divide-gray-200",children:b.map(i=>{const h=i._id||i.id;return e.jsx("div",{className:`px-6 py-4 hover:bg-gray-50 transition-colors ${i.isMarking?"opacity-60":""}`,children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-indigo-600 font-semibold",children:i.personalInfo.fullName.split(" ").map(A=>A[0]).join("")})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h4",{className:"font-medium text-gray-900 truncate",children:i.personalInfo.fullName}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[i.instrument&&e.jsx("span",{children:i.instrument}),i.academicInfo?.grade&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:["×›×™×ª×” ",i.academicInfo.grade]})]})]})]})]})}),e.jsxs("div",{className:"flex-shrink-0",children:[i.attendanceStatus==="present"&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full bg-green-100 text-green-800 text-sm font-medium",children:[e.jsx(Ee,{className:"w-4 h-4"}),"× ×•×›×—"]}),i.attendanceStatus==="absent"&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full bg-red-100 text-red-800 text-sm font-medium",children:[e.jsx(_e,{className:"w-4 h-4"}),"× ×¢×“×¨"]}),i.attendanceStatus===null&&e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full bg-gray-100 text-gray-600 text-sm font-medium",children:"×œ× ×¡×•××Ÿ"})]}),e.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[e.jsxs("button",{onClick:()=>E(h,"present"),disabled:i.isMarking||i.attendanceStatus==="present",className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${i.attendanceStatus==="present"?"bg-green-100 text-green-700 cursor-default":"bg-green-600 text-white hover:bg-green-700 active:scale-95"} disabled:opacity-50 disabled:cursor-not-allowed`,children:[i.isMarking?e.jsx(Ve,{className:"w-4 h-4 animate-spin"}):e.jsx(Ee,{className:"w-4 h-4"}),"× ×•×›×—"]}),e.jsxs("button",{onClick:()=>E(h,"absent"),disabled:i.isMarking||i.attendanceStatus==="absent",className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${i.attendanceStatus==="absent"?"bg-red-100 text-red-700 cursor-default":"bg-red-600 text-white hover:bg-red-700 active:scale-95"} disabled:opacity-50 disabled:cursor-not-allowed`,children:[i.isMarking?e.jsx(Ve,{className:"w-4 h-4 animate-spin"}):e.jsx(_e,{className:"w-4 h-4"}),"× ×¢×“×¨"]})]})]})},h)})})]}),n.markedToday===n.totalStudents&&n.totalStudents>0&&e.jsx("div",{className:"bg-green-50 rounded-lg border border-green-200 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ee,{className:"w-6 h-6 text-green-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-900",children:"×›×œ ×”×ª×œ××™×“×™× ×¡×•×× ×•! âœ“"}),e.jsxs("p",{className:"text-sm text-green-700",children:[n.presentToday," × ×•×›×—×™× â€¢ ",n.absentToday," × ×¢×“×¨×™×"]})]})]})})]})}function Vt(){const{user:t,checkAuthStatus:b}=Ie(),[N,v]=r.useState(!1),[y,l]=r.useState(!1),[a,n]=r.useState({type:null,message:""}),[C,w]=r.useState(null),[E,u]=r.useState({fullName:"",email:"",phone:"",address:"",birthDate:""});r.useEffect(()=>{L()},[]);const L=async()=>{try{l(!0);const x=await Ye.getMyProfile();w(x),u({fullName:x?.personalInfo?.fullName||"",email:x?.personalInfo?.email||"",phone:x?.personalInfo?.phone||"",address:x?.personalInfo?.address||"",birthDate:x?.personalInfo?.birthDate||""})}catch(x){console.error("Error fetching profile data:",x),n({type:"error",message:"×©×’×™××” ×‘×˜×¢×™× ×ª ×¤×¨×˜×™ ×”×¤×¨×•×¤×™×œ"}),t&&u({fullName:t?.personalInfo?.fullName||"",email:t?.personalInfo?.email||t?.email||"",phone:t?.personalInfo?.phone||t?.phone||"",address:t?.personalInfo?.address||t?.address||"",birthDate:t?.personalInfo?.birthDate||t?.birthDate||""})}finally{l(!1)}},U=async()=>{try{l(!0),n({type:null,message:""});const x=await Ye.updateMyProfile(E);w(x),b&&await b(!0),v(!1),n({type:"success",message:"×”×¤×¨×•×¤×™×œ ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”"}),setTimeout(()=>{n({type:null,message:""})},3e3)}catch(x){console.error("Error updating profile:",x),n({type:"error",message:"×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”×¤×¨×•×¤×™×œ. ×× × × ×¡×” ×©×•×‘."})}finally{l(!1)}},i=()=>{const x=C||t;u({fullName:x?.personalInfo?.fullName||"",email:x?.personalInfo?.email||x?.email||"",phone:x?.personalInfo?.phone||x?.phone||"",address:x?.personalInfo?.address||x?.address||"",birthDate:x?.personalInfo?.birthDate||x?.birthDate||""}),v(!1),n({type:null,message:""})},h=x=>x?new Date(x).toLocaleDateString("he-IL"):"",A=C||t;return y&&!A?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600 font-reisinger-yonatan",children:"×˜×•×¢×Ÿ ×¤×¨×˜×™ ×¤×¨×•×¤×™×œ..."})]})}):e.jsxs("div",{className:"space-y-6",children:[a.type&&e.jsxs("div",{className:`p-4 rounded-lg flex items-center gap-2 ${a.type==="success"?"bg-green-50 text-green-800 border border-green-200":"bg-red-50 text-red-800 border border-red-200"}`,children:[a.type==="success"?e.jsx(qe,{className:"w-5 h-5"}):e.jsx(Me,{className:"w-5 h-5"}),e.jsx("span",{className:"font-reisinger-yonatan",children:a.message})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-yonatan",children:"×¤×¨×˜×™× ××™×©×™×™×"}),N?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:U,disabled:y,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[y?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsx(rt,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"×©××™×¨×”"})]}),e.jsxs("button",{onClick:i,disabled:y,className:"flex items-center gap-2 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ve,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"×‘×™×˜×•×œ"})]})]}):e.jsxs("button",{onClick:()=>v(!0),disabled:y,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(wt,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"×¢×¨×™×›×”"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:"×©× ××œ×"}),N?e.jsx("input",{type:"text",value:E.fullName,onChange:x=>u(d=>({...d,fullName:x.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"rtl",placeholder:"×”×–×Ÿ ×©× ××œ×"}):e.jsx("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:e.jsx("span",{className:"font-reisinger-yonatan",children:E.fullName||"×œ× ×¦×•×™×Ÿ"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:'×“×•×"×œ'}),N?e.jsx("input",{type:"email",value:E.email,onChange:x=>u(d=>({...d,email:x.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"ltr",placeholder:"example@email.com"}):e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:[e.jsx(St,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-reisinger-yonatan",dir:"ltr",children:E.email||"×œ× ×¦×•×™×Ÿ"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:"×˜×œ×¤×•×Ÿ"}),N?e.jsx("input",{type:"tel",value:E.phone,onChange:x=>u(d=>({...d,phone:x.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"ltr",placeholder:"050-1234567"}):e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:[e.jsx(tt,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-reisinger-yonatan",dir:"ltr",children:E.phone||"×œ× ×¦×•×™×Ÿ"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:"×›×ª×•×‘×ª"}),N?e.jsx("input",{type:"text",value:E.address,onChange:x=>u(d=>({...d,address:x.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"rtl",placeholder:"×”×–×Ÿ ×›×ª×•×‘×ª"}):e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:[e.jsx(ke,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-reisinger-yonatan",children:E.address||"×œ× ×¦×•×™×Ÿ"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:"×ª××¨×™×š ×œ×™×“×”"}),N?e.jsx("input",{type:"date",value:E.birthDate,onChange:x=>u(d=>({...d,birthDate:x.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"}):e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:[e.jsx(fe,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-reisinger-yonatan",children:h(E.birthDate)||"×œ× ×¦×•×™×Ÿ"})]})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-blue-900 mb-2 font-reisinger-yonatan",children:"××™×“×¢ ×ª×¤×§×™×“"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-sm font-medium text-blue-700 font-reisinger-yonatan",children:"×ª×¤×§×™×“:"}),e.jsx("div",{className:"text-blue-900 font-reisinger-yonatan",children:(()=>{const x=A?.roles||[];if(x.length>0)return x.join(", ");const d=A?.role||"";switch(d){case"teacher":return"××•×¨×”";case"××•×¨×”":return"××•×¨×”";case"conductor":return"×× ×¦×—";case"×× ×¦×—":return"×× ×¦×—";case"theory_teacher":return"××•×¨×” ×ª×™××•×¨×™×”";case"××•×¨×” ×ª×™××•×¨×™×”":return"××•×¨×” ×ª×™××•×¨×™×”";case"admin":return"×× ×”×œ";case"×× ×”×œ":return"×× ×”×œ";default:return d||"×œ× ×¦×•×™×Ÿ"}})()})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-sm font-medium text-blue-700 font-reisinger-yonatan",children:"××–×”×” ××©×ª××©:"}),e.jsx("div",{className:"text-blue-900 font-reisinger-yonatan font-mono text-sm",children:A?.teacherId||A?._id||A?.id||"×œ× ×¦×•×™×Ÿ"})]}),A?.isActive!==void 0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-sm font-medium text-blue-700 font-reisinger-yonatan",children:"×¡×˜×˜×•×¡:"}),e.jsx("div",{className:"text-blue-900 font-reisinger-yonatan",children:A.isActive?"×¤×¢×™×œ":"×œ× ×¤×¢×™×œ"})]}),A?.professionalInfo?.instrument&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-sm font-medium text-blue-700 font-reisinger-yonatan",children:"×›×œ×™ × ×’×™× ×”:"}),e.jsx("div",{className:"text-blue-900 font-reisinger-yonatan",children:A.professionalInfo.instrument})]})]})]})]})}function ss(){const{user:t}=Ie(),b=ft();pt();const[N,v]=r.useState("general"),[y,l]=r.useState(null),[a,n]=r.useState(!0),[C,w]=r.useState(null);r.useEffect(()=>{const c=b.state;if(c?.activeTab){v(c.activeTab),window.history.replaceState(null,"",window.location.pathname);return}const I=new URLSearchParams(b.search),B=I.get("tab"),_=I.get("action");B&&v(B),_&&w(_),(B||_)&&window.history.replaceState(null,"",window.location.pathname)},[b]),r.useEffect(()=>{t&&E()},[t]);const E=async()=>{try{if(n(!0),!(t?._id||t?.teacherId||t?.id)){console.warn("No user ID available for loading profile statistics");return}const I=await Ye.getMyProfile();if(!I){console.warn("No teacher profile found"),l({studentsCount:0,activeStudents:0,weeklyHours:0,orchestrasCount:0,theoryLessonsCount:0});return}const B=I?.teaching?.studentIds||[],_=I?.conducting?.orchestraIds||[],Y=I?.teaching?.timeBlocks||[],[ne,k]=await Promise.allSettled([B.length>0?R.students.getBatchStudents(B):Promise.resolve([]),_.length>0?R.orchestras.getBatchOrchestras(_):Promise.resolve([])]),W=ne.status==="fulfilled"?ne.value:[];ne.status==="rejected"&&console.error("Failed to load student data:",ne.reason);const V=k.status==="fulfilled"?k.value:[];k.status==="rejected"&&console.error("Failed to load orchestra data:",k.reason);const H=Array.isArray(W)?W.filter(S=>S.academicInfo?.isActive!==!1):[],K=Array.isArray(Y)?Y.reduce((S,Z)=>S+(parseInt(Z.totalDuration)||0),0):0,J=Math.round(K/60*10)/10;l({studentsCount:Array.isArray(W)?W.length:0,activeStudents:H.length,weeklyHours:J,orchestrasCount:Array.isArray(V)?V.length:0,theoryLessonsCount:0})}catch(c){console.error("Error loading profile statistics:",c),l({studentsCount:0,activeStudents:0,weeklyHours:0,orchestrasCount:0,theoryLessonsCount:0})}finally{n(!1)}};if(!t)return e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"×˜×•×¢×Ÿ ×¤×¨×˜×™ ××©×ª××©..."})]})});const u=()=>t?.roles?.includes("conductor")||t?.roles?.includes("×× ×¦×—")||t?.conducting?.orchestraIds&&t.conducting.orchestraIds.length>0,L=()=>t?.roles?.includes("teacher")||t?.roles?.includes("××•×¨×”")||t?.teaching?.studentIds&&t.teaching.studentIds.length>0,U=()=>t?.roles?.includes("theory_teacher")||t?.roles?.includes("××•×¨×” ×ª××•×¨×™×”"),h=(()=>{const I=[...[{id:"general",label:"×¤×¨×˜×™× ×›×œ×œ×™×™×",icon:De,component:Vt}]];return L()&&(I.push({id:"students",label:"×”×ª×œ××™×“×™× ×©×œ×™",icon:ye,component:Lt}),I.push({id:"schedule",label:"×œ×•×— ×–×× ×™× ×©×‘×•×¢×™",icon:fe,component:Ot}),t?.teaching?.studentIds&&t.teaching.studentIds.length>0&&I.push({id:"attendance",label:"× ×•×›×—×•×ª",icon:Oe,component:Qt})),u()&&I.push({id:"orchestras",label:"×”×ª×–××•×¨×•×ª ×©×œ×™",icon:Ce,component:Et}),U()&&I.push({id:"lessons",label:"×©×™×¢×•×¨×™ ×”×ª×™××•×¨×™×” ×©×œ×™",icon:Pe,component:zt}),I})(),x=(h.find(c=>c.id===N)||h[0]).component,d={};N==="students"&&C&&(d.action=C);const j=()=>{const c=t?.role||t?.roles?.[0]||"";switch(c){case"teacher":return"××•×¨×”";case"××•×¨×”":return"××•×¨×”";case"conductor":return"×× ×¦×—";case"×× ×¦×—":return"×× ×¦×—";case"theory_teacher":return"××•×¨×” ×ª×™××•×¨×™×”";case"××•×¨×” ×ª×™××•×¨×™×”":return"××•×¨×” ×ª×™××•×¨×™×”";case"admin":return"×× ×”×œ";case"×× ×”×œ":return"×× ×”×œ";default:return c||"××©×ª××©"}},O=()=>t?.personalInfo?.fullName||t?.fullName||t?.name||"××©×ª××©",p=()=>{const c=O();if(!c||c==="××©×ª××©")return"×";const I=c.trim().split(" ");return I.length>=2?I[0][0]+I[1][0]:I[0][0]||"×"},M=()=>t?.personalInfo?.email||t?.email||"";return e.jsxs("div",{className:"p-6",dir:"rtl",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-indigo-600 flex items-center justify-center",children:e.jsx("span",{className:"text-xl font-bold text-white font-reisinger-yonatan",children:p()})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 font-reisinger-yonatan",children:O()}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[j()," â€¢ ",M()]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-6",children:[e.jsx(Fe,{title:"×¡×”×´×› ×ª×œ××™×“×™×",value:a?"...":y?.studentsCount?.toString()||"0",icon:ye,color:"blue",loading:a}),e.jsx(Fe,{title:"×ª×œ××™×“×™× ×¤×¢×™×œ×™×",value:a?"...":y?.activeStudents?.toString()||"0",icon:Tt,color:"green",loading:a}),e.jsx(Fe,{title:"×©×¢×•×ª ×©×‘×•×¢×™×•×ª",value:a?"...":y?.weeklyHours?.toString()||"0",icon:pe,color:"purple",loading:a}),e.jsx(Fe,{title:u()?"×ª×–××•×¨×•×ª":"×©×™×¢×•×¨×™ ×ª×™××•×¨×™×”",value:a?"...":(y?.orchestrasCount||y?.theoryLessonsCount)?.toString()||"0",icon:u()?Ce:Pe,color:"indigo",loading:a})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 mb-6",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex gap-0 overflow-x-auto scrollbar-hide",children:h.map(c=>{const I=c.icon;return e.jsxs("button",{onClick:()=>v(c.id),className:`flex items-center gap-2 sm:gap-3 px-3 sm:px-6 py-3 sm:py-4 font-medium text-xs sm:text-sm transition-all whitespace-nowrap ${N===c.id?"text-indigo-600 border-b-2 border-indigo-600 bg-indigo-50":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(I,{className:"w-5 h-5"}),e.jsx("span",{className:"font-reisinger-yonatan",children:c.label})]},c.id)})})}),e.jsx("div",{className:"p-6",children:e.jsx(x,{...d})})]})]})}function Fe({title:t,value:b,icon:N,color:v,loading:y}){const a={blue:{bg:"bg-blue-50",text:"text-blue-600",border:"border-blue-200"},green:{bg:"bg-green-50",text:"text-green-600",border:"border-green-200"},purple:{bg:"bg-purple-50",text:"text-purple-600",border:"border-purple-200"},indigo:{bg:"bg-indigo-50",text:"text-indigo-600",border:"border-indigo-200"}}[v];return e.jsx("div",{className:`bg-white rounded-lg border ${a.border} p-3 sm:p-4 shadow-sm hover:shadow-md transition-all duration-200`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-gray-600 font-reisinger-yonatan truncate",children:t}),e.jsx("div",{className:"text-lg sm:text-2xl font-bold text-gray-900 mt-1 font-reisinger-yonatan",children:y?e.jsx("div",{className:"animate-pulse bg-gray-200 h-6 sm:h-8 w-12 sm:w-16 rounded"}):b})]}),e.jsx("div",{className:`${a.bg} p-2 sm:p-3 rounded-full flex-shrink-0 ml-2`,children:e.jsx(N,{className:`w-4 h-4 sm:w-6 sm:h-6 ${a.text}`})})]})})}export{ss as default};
