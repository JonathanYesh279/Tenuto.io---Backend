import{j as e,h as hs,C as je}from"../assets/index-CoKafZFz.js";import{r as p,R as we,c as ys,b as fs}from"./vendor-C9PcmKF2.js";import{C as G}from"./Card-1BAWwzNR.js";import{T as bs}from"./Table-AhthNN5h.js";import{S as xe}from"./StatsCard-DEtP3a5j.js";import{u as js}from"./useBagrut-BaAHn2qN.js";import{a as K}from"./cascade-deletion-BvQll6O-.js";import{ah as ge,ai as Fe,h as te,X as V,c as ie,f as Ns,e as ue,M as ee,aj as oe,T as Y,P as J,ak as Oe,x as ke,al as Ce,U as se,r as pe,d as Be,k as vs,a as Z,am as ws,an as ks,ao as Cs,g as de,S as Bs,a2 as He,a7 as Ss,p as Ls,O as Re,a3 as Ge,ae as Ue,ab as Te,B as Ne,o as $e,ap as Ae,aq as Ds}from"./ui-DsxFGtGk.js";import"./query-BdHdBeoH.js";import"./utils-x1PSU_OZ.js";const Is=({isOpen:s,performance:g,programPieces:t,onClose:w,onUpdate:N})=>{const[h,j]=p.useState(!1),[o,n]=p.useState(g);if(we.useEffect(()=>{n(g),j(!1)},[g]),!s||!g||!o)return null;const k=()=>{o&&(N(o),j(!1))},I=()=>{n(g),j(!1)},U=(d,C)=>{n(D=>D?{...D,evaluation:{...D.evaluation,technique:0,interpretation:0,stage_presence:0,overall_impression:0,...D.evaluation,[d]:C}}:null)},B=()=>{const d=prompt("×”×›× ×¡ ×§×™×©×•×¨ ×œ×”×§×œ×˜×”:");d&&o&&n({...o,recordingLinks:[...o.recordingLinks||[],d]})},S=d=>{o&&n({...o,recordingLinks:o.recordingLinks?.filter((C,D)=>D!==d)})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ge,{className:"w-6 h-6 text-primary-600"}),h?e.jsx("input",{type:"text",value:o.title,onChange:d=>n({...o,title:d.target.value}),className:"text-2xl font-bold text-gray-900 bg-transparent border-b-2 border-gray-300 focus:border-primary-500 outline-none"}):e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:g.title})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[h?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:k,className:"flex items-center gap-1 px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:[e.jsx(te,{className:"w-4 h-4"}),"×©×ž×•×¨"]}),e.jsxs("button",{onClick:I,className:"flex items-center gap-1 px-3 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50",children:[e.jsx(V,{className:"w-4 h-4"}),"×‘×™×˜×•×œ"]})]}):e.jsxs("button",{onClick:()=>j(!0),className:"flex items-center gap-1 px-3 py-2 text-blue-600 border border-blue-300 rounded-lg hover:bg-blue-50",children:[e.jsx(Fe,{className:"w-4 h-4"}),"×¢×¨×•×š"]}),e.jsx("button",{onClick:w,className:"p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg",children:e.jsx(V,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs(G,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"×¤×¨×˜×™ ×”×‘×™×¦×•Ø¹"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ie,{className:"w-5 h-5 text-gray-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×ª××¨×™×š ×•×–×ž×Ÿ"}),h?e.jsx("input",{type:"datetime-local",value:o.date?new Date(o.date).toISOString().slice(0,16):"",onChange:d=>n({...o,date:d.target.value?new Date(d.target.value):void 0}),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"}):e.jsx("p",{className:"text-gray-900",children:g.date?new Date(g.date).toLocaleString("he-IL",{dateStyle:"full",timeStyle:"short"}):"×œ× × ×§×‘×¢"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ns,{className:"w-5 h-5 text-gray-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×ž×§×•×"}),h?e.jsx("input",{type:"text",value:o.location||"",onChange:d=>n({...o,location:d.target.value}),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"×ž×§×•× ×”×‘×™×¦×•×¢"}):e.jsx("p",{className:"text-gray-900",children:g.location||"×œ× ×¦×•×™×Ÿ"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ue,{className:"w-5 h-5 text-gray-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×ž×©×š ×–×ž×Ÿ"}),h?e.jsx("input",{type:"text",value:o.duration||"",onChange:d=>n({...o,duration:d.target.value}),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"×œ×“×•×’×ž×”: 45 ×“×§×•×ª"}):e.jsx("p",{className:"text-gray-900",children:g.duration||"×œ× ×¦×•×™×Ÿ"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ee,{className:"w-5 h-5 text-gray-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×¡×˜×˜×•×¡"}),h?e.jsxs("select",{value:o.status,onChange:d=>n({...o,status:d.target.value}),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"scheduled",children:"×ž×ª×•×–×ž×Ÿ"}),e.jsx("option",{value:"completed",children:"×”×•×©×œ×"}),e.jsx("option",{value:"cancelled",children:"×‘×•×˜×œ"})]}):e.jsxs("p",{className:"text-gray-900",children:[g.status==="completed"&&"×”×•×©×œ×",g.status==="scheduled"&&"×ž×ª×•×–×ž×Ÿ",g.status==="cancelled"&&"×‘×•×˜×œ"]})]})]})]})]}),e.jsxs(G,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"×™×¦×™×¨×•×ª ×‘×‘×™×¦×•×¢"}),e.jsxs("div",{className:"space-y-2",children:[g.pieces.map((d,C)=>{const D=t.find(L=>L.pieceTitle===d||L.pieceName===d);return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(ee,{className:"w-4 h-4 text-primary-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900",children:d}),D&&e.jsxs("div",{className:"text-sm text-gray-600",children:[D.composer," ",D.duration&&`â€¢ ${D.duration}`]})]})]},C)}),g.pieces.length===0&&e.jsx("p",{className:"text-gray-500 text-center py-4",children:"××™×Ÿ ×™×¦×™×¨×•×ª ×©×”×•×’×“×¨×• ×œ×‘×™×¦×•×¢ ×–×”"})]})]}),e.jsxs(G,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"×”×¢×¨×›×”"}),g.evaluation||h?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[{key:"technique",label:"×˜×›× ×™×§×”"},{key:"interpretation",label:"×¤×¨×©× ×•×ª"},{key:"stage_presence",label:"× ×•×›×—×•×ª ×‘×ž×”"},{key:"overall_impression",label:"×¨×•×©× ×›×œ×œ×™"}].map(({key:d,label:C})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:C}),h?e.jsx("input",{type:"number",min:"0",max:"100",value:o.evaluation?.[d]||0,onChange:D=>U(d,parseInt(D.target.value)||0),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"}):e.jsxs("div",{className:"text-2xl font-bold text-primary-600",children:[g.evaluation?.[d]||0,"/100"]})]},d))}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×”×¢×¨×•×ª ×”×ž×¢×¨×™×š"}),h?e.jsx("textarea",{value:o.evaluation?.comments||"",onChange:d=>U("comments",d.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",rows:4,placeholder:"×”×¢×¨×•×ª ×¢×œ ×”×‘×™×¦×•×¢..."}):e.jsx("p",{className:"text-gray-900 bg-gray-50 p-3 rounded-lg",children:g.evaluation?.comments||"××™×Ÿ ×”×¢×¨×•×ª"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×ž×¢×¨×™×š"}),h?e.jsx("input",{type:"text",value:o.evaluation?.evaluator||"",onChange:d=>U("evaluator",d.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"×©× ×”×ž×¢×¨×™×š"}):e.jsx("p",{className:"text-gray-900",children:g.evaluation?.evaluator||"×œ× ×¦×•×™×Ÿ"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×ª××¨×™×š ×”×¢×¨×›×”"}),h?e.jsx("input",{type:"date",value:o.evaluation?.evaluationDate?new Date(o.evaluation.evaluationDate).toISOString().slice(0,10):"",onChange:d=>U("evaluationDate",d.target.value?new Date(d.target.value):void 0),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"}):e.jsx("p",{className:"text-gray-900",children:g.evaluation?.evaluationDate?new Date(g.evaluation.evaluationDate).toLocaleDateString("he-IL"):"×œ× ×¦×•×™×Ÿ"})]})]})]}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"×œ× ×‘×•×¦×¢×” ×”×¢×¨×›×” ×¢×“×™×™×Ÿ"})]}),e.jsxs(G,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"×”×§×œ×˜×•×ª"}),h&&e.jsxs("button",{onClick:B,className:"flex items-center gap-1 px-3 py-2 text-blue-600 border border-blue-300 rounded-lg hover:bg-blue-50",children:[e.jsx(oe,{className:"w-4 h-4"}),"×”×•×¡×£ ×§×™×©×•×¨"]})]}),o.recordingLinks&&o.recordingLinks.length>0?e.jsx("div",{className:"space-y-2",children:o.recordingLinks.map((d,C)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(ge,{className:"w-4 h-4 text-blue-600"}),e.jsx("a",{href:d,target:"_blank",rel:"noopener noreferrer",className:"flex-1 text-blue-600 hover:underline truncate",children:d}),h&&e.jsx("button",{onClick:()=>S(C),className:"p-1 text-red-600 hover:bg-red-50 rounded",children:e.jsx(V,{className:"w-4 h-4"})})]},C))}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"××™×Ÿ ×”×§×œ×˜×•×ª"})]}),e.jsxs(G,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"×”×¢×¨×•×ª × ×•×¡×¤×•×ª"}),h?e.jsx("textarea",{value:o.notes||"",onChange:d=>n({...o,notes:d.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",rows:4,placeholder:"×”×¢×¨×•×ª × ×•×¡×¤×•×ª ×¢×œ ×”×‘×™×¦×•×¢..."}):e.jsx("p",{className:"text-gray-900 whitespace-pre-wrap",children:g.notes||"××™×Ÿ ×”×¢×¨×•×ª × ×•×¡×¤×•×ª"})]})]})]})})},Es=Is,Me=s=>s>=95?"×ž×¢×•×œ×”":s>=90?"×˜×•×‘ ×ž××•×“":s>=85?"×›×ž×¢×˜ ×˜×•×‘ ×ž××•×“":s>=75?"×˜×•×‘":s>=65?"×›×ž×¢×˜ ×˜×•×‘":s>=55?"×ž×¡×¤×™×§":s>=45?"×ž×¡×¤×™×§ ×‘×§×•×©×™":"×œ× ×¢×‘×¨/×”",ve=s=>{if(!s)return 0;const g=s.playingSkills?.points||0,t=s.musicalUnderstanding?.points||0,w=s.textKnowledge?.points||0,N=s.playingByHeart?.points||0;return g+t+w+N},Ps=(s,g)=>g||s==="×¢×‘×¨/×”"?"text-green-600 bg-green-50":s==="×œ× ×¢×‘×¨/×”"?"text-red-600 bg-red-50":s==="×œ× × ×‘×—×Ÿ"?"text-gray-600 bg-gray-50":"text-orange-600 bg-orange-50",Gs=({presentation:s,programPieces:g,onSave:t,onCancel:w})=>{const[N,h]=p.useState(s.date?new Date(s.date).toISOString().slice(0,16):""),[j,o]=p.useState(s.reviewedBy||""),[n,k]=p.useState(s.notes||""),[I,U]=p.useState(s.recordingLinks||[""]),[B,S]=p.useState([]),[d,C]=p.useState({});p.useEffect(()=>{const b=g.map((a,c)=>({pieceNumber:c+1,pieceTitle:a.pieceTitle,composer:a.composer,playingSkills:0,musicalUnderstanding:0,textKnowledge:0,playingByHeart:!1,comments:""}));s.detailedGrading&&b.forEach((a,c)=>{c===0&&s.detailedGrading&&(a.playingSkills=s.detailedGrading.playingSkills?.points||0,a.musicalUnderstanding=s.detailedGrading.musicalUnderstanding?.points||0,a.textKnowledge=s.detailedGrading.textKnowledge?.points||0,a.playingByHeart=(s.detailedGrading.playingByHeart?.points||0)===10)}),S(b)},[g,s.detailedGrading]);const D=(b,a,c)=>{const i={playingSkills:40,musicalUnderstanding:30,textKnowledge:20}[a];return c<0?"×”×¦×™×•×Ÿ ×—×™×™×‘ ×œ×”×™×•×ª ×—×™×•×‘×™":c>i?`×”×¦×™×•×Ÿ ×”×ž×§×¡×™×ž×œ×™ ×”×•× ${i}`:null},L=(b,a,c)=>{S(i=>{const l=[...i];return l[b]={...l[b],[a]:c},l});const y=`piece${b}_${a}`;d[y]&&C(i=>({...i,[y]:""}))},f=b=>b.playingSkills+b.musicalUnderstanding+b.textKnowledge+(b.playingByHeart?10:0),v=()=>{if(B.length===0)return 0;const b=B.reduce((c,y)=>c+f(y),0),a=B.length*100;return Math.round(b/a*100)},u=()=>{const b={};return B.forEach((a,c)=>{const y=D(c,"playingSkills",a.playingSkills),i=D(c,"musicalUnderstanding",a.musicalUnderstanding),l=D(c,"textKnowledge",a.textKnowledge);y&&(b[`piece${c}_playingSkills`]=y),i&&(b[`piece${c}_musicalUnderstanding`]=i),l&&(b[`piece${c}_textKnowledge`]=l)}),N||(b.presentationDate="×ª××¨×™×š ×”×©×ž×¢×” × ×“×¨×©"),j.trim()||(b.examinerNames="×©×ž×•×ª ×”×‘×•×—× ×™× × ×“×¨×©×™×"),C(b),Object.keys(b).length===0},P=()=>{if(!u())return;const b=v(),a={playingSkills:{points:Math.round(B.reduce((i,l)=>i+l.playingSkills,0)/B.length),maxPoints:40,grade:"×ž×¢×•×œ×”",comments:"×ž×ž×•×¦×¢ ×ž×›×œ ×”×™×¦×™×¨×•×ª"},musicalUnderstanding:{points:Math.round(B.reduce((i,l)=>i+l.musicalUnderstanding,0)/B.length),maxPoints:30,grade:"×˜×•×‘ ×ž××•×“",comments:"×ž×ž×•×¦×¢ ×ž×›×œ ×”×™×¦×™×¨×•×ª"},textKnowledge:{points:Math.round(B.reduce((i,l)=>i+l.textKnowledge,0)/B.length),maxPoints:20,grade:"×˜×•×‘",comments:"×ž×ž×•×¦×¢ ×ž×›×œ ×”×™×¦×™×¨×•×ª"},playingByHeart:{points:B.filter(i=>i.playingByHeart).length>B.length/2?10:0,maxPoints:10,grade:B.filter(i=>i.playingByHeart).length>B.length/2?"×›×Ÿ":"×œ×",comments:`${B.filter(i=>i.playingByHeart).length} ×ž×ª×•×š ${B.length} ×™×¦×™×¨×•×ª × ×•×’× ×• ×‘×¢"×¤`}},y={...{...s,date:N?new Date(N):void 0,reviewedBy:j,notes:n,recordingLinks:I.filter(i=>i.trim()!==""),detailedGrading:a,grade:b,gradeLevel:R(b),completed:b>=60,status:b>=60?"×¢×‘×¨/×”":"×œ× ×¢×‘×¨/×”"},backendIndex:-1};t(s.presentationNumber-1,y)},R=b=>b>=95?"×ž×¦×˜×™×™×Ÿ ×‘×ž×™×•×—×“":b>=90?"×ž×¦×˜×™×™×Ÿ":b>=85?"×˜×•×‘ ×ž××•×“":b>=70?"×˜×•×‘":b>=60?"×¢×•×‘×¨":"×œ× ×¢×•×‘×¨",$=()=>{U([...I,""])},F=(b,a)=>{const c=[...I];c[b]=a,U(c)},X=b=>{I.length>1&&U(I.filter((a,c)=>c!==b))},z=b=>{const a=[];for(let c=0;c<=b;c++)a.push(e.jsx("option",{value:c,children:c},c));return a};return e.jsx("div",{className:"detailed-grading-modal",children:e.jsxs("div",{className:"detailed-grading-content",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 sm:p-6 border-b border-gray-200 bg-gray-50",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"×ž×’×Ÿ ×‘×’×¨×•×ª - ×”×©×ž×¢×” 4"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"×”×©×ž×¢×” ××—×¨×•× ×” ×œ×§×¨××ª ×¨×¡×™×˜×œ ×•×§×‘×™×¢×ª ×¦×™×•×Ÿ ×ž×’×Ÿ"})]}),e.jsx("button",{onClick:w,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors min-w-[44px] min-h-[44px] flex items-center justify-center","aria-label":"×¡×’×•×¨",children:e.jsx(V,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 sm:p-6 scroll-smooth focus:scroll-auto",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 mb-6 sm:mb-8",children:[e.jsxs(G,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"×¤×¨×˜×™ ×”×©×ž×¢×”"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×ª××¨×™×š ×”×©×ž×¢×” *"}),e.jsx("input",{type:"datetime-local",value:N,onChange:b=>h(b.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent ${d.presentationDate?"border-red-300":"border-gray-300"}`}),d.presentationDate&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.presentationDate})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©×ž×•×ª ×”×‘×•×—× ×™× *"}),e.jsx("input",{type:"text",value:j,onChange:b=>o(b.target.value),placeholder:"×©× ×ž×œ× ×©×œ ×”×‘×•×—×Ÿ/×™×",className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent ${d.examinerNames?"border-red-300":"border-gray-300"}`}),d.examinerNames&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.examinerNames})]})]})]}),e.jsxs(G,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"×ª×™×¢×•×“ ×”×©×ž×¢×”"}),e.jsxs("div",{className:"space-y-3",children:[I.map((b,a)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"url",value:b,onChange:c=>F(a,c.target.value),placeholder:"https://example.com/recording",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"}),I.length>1&&e.jsx("button",{onClick:()=>X(a),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(Y,{className:"w-4 h-4"})})]},a)),e.jsxs("button",{onClick:$,className:"flex items-center gap-2 px-3 py-2 text-primary-600 hover:bg-primary-50 rounded-lg transition-colors",children:[e.jsx(J,{className:"w-4 h-4"}),"×”×•×¡×£ ×§×™×©×•×¨ × ×•×¡×£"]})]})]})]}),e.jsxs(G,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"×˜×‘×œ×ª ×¦×™×•× ×™× ×ž×¤×•×¨×˜×ª"}),e.jsxs("div",{className:"flex items-center gap-2 text-lg font-bold text-primary-600",children:[e.jsx(Oe,{className:"w-5 h-5"}),"×ž×ž×•×¦×¢ ×›×œ×œ×™: ",v()]})]}),e.jsx("div",{className:"overflow-x-auto -mx-4 sm:mx-0",children:e.jsxs("table",{className:"detailed-grading-table",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 sm:px-4 py-3 text-right text-sm font-semibold text-gray-700 border border-gray-200",children:"×ž×¡' ×™×¦×™×¨×”"}),e.jsx("th",{className:"px-2 sm:px-4 py-3 text-right text-sm font-semibold text-gray-700 border border-gray-200 min-w-[180px]",children:"×©× ×”×™×¦×™×¨×” ×•×ž×œ×—×™×Ÿ"}),e.jsxs("th",{className:"px-2 sm:px-4 py-3 text-center text-xs sm:text-sm font-semibold text-gray-700 border border-gray-200",children:["×ž×™×•×ž× ×•×ª × ×’×™× ×”/×©×™×¨×”",e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:"(×ž×§×¡' 40)"})]}),e.jsxs("th",{className:"px-2 sm:px-4 py-3 text-center text-xs sm:text-sm font-semibold text-gray-700 border border-gray-200",children:["×”×‘× ×” ×ž×•×¡×™×§×œ×™×ª",e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:"(×ž×§×¡' 30)"})]}),e.jsxs("th",{className:"px-2 sm:px-4 py-3 text-center text-xs sm:text-sm font-semibold text-gray-700 border border-gray-200",children:["×™×“×™×¢×ª ×”×˜×§×¡×˜",e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:"(×ž×§×¡' 20)"})]}),e.jsxs("th",{className:"px-2 sm:px-4 py-3 text-center text-xs sm:text-sm font-semibold text-gray-700 border border-gray-200",children:['× ×•×’×Ÿ ×‘×¢"×¤',e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:"(10)"})]}),e.jsxs("th",{className:"px-2 sm:px-4 py-3 text-center text-xs sm:text-sm font-semibold text-gray-700 border border-gray-200",children:['×¡×”"×›',e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:"(100)"})]})]})}),e.jsx("tbody",{children:B.map((b,a)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-2 sm:px-4 py-3 text-center font-medium text-gray-900 border border-gray-200",children:b.pieceNumber}),e.jsx("td",{className:"px-2 sm:px-4 py-3 border border-gray-200",children:e.jsxs("div",{className:"text-xs sm:text-sm",children:[e.jsx("div",{className:"font-medium text-gray-900",children:b.pieceTitle}),e.jsx("div",{className:"text-gray-600",children:b.composer})]})}),e.jsxs("td",{className:"px-2 sm:px-4 py-3 text-center border border-gray-200",children:[e.jsx("select",{value:b.playingSkills,onChange:c=>L(a,"playingSkills",parseInt(c.target.value)),className:`w-16 sm:w-20 px-1 sm:px-2 py-1 text-center text-sm border rounded focus:ring-2 focus:ring-primary-500 focus:border-transparent ${d[`piece${a}_playingSkills`]?"border-red-300":"border-gray-300"}`,children:z(40)}),d[`piece${a}_playingSkills`]&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:d[`piece${a}_playingSkills`]})]}),e.jsxs("td",{className:"px-2 sm:px-4 py-3 text-center border border-gray-200",children:[e.jsx("select",{value:b.musicalUnderstanding,onChange:c=>L(a,"musicalUnderstanding",parseInt(c.target.value)),className:`w-16 sm:w-20 px-1 sm:px-2 py-1 text-center text-sm border rounded focus:ring-2 focus:ring-primary-500 focus:border-transparent ${d[`piece${a}_musicalUnderstanding`]?"border-red-300":"border-gray-300"}`,children:z(30)}),d[`piece${a}_musicalUnderstanding`]&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:d[`piece${a}_musicalUnderstanding`]})]}),e.jsxs("td",{className:"px-2 sm:px-4 py-3 text-center border border-gray-200",children:[e.jsx("select",{value:b.textKnowledge,onChange:c=>L(a,"textKnowledge",parseInt(c.target.value)),className:`w-16 sm:w-20 px-1 sm:px-2 py-1 text-center text-sm border rounded focus:ring-2 focus:ring-primary-500 focus:border-transparent ${d[`piece${a}_textKnowledge`]?"border-red-300":"border-gray-300"}`,children:z(20)}),d[`piece${a}_textKnowledge`]&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:d[`piece${a}_textKnowledge`]})]}),e.jsxs("td",{className:"px-2 sm:px-4 py-3 text-center border border-gray-200",children:[e.jsx("input",{type:"checkbox",checked:b.playingByHeart,onChange:c=>L(a,"playingByHeart",c.target.checked),className:"w-4 h-4 text-primary-600 bg-gray-100 border-gray-300 rounded focus:ring-primary-500"}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:b.playingByHeart?"10":"0"})]}),e.jsx("td",{className:"px-2 sm:px-4 py-3 text-center font-bold text-primary-600 border border-gray-200",children:f(b)})]},a))})]})}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"×ž×¤×ª×— ×¦×™×•× ×™×"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-2 text-sm",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-medium text-green-600",children:"95-100"}),e.jsx("span",{className:"text-gray-600",children:"×ž×¦×˜×™×™×Ÿ ×‘×ž×™×•×—×“"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-medium text-green-600",children:"90-94"}),e.jsx("span",{className:"text-gray-600",children:"×ž×¦×˜×™×™×Ÿ"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-medium text-blue-600",children:"85-89"}),e.jsx("span",{className:"text-gray-600",children:"×˜×•×‘ ×ž××•×“"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-medium text-yellow-600",children:"70-84"}),e.jsx("span",{className:"text-gray-600",children:"×˜×•×‘"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-medium text-orange-600",children:"60-69"}),e.jsx("span",{className:"text-gray-600",children:"×¢×•×‘×¨"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-medium text-red-600",children:"0-59"}),e.jsx("span",{className:"text-gray-600",children:"×œ× ×¢×•×‘×¨"})]})]})]})]}),e.jsxs(G,{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"×”×¢×¨×•×ª ×›×œ×œ×™×•×ª"}),e.jsx("textarea",{value:n,onChange:b=>k(b.target.value),placeholder:"×”×¢×¨×•×ª ×›×œ×œ×™×•×ª ×¢×œ ×”×‘×™×¦×•×¢, ×”×ž×œ×¦×•×ª ×œ×©×™×¤×•×¨, × ×§×•×“×•×ª ×—×•×–×§...",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent resize-vertical"})]})]}),e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-3 p-4 sm:p-6 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex gap-3 w-full sm:w-auto",children:[e.jsx("button",{onClick:w,className:"flex-1 sm:flex-none px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"×‘×™×˜×•×œ"}),e.jsxs("button",{onClick:P,className:"flex-1 sm:flex-none flex items-center justify-center px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[e.jsx(te,{className:"w-4 h-4 ml-2"}),"×©×ž×•×¨ ×¦×™×•× ×™×"]})]})})]})})},Us=({presentation:s,onUpdate:g,onView:t,onDelete:w,programPieces:N=[]})=>{const[h,j]=p.useState(!1),[o,n]=p.useState(!1),[k,I]=p.useState(!1),[U,B]=p.useState(s),[S,d]=p.useState([]),[C,D]=p.useState([]),[L,f]=p.useState("");console.log("ðŸ” PresentationCard render:",{presentationNumber:s.presentationNumber,"presentation.reviewedBy":s.reviewedBy,examinerNames:L,renderTime:new Date().toISOString()}),we.useEffect(()=>{if(h){const i=s.reviewedBy?s.reviewedBy.split(",").map(m=>m.trim()).filter(m=>m.length>0):[""];d(i.length>0?i:[""]);const l=s.recordingLinks&&s.recordingLinks.length>0?s.recordingLinks:[""];D(l)}},[h,s.reviewedBy,s.recordingLinks]),we.useEffect(()=>{(async()=>{if(s.reviewedBy){console.log("ðŸ” Starting examiner name resolution for:",s.reviewedBy);const l=s.reviewedBy.split(",").map(T=>T.trim()),m=[];for(const T of l)if(console.log("ðŸ” Processing part:",T,"Is ObjectId?",/^[a-f\d]{24}$/i.test(T)),/^[a-f\d]{24}$/i.test(T))try{console.log("ðŸ” Fetching teacher for ObjectId:",T);const H=await K.teachers.getTeacher(T);console.log("ðŸ“‹ Teacher response for ID",T,":",H);const ce=H?.personalInfo?.fullName||(H?.personalInfo?.firstName&&H?.personalInfo?.lastName?`${H.personalInfo.firstName} ${H.personalInfo.lastName}`:H?.personalInfo?.firstName||H?.personalInfo?.lastName)||T;console.log("âœ… Resolved teacher name:",T,"->",ce),m.push(ce)}catch(H){console.error("âŒ Error fetching teacher name for",T,":",H),m.push(T)}else console.log("âœ… Using name as-is:",T),m.push(T);const A=m.join(", ");console.log("ðŸ” Final examiner names:",A),console.log("ðŸ” Setting examinerNames state to:",A),f(A),console.log("ðŸ” examinerNames state should now be:",A)}else f("")})()},[s.reviewedBy]);const v=()=>{const i=S.filter(A=>A.trim().length>0).join(", "),l=C.filter(A=>A.trim().length>0),m={...U,reviewedBy:i,recordingLinks:l,backendIndex:s.backendIndex??s.presentationNumber-1};console.log("ðŸ” PresentationCard handleSave:",{examiners:S,reviewedByString:i,updatedData:m,presentationNumber:s.presentationNumber}),g(s.presentationNumber-1,m),j(!1)},u=()=>{B(s),d([]),D([]),j(!1)},P=()=>{w&&(w(s.presentationNumber-1),I(!1))},R=()=>{d([...S,""])},$=(i,l)=>{const m=[...S];m[i]=l,d(m)},F=i=>{S.length>1&&d(S.filter((l,m)=>m!==i))},X=()=>{D([...C,""])},z=(i,l)=>{const m=[...C];m[i]=l,D(m)},b=i=>{C.length>1&&D(C.filter((l,m)=>m!==i))},a=(i,l)=>l||i==="×¢×‘×¨/×”"?"×¢×‘×¨/×”":i==="×œ× ×¢×‘×¨/×”"?"×œ× ×¢×‘×¨/×”":i==="×œ× × ×‘×—×Ÿ"?"×œ× × ×‘×—×Ÿ":"×ž×ž×ª×™×Ÿ",c=(i,l)=>l||i==="×¢×‘×¨/×”"?e.jsx(Be,{className:"w-4 h-4"}):i==="×œ× ×¢×‘×¨/×”"?e.jsx(vs,{className:"w-4 h-4"}):i==="×œ× × ×‘×—×Ÿ"?e.jsx(Z,{className:"w-4 h-4"}):e.jsx(ue,{className:"w-4 h-4"}),y=s.type==="magen";return e.jsxs(e.Fragment,{children:[e.jsx(G,{className:`hover:shadow-lg transition-all cursor-pointer group relative ${y?"bg-blue-50":""}`,children:e.jsxs("div",{onClick:()=>!h&&t(s),className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[y?e.jsx(ke,{className:"w-5 h-5 text-yellow-500"}):e.jsx(ge,{className:"w-5 h-5 text-primary-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.title})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${Ps(s.status,s.completed)}`,children:[c(s.status,s.completed),a(s.status,s.completed)]}),!h&&!o?e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-all",children:[e.jsx("button",{onClick:i=>{i.stopPropagation(),y&&N.length>0?n(!0):j(!0)},className:"p-1 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded transition-all",title:"×¢×¨×™×›×”",children:e.jsx(Ce,{className:"w-4 h-4"})}),w&&e.jsx("button",{onClick:i=>{i.stopPropagation(),I(!0)},className:"p-1 text-red-600 hover:text-red-800 hover:bg-red-50 rounded transition-all",title:"×ž×—×™×§×”",children:e.jsx(Y,{className:"w-4 h-4"})})]}):h?e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:i=>{i.stopPropagation(),v()},className:"p-1 text-green-600 hover:bg-green-50 rounded",children:e.jsx(te,{className:"w-4 h-4"})}),e.jsx("button",{onClick:i=>{i.stopPropagation(),u()},className:"p-1 text-red-600 hover:bg-red-50 rounded",children:e.jsx(V,{className:"w-4 h-4"})})]}):null]})]}),h?e.jsxs("div",{className:"space-y-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4 text-gray-500"}),e.jsx("label",{className:"text-sm font-medium text-gray-700 w-24",children:"×ª××¨×™×š ×”×©×ž×¢×”:"}),e.jsx("input",{type:"datetime-local",value:U.date?new Date(U.date).toISOString().slice(0,16):"",onChange:i=>B({...U,date:i.target.value?new Date(i.target.value):void 0}),className:"flex-1 px-3 py-2 border border-gray-300 rounded focus:border-primary-500 focus:ring-1 focus:ring-primary-500 outline-none text-sm"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4 text-gray-500"}),e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"×©×ž×•×ª ×”×‘×•×—× ×™×:"})]}),S.map((i,l)=>e.jsxs("div",{className:"flex items-center gap-2 mr-6",children:[e.jsx("input",{type:"text",value:i,onChange:m=>$(l,m.target.value),placeholder:"×©× ×”×‘×•×—×Ÿ",className:"flex-1 px-3 py-2 border border-gray-300 rounded focus:border-primary-500 focus:ring-1 focus:ring-primary-500 outline-none text-sm"}),S.length>1&&e.jsx("button",{onClick:()=>F(l),className:"p-1 text-red-600 hover:bg-red-50 rounded",type:"button",children:e.jsx(Y,{className:"w-4 h-4"})})]},l)),e.jsxs("button",{onClick:R,className:"flex items-center gap-2 px-3 py-2 text-primary-600 hover:bg-primary-50 rounded transition-colors text-sm mr-6",type:"button",children:[e.jsx(J,{className:"w-4 h-4"}),"×”×•×¡×£ ×‘×•×—×Ÿ"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4 text-gray-500"}),e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"×§×™×©×•×¨×™ ×ª×™×¢×•×“:"})]}),C.map((i,l)=>e.jsxs("div",{className:"flex items-center gap-2 mr-6",children:[e.jsx("input",{type:"url",value:i,onChange:m=>z(l,m.target.value),placeholder:"https://example.com/recording",className:"flex-1 px-3 py-2 border border-gray-300 rounded focus:border-primary-500 focus:ring-1 focus:ring-primary-500 outline-none text-sm"}),C.length>1&&e.jsx("button",{onClick:()=>b(l),className:"p-1 text-red-600 hover:bg-red-50 rounded",type:"button",children:e.jsx(Y,{className:"w-4 h-4"})})]},l)),e.jsxs("button",{onClick:X,className:"flex items-center gap-2 px-3 py-2 text-primary-600 hover:bg-primary-50 rounded transition-colors text-sm mr-6",type:"button",children:[e.jsx(J,{className:"w-4 h-4"}),"×”×•×¡×£ ×§×™×©×•×¨"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4 text-gray-500"}),e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"×”×¢×¨×•×ª ×›×œ×œ×™×•×ª:"})]}),e.jsx("textarea",{value:U.notes||"",onChange:i=>B({...U,notes:i.target.value}),placeholder:"×”×¢×¨×•×ª ×›×œ×œ×™×•×ª ×¢×œ ×”×‘×™×¦×•×¢...",className:"w-full px-3 py-2 border border-gray-300 rounded focus:border-primary-500 focus:ring-1 focus:ring-primary-500 outline-none text-sm resize-vertical",rows:3})]})]}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx(ie,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{children:s.date?new Date(s.date).toLocaleDateString("he-IL",{year:"numeric",month:"short",day:"numeric"}):"×œ× × ×§×‘×¢"})]}),(L||s.reviewedBy)&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx(se,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{title:`Original: ${s.reviewedBy}, Resolved: ${L||"none"}`,children:(()=>{const i=L||s.reviewedBy;return console.log("ðŸ” Rendering examiner display:",{examinerNames:L,"presentation.reviewedBy":s.reviewedBy,displayName:i,presentationNumber:s.presentationNumber}),i})()})]})]}),y&&s.detailedGrading&&!h&&e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-white p-2 rounded border border-blue-200",children:[e.jsx("div",{className:"font-medium text-gray-600",children:"×ž×™×•×ž× ×•×ª × ×’×™× ×”"}),e.jsxs("div",{className:"text-primary-600 font-semibold",children:[s.detailedGrading.playingSkills?.points||0,"/40"]})]}),e.jsxs("div",{className:"bg-white p-2 rounded border border-blue-200",children:[e.jsx("div",{className:"font-medium text-gray-600",children:"×”×‘× ×” ×ž×•×¡×™×§×œ×™×ª"}),e.jsxs("div",{className:"text-primary-600 font-semibold",children:[s.detailedGrading.musicalUnderstanding?.points||0,"/30"]})]}),e.jsxs("div",{className:"bg-white p-2 rounded border border-blue-200",children:[e.jsx("div",{className:"font-medium text-gray-600",children:"×™×“×™×¢×ª ×”×˜×§×¡×˜"}),e.jsxs("div",{className:"text-primary-600 font-semibold",children:[s.detailedGrading.textKnowledge?.points||0,"/20"]})]}),e.jsxs("div",{className:"bg-white p-2 rounded border border-blue-200",children:[e.jsx("div",{className:"font-medium text-gray-600",children:'× ×•×’×Ÿ ×‘×¢"×¤'}),e.jsxs("div",{className:"text-primary-600 font-semibold",children:[s.detailedGrading.playingByHeart?.points||0,"/10"]})]})]})}),s.notes&&!h&&e.jsxs("div",{className:"text-sm text-gray-600 bg-gray-50 p-2 rounded",children:[e.jsx("span",{className:"font-medium",children:"×”×¢×¨×•×ª: "}),s.notes.length>100?`${s.notes.substring(0,100)}...`:s.notes]}),s.recordingLinks&&s.recordingLinks.length>0&&e.jsxs("div",{className:"mt-3 flex items-center gap-2 text-sm text-blue-600",children:[e.jsx(oe,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.recordingLinks.length," ×§×™×©×•×¨×™ ×ª×™×¢×•×“"]})]})]})}),o&&e.jsx(Gs,{presentation:s,programPieces:N,onSave:(i,l)=>{g(i,l),n(!1)},onCancel:()=>n(!1)}),k&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-full",children:e.jsx(Y,{className:"w-6 h-6 text-red-600"})}),e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["×ž×—×™×§×ª ",s.title]})]}),e.jsxs("p",{className:"text-gray-600 mb-6",children:["×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×ž×—×•×§ ××ª ",s.title,"? ×¤×¢×•×œ×” ×–×• ×œ× × ×™×ª× ×ª ×œ×‘×™×˜×•×œ."]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>I(!1),className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"×‘×™×˜×•×œ"}),e.jsx("button",{onClick:P,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"×ž×—×§"})]})]})})]})},Ts=Us,$s=({isOpen:s,title:g,placeholder:t="",initialValue:w="",onSubmit:N,onClose:h})=>{const[j,o]=p.useState(w);if(!s)return null;const n=I=>{I.preventDefault(),j.trim()&&(N(j.trim()),o(""),h())},k=()=>{o(""),h()};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:g}),e.jsx("button",{onClick:k,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg",children:e.jsx(V,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:n,className:"p-4",children:[e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"url",value:j,onChange:I=>o(I.target.value),placeholder:t,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",autoFocus:!0,required:!0})}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:k,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50",children:"×‘×™×˜×•×œ"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600",children:"×”×•×¡×£"})]})]})]})})},As=({isOpen:s,presentation:g,programPieces:t,onClose:w,onUpdate:N,onNavigateToTab:h})=>{const[j,o]=p.useState(!1),[n,k]=p.useState(g),[I,U]=p.useState(!1);if(p.useEffect(()=>{k(g),o(!1)},[g]),!s||!g||!n)return null;const B=g.type==="magen",S=()=>{if(n){if(B&&n.detailedGrading){const f=ve(n.detailedGrading);n.grade=f,n.gradeLevel=Me(f)}N(g.presentationNumber-1,n),o(!1),setTimeout(()=>{w(),h&&h("×”×©×ž×¢×•×ª")},100)}},d=()=>{k(g),o(!1)},C=(f,v,u)=>{n.detailedGrading||(n.detailedGrading={playingSkills:{grade:"",points:0,maxPoints:40,comments:""},musicalUnderstanding:{grade:"",points:0,maxPoints:30,comments:""},textKnowledge:{grade:"",points:0,maxPoints:20,comments:""},playingByHeart:{grade:"",points:0,maxPoints:10,comments:""}}),k({...n,detailedGrading:{...n.detailedGrading,[f]:{...n.detailedGrading[f],[v]:u}}})},D=f=>{f&&n&&k({...n,recordingLinks:[...n.recordingLinks||[],f]})},L=f=>{n&&k({...n,recordingLinks:n.recordingLinks?.filter((v,u)=>u!==f)})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[B?e.jsx(ke,{className:"w-6 h-6 text-yellow-500"}):e.jsx(ge,{className:"w-6 h-6 text-primary-600"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:g.title})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[j?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:S,className:"flex items-center gap-1 px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:[e.jsx(te,{className:"w-4 h-4"}),"×©×ž×•×¨"]}),e.jsxs("button",{onClick:d,className:"flex items-center gap-1 px-3 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50",children:[e.jsx(V,{className:"w-4 h-4"}),"×‘×™×˜×•×œ"]})]}):e.jsxs("button",{onClick:()=>o(!0),className:"flex items-center gap-1 px-3 py-2 text-blue-600 border border-blue-300 rounded-lg hover:bg-blue-50",children:[e.jsx(Fe,{className:"w-4 h-4"}),"×¢×¨×•×š"]}),e.jsx("button",{onClick:w,className:"p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg",children:e.jsx(V,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs(G,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"×¤×¨×˜×™ ×”×”×©×ž×¢×”"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ie,{className:"w-5 h-5 text-gray-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×ª××¨×™×š ×”×©×ž×¢×”"}),j?e.jsx("input",{type:"date",value:n.date?new Date(n.date).toISOString().slice(0,10):"",onChange:f=>k({...n,date:f.target.value?new Date(f.target.value):void 0}),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"}):e.jsx("p",{className:"text-gray-900",children:g.date?new Date(g.date).toLocaleDateString("he-IL"):"×œ× × ×§×‘×¢"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(se,{className:"w-5 h-5 text-gray-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×©×ž×•×ª ×”×‘×•×—× ×™×"}),j?e.jsx("input",{type:"text",value:n.reviewedBy||"",onChange:f=>k({...n,reviewedBy:f.target.value}),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"×©×ž×•×ª ×”×‘×•×—× ×™×"}):e.jsx("p",{className:"text-gray-900",children:g.reviewedBy||"×œ× ×¦×•×™×Ÿ"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Z,{className:"w-5 h-5 text-gray-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×¡×˜×˜×•×¡"}),j?e.jsxs("select",{value:n.status||"×œ× × ×‘×—×Ÿ",onChange:f=>k({...n,status:f.target.value,completed:f.target.value==="×¢×‘×¨/×”"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"×œ× × ×‘×—×Ÿ",children:"×œ× × ×‘×—×Ÿ"}),e.jsx("option",{value:"×¢×‘×¨/×”",children:"×¢×‘×¨/×”"}),e.jsx("option",{value:"×œ× ×¢×‘×¨/×”",children:"×œ× ×¢×‘×¨/×”"})]}):e.jsx("p",{className:"text-gray-900",children:g.status||"×œ× × ×‘×—×Ÿ"})]})]})]})]}),B&&e.jsxs(G,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"×¤×™×¨×•×˜ ×¦×™×•× ×™× - ×ž×’×Ÿ ×‘×’×¨×•×ª"}),e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-right px-4 py-2 font-medium text-gray-700",children:"×§×¨×™×˜×¨×™×•×Ÿ"}),e.jsx("th",{className:"text-center px-4 py-2 font-medium text-gray-700",children:"× ×™×§×•×“"}),e.jsx("th",{className:"text-center px-4 py-2 font-medium text-gray-700",children:"×ž×§×¡×™×ž×•×"}),e.jsx("th",{className:"text-right px-4 py-2 font-medium text-gray-700",children:"×”×¢×¨×•×ª"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-200",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 font-medium",children:"×ž×™×•×ž× ×•×ª × ×’×™× ×”/×©×™×¨×”"}),e.jsx("td",{className:"text-center px-4 py-3",children:j?e.jsx("input",{type:"number",min:"0",max:"40",value:n.detailedGrading?.playingSkills?.points||0,onChange:f=>C("playingSkills","points",parseInt(f.target.value)||0),className:"w-16 px-2 py-1 border border-gray-300 rounded text-center"}):e.jsx("span",{className:"font-semibold text-primary-600",children:n.detailedGrading?.playingSkills?.points||0})}),e.jsx("td",{className:"text-center px-4 py-3 text-gray-600",children:"40"}),e.jsx("td",{className:"px-4 py-3",children:j?e.jsx("input",{type:"text",value:n.detailedGrading?.playingSkills?.comments||"",onChange:f=>C("playingSkills","comments",f.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",placeholder:"×”×¢×¨×•×ª..."}):e.jsx("span",{className:"text-gray-600 text-sm",children:n.detailedGrading?.playingSkills?.comments||"-"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 font-medium",children:"×”×‘× ×” ×ž×•×¡×™×§×œ×™×ª"}),e.jsx("td",{className:"text-center px-4 py-3",children:j?e.jsx("input",{type:"number",min:"0",max:"30",value:n.detailedGrading?.musicalUnderstanding?.points||0,onChange:f=>C("musicalUnderstanding","points",parseInt(f.target.value)||0),className:"w-16 px-2 py-1 border border-gray-300 rounded text-center"}):e.jsx("span",{className:"font-semibold text-primary-600",children:n.detailedGrading?.musicalUnderstanding?.points||0})}),e.jsx("td",{className:"text-center px-4 py-3 text-gray-600",children:"30"}),e.jsx("td",{className:"px-4 py-3",children:j?e.jsx("input",{type:"text",value:n.detailedGrading?.musicalUnderstanding?.comments||"",onChange:f=>C("musicalUnderstanding","comments",f.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",placeholder:"×”×¢×¨×•×ª..."}):e.jsx("span",{className:"text-gray-600 text-sm",children:n.detailedGrading?.musicalUnderstanding?.comments||"-"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 font-medium",children:"×™×“×™×¢×ª ×”×˜×§×¡×˜"}),e.jsx("td",{className:"text-center px-4 py-3",children:j?e.jsx("input",{type:"number",min:"0",max:"20",value:n.detailedGrading?.textKnowledge?.points||0,onChange:f=>C("textKnowledge","points",parseInt(f.target.value)||0),className:"w-16 px-2 py-1 border border-gray-300 rounded text-center"}):e.jsx("span",{className:"font-semibold text-primary-600",children:n.detailedGrading?.textKnowledge?.points||0})}),e.jsx("td",{className:"text-center px-4 py-3 text-gray-600",children:"20"}),e.jsx("td",{className:"px-4 py-3",children:j?e.jsx("input",{type:"text",value:n.detailedGrading?.textKnowledge?.comments||"",onChange:f=>C("textKnowledge","comments",f.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",placeholder:"×”×¢×¨×•×ª..."}):e.jsx("span",{className:"text-gray-600 text-sm",children:n.detailedGrading?.textKnowledge?.comments||"-"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 font-medium",children:'× ×•×’×Ÿ ×‘×¢"×¤'}),e.jsx("td",{className:"text-center px-4 py-3",children:j?e.jsx("input",{type:"number",min:"0",max:"10",value:n.detailedGrading?.playingByHeart?.points||0,onChange:f=>C("playingByHeart","points",parseInt(f.target.value)||0),className:"w-16 px-2 py-1 border border-gray-300 rounded text-center"}):e.jsx("span",{className:"font-semibold text-primary-600",children:n.detailedGrading?.playingByHeart?.points||0})}),e.jsx("td",{className:"text-center px-4 py-3 text-gray-600",children:"10"}),e.jsx("td",{className:"px-4 py-3",children:j?e.jsx("input",{type:"text",value:n.detailedGrading?.playingByHeart?.comments||"",onChange:f=>C("playingByHeart","comments",f.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",placeholder:"×”×¢×¨×•×ª..."}):e.jsx("span",{className:"text-gray-600 text-sm",children:n.detailedGrading?.playingByHeart?.comments||"-"})})]}),e.jsxs("tr",{className:"bg-primary-50 font-semibold",children:[e.jsx("td",{className:"px-4 py-3",children:'×¡×”"×›'}),e.jsx("td",{className:"text-center px-4 py-3 text-primary-600 text-lg",children:ve(n.detailedGrading)}),e.jsx("td",{className:"text-center px-4 py-3",children:"100"}),e.jsx("td",{className:"px-4 py-3 text-primary-600",children:Me(ve(n.detailedGrading))})]})]})]})})})]}),e.jsxs(G,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"×§×™×©×•×¨×™ ×ª×™×¢×•×“"}),j&&e.jsxs("button",{onClick:()=>U(!0),className:"flex items-center gap-1 px-3 py-2 text-blue-600 border border-blue-300 rounded-lg hover:bg-blue-50",children:[e.jsx(oe,{className:"w-4 h-4"}),"×”×•×¡×£ ×§×™×©×•×¨"]})]}),n.recordingLinks&&n.recordingLinks.length>0?e.jsx("div",{className:"space-y-2",children:n.recordingLinks.map((f,v)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(ge,{className:"w-4 h-4 text-blue-600"}),e.jsx("a",{href:f,target:"_blank",rel:"noopener noreferrer",className:"flex-1 text-blue-600 hover:underline truncate",children:f}),j&&e.jsx("button",{onClick:()=>L(v),className:"p-1 text-red-600 hover:bg-red-50 rounded",children:e.jsx(V,{className:"w-4 h-4"})})]},v))}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"××™×Ÿ ×§×™×©×•×¨×™ ×ª×™×¢×•×“"})]}),e.jsxs(G,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"×”×¢×¨×•×ª ×›×œ×œ×™×•×ª"}),j?e.jsx("textarea",{value:n.notes||"",onChange:f=>k({...n,notes:f.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",rows:4,placeholder:"×”×¢×¨×•×ª ×›×œ×œ×™×•×ª ×¢×œ ×”×”×©×ž×¢×”..."}):e.jsx("p",{className:"text-gray-900 whitespace-pre-wrap",children:g.notes||"××™×Ÿ ×”×¢×¨×•×ª"})]})]}),e.jsx($s,{isOpen:I,title:"×”×•×¡×£ ×§×™×©×•×¨ ×œ×ª×™×¢×•×“",placeholder:"https://example.com/recording",onSubmit:D,onClose:()=>U(!1)})]})})},Ms=As,_s=({bagrut:s,onUpdate:g})=>{const[t,w]=p.useState(!1),[N,h]=p.useState(""),[j,o]=p.useState({date:"",reviewedBy:[""],recordingLinks:[""],review:"",completed:!1,grade:0,detailedGrading:null}),[n,k]=p.useState([]),[I,U]=p.useState({});p.useEffect(()=>{if(s.magenBagrut){const a=s.magenBagrut.reviewedBy?s.magenBagrut.reviewedBy.split(",").map(y=>y.trim()):[""],c=s.magenBagrut.recordingLinks&&s.magenBagrut.recordingLinks.length>0?s.magenBagrut.recordingLinks:[""];o({date:s.magenBagrut.date?new Date(s.magenBagrut.date).toISOString().slice(0,16):"",reviewedBy:a.length>0?a:[""],recordingLinks:c,review:s.magenBagrut.review||"",completed:s.magenBagrut.completed||!1,grade:s.magenBagrut.grade||0,detailedGrading:s.magenBagrut.detailedGrading||null})}if(s.program&&s.program.length>0){const a=s.program.map((c,y)=>({pieceNumber:c.pieceNumber||y+1,pieceTitle:c.pieceTitle,composer:c.composer,playingSkills:0,musicalUnderstanding:0,textKnowledge:0,playingByHeart:!1,comments:""}));s.magenBagrut?.pieceGradings&&s.magenBagrut.pieceGradings.forEach((c,y)=>{a[y]&&(a[y]={...a[y],...c})}),k(a)}},[s.magenBagrut,s.program]),p.useEffect(()=>{(async()=>{if(s.magenBagrut?.reviewedBy){const c=s.magenBagrut.reviewedBy.split(",").map(i=>i.trim()),y=[];for(const i of c)if(/^[a-f\d]{24}$/i.test(i))try{const l=await K.teachers.getTeacher(i);console.log("ðŸ“‹ Teacher response for ID",i,":",l);const m=l?.personalInfo?.fullName||(l?.personalInfo?.firstName&&l?.personalInfo?.lastName?`${l.personalInfo.firstName} ${l.personalInfo.lastName}`:l?.personalInfo?.firstName||l?.personalInfo?.lastName)||i;console.log("âœ… Resolved teacher name:",i,"->",m),y.push(m)}catch(l){console.error("Error fetching teacher name:",l),y.push(i)}else y.push(i);h(y.join(", "))}else h("")})()},[s.magenBagrut?.reviewedBy]);const B=(a,c,y)=>{k(l=>{const m=[...l];return m[a]={...m[a],[c]:y},m});const i=`piece${a}_${c}`;I[i]&&U(l=>({...l,[i]:""}))},S=a=>a.playingSkills+a.musicalUnderstanding+a.textKnowledge+(a.playingByHeart?10:0),d=()=>{if(n.length===0)return 0;const a=n.reduce((y,i)=>y+S(i),0),c=n.length*100;return Math.round(a/c*100)},C=a=>a>=90?"×ž×¢×•×œ×”":a>=80?"×˜×•×‘ ×ž××•×“":a>=70?"×˜×•×‘":a>=60?"×ž×¡×¤×™×§":a>=55?"×ž×¡×¤×™×§ ×‘×§×•×©×™":a>=1?"×œ× ×¢×‘×¨/×”":null,D=a=>{const c=[];for(let y=0;y<=a;y++)c.push(e.jsx("option",{value:y,children:y},y));return c},L=async()=>{try{console.log("ðŸ”„ Starting ×ž×’×Ÿ ×‘×’×¨×•×ª save process..."),console.log("ðŸ” Current form data:",j),console.log("ðŸ” Current piece gradings:",n);const a=j.reviewedBy.filter(m=>m.trim().length>0).join(", "),c=j.recordingLinks.filter(m=>m.trim().length>0);console.log("ðŸ” Processed reviewedByString:",a),console.log("ðŸ” Processed validLinks:",c);const y=d();console.log("ðŸ” Calculated overall grade:",y);let i=null;n.length>0&&(i={playingSkills:{points:Math.round(n.reduce((m,A)=>m+A.playingSkills,0)/n.length),maxPoints:40,grade:"×ž×¢×•×œ×”",comments:"×ž×ž×•×¦×¢ ×ž×›×œ ×”×™×¦×™×¨×•×ª"},musicalUnderstanding:{points:Math.round(n.reduce((m,A)=>m+A.musicalUnderstanding,0)/n.length),maxPoints:30,grade:"×˜×•×‘ ×ž××•×“",comments:"×ž×ž×•×¦×¢ ×ž×›×œ ×”×™×¦×™×¨×•×ª"},textKnowledge:{points:Math.round(n.reduce((m,A)=>m+A.textKnowledge,0)/n.length),maxPoints:20,grade:"×˜×•×‘",comments:"×ž×ž×•×¦×¢ ×ž×›×œ ×”×™×¦×™×¨×•×ª"},playingByHeart:{points:n.filter(m=>m.playingByHeart).length>n.length/2?10:0,maxPoints:10,grade:n.filter(m=>m.playingByHeart).length>n.length/2?"×ž×¢×•×œ×”":"×œ× ×”×•×¢×¨×š",comments:`${n.filter(m=>m.playingByHeart).length} ×ž×ª×•×š ${n.length} ×™×¦×™×¨×•×ª × ×•×’× ×• ×‘×¢"×¤`}});const l={date:j.date?new Date(j.date):void 0,reviewedBy:a,review:j.review,recordingLinks:c,completed:y>=60,grade:y,gradeLevel:C(y),detailedGrading:i,pieceGradings:n};console.log("ðŸ’¾ Final ×ž×’×Ÿ ×‘×’×¨×•×ª data to save:",l),console.log("ðŸ“¡ Calling onUpdate with magen data..."),await g(l),console.log("âœ… onUpdate completed successfully"),w(!1),console.log("ðŸ”„ Edit mode disabled, save process completed")}catch(a){console.error("âŒ Error saving ×ž×’×Ÿ ×‘×’×¨×•×ª:",a),console.error("âŒ Error details:",a.message,a.stack)}},f=()=>{w(!1)},v=()=>{o(a=>({...a,reviewedBy:[...a.reviewedBy,""]}))},u=(a,c)=>{o(y=>{const i=[...y.reviewedBy];return i[a]=c,{...y,reviewedBy:i}})},P=a=>{j.reviewedBy.length>1&&o(c=>({...c,reviewedBy:c.reviewedBy.filter((y,i)=>i!==a)}))},R=()=>{o(a=>({...a,recordingLinks:[...a.recordingLinks,""]}))},$=(a,c)=>{o(y=>{const i=[...y.recordingLinks];return i[a]=c,{...y,recordingLinks:i}})},F=a=>{j.recordingLinks.length>1&&o(c=>({...c,recordingLinks:c.recordingLinks.filter((y,i)=>i!==a)}))},X=()=>s.magenBagrut?s.magenBagrut.completed?"green":s.magenBagrut.date?"orange":"gray":"gray",z=()=>s.magenBagrut?s.magenBagrut.completed?e.jsx(Be,{className:"w-4 h-4"}):s.magenBagrut.date?e.jsx(ue,{className:"w-4 h-4"}):e.jsx(Z,{className:"w-4 h-4"}):e.jsx(Z,{className:"w-4 h-4"}),b=()=>s.magenBagrut?s.magenBagrut.completed?"×”×•×©×œ×":s.magenBagrut.date?"×ž×ª×•×–×ž×Ÿ":"×‘×ª×”×œ×™×š":"×œ× × ×§×‘×¢";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"×ž×’×Ÿ ×‘×’×¨×•×ª"}),e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium 
            ${X()==="green"?"bg-green-100 text-green-800":X()==="orange"?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-800"}`,children:[z(),b()]})]}),e.jsx("div",{className:"flex gap-2",children:t?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:L,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(te,{className:"w-4 h-4"}),"×©×ž×•×¨"]}),e.jsxs("button",{onClick:f,className:"flex items-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(V,{className:"w-4 h-4"}),"×‘×™×˜×•×œ"]})]}):e.jsxs("button",{onClick:()=>w(!0),className:"flex items-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(Ce,{className:"w-4 h-4"}),"×¢×¨×™×›×”"]})})]}),s.magenBagrut||t?e.jsxs("div",{className:"space-y-6",children:[e.jsxs(G,{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"×¤×¨×˜×™ ×”×©×ž×¢×”"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx("div",{children:t?e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ie,{className:"w-4 h-4"}),"×ª××¨×™×š ×”×©×ž×¢×”"]}),e.jsx("input",{type:"datetime-local",value:j.date,onChange:a=>o(c=>({...c,date:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}):e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ie,{className:"w-5 h-5 text-gray-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"×ª××¨×™×š ×”×©×ž×¢×”"}),e.jsx("div",{className:"font-medium text-gray-900",children:s.magenBagrut?.date?new Date(s.magenBagrut.date).toLocaleDateString("he-IL",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):e.jsx("span",{className:"text-gray-400",children:"×œ× × ×§×‘×¢"})})]})]})}),e.jsx("div",{className:"md:col-span-2",children:t?e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[e.jsx(se,{className:"w-4 h-4"}),"×©×ž×•×ª ×”×‘×•×—× ×™×"]}),j.reviewedBy.map((a,c)=>e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"text",value:a,onChange:y=>u(c,y.target.value),placeholder:"×©× ×”×‘×•×—×Ÿ",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"}),j.reviewedBy.length>1&&e.jsx("button",{onClick:()=>P(c),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(Y,{className:"w-4 h-4"})})]},c)),e.jsxs("button",{onClick:v,className:"flex items-center gap-2 px-3 py-2 text-primary-600 hover:bg-primary-50 rounded-lg transition-colors text-sm",children:[e.jsx(J,{className:"w-4 h-4"}),"×”×•×¡×£ ×‘×•×—×Ÿ"]})]}):e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(se,{className:"w-5 h-5 text-gray-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"×‘×•×—× ×™×"}),e.jsx("div",{className:"font-medium text-gray-900",children:N||s.magenBagrut?.reviewedBy?N||s.magenBagrut.reviewedBy:e.jsx("span",{className:"text-gray-400",children:"×œ× ×”×•×–× ×•"})})]})]})})]}),e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:t?e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[e.jsx(oe,{className:"w-4 h-4"}),"×§×™×©×•×¨×™ ×ª×™×¢×•×“"]}),j.recordingLinks.map((a,c)=>e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"url",value:a,onChange:y=>$(c,y.target.value),placeholder:"https://example.com/recording",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"}),j.recordingLinks.length>1&&e.jsx("button",{onClick:()=>F(c),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(Y,{className:"w-4 h-4"})})]},c)),e.jsxs("button",{onClick:R,className:"flex items-center gap-2 px-3 py-2 text-primary-600 hover:bg-primary-50 rounded-lg transition-colors text-sm",children:[e.jsx(J,{className:"w-4 h-4"}),"×”×•×¡×£ ×§×™×©×•×¨"]})]}):e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(oe,{className:"w-5 h-5 text-gray-500 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"×§×™×©×•×¨×™ ×ª×™×¢×•×“"}),s.magenBagrut?.recordingLinks&&s.magenBagrut.recordingLinks.length>0?e.jsx("div",{className:"space-y-1",children:s.magenBagrut.recordingLinks.map((a,c)=>e.jsx("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"block text-blue-600 hover:text-blue-800 hover:underline text-sm",children:a},c))}):e.jsx("div",{className:"text-gray-400 text-sm",children:"××™×Ÿ ×§×™×©×•×¨×™×"})]})]})})]}),s.program&&s.program.length>0?e.jsxs(G,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"×˜×‘×œ×ª ×¦×™×•× ×™× ×ž×¤×•×¨×˜×ª"}),n.length>0&&e.jsxs("div",{className:"flex items-center gap-2 text-lg font-bold text-primary-600",children:[e.jsx(Oe,{className:"w-5 h-5"}),"×ž×ž×•×¦×¢ ×›×œ×œ×™: ",d()]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm border-collapse border border-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right font-semibold text-gray-700 border border-gray-200",children:"×ž×¡' ×™×¦×™×¨×”"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold text-gray-700 border border-gray-200 min-w-[200px]",children:"×©× ×”×™×¦×™×¨×” ×•×ž×œ×—×™×Ÿ"}),e.jsxs("th",{className:"px-4 py-3 text-center font-semibold text-gray-700 border border-gray-200",children:["×ž×™×•×ž× ×•×ª × ×’×™× ×”/×©×™×¨×”",e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:"(×ž×§×¡' 40)"})]}),e.jsxs("th",{className:"px-4 py-3 text-center font-semibold text-gray-700 border border-gray-200",children:["×”×‘× ×” ×ž×•×¡×™×§×œ×™×ª",e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:"(×ž×§×¡' 30)"})]}),e.jsxs("th",{className:"px-4 py-3 text-center font-semibold text-gray-700 border border-gray-200",children:["×™×“×™×¢×ª ×”×˜×§×¡×˜",e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:"(×ž×§×¡' 20)"})]}),e.jsxs("th",{className:"px-4 py-3 text-center font-semibold text-gray-700 border border-gray-200",children:['× ×•×’×Ÿ ×‘×¢"×¤',e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:"(10)"})]}),e.jsxs("th",{className:"px-4 py-3 text-center font-semibold text-gray-700 border border-gray-200",children:['×¡×”"×›',e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:"(100)"})]})]})}),e.jsx("tbody",{children:n.length>0?n.map((a,c)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-center font-medium text-gray-900 border border-gray-200",children:a.pieceNumber}),e.jsx("td",{className:"px-4 py-3 border border-gray-200",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium text-gray-900",children:a.pieceTitle}),e.jsx("div",{className:"text-gray-600",children:a.composer})]})}),e.jsx("td",{className:"px-4 py-3 text-center border border-gray-200",children:t?e.jsx("select",{value:a.playingSkills,onChange:y=>B(c,"playingSkills",parseInt(y.target.value)),className:`w-20 px-2 py-1 text-center border rounded focus:ring-2 focus:ring-primary-500 focus:border-transparent ${I[`piece${c}_playingSkills`]?"border-red-300":"border-gray-300"}`,children:D(40)}):e.jsx("span",{className:"font-medium text-gray-900",children:a.playingSkills})}),e.jsx("td",{className:"px-4 py-3 text-center border border-gray-200",children:t?e.jsx("select",{value:a.musicalUnderstanding,onChange:y=>B(c,"musicalUnderstanding",parseInt(y.target.value)),className:`w-20 px-2 py-1 text-center border rounded focus:ring-2 focus:ring-primary-500 focus:border-transparent ${I[`piece${c}_musicalUnderstanding`]?"border-red-300":"border-gray-300"}`,children:D(30)}):e.jsx("span",{className:"font-medium text-gray-900",children:a.musicalUnderstanding})}),e.jsx("td",{className:"px-4 py-3 text-center border border-gray-200",children:t?e.jsx("select",{value:a.textKnowledge,onChange:y=>B(c,"textKnowledge",parseInt(y.target.value)),className:`w-20 px-2 py-1 text-center border rounded focus:ring-2 focus:ring-primary-500 focus:border-transparent ${I[`piece${c}_textKnowledge`]?"border-red-300":"border-gray-300"}`,children:D(20)}):e.jsx("span",{className:"font-medium text-gray-900",children:a.textKnowledge})}),e.jsx("td",{className:"px-4 py-3 text-center border border-gray-200",children:t?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("button",{type:"button",onClick:()=>B(c,"playingByHeart",!a.playingByHeart),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 ${a.playingByHeart?"bg-green-500":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${a.playingByHeart?"translate-x-6":"translate-x-1"}`})}),e.jsx("span",{className:"text-xs text-gray-600 mt-1",children:a.playingByHeart?"10":"0"})]}):e.jsxs("div",{className:"flex flex-col items-center",children:[a.playingByHeart?e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 rounded text-sm font-medium",children:"×›×Ÿ"}):e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 rounded text-sm font-medium",children:"×œ×"}),e.jsx("span",{className:"text-xs text-gray-600 mt-1",children:a.playingByHeart?"10":"0"})]})}),e.jsx("td",{className:"px-4 py-3 text-center font-bold text-primary-600 border border-gray-200",children:S(a)})]},c)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-8 text-center text-gray-500 border border-gray-200",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(Z,{className:"w-8 h-8 text-gray-300"}),e.jsx("p",{children:"××™×Ÿ ×™×¦×™×¨×•×ª ×‘×ª×›× ×™×ª ×”×‘×’×¨×•×ª ×œ×“×™×¨×•×’"}),e.jsx("p",{className:"text-sm",children:'×™×© ×œ×”×•×¡×™×£ ×™×¦×™×¨×•×ª ×‘×œ×©×•× ×™×ª "×™×¦×™×¨×•×ª ×‘×ª×›× ×™×ª" ×œ×¤× ×™ ×”×ž×©×š ×”×“×™×¨×•×’'})]})})})})]})}),t&&e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"×ž×¤×ª×— ×¦×™×•× ×™×"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-2 text-sm",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-medium text-green-600",children:"95-100"}),e.jsx("span",{className:"text-gray-600",children:"×ž×¦×˜×™×™×Ÿ ×‘×ž×™×•×—×“"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-medium text-green-600",children:"90-94"}),e.jsx("span",{className:"text-gray-600",children:"×ž×¦×˜×™×™×Ÿ"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-medium text-blue-600",children:"85-89"}),e.jsx("span",{className:"text-gray-600",children:"×˜×•×‘ ×ž××•×“"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-medium text-yellow-600",children:"70-84"}),e.jsx("span",{className:"text-gray-600",children:"×˜×•×‘"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-medium text-orange-600",children:"60-69"}),e.jsx("span",{className:"text-gray-600",children:"×¢×•×‘×¨"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-medium text-red-600",children:"0-59"}),e.jsx("span",{className:"text-gray-600",children:"×œ× ×¢×•×‘×¨"})]})]})]})]}):e.jsx(G,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Z,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"××™×Ÿ ×™×¦×™×¨×•×ª ×‘×ª×›× ×™×ª ×”×‘×’×¨×•×ª"}),e.jsxs("p",{className:"text-gray-600 mb-6",children:["×œ×¤× ×™ ×©× ×™×ª×Ÿ ×œ×“×¨×’ ××ª ×”×ž×’×Ÿ ×‘×’×¨×•×ª, ×™×© ×œ×”×•×¡×™×£ ×™×¦×™×¨×•×ª ×œ×ª×›× ×™×ª ×”×‘×’×¨×•×ª.",e.jsx("br",{}),'×¢×‘×•×¨ ×œ×œ×©×•× ×™×ª "×™×¦×™×¨×•×ª ×‘×ª×›× ×™×ª" ×•×”×•×¡×£ ×œ×¤×—×•×ª ×™×¦×™×¨×” ××—×ª.']}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:()=>{const a=document.querySelector('[data-tab="works"]');a&&a.click()},className:"inline-flex items-center gap-2 px-6 py-3 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[e.jsx(J,{className:"w-5 h-5"}),"×¢×‘×•×¨ ×œ×¨×©×™×ž×ª ×™×¦×™×¨×•×ª"]})})]})})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Z,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"×ž×’×Ÿ ×‘×’×¨×•×ª ×˜×¨× × ×§×‘×¢"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"×”×©×ž×¢×ª ×ž×’×Ÿ ×‘×’×¨×•×ª ×”×™× ×”×©×ž×¢×” ××—×¨×•× ×” ×œ×§×¨××ª ×¨×¡×™×˜×œ ×•×§×‘×™×¢×ª ×¦×™×•×Ÿ ×ž×’×Ÿ"}),e.jsxs("button",{onClick:()=>w(!0),className:"inline-flex items-center gap-2 px-6 py-3 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[e.jsx(J,{className:"w-5 h-5"}),"×”×’×“×¨ ×ž×’×Ÿ ×‘×’×¨×•×ª"]})]})]})},Fs=_s,Os=({isOpen:s,onClose:g,onSubmit:t,existingPieces:w=[],initialData:N=null,title:h="×”×•×¡×£ ×™×¦×™×¨×”",submitText:j="×”×•×¡×£ ×™×¦×™×¨×”"})=>{const[o,n]=p.useState({pieceNumber:1,pieceTitle:"",composer:"",duration:"",movement:"",youtubeLink:""}),[k,I]=p.useState({}),[U,B]=p.useState(!1),S=()=>{const v=w.map(u=>u.pieceNumber).filter(u=>u!=null);for(let u=1;u<=10;u++)if(!v.includes(u))return u;return v.length+1},d=()=>{n(N?{pieceNumber:N.pieceNumber||1,pieceTitle:N.pieceTitle||"",composer:N.composer||"",duration:N.duration||"",movement:N.movement||"",youtubeLink:N.youtubeLink||""}:{pieceNumber:S(),pieceTitle:"",composer:"",duration:"",movement:"",youtubeLink:""}),I({}),B(!1)};p.useEffect(()=>{s&&n(N?{pieceNumber:N.pieceNumber||1,pieceTitle:N.pieceTitle||"",composer:N.composer||"",duration:N.duration||"",movement:N.movement||"",youtubeLink:N.youtubeLink||""}:v=>({...v,pieceNumber:S()}))},[s,w,N]);const C=()=>{d(),g()},D=()=>{const v={};return(!o.pieceNumber||o.pieceNumber<1)&&(v.pieceNumber="×ž×¡×¤×¨ ×™×¦×™×¨×” ×—×•×‘×”"),w.some(P=>P.pieceNumber===o.pieceNumber)&&(!N||N.pieceNumber!==o.pieceNumber)&&(v.pieceNumber="×ž×¡×¤×¨ ×™×¦×™×¨×” ×–×” ×›×‘×¨ ×§×™×™×"),o.pieceTitle.trim()||(v.pieceTitle="×©× ×”×™×¦×™×¨×” ×”×•× ×©×“×” ×—×•×‘×”"),o.composer.trim()||(v.composer="×©× ×”×ž×œ×—×™×Ÿ ×”×•× ×©×“×” ×—×•×‘×”"),o.duration.trim()||(v.duration="×ž×©×š ×”×‘×™×¦×•×¢ ×”×•× ×©×“×” ×—×•×‘×”"),o.youtubeLink&&o.youtubeLink.trim()&&(/^(https?:\/\/)?(www\.)?(youtube\.com|youtu\.be)\/.+/.test(o.youtubeLink)||(v.youtubeLink="×§×™×©×•×¨ ×™×•×˜×™×•×‘ ×œ× ×ª×§×™×Ÿ")),I(v),Object.keys(v).length===0},L=async v=>{if(v.preventDefault(),!!D()){B(!0);try{await t({...o,movement:o.movement?.trim()||void 0,youtubeLink:o.youtubeLink?.trim()||void 0}),C()}catch(u){console.error("Error adding piece:",u),I({general:"×©×’×™××” ×‘×”×•×¡×¤×ª ×”×™×¦×™×¨×”. ×× × × ×¡×” ×©×•×‘."})}finally{B(!1)}}},f=(v,u)=>{n(P=>({...P,[v]:u})),k[v]&&I(P=>({...P,[v]:""}))};return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:h}),e.jsx("p",{className:"text-gray-600 mt-1",children:N?"×¢×¨×•×š ××ª ×¤×¨×˜×™ ×”×™×¦×™×¨×”":"×”×•×¡×£ ×™×¦×™×¨×” ×—×“×©×” ×œ×ª×›× ×™×ª ×”×‘×™×¦×•×¢"})]}),e.jsx("button",{onClick:C,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(V,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:L,className:"p-6 space-y-6",children:[k.general&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("span",{className:"text-red-700",children:k.general})}),e.jsxs(G,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5 text-gray-600"}),"×¤×¨×˜×™ ×”×™×¦×™×¨×”"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["×ž×¡×¤×¨ ×™×¦×™×¨×” ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ws,{className:"w-4 h-4 text-gray-400"}),e.jsx("select",{value:o.pieceNumber,onChange:v=>f("pieceNumber",parseInt(v.target.value)),disabled:!!N,className:`flex-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent ${k.pieceNumber?"border-red-300":"border-gray-300"} ${N?"bg-gray-100 cursor-not-allowed":""}`,children:Array.from({length:10},(v,u)=>u+1).map(v=>{const u=w.some(P=>P.pieceNumber===v);return e.jsxs("option",{value:v,disabled:u,children:["×™×¦×™×¨×” ",v," ",u?"(×ª×¤×•×¡)":""]},v)})})]}),k.pieceNumber&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:k.pieceNumber})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["×©× ×”×™×¦×™×¨×” ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:o.pieceTitle,onChange:v=>f("pieceTitle",v.target.value),placeholder:"×œ×“×•×’×ž×”: ×¡×•× ×˜×” ×œ×¤×¡× ×ª×¨ ×‘×ž×™ ×ž×™× ×•×¨",className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent ${k.pieceTitle?"border-red-300":"border-gray-300"}`}),k.pieceTitle&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:k.pieceTitle})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["×ž×œ×—×™×Ÿ ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:o.composer,onChange:v=>f("composer",v.target.value),placeholder:"×œ×“×•×’×ž×”: ×™×•×”××Ÿ ×¡×‘×¡×˜×™××Ÿ ×‘××š",className:`flex-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent ${k.composer?"border-red-300":"border-gray-300"}`})]}),k.composer&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:k.composer})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["×ž×©×š ×”×‘×™×¦×•×¢ ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:o.duration,onChange:v=>f("duration",v.target.value),placeholder:"×œ×“×•×’×ž×”: 7 ×“×§×•×ª",className:`flex-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent ${k.duration?"border-red-300":"border-gray-300"}`})]}),k.duration&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:k.duration})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×¤×¨×§"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ks,{className:"w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:o.movement||"",onChange:v=>f("movement",v.target.value),placeholder:"×œ×“×•×’×ž×”: ×¤×¨×§ ×¨××©×•×Ÿ - Allegro",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"××•×¤×¦×™×•× ×œ×™ - ×¦×™×™×Ÿ ×¤×¨×§ ××• ×ª× ×•×¢×” ×¡×¤×¦×™×¤×™×™×"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×§×™×©×•×¨ ×™×•×˜×™×•×‘"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Cs,{className:"w-4 h-4 text-gray-400"}),e.jsx("input",{type:"url",value:o.youtubeLink||"",onChange:v=>f("youtubeLink",v.target.value),placeholder:"https://www.youtube.com/watch?v=...",className:`flex-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent ${k.youtubeLink?"border-red-300":"border-gray-300"}`})]}),k.youtubeLink&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:k.youtubeLink}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"××•×¤×¦×™×•× ×œ×™ - ×§×™×©×•×¨ ×œ×”×§×œ×˜×” ×‘×™×•×˜×™×•×‘"})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:C,disabled:U,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"×‘×™×˜×•×œ"}),e.jsx("button",{type:"submit",disabled:U,className:"flex items-center px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:U?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"×ž×•×¡×™×£..."]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"w-4 h-4 ml-2"}),j]})})]})]})]})}):null},_e=Os,Hs=({initialData:s,onSubmit:g,onCancel:t,isEdit:w=!1,showTeacherSearch:N=!0})=>{const[h,j]=p.useState({name:"",instrument:"",phone:"",email:""}),[o,n]=p.useState([]),[k,I]=p.useState(""),[U,B]=p.useState(!1),[S,d]=p.useState(null),[C,D]=p.useState(!1),[L,f]=p.useState({}),[v,u]=p.useState(!1),[P,R]=p.useState(!0),$=["×¤×¡× ×ª×¨","×’×™×˜×¨×”","×›×™× ×•×¨","×•×™×•×œ×”","×¦'×œ×•","×§×•× ×˜×¨×‘×¡","×—×œ×™×œ×™×ª","×—×œ×™×œ ×¦×“","××‘×•×‘","×§×œ×¨×™× ×˜","×¡×§×¡×•×¤×•×Ÿ","×‘×¡×•×Ÿ","×—×¦×•×¦×¨×”","×§×¨×Ÿ ×™×¢×¨","×˜×¨×•×ž×‘×•×Ÿ","×ª×•×¤×™×","×›×œ×™ ×”×§×©×”","××—×¨"];p.useEffect(()=>{N&&(async()=>{try{R(!0);const m=await K.teachers.getTeachers();console.log("ðŸŽ­ Loaded teachers for accompanist selection:",m?.length||0),n(m||[])}catch(m){console.error("Error loading teachers:",m)}finally{R(!1)}})()},[N]),p.useEffect(()=>{s&&(j({name:s.name||"",instrument:s.instrument||"",phone:s.phone||"",email:s.email||""}),D(!0))},[s]);const F=p.useMemo(()=>{if(!k.trim()||!o)return o.slice(0,10);const l=k.toLowerCase().trim();return o.filter(m=>{const A=m.personalInfo?.fullName?.toLowerCase()||"",T=m.personalInfo?.firstName?.toLowerCase()||"",H=m.personalInfo?.lastName?.toLowerCase()||"",ce=m.professionalInfo?.instruments?.join(" ").toLowerCase()||"";return A.includes(l)||T.includes(l)||H.includes(l)||ce.includes(l)}).slice(0,20)},[o,k]),X=l=>{d(l),j(m=>({...m,name:l.personalInfo?.fullName||"",phone:l.personalInfo?.phone||"",email:l.personalInfo?.email||""})),I(l.personalInfo?.fullName||""),B(!1),D(!1),L.name&&f(m=>({...m,name:""}))},z=l=>{I(l),B(!0),d(null),S||j(m=>({...m,name:l}))},b=()=>{D(!0),d(null),I(""),B(!1),j(l=>({...l,name:"",phone:"",email:""}))},a=()=>{const l={};return h.name.trim()||(l.name="×©× ×”×ž×œ×•×•×” ×”×•× ×©×“×” ×—×•×‘×”"),h.instrument.trim()||(l.instrument="×›×œ×™ ×”×œ×™×•×•×™ ×”×•× ×©×“×” ×—×•×‘×”"),h.email&&!h.email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)&&(l.email="×›×ª×•×‘×ª ××™×ž×™×™×œ ×œ× ×ª×§×™× ×”"),h.phone&&h.phone.trim()&&(/^05\d{8}$/.test(h.phone.replace(/\D/g,""))||(l.phone="×ž×¡×¤×¨ ×˜×œ×¤×•×Ÿ ×œ× ×ª×§×™×Ÿ (×¦×¨×™×š ×œ×”×ª×—×™×œ ×‘-05 ×•×œ×›×œ×•×œ 10 ×¡×¤×¨×•×ª)")),f(l),Object.keys(l).length===0},c=async l=>{if(l.preventDefault(),!!a()){u(!0);try{await g(h)}catch(m){console.error("Error submitting accompanist:",m);const{fieldErrors:A,generalMessage:T,isValidationError:H}=hs(m,"×©×’×™××” ×‘×©×ž×™×¨×ª ×”×ž×œ×•×•×”. ×× × × ×¡×” ×©×•×‘.");f(H?{...A,general:T}:{general:T})}finally{u(!1)}}},y=l=>{const m=l.replace(/\D/g,"");return m.startsWith("972")&&m.length>=12?"0"+m.slice(3):m.length>0&&!m.startsWith("05")&&m.startsWith("5")?"05"+m.slice(1,9):m.slice(0,10)},i=(l,m)=>{let A=m;l==="phone"&&(A=y(m)),j(T=>({...T,[l]:A})),L[l]&&f(T=>({...T,[l]:""}))};return e.jsxs("div",{className:"bg-white rounded-lg max-w-2xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:w?"×¢×¨×™×›×ª ×ž×œ×•×•×”":"×ž×œ×•×•×” ×—×“×©"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"×”×•×¡×¤×ª × ×’×Ÿ ×ž×œ×•×•×” ×œ×‘×™×¦×•×¢ ×”×‘×’×¨×•×ª"})]}),e.jsx("button",{onClick:t,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(V,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:c,className:"p-6 space-y-6",children:[L.general&&e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-3",children:[e.jsx(Z,{className:"w-5 h-5 text-red-500"}),e.jsx("span",{className:"text-red-700",children:L.general})]}),N&&!C&&e.jsxs(G,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(de,{className:"w-5 h-5 text-gray-600"}),"×‘×—×™×¨×ª ×ž×•×¨×” ×ž×”×ž×¢×¨×›×ª"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×—×™×¤×•×© ×ž×•×¨×”"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Bs,{className:"w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:k,onChange:l=>z(l.target.value),onFocus:()=>B(!0),placeholder:"×—×¤×© ×œ×¤×™ ×©× ××• ×›×œ×™ × ×’×™× ×”...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",disabled:P})]}),P&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"×˜×•×¢×Ÿ ×¨×©×™×ž×ª ×ž×•×¨×™×..."}),U&&!P&&F.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-50 max-h-60 overflow-y-auto",children:F.map(l=>e.jsx("div",{onClick:()=>X(l),className:"p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(se,{className:"w-4 h-4 text-gray-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900",children:l.personalInfo?.fullName||"×œ×œ× ×©×"}),l.professionalInfo?.instruments&&l.professionalInfo.instruments.length>0&&e.jsxs("div",{className:"text-sm text-gray-600",children:["×›×œ×™×: ",l.professionalInfo.instruments.join(", ")]}),l.personalInfo?.phone&&e.jsx("div",{className:"text-xs text-gray-500",children:l.personalInfo.phone})]})]})},l._id))})]}),S&&e.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(se,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-green-900",children:["× ×‘×—×¨: ",S.personalInfo?.fullName]}),S.personalInfo?.phone&&e.jsxs("div",{className:"text-sm text-green-700",children:["×˜×œ×¤×•×Ÿ: ",S.personalInfo.phone]})]})]})}),e.jsx("div",{className:"pt-3 border-t border-gray-200",children:e.jsx("button",{type:"button",onClick:b,className:"text-sm text-primary-600 hover:text-primary-700 underline",children:"×œ× ×ž×¦××ª ××ª ×”×ž×•×¨×”? ×”×–×Ÿ ×¤×¨×˜×™× ×‘××•×¤×Ÿ ×™×“× ×™"})})]})]}),(C||!N)&&e.jsxs(G,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(de,{className:"w-5 h-5 text-gray-600"}),"×¤×¨×˜×™ ×”×ž×œ×•×•×”"]}),N&&e.jsx("button",{type:"button",onClick:()=>D(!1),className:"text-sm text-primary-600 hover:text-primary-700 underline",children:"×—×–×•×¨ ×œ×—×™×¤×•×© ×ž×•×¨×™×"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["×©× ×”×ž×œ×•×•×” ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:h.name,onChange:l=>i("name",l.target.value),placeholder:"×œ×“×•×’×ž×”: ×™×•×¡×™ ×›×”×Ÿ",className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent ${L.name?"border-red-300":"border-gray-300"}`}),L.name&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:L.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×ž×¡×¤×¨ ×˜×œ×¤×•×Ÿ"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(He,{className:"w-4 h-4 text-gray-400"}),e.jsx("input",{type:"tel",value:h.phone,onChange:l=>i("phone",l.target.value),placeholder:"0501234567",className:`flex-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent ${L.phone?"border-red-300":"border-gray-300"}`,dir:"ltr"})]}),L.phone&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:L.phone})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×›×ª×•×‘×ª ××™×ž×™×™×œ"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ss,{className:"w-4 h-4 text-gray-400"}),e.jsx("input",{type:"email",value:h.email,onChange:l=>i("email",l.target.value),placeholder:"×œ×“×•×’×ž×”: yosi@example.com",className:`flex-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent ${L.email?"border-red-300":"border-gray-300"}`,dir:"ltr"})]}),L.email&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:L.email})]})]})]}),e.jsxs(G,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5 text-gray-600"}),"×›×œ×™ ×”×œ×™×•×•×™"]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["×›×œ×™ ×”×œ×™×•×•×™ ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:h.instrument,onChange:l=>i("instrument",l.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent ${L.instrument?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×›×œ×™"}),$.map(l=>e.jsx("option",{value:l,children:l},l))]}),L.instrument&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:L.instrument}),h.instrument==="××—×¨"&&e.jsx("div",{className:"mt-2",children:e.jsx("input",{type:"text",placeholder:"×”×›× ×¡ ××ª ×©× ×”×›×œ×™",onChange:l=>i("instrument",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})})]})]}),e.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(de,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"×ž×™×“×¢ ×—×©×•×‘"}),e.jsx("p",{children:"×¤×¨×˜×™ ×”×§×©×¨ ×™×•×¢×‘×¨×• ×œ×ž×œ×•×•×” ×œ×ª×™××•× ×—×–×¨×•×ª ×•×™×•× ×”×‘×’×¨×•×ª. ×•×“× ×©×”×¤×¨×˜×™× × ×›×•× ×™× ×•×¢×“×›× ×™×™×."})]})]})}),e.jsxs("div",{className:"flex justify-between items-center pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:t,disabled:v,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"×‘×™×˜×•×œ"}),e.jsx("button",{type:"submit",disabled:v,className:"flex items-center px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:v?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"×©×•×ž×¨..."]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"w-4 h-4 ml-2"}),"×©×ž×•×¨ ×ž×œ×•×•×”"]})})]})]})]})},Rs=Hs;function Ks({accompaniment:s,onUpdate:g,readonly:t=!1}){const[w,N]=p.useState(null),[h,j]=p.useState(null),[o,n]=p.useState(!1),k=["× ×’×Ÿ ×ž×œ×•×•×”","×”×¨×›×‘"],I=["×¤×¡× ×ª×¨","×’×™×˜×¨×”","×›×™× ×•×¨","×•×™×•×œ×”","×¦'×œ×•","×§×•× ×˜×¨×‘×¡","×—×œ×™×œ×™×ª","×§×œ×¨×™× ×˜","×¡×§×¡×•×¤×•×Ÿ","×—×¦×•×¦×¨×”","×˜×¨×•×ž×‘×•×Ÿ","×ª×•×¤×™×","×›×œ×™ ×”×§×©×”","××—×¨"],U=u=>{g({...s,type:u})},B=u=>{N(u),j({...s.accompanists[u]})},S=()=>{N(null),j(null)},d=()=>{if(w!==null&&h){const u=[...s.accompanists];u[w]=h,g({...s,accompanists:u}),N(null),j(null)}},C=u=>{if(window.confirm("×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×ž×—×•×§ × ×’×Ÿ ×–×”?")){const P=s.accompanists.filter((R,$)=>$!==u);g({...s,accompanists:P})}},D=u=>{if(u.name&&u.instrument){const P=[...s.accompanists,{name:u.name,instrument:u.instrument,phone:u.phone}];g({...s,accompanists:P}),n(!1)}},L=()=>{n(!1)},f=u=>u?/^05\d{8}$/.test(u):!0,v=(u,P)=>{const R=w===P;return e.jsx(G,{padding:"md",className:"relative",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("div",{className:"flex-1",children:R?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×©× ×”× ×’×Ÿ *"}),e.jsx("input",{type:"text",value:h?.name||"",onChange:$=>j(F=>F?{...F,name:$.target.value}:null),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"×©× ×ž×œ×"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×›×œ×™ × ×’×™× ×” *"}),e.jsxs("select",{value:h?.instrument||"",onChange:$=>j(F=>F?{...F,instrument:$.target.value}:null),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×›×œ×™ × ×’×™× ×”"}),I.map($=>e.jsx("option",{value:$,children:$},$))]}),h?.instrument==="××—×¨"&&e.jsx("input",{type:"text",value:h?.instrument||"",onChange:$=>j(F=>F?{...F,instrument:$.target.value}:null),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 mt-2",placeholder:"×¦×™×™×Ÿ ×›×œ×™ × ×’×™× ×”"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×ž×¡×¤×¨ ×˜×œ×¤×•×Ÿ"}),e.jsx("input",{type:"tel",value:h?.phone||"",onChange:$=>j(F=>F?{...F,phone:$.target.value||null}:null),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 ${h?.phone&&!f(h.phone)?"border-red-300 focus:ring-red-500":"border-gray-300"}`,placeholder:"0501234567"}),h?.phone&&!f(h.phone)&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:"×ž×¡×¤×¨ ×˜×œ×¤×•×Ÿ ×—×™×™×‘ ×œ×”×ª×—×™×œ ×‘-05 ×•×œ×”×›×™×œ 10 ×¡×¤×¨×•×ª"})]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(Ls,{className:"w-5 h-5 text-primary-600 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:u.name})]}),e.jsxs("div",{className:"flex items-center text-gray-600 mb-2",children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"text-sm",children:u.instrument})]}),u.phone&&e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(He,{className:"w-4 h-4 mr-2"}),e.jsx("a",{href:`tel:${u.phone}`,className:"text-sm text-primary-600 hover:text-primary-800",children:u.phone})]})]})}),!t&&e.jsx("div",{className:"flex items-center gap-2 mr-4",children:R?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:d,disabled:!h?.name||!h?.instrument,className:"p-2 text-green-600 hover:text-green-800 disabled:text-gray-400",children:e.jsx(te,{className:"w-4 h-4"})}),e.jsx("button",{onClick:S,className:"p-2 text-gray-600 hover:text-gray-800",children:e.jsx(V,{className:"w-4 h-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>B(P),className:"p-2 text-primary-600 hover:text-primary-800",children:e.jsx(Re,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>C(P),className:"p-2 text-red-600 hover:text-red-800",children:e.jsx(Y,{className:"w-4 h-4"})})]})})]})},P)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx(de,{className:"w-6 h-6 mr-3 text-primary-600"}),"×œ×™×•×•×™ ×ž×•×–×™×§×œ×™"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"× ×’× ×™×:"})," ",s.accompanists.length]}),!t&&e.jsxs("button",{onClick:()=>n(!0),className:"flex items-center px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"×”×•×¡×£ × ×’×Ÿ"]})]})]}),e.jsxs(G,{padding:"md",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"×¡×•×’ ×”×œ×™×•×•×™"})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:k.map(u=>e.jsx("div",{children:e.jsxs("label",{className:"flex items-center p-4 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",children:[e.jsx("input",{type:"radio",name:"accompanimentType",value:u,checked:s.type===u,onChange:P=>!t&&U(P.target.value),disabled:t,className:"w-4 h-4 text-primary-600 border-gray-300 focus:ring-primary-500"}),e.jsxs("div",{className:"mr-3",children:[e.jsx("div",{className:"font-medium text-gray-900",children:u}),e.jsx("div",{className:"text-sm text-gray-600",children:u==="× ×’×Ÿ ×ž×œ×•×•×”"?"× ×’×Ÿ ×™×—×™×“ ×”×ž×œ×•×•×” ××ª ×”×‘×™×¦×•×¢":"×”×¨×›×‘ ×©×œ ×ž×¡×¤×¨ × ×’× ×™×"})]})]})},u))})]}),o&&!t&&e.jsx(Rs,{onSubmit:D,onCancel:L}),s.accompanists.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["× ×’× ×™× ×ž×œ×•×•×™× (",s.type,")"]}),s.accompanists.map((u,P)=>v(u,P))]}):e.jsx(G,{padding:"md",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(de,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"××™×Ÿ × ×’× ×™× ×ž×œ×•×•×™×"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"×”×•×¡×£ × ×’×Ÿ ×ž×œ×•×•×” ×œ×‘×™×¦×•×¢ ×”×‘×’×¨×•×ª"}),!t&&e.jsxs("button",{onClick:()=>n(!0),className:"inline-flex items-center px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"×”×•×¡×£ × ×’×Ÿ ×¨××©×•×Ÿ"]})]})})]})}const Vs=s=>(s.presentations?.slice(0,3)||[]).map((w,N)=>({presentationNumber:N+1,title:`×”×©×ž×¢×” ${N+1}`,date:w.date,status:w.completed?"×¢×‘×¨/×”":"×œ× × ×‘×—×Ÿ",completed:w.completed||!1,grade:w.grade,gradeLevel:w.gradeLevel,recordingLinks:w.recordingLinks||[],notes:w.notes||"",reviewedBy:w.reviewedBy,detailedGrading:w.detailedGrading,type:"regular",backendIndex:N})),Ke=s=>s.type==="magen"||s.presentationNumber===4||s.backendIndex===-1,zs=s=>Ke(s)?-1:s.backendIndex??s.presentationNumber-1,qs=s=>s>=0&&s<=2,Ws=s=>({completed:s.completed,status:s.status,date:s.date,review:s.notes,reviewedBy:s.reviewedBy,grade:s.grade,gradeLevel:s.gradeLevel,recordingLinks:s.recordingLinks||[]}),Xs=s=>{const g=s.presentations?.filter(w=>w.completed).length||0,t=s.magenBagrut?.completed?1:0;return{regular:g,magen:t,total:g+t}},Qs={MAX_REGULAR_PRESENTATIONS:3,TOTAL_PRESENTATIONS_WITH_MAGEN:4,MAGEN_DISPLAY_INDEX:4,MAGEN_BACKEND_MARKER:-1},ne=({label:s,icon:g,isActive:t,onClick:w,badge:N})=>e.jsxs("button",{onClick:w,className:`
      flex items-center px-4 py-3 border-b-2 transition-all
      ${t?"border-primary-600 text-primary-700 bg-primary-50":"border-transparent text-gray-800 hover:text-gray-900 hover:bg-gray-50"}
    `,children:[g,e.jsx("span",{className:"mr-2 font-medium",children:s}),N!==void 0&&N>0&&e.jsx("span",{className:"mr-2 px-2 py-0.5 bg-primary-100 text-primary-700 rounded-full text-xs font-semibold",children:N})]});function it(){const{bagrutId:s}=ys(),g=fs(),{bagrut:t,loading:w,error:N,fetchBagrutById:h,updateBagrut:j,deleteBagrut:o,completeBagrut:n,calculateFinalGrade:k,uploadDocument:I,removeDocument:U,downloadDocument:B}=js(),[S,d]=p.useState("overview"),[C,D]=p.useState(null),[L,f]=p.useState(null),[v,u]=p.useState(!1),[P,R]=p.useState(!1),[$,F]=p.useState(""),[X,z]=p.useState(!1),[b,a]=p.useState(null),[c,y]=p.useState(!1),[i,l]=p.useState(!1),[m,A]=p.useState(!1),[T,H]=p.useState(null),[ce,he]=p.useState(!1),[ye,fe]=p.useState(null),[Ve,ze]=p.useState(null),[qe,Se]=p.useState(!1),[ae,be]=p.useState(!1),[q,re]=p.useState({teacherId:"",conservatoryName:"",testDate:"",recitalUnits:5,recitalField:"",notes:""});t?.program?.slice(0,2).map(r=>r.pieceTitle||r.pieceName||""),t?.program?.slice(2,4).map(r=>r.pieceTitle||r.pieceName||""),t?.program?.slice(4,5).map(r=>r.pieceTitle||r.pieceName||""),p.useEffect(()=>{console.log("ðŸ” BagrutDetails useEffect: bagrutId:",s),s&&W()},[s]),p.useEffect(()=>{t&&re({teacherId:t.teacherId||"",conservatoryName:t.conservatoryName||"",testDate:t.testDate?new Date(t.testDate).toISOString().split("T")[0]:"",recitalUnits:t.recitalUnits||5,recitalField:t.recitalField||"",notes:t.notes||""})},[t]);const W=async()=>{if(s)try{console.log("ðŸš€ BagrutDetails: Starting to load bagrut details for ID:",s),await h(s),console.log("âœ… BagrutDetails: fetchBagrutById completed")}catch(r){console.error("âŒ BagrutDetails: Error loading bagrut:",r)}};p.useEffect(()=>{console.log("ðŸ” BagrutDetails bagrut effect: bagrut exists:",!!t),t&&(console.log("ðŸ“Š BagrutDetails: Bagrut data received:",t._id),We())},[t]);const We=async()=>{if(t)try{const[r,x]=await Promise.all([K.students.getStudentById(t.studentId),K.teachers.getTeacherById(t.teacherId)]);D(r),f(x)}catch(r){console.error("Error loading additional data:",r)}},Xe=async()=>{if(!s)return;await o(s)&&g("/bagruts"),u(!1)},Qe=async()=>{if(!s||!$.trim())return;await n(s,$)&&(await W(),R(!1),F(""))},Ye=async r=>{if(!(!s||!t))try{console.log("ðŸ” BagrutDetails: Updating accompaniment:",r);const x={studentId:t.studentId,teacherId:t.teacherId,program:t.program||[],conservatoryName:t.conservatoryName||"",accompaniment:r,presentations:t.presentations||[],isCompleted:t.isCompleted,isActive:t.isActive};t.testDate&&(x.testDate=t.testDate),t.notes&&(x.notes=t.notes),t.recitalUnits&&(x.recitalUnits=t.recitalUnits),t.recitalField&&(x.recitalField=t.recitalField),t.directorName&&(x.directorName=t.directorName),t.directorEvaluation&&(x.directorEvaluation=t.directorEvaluation),console.log("ðŸ” BagrutDetails: Sending accompaniment update:",x),await j(s,x)&&(console.log("âœ… BagrutDetails: Accompaniment updated successfully"),await W())}catch(x){console.error("âŒ BagrutDetails: Error updating accompaniment:",x)}},Je=async r=>{const x=r.target.files?.[0];if(!(!x||!s)){z(!0);try{const E=prompt("×‘×—×¨ ×§×˜×’×•×¨×™×”: ×ª×¢×•×“×”, ×ª×›× ×™×ª, ×”×§×œ×˜×”, ×ž×›×ª×‘ ×”×ž×œ×¦×”, ××—×¨"),M=prompt("×ª×™××•×¨ ×”×ž×¡×ž×š (××•×¤×¦×™×•× ×œ×™)");E&&await I(s,x,E,M||void 0)&&await W()}catch(E){console.error("Error uploading document:",E)}finally{z(!1)}}},Ze=async(r,x)=>{if(!s)return;const E=await B(s,r);if(E){const M=window.URL.createObjectURL(E),O=document.createElement("a");O.href=M,O.download=x,O.click(),window.URL.revokeObjectURL(M)}},es=async r=>{if(!s||!window.confirm("×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×ž×—×•×§ ×ž×¡×ž×š ×–×”?"))return;await U(s,r)&&await W()},ss=r=>{console.log("Updated performance:",r),y(!1)},ts=r=>{console.log("View presentation:",r),ze(r),Se(!0)},Le=async(r,x)=>{if(s)try{if(Ke(x)){const E=Ws(x);await K.bagrut.updateMagenBagrut(s,E)&&await W()}else{const E=zs(x);if(!qs(E)){console.error("Invalid presentation index for regular presentation:",E);return}console.log("ðŸ” Updating presentation:",{bagrutId:s,backendIndex:E,updatedPresentation:x}),await K.bagrut.updatePresentation(s,E,x)?(console.log("âœ… Presentation updated successfully"),await W()):console.error("âŒ Presentation update failed")}}catch(E){console.error("Error updating presentation:",E)}},as=async r=>{if(s)try{const x={date:null,completed:!1,grade:null,gradeLevel:null,recordingLinks:[],notes:"",reviewedBy:null,detailedGrading:null};await K.bagrut.updatePresentation(s,r,x)&&await W()}catch(x){console.error("Error deleting presentation:",x)}},rs=()=>{y(!1),a(null)},ls=async r=>{if(!(!s||!t))try{const x=[...t.program||[],r];let E=!1;try{E=await K.bagrut.updateBagrutProgram(s,x)}catch(M){console.warn("Program-specific endpoint not available, falling back to full bagrut update:",M),console.log("ðŸ” Original presentations:",t.presentations);const O=t.presentations?.map((_,ps)=>{console.log(`ðŸ” Processing presentation ${ps}:`,_);const Q={};return _.completed!==void 0&&(Q.completed=_.completed),_.status&&["×¢×‘×¨/×”","×œ× ×¢×‘×¨/×”","×œ× × ×‘×—×Ÿ"].includes(_.status)&&(Q.status=_.status),_.date&&(Q.date=_.date),_.review&&(Q.review=_.review),_.reviewedBy&&(Q.reviewedBy=_.reviewedBy),_.notes&&(Q.notes=_.notes),_.recordingLinks&&(Q.recordingLinks=_.recordingLinks),_.grade&&(Q.grade=_.grade),_.gradeLevel&&(Q.gradeLevel=_.gradeLevel),_.detailedGrading&&(Q.detailedGrading=_.detailedGrading),Q}).filter(_=>_&&Object.keys(_).length>0);console.log("ðŸ” Cleaned presentations:",O);const le={studentId:t.studentId,teacherId:t.teacherId,program:x,conservatoryName:t.conservatoryName||"",accompaniment:t.accompaniment||{type:"× ×’×Ÿ ×ž×œ×•×•×”",accompanists:[]},presentations:O||[],isCompleted:t.isCompleted,isActive:t.isActive};t.testDate&&(le.testDate=t.testDate),t.notes&&(le.notes=t.notes),t.recitalUnits&&(le.recitalUnits=t.recitalUnits),t.recitalField&&(le.recitalField=t.recitalField),t.magenBagrut&&(le.magenBagrut=t.magenBagrut),console.log("ðŸ” Sending update data:",le),E=await K.bagrut.updateBagrut(s,le)}E&&(await W(),l(!1))}catch(x){throw console.error("Error adding piece:",x),new Error("×©×’×™××” ×‘×”×•×¡×¤×ª ×”×™×¦×™×¨×”")}},ns=r=>{H(r),A(!0)},is=async r=>{if(!(!s||!t||!T))try{const x=(t.program||[]).map(M=>M.pieceNumber===T.pieceNumber?{...r,pieceNumber:T.pieceNumber}:M);let E=!1;try{E=await K.bagrut.updateBagrutProgram(s,x)}catch(M){console.warn("Program-specific endpoint not available, falling back to full bagrut update:",M);const O={studentId:t.studentId,teacherId:t.teacherId,program:x,conservatoryName:t.conservatoryName||"",accompaniment:t.accompaniment||{type:"× ×’×Ÿ ×ž×œ×•×•×”",accompanists:[]},presentations:t.presentations||[],isCompleted:t.isCompleted,isActive:t.isActive};t.testDate&&(O.testDate=t.testDate),t.notes&&(O.notes=t.notes),t.recitalUnits&&(O.recitalUnits=t.recitalUnits),t.recitalField&&(O.recitalField=t.recitalField),t.magenBagrut&&(O.magenBagrut=t.magenBagrut),E=await K.bagrut.updateBagrut(s,O)}E&&(await W(),A(!1),H(null))}catch(x){throw console.error("Error updating piece:",x),new Error("×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”×™×¦×™×¨×”")}},cs=r=>{fe(r),he(!0)},ds=async()=>{if(!(!s||!t||ye===null))try{const x=(t.program||[]).filter(M=>M.pieceNumber!==ye).map((M,O)=>({...M,pieceNumber:O+1}));let E=!1;try{E=await K.bagrut.updateBagrutProgram(s,x)}catch(M){console.warn("Program-specific endpoint not available, falling back to full bagrut update:",M);const O={studentId:t.studentId,teacherId:t.teacherId,program:x,conservatoryName:t.conservatoryName||"",accompaniment:t.accompaniment||{type:"× ×’×Ÿ ×ž×œ×•×•×”",accompanists:[]},presentations:t.presentations||[],isCompleted:t.isCompleted,isActive:t.isActive};t.testDate&&(O.testDate=t.testDate),t.notes&&(O.notes=t.notes),t.recitalUnits&&(O.recitalUnits=t.recitalUnits),t.recitalField&&(O.recitalField=t.recitalField),t.magenBagrut&&(O.magenBagrut=t.magenBagrut),E=await K.bagrut.updateBagrut(s,O)}E&&(await W(),he(!1),fe(null))}catch(r){throw console.error("Error deleting piece:",r),new Error("×©×’×™××” ×‘×ž×—×™×§×ª ×”×™×¦×™×¨×”")}},os=async()=>{if(!(!s||!t))try{const r={studentId:t.studentId,teacherId:q.teacherId,conservatoryName:q.conservatoryName,testDate:q.testDate?new Date(q.testDate):void 0,recitalUnits:q.recitalUnits,recitalField:q.recitalField,notes:q.notes,program:t.program||[],accompaniment:t.accompaniment||{type:"× ×’×Ÿ ×ž×œ×•×•×”",accompanists:[]},presentations:t.presentations||[],isCompleted:t.isCompleted,isActive:t.isActive};t.magenBagrut&&(r.magenBagrut=t.magenBagrut),await K.bagrut.updateBagrut(s,r)&&(await W(),be(!1))}catch(r){console.error("Error saving overview data:",r),alert("×©×’×™××” ×‘×©×ž×™×¨×ª ×”× ×ª×•× ×™×")}},ms=()=>{t&&re({teacherId:t.teacherId||"",conservatoryName:t.conservatoryName||"",testDate:t.testDate?new Date(t.testDate).toISOString().split("T")[0]:"",recitalUnits:t.recitalUnits||5,recitalField:t.recitalField||"",notes:t.notes||""}),be(!1)},xs=async()=>{if(s)try{const r=await fetch(`/api/bagrut/${s}/export/pdf`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(r.ok){const x=await r.blob(),E=window.URL.createObjectURL(x),M=document.createElement("a");M.href=E,M.download=`bagrut-${C?.personalInfo?.fullName||s}.pdf`,M.click(),window.URL.revokeObjectURL(E)}}catch(r){console.error("Error exporting PDF:",r)}};if(console.log("ðŸ” BagrutDetails render: loading:",w,"bagrut:",!!t,"error:",N),w)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ge,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-primary-600"}),e.jsx("div",{className:"text-gray-800",children:"×˜×•×¢×Ÿ ×¤×¨×˜×™ ×‘×’×¨×•×ª..."}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:["ID: ",s]})]})});if(N||!t)return console.log("âŒ BagrutDetails: Showing error state - error:",N,"bagrut exists:",!!t),e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Z,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"×©×’×™××” ×‘×˜×¢×™× ×ª ×”×‘×’×¨×•×ª"}),e.jsx("p",{className:"text-gray-800 mb-4",children:N||"×‘×’×¨×•×ª ×œ× × ×ž×¦××”"}),e.jsxs("div",{className:"text-xs text-gray-400 mb-4",children:["Debug: ID=",s,", Loading=",w,", Error=",N,", Bagrut=",!!t]}),e.jsxs("button",{onClick:()=>g("/bagruts"),className:"inline-flex items-center px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:[e.jsx(Ue,{className:"w-4 h-4 ml-2"}),"×—×–×•×¨ ×œ×¨×©×™×ž×ª ×‘×’×¨×•×™×•×ª"]})]});const me=Xs(t),gs=Qs.TOTAL_PRESENTATIONS_WITH_MAGEN,De=t.program?.length||0,Ie=t.documents?.length||0,Ee=Vs(t),Pe=Math.round(me.total/gs*100),us=()=>t.isCompleted?"green":Pe>=50?"orange":"red";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between bg-white p-6 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>g("/bagruts"),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Ue,{className:"w-5 h-5 text-gray-600"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900",children:["×‘×’×¨×•×ª - ",C?.personalInfo?.fullName||"×˜×•×¢×Ÿ..."]}),t.isCompleted?e.jsx("span",{className:"px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-medium",children:"×”×•×©×œ×"}):e.jsx("span",{className:"px-3 py-1 bg-orange-100 text-orange-700 rounded-full text-sm font-medium",children:"×‘×ª×”×œ×™×š"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-800",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(se,{className:"w-4 h-4"}),"×ž×•×¨×”: ",L?.personalInfo?.fullName||"×˜×•×¢×Ÿ..."]}),t.conservatoryName&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"w-4 h-4"}),t.conservatoryName]}),t.testDate&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ie,{className:"w-4 h-4"}),new Date(t.testDate).toLocaleDateString("he-IL")]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[!t.isCompleted&&e.jsx(e.Fragment,{children:e.jsxs("button",{onClick:()=>R(!0),className:"flex items-center px-3 py-2 text-green-700 border border-green-300 rounded-lg hover:bg-green-50",children:[e.jsx(Be,{className:"w-4 h-4 ml-1"}),"×”×©×œ× ×‘×’×¨×•×ª"]})}),e.jsxs("button",{onClick:xs,className:"flex items-center px-3 py-2 text-blue-700 border border-blue-300 rounded-lg hover:bg-blue-50",children:[e.jsx(Te,{className:"w-4 h-4 ml-1"}),"×™×™×¦× PDF"]}),e.jsxs("button",{onClick:()=>u(!0),className:"flex items-center px-3 py-2 text-red-700 border border-red-300 rounded-lg hover:bg-red-50",children:[e.jsx(Y,{className:"w-4 h-4 ml-1"}),"×ž×—×§"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsx(xe,{title:"×”×ª×§×“×ž×•×ª ×›×œ×œ×™×ª",value:`${Pe}%`,subtitle:"×”×©×œ×ž×ª ×ž×©×™×ž×•×ª",icon:e.jsx(ue,{}),color:us()}),e.jsx(xe,{title:"×”×©×ž×¢×•×ª",value:`${me.regular}/3`,subtitle:"×”×©×ž×¢×•×ª ×¨×’×™×œ×•×ª ×©×”×•×©×œ×ž×•",icon:e.jsx(Ne,{}),color:me.regular===3?"green":"orange"}),e.jsx(xe,{title:"×ª×›× ×™×ª",value:De.toString(),subtitle:"×™×¦×™×¨×•×ª ×‘×ª×›× ×™×ª",icon:e.jsx(ee,{}),color:"blue"}),e.jsx(xe,{title:"×ž×¡×ž×›×™×",value:Ie.toString(),subtitle:"×ž×¡×ž×›×™× ×ž×¦×•×¨×¤×™×",icon:e.jsx(pe,{}),color:"purple"}),e.jsx(xe,{title:"×¦×™×•×Ÿ ×¡×•×¤×™",value:t.finalGrade?.toString()||"-",subtitle:t.finalGradeLevel||"×˜×¨× ×—×•×©×‘",icon:e.jsx($e,{}),color:t.finalGrade&&t.finalGrade>=90?"green":"gray"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("div",{className:"flex overflow-x-auto",children:[e.jsx(ne,{label:"×¡×§×™×¨×” ×›×œ×œ×™×ª",icon:e.jsx(pe,{className:"w-4 h-4"}),isActive:S==="overview",onClick:()=>d("overview")}),e.jsx(ne,{label:"×ª×›× ×™×ª",icon:e.jsx(ee,{className:"w-4 h-4"}),isActive:S==="program",onClick:()=>d("program"),badge:De}),e.jsx(ne,{label:"×”×©×ž×¢×•×ª",icon:e.jsx(Ne,{className:"w-4 h-4"}),isActive:S==="presentations",onClick:()=>d("presentations"),badge:me.regular}),e.jsx(ne,{label:"×ž×’×Ÿ ×‘×’×¨×•×ª",icon:e.jsx(ke,{className:"w-4 h-4"}),isActive:S==="magen",onClick:()=>d("magen")}),e.jsx(ne,{label:"×¦×™×•× ×™×",icon:e.jsx($e,{className:"w-4 h-4"}),isActive:S==="grading",onClick:()=>d("grading")}),e.jsx(ne,{label:"×ž×¡×ž×›×™×",icon:e.jsx(Ae,{className:"w-4 h-4"}),isActive:S==="documents",onClick:()=>d("documents"),badge:Ie}),e.jsx(ne,{label:"×ž×œ×•×•×™×",icon:e.jsx(de,{className:"w-4 h-4"}),isActive:S==="accompanists",onClick:()=>d("accompanists"),badge:t.accompaniment?.accompanists?.length||0})]})}),e.jsxs("div",{className:"p-6",children:[S==="overview"&&e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-end mb-4",children:ae?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:os,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(te,{className:"w-4 h-4"}),"×©×ž×•×¨"]}),e.jsxs("button",{onClick:ms,className:"flex items-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(V,{className:"w-4 h-4"}),"×‘×™×˜×•×œ"]})]}):e.jsxs("button",{onClick:()=>be(!0),className:"flex items-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(Re,{className:"w-4 h-4"}),"×¢×¨×•×š ×¤×¨×˜×™× ×›×œ×œ×™×™×"]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(G,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"×¤×¨×˜×™ ×”×ª×œ×ž×™×“"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"force-black-text",children:"×©×:"}),e.jsx("span",{className:"font-medium text-gray-900",children:C?.personalInfo?.fullName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"force-black-text",children:"×˜×œ×¤×•×Ÿ:"}),e.jsx("span",{className:"font-medium text-gray-900",dir:"ltr",children:C?.personalInfo?.phone})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"force-black-text",children:"×›×™×ª×”:"}),e.jsx("span",{className:"font-medium text-gray-900",children:C?.academicInfo?.class})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"force-black-text",children:"×›×œ×™ ×¨××©×™:"}),e.jsx("span",{className:"font-medium text-gray-900",children:C?.academicInfo?.instrumentProgress?.find(r=>r.isPrimary)?.instrumentName})]})]})]}),e.jsxs(G,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"×¤×¨×˜×™ ×‘×’×¨×•×ª"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"force-black-text",children:"×ž×•×¨×” ×ž× ×—×”:"}),ae?e.jsx("span",{className:"text-gray-500",children:"×œ× × ×™×ª×Ÿ ×œ×©× ×•×ª"}):e.jsx("span",{className:"font-medium text-gray-900",children:L?.personalInfo?.fullName})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"force-black-text",children:"×§×•× ×¡×¨×‘×˜×•×¨×™×•×Ÿ:"}),ae?e.jsx("input",{type:"text",value:q.conservatoryName,onChange:r=>re(x=>({...x,conservatoryName:r.target.value})),className:"px-2 py-1 border border-gray-300 rounded text-right"}):e.jsx("span",{className:"font-medium text-gray-900",children:t.conservatoryName||"×œ× ×¦×•×™×Ÿ"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"force-black-text",children:"×ª××¨×™×š ×ž×‘×—×Ÿ:"}),ae?e.jsx("input",{type:"date",value:q.testDate,onChange:r=>re(x=>({...x,testDate:r.target.value})),className:"px-2 py-1 border border-gray-300 rounded"}):e.jsx("span",{className:"font-medium text-gray-900",children:t.testDate?new Date(t.testDate).toLocaleDateString("he-IL"):"×œ× × ×§×‘×¢"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"force-black-text",children:"×™×—×™×“×•×ª ×¨×¡×™×˜×œ:"}),ae?e.jsxs("select",{value:q.recitalUnits,onChange:r=>re(x=>({...x,recitalUnits:parseInt(r.target.value)})),className:"px-2 py-1 border border-gray-300 rounded",children:[e.jsx("option",{value:"3",children:"3"}),e.jsx("option",{value:"5",children:"5"})]}):e.jsx("span",{className:"font-medium text-gray-900",children:t.recitalUnits||"×œ× ×¦×•×™×Ÿ"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"force-black-text",children:"×ª×—×•× ×¨×¡×™×˜×œ:"}),ae?e.jsxs("select",{value:q.recitalField,onChange:r=>re(x=>({...x,recitalField:r.target.value})),className:"px-2 py-1 border border-gray-300 rounded",children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×ª×—×•×"}),e.jsx("option",{value:"×§×œ××¡×™",children:"×§×œ××¡×™"}),e.jsx("option",{value:"×’'××–",children:"×’'××–"}),e.jsx("option",{value:"×ž×•×¡×™×§×” ×¢×¨×‘×™×ª",children:"×ž×•×¡×™×§×” ×¢×¨×‘×™×ª"}),e.jsx("option",{value:"××—×¨",children:"××—×¨"})]}):e.jsx("span",{className:"font-medium text-gray-900",children:t.recitalField||"×œ× ×¦×•×™×Ÿ"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"force-black-text",children:"×¡×˜×˜×•×¡:"}),e.jsx("span",{className:`font-medium ${t.isCompleted?"text-green-600":"text-orange-600"}`,children:t.isCompleted?"×”×•×©×œ×":"×‘×ª×”×œ×™×š"})]})]})]}),e.jsxs(G,{className:"lg:col-span-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"×”×¢×¨×•×ª"}),ae?e.jsx("textarea",{value:q.notes,onChange:r=>re(x=>({...x,notes:r.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg resize-none",rows:4,placeholder:"×”×•×¡×£ ×”×¢×¨×•×ª..."}):e.jsx("p",{className:"text-gray-900 whitespace-pre-wrap",children:t.notes||"××™×Ÿ ×”×¢×¨×•×ª"})]})]})]}),S==="program"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"×ª×›× ×™×ª ×”×‘×™×¦×•×¢"}),e.jsxs("button",{onClick:()=>l(!0),className:"flex items-center px-3 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:[e.jsx(J,{className:"w-4 h-4 ml-1"}),"×”×•×¡×£ ×™×¦×™×¨×”"]})]}),t.program&&t.program.length>0?e.jsx(bs,{data:t.program,columns:[{key:"pieceNumber",header:"×ž×¡×³",width:"60px",align:"center"},{key:"composer",header:"×ž×œ×—×™×Ÿ",render:r=>r.composer||"×œ× ×¦×•×™×Ÿ"},{key:"pieceTitle",header:"×©× ×”×™×¦×™×¨×”",render:r=>r.pieceTitle||"×œ× ×¦×•×™×Ÿ"},{key:"movement",header:"×¤×¨×§",render:r=>r.movement||"-"},{key:"duration",header:"×ž×©×š",render:r=>r.duration||"×œ× ×¦×•×™×Ÿ"},{key:"youtubeLink",header:"×§×™×©×•×¨ ×™×•×˜×™×•×‘",render:r=>r.youtubeLink?e.jsx("a",{href:r.youtubeLink,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 hover:underline",children:"×¦×¤×” ×‘×™×•×˜×™×•×‘"}):e.jsx("span",{className:"text-gray-500",children:"××™×Ÿ ×§×™×©×•×¨"})},{key:"actions",header:"×¤×¢×•×œ×•×ª",width:"120px",render:r=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>ns(r),className:"p-1 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded",title:"×¢×¨×•×š ×™×¦×™×¨×”",children:e.jsx(Ce,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>cs(r.pieceNumber),className:"p-1 text-red-600 hover:text-red-800 hover:bg-red-50 rounded",title:"×ž×—×§ ×™×¦×™×¨×”",children:e.jsx(Y,{className:"w-4 h-4"})})]})}]}):e.jsxs("div",{className:"text-center py-8 text-gray-700",children:[e.jsx(ee,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{children:"××™×Ÿ ×™×¦×™×¨×•×ª ×‘×ª×›× ×™×ª"})]})]}),S==="presentations"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"×”×©×ž×¢×•×ª"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[me.regular," ×ž×ª×•×š 3 ×”×©×ž×¢×•×ª ×”×•×©×œ×ž×•"]})]}),Ee.length>0?e.jsx("div",{className:"grid grid-cols-1 gap-4",children:Ee.map(r=>e.jsx(Ts,{presentation:r,onUpdate:Le,onDelete:as,onView:ts,programPieces:t.program||[]},`presentation-${r.presentationNumber}`))}):e.jsxs("div",{className:"text-center py-8 text-gray-700",children:[e.jsx(Ne,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{children:"××™×Ÿ ×”×©×ž×¢×•×ª"}),e.jsxs("button",{onClick:()=>g(`/bagruts/${s}/edit?tab=presentations`),className:"mt-4 flex items-center mx-auto px-3 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:[e.jsx(J,{className:"w-4 h-4 ml-1"}),"×”×•×¡×£ ×”×©×ž×¢×•×ª"]})]})]}),S==="magen"&&e.jsx(Fs,{bagrut:t,onUpdate:async r=>{try{console.log("ðŸ”„ BagrutDetails: Received magen data for update:",r),console.log("ðŸ” BagrutDetails: Current bagrutId:",s),console.log("ðŸ” BagrutDetails: Current bagrut data:",t);const x=r,E={studentId:t.studentId,teacherId:t.teacherId,program:t.program||[],magenBagrut:x};console.log("ðŸ“¡ BagrutDetails: Calling apiService.bagrut.updateBagrut with payload:",E);const M=await K.bagrut.updateBagrut(s,E);console.log("âœ… BagrutDetails: API update result:",M),console.log("ðŸ”„ BagrutDetails: Refreshing bagrut data..."),await h(s),console.log("âœ… BagrutDetails: Bagrut data refreshed successfully")}catch(x){console.error("âŒ BagrutDetails: Error updating magen bagrut:",x),console.error("âŒ BagrutDetails: Error details:",x.message,x.response?.data),alert("×©×’×™××” ×‘×©×ž×™×¨×”: "+(x.response?.data?.message||x.message))}}}),S==="grading"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(G,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"×¦×™×•×Ÿ ×¡×•×¤×™"}),e.jsxs("div",{className:"flex justify-between items-center p-4 bg-primary-50 rounded-lg",children:[e.jsx("span",{className:"text-lg font-semibold force-black-text",children:"×¦×™×•×Ÿ ×ž×’×Ÿ ×‘×’×¨×•×ª"}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-3xl font-bold text-primary-600",children:t.magenBagrut?.grade||t.finalGrade||"-"}),(t.magenBagrut?.gradeLevel||t.finalGradeLevel)&&e.jsx("div",{className:"text-sm text-gray-800 mt-1",children:t.magenBagrut?.gradeLevel||t.finalGradeLevel})]})]})]}),t.magenBagrut?.pieceGradings&&t.magenBagrut.pieceGradings.length>0?e.jsxs(G,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"×¤×™×¨×•×˜ ×¦×™×•× ×™× ×œ×¤×™ ×™×¦×™×¨×•×ª"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm border-collapse border border-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right font-semibold text-gray-700 border border-gray-200",children:"×™×¦×™×¨×”"}),e.jsxs("th",{className:"px-4 py-3 text-center font-semibold text-gray-700 border border-gray-200",children:["×ž×™×•×ž× ×•×ª × ×’×™× ×”/×©×™×¨×”",e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:"(×ž×§×¡' 40)"})]}),e.jsxs("th",{className:"px-4 py-3 text-center font-semibold text-gray-700 border border-gray-200",children:["×”×‘× ×” ×ž×•×¡×™×§×œ×™×ª",e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:"(×ž×§×¡' 30)"})]}),e.jsxs("th",{className:"px-4 py-3 text-center font-semibold text-gray-700 border border-gray-200",children:["×™×“×™×¢×ª ×”×˜×§×¡×˜",e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:"(×ž×§×¡' 20)"})]}),e.jsxs("th",{className:"px-4 py-3 text-center font-semibold text-gray-700 border border-gray-200",children:['× ×’×™× ×” ×‘×¢"×¤',e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:"(10)"})]}),e.jsxs("th",{className:"px-4 py-3 text-center font-semibold text-gray-700 border border-gray-200",children:['×¡×”"×›',e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:"(100)"})]})]})}),e.jsx("tbody",{children:t.magenBagrut.pieceGradings.map((r,x)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 border border-gray-200",children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[r.pieceTitle," #",r.pieceNumber]}),e.jsx("div",{className:"text-gray-600",children:r.composer})]})}),e.jsx("td",{className:"px-4 py-3 text-center border border-gray-200",children:e.jsx("div",{className:"font-semibold text-gray-900",children:r.playingSkills})}),e.jsx("td",{className:"px-4 py-3 text-center border border-gray-200",children:e.jsx("div",{className:"font-semibold text-gray-900",children:r.musicalUnderstanding})}),e.jsx("td",{className:"px-4 py-3 text-center border border-gray-200",children:e.jsx("div",{className:"font-semibold text-gray-900",children:r.textKnowledge})}),e.jsx("td",{className:"px-4 py-3 text-center border border-gray-200",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-sm",children:r.playingByHeart?"âœ“":"âœ—"}),e.jsx("span",{className:"text-xs text-gray-600",children:r.playingByHeart?"10":"0"})]})}),e.jsx("td",{className:"px-4 py-3 text-center font-bold text-primary-600 border border-gray-200",children:(r.playingSkills||0)+(r.musicalUnderstanding||0)+(r.textKnowledge||0)+(r.playingByHeart?10:0)})]},x))})]})}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"×ž×ž×•×¦×¢ ×ž×™×•×ž× ×•×ª × ×’×™× ×”:"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[Math.round(t.magenBagrut.pieceGradings.reduce((r,x)=>r+(x.playingSkills||0),0)/t.magenBagrut.pieceGradings.length),"/40"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"×ž×ž×•×¦×¢ ×”×‘× ×” ×ž×•×¡×™×§×œ×™×ª:"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[Math.round(t.magenBagrut.pieceGradings.reduce((r,x)=>r+(x.musicalUnderstanding||0),0)/t.magenBagrut.pieceGradings.length),"/30"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"×ž×ž×•×¦×¢ ×™×“×™×¢×ª ×˜×§×¡×˜:"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[Math.round(t.magenBagrut.pieceGradings.reduce((r,x)=>r+(x.textKnowledge||0),0)/t.magenBagrut.pieceGradings.length),"/20"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"×™×¦×™×¨×•×ª ×‘×¢×œ ×¤×”:"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[t.magenBagrut.pieceGradings.filter(r=>r.playingByHeart).length,"/",t.magenBagrut.pieceGradings.length]})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-blue-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-semibold text-gray-800",children:"×¦×™×•×Ÿ ×›×•×œ×œ:"}),e.jsxs("span",{className:"text-2xl font-bold text-primary-600",children:[Math.round(t.magenBagrut.pieceGradings.reduce((r,x)=>r+(x.playingSkills||0)+(x.musicalUnderstanding||0)+(x.textKnowledge||0)+(x.playingByHeart?10:0),0)/t.magenBagrut.pieceGradings.length),"/100"]})]})})]})]}):t.magenBagrut?.detailedGrading?e.jsxs(G,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"×¤×™×¨×•×˜ ×¦×™×•× ×™× (×¡×™×›×•×)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"force-black-text",children:"×ž×™×•×ž× ×•×ª × ×’×™× ×”"}),e.jsxs("span",{className:"text-xl font-semibold text-gray-900",children:[t.magenBagrut.detailedGrading.playingSkills?.points||0,"/40"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"force-black-text",children:"×”×‘× ×” ×ž×•×–×™×§×œ×™×ª"}),e.jsxs("span",{className:"text-xl font-semibold text-gray-900",children:[t.magenBagrut.detailedGrading.musicalUnderstanding?.points||0,"/30"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"force-black-text",children:"×™×“×™×¢×ª ×”×˜×§×¡×˜"}),e.jsxs("span",{className:"text-xl font-semibold text-gray-900",children:[t.magenBagrut.detailedGrading.textKnowledge?.points||0,"/20"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"force-black-text",children:"× ×’×™× ×” ×‘×¢×œ ×¤×”"}),e.jsxs("span",{className:"text-xl font-semibold text-gray-900",children:[t.magenBagrut.detailedGrading.playingByHeart?.points||0,"/10"]})]})]}),e.jsx("div",{className:"mt-6 p-3 bg-blue-50 rounded-lg",children:e.jsxs("div",{className:"text-2xl font-bold text-blue-900",children:["×¦×™×•×Ÿ ×ž×¤×•×¨×˜: ",(t.magenBagrut.detailedGrading.playingSkills?.points||0)+(t.magenBagrut.detailedGrading.musicalUnderstanding?.points||0)+(t.magenBagrut.detailedGrading.textKnowledge?.points||0)+(t.magenBagrut.detailedGrading.playingByHeart?.points||0),"/100"]})})]}):e.jsx(G,{children:e.jsxs("div",{className:"text-center text-gray-500 py-12",children:[e.jsx(Z,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"×˜×¨× ×”×•×–× ×• ×¦×™×•× ×™×"}),e.jsx("p",{className:"text-gray-600",children:"×”×¦×™×•× ×™× ×™×•×¦×’×• ×›××Ÿ ×œ××—×¨ ×”×©×œ×ž×ª ×ž×’×Ÿ ×‘×’×¨×•×ª"})]})})]}),S==="documents"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"×ž×¡×ž×›×™×"}),e.jsxs("label",{className:"flex items-center px-3 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 cursor-pointer",children:[e.jsx(Ds,{className:"w-4 h-4 ml-1"}),"×”×¢×œ×” ×ž×¡×ž×š",e.jsx("input",{type:"file",onChange:Je,className:"hidden",disabled:X})]})]}),X&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx(Ge,{className:"w-6 h-6 animate-spin mx-auto text-primary-600"}),e.jsx("p",{className:"text-sm text-gray-800 mt-2",children:"×ž×¢×œ×” ×ž×¡×ž×š..."})]}),t.documents&&t.documents.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.documents.map(r=>e.jsx(G,{className:"hover:shadow-lg transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(Ae,{className:"w-8 h-8 text-gray-400 mb-2"}),e.jsx("h4",{className:"font-medium text-gray-900 text-sm mb-1",children:r.fileName}),e.jsx("span",{className:"inline-block px-2 py-1 bg-gray-100 text-gray-800 rounded text-xs mb-2",children:r.category}),r.description&&e.jsx("p",{className:"text-xs text-gray-800",children:r.description}),e.jsx("div",{className:"text-xs text-gray-700 mt-2",children:new Date(r.uploadDate).toLocaleDateString("he-IL")})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>Ze(r._id,r.fileName),className:"p-1 text-blue-600 hover:bg-blue-50 rounded",title:"×”×•×¨×“",children:e.jsx(Te,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>es(r._id),className:"p-1 text-red-600 hover:bg-red-50 rounded",title:"×ž×—×§",children:e.jsx(Y,{className:"w-4 h-4"})})]})]})},r._id))}):e.jsxs("div",{className:"text-center py-8 text-gray-700",children:[e.jsx(pe,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{children:"××™×Ÿ ×ž×¡×ž×›×™× ×ž×¦×•×¨×¤×™×"})]})]}),S==="accompanists"&&e.jsx(Ks,{accompaniment:t.accompaniment||{type:"× ×’×Ÿ ×ž×œ×•×•×”",accompanists:[]},onUpdate:Ye,readonly:t.isCompleted})]})]}),e.jsx(je,{isOpen:v,title:"×ž×—×™×§×ª ×‘×’×¨×•×ª",message:`×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×ž×—×•×§ ××ª ×”×‘×’×¨×•×ª ×©×œ ${C?.personalInfo?.fullName}? ×¤×¢×•×œ×” ×–×• ×œ× × ×™×ª× ×ª ×œ×‘×™×˜×•×œ.`,confirmText:"×ž×—×§",cancelText:"×‘×™×˜×•×œ",onConfirm:Xe,onCancel:()=>u(!1),variant:"danger"}),e.jsx(je,{isOpen:P,title:"×”×©×œ×ž×ª ×‘×’×¨×•×ª",message:"×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×”×©×œ×™× ××ª ×”×‘×’×¨×•×ª? ×œ××—×¨ ×”×”×©×œ×ž×” ×œ× × ×™×ª×Ÿ ×™×”×™×” ×œ×¢×¨×•×š ××ª ×”× ×ª×•× ×™×.",confirmText:"×”×©×œ× ×‘×’×¨×•×ª",cancelText:"×‘×™×˜×•×œ",onConfirm:Qe,onCancel:()=>R(!1),variant:"primary",children:e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×—×ª×™×ž×ª ×”×ž×•×¨×”"}),e.jsx("input",{type:"text",value:$,onChange:r=>F(r.target.value),placeholder:"×”×›× ×¡ ××ª ×©×ž×š ×”×ž×œ× ×›×—×ª×™×ž×”",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]})}),e.jsx(Es,{isOpen:c,performance:b,programPieces:t?.program||[],onClose:rs,onUpdate:ss}),e.jsx(_e,{isOpen:i,onClose:()=>l(!1),onSubmit:ls,existingPieces:t?.program||[]}),e.jsx(_e,{isOpen:m,onClose:()=>{A(!1),H(null)},onSubmit:is,existingPieces:(t?.program||[]).filter(r=>r.pieceNumber!==T?.pieceNumber),initialData:T,title:"×¢×¨×•×š ×™×¦×™×¨×”",submitText:"×¢×“×›×Ÿ ×™×¦×™×¨×”"}),e.jsx(je,{isOpen:ce,title:"×ž×—×™×§×ª ×™×¦×™×¨×”",message:`×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×ž×—×•×§ ××ª ×”×™×¦×™×¨×” ×ž×¡' ${ye}? ×¤×¢×•×œ×” ×–×• ×œ× × ×™×ª× ×ª ×œ×‘×™×˜×•×œ.`,confirmText:"×ž×—×§ ×™×¦×™×¨×”",cancelText:"×‘×™×˜×•×œ",onConfirm:ds,onCancel:()=>{he(!1),fe(null)},variant:"danger"}),e.jsx(Ms,{isOpen:qe,presentation:Ve,programPieces:t?.program||[],onClose:()=>Se(!1),onUpdate:Le,onNavigateToTab:r=>d("presentations")})]})}export{it as default};
