import{j as e,h as Le,a as Pe,u as De,C as _e}from"../assets/index-CoKafZFz.js";import{r as n,b as Ve}from"./vendor-C9PcmKF2.js";import{C as K}from"./Card-1BAWwzNR.js";import{T as $e,S as Ce}from"./Table-AhthNN5h.js";import{S as ge}from"./StatsCard-DEtP3a5j.js";import{U as oe,r as ie,M as Ne,d as pe,c as Ge,O as Se,ab as ke,T as ve,I as Ie,X as Ee,a as Te,D as Ue,h as Me,a0 as Re,af as ye,ae as Ae,S as je,P as Fe,a3 as Oe,e as ze,o as He,a6 as Ke,_ as Ye}from"./ui-DsxFGtGk.js";import{u as qe}from"./useBagrut-BaAHn2qN.js";import{a as he}from"./cascade-deletion-BvQll6O-.js";import"./query-BdHdBeoH.js";import"./utils-x1PSU_OZ.js";const We=({bagrut:m,studentName:Y,teacherName:d,onClick:y,onEdit:q,onDelete:E,onExport:i,className:L=""})=>{const o=m.presentations?.filter(h=>h.completed).length||0,N=4,f=m.magenBagrut?.completed?1:0,k=m.program?.length||0,u=N+1,P=o+f,S=Math.round(P/u*100),D=()=>m.isCompleted?"bg-green-100 text-green-800":S>=50?"bg-orange-100 text-orange-800":"bg-red-100 text-red-800",v=h=>h>=90?"text-green-600":h>=80?"text-blue-600":h>=70?"text-yellow-600":"text-red-600";return e.jsxs(K,{className:`hover:shadow-card-hover transition-shadow cursor-pointer ${L}`,onClick:y,padding:"md",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center",children:e.jsx(oe,{className:"w-5 h-5 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:Y}),e.jsx("p",{className:"text-sm text-gray-600",children:d})]})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${D()}`,children:m.isCompleted?"×”×•×©×œ×":"×‘×ª×”×œ×™×š"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"×”×ª×§×“××•×ª"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[S,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${S>=100?"bg-green-500":S>=50?"bg-yellow-500":"bg-red-500"}`,style:{width:`${S}%`}})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(ie,{className:"w-4 h-4 ml-1 text-gray-400"}),e.jsxs("span",{children:[o,"/",N," ××¦×’×•×ª"]})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(Ne,{className:"w-4 h-4 ml-1 text-gray-400"}),e.jsxs("span",{children:[k," ×™×¦×™×¨×•×ª"]})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(pe,{className:"w-4 h-4 ml-1 text-gray-400"}),e.jsxs("span",{children:["××’×Ÿ: ",f?"×”×•×©×œ×":"×‘×ª×”×œ×™×š"]})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(Ge,{className:"w-4 h-4 ml-1 text-gray-400"}),e.jsx("span",{children:m.testDate?new Date(m.testDate).toLocaleDateString("he-IL",{month:"short",day:"numeric"}):"×œ× × ×§×‘×¢"})]})]}),m.finalGrade&&e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg mb-4",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"×¦×™×•×Ÿ ×¡×•×¤×™"}),e.jsx("div",{className:`text-2xl font-bold ${v(m.finalGrade)}`,children:m.finalGrade}),m.finalGradeLevel&&e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:m.finalGradeLevel})]}),m.conservatoryName&&e.jsx("div",{className:"text-sm text-gray-600 mb-4 text-center",children:m.conservatoryName}),e.jsxs("div",{className:"flex justify-between items-center pt-3 border-t border-gray-100",children:[e.jsxs("div",{className:"flex space-x-2 space-x-reverse",children:[e.jsx("button",{onClick:h=>{h.stopPropagation(),q?.()},className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",title:"×¢×¨×•×š",children:e.jsx(Se,{className:"w-4 h-4"})}),e.jsx("button",{onClick:h=>{h.stopPropagation(),i?.()},className:"p-2 text-blue-600 hover:text-blue-900 hover:bg-blue-100 rounded-lg transition-colors",title:"×™×™×¦× PDF",children:e.jsx(ke,{className:"w-4 h-4"})}),e.jsx("button",{onClick:h=>{h.stopPropagation(),E?.()},className:"p-2 text-red-600 hover:text-red-900 hover:bg-red-50 rounded-lg transition-colors",title:"××—×§",children:e.jsx(ve,{className:"w-4 h-4"})})]}),e.jsxs("button",{onClick:h=>{h.stopPropagation(),y?.()},className:"flex items-center px-3 py-1.5 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors text-sm",children:[e.jsx(Ie,{className:"w-3.5 h-3.5 ml-1"}),"×¤×¨×˜×™×"]})]})]})},Xe=We,T=[{id:"basic",name:"××™×“×¢ ×‘×¡×™×¡×™",icon:oe},{id:"recital",name:"×”×’×“×¨×ª ×¨×¡×™×˜×œ",icon:Ne},{id:"program",name:"×ª×•×›× ×™×ª ×‘×¡×™×¡×™×ª",icon:ie}],Je=({students:m,teachers:Y,initialData:d,isEdit:y=!1,onSubmit:q,onCancel:E})=>{const[i,L]=n.useState(0),[o,N]=n.useState({studentId:"",teacherId:"",conservatoryName:"××¨×›×– ×”××•×¡×™×§×” ×¨×¢× × ×”",testDate:void 0,notes:"",recitalUnits:5,recitalField:"×§×œ××¡×™",program:[{pieceTitle:"",composer:"",duration:""},{pieceTitle:"",composer:"",duration:""}],accompaniment:{type:"× ×’×Ÿ ××œ×•×•×”",accompanists:[{name:"",instrument:"×¤×¡× ×ª×¨"}]}}),[f,k]=n.useState({}),[u,P]=n.useState(!1),[S,D]=n.useState(!1),[v,h]=n.useState([]),[we,W]=n.useState({}),[_,U]=n.useState(""),[M,R]=n.useState(""),[se,A]=n.useState(!1),[ce,X]=n.useState(!1),[J,te]=n.useState(!1),[O,re]=n.useState(!1),Q=n.useRef([]),z=n.useRef([]);n.useEffect(()=>{d&&N(t=>({...t,studentId:d.studentId||"",teacherId:d.teacherId||"",conservatoryName:d.conservatoryName||"××¨×›×– ×”××•×¡×™×§×” ×¨×¢× × ×”",testDate:d.testDate?new Date(d.testDate):void 0,notes:d.notes||"",recitalUnits:d.recitalUnits||5,recitalField:d.recitalField||"×§×œ××¡×™",program:d.program?.slice(0,3)||t.program,accompaniment:{type:d.accompaniment?.type||"× ×’×Ÿ ××œ×•×•×”",accompanists:d.accompaniment?.accompanists?.map(r=>({name:r.name||"",instrument:r.instrument||"×¤×¡× ×ª×¨"}))||[{name:"",instrument:"×¤×¡× ×ª×¨"}]}})),Z()},[d]),n.useEffect(()=>{Z()},[o]);const F=n.useCallback((t,r)=>{switch(t){case"studentId":return r?{isValid:!0}:{isValid:!1,error:"×™×© ×œ×‘×—×•×¨ ×ª×œ××™×“"};case"teacherId":return r?{isValid:!0}:{isValid:!1,error:"×™×© ×œ×‘×—×•×¨ ××•×¨×” ×× ×—×”"};case"conservatoryName":return r&&r.length<2?{isValid:!1,error:"×©× ×”×§×•× ×¡×¨×‘×˜×•×¨×™×•×Ÿ ×§×¦×¨ ××“×™"}:{isValid:!0};case"recitalUnits":return!r||r!==3&&r!==5?{isValid:!1,error:"×™×© ×œ×‘×—×•×¨ 3 ××• 5 ×™×—×™×“×•×ª"}:{isValid:!0};case"recitalField":return r?{isValid:!0}:{isValid:!1,error:"×™×© ×œ×‘×—×•×¨ ×ª×—×•× ×¨×¡×™×˜×œ"};default:return{isValid:!0}}},[]),Z=n.useCallback(()=>{const t=[],r=["studentId","teacherId"],a=r.filter(I=>F(I,o[I]).isValid);t.push({isValid:a.length===r.length,isComplete:a.length===r.length,completedFields:a.length,totalFields:r.length});const c=["recitalUnits","recitalField"],g=c.filter(I=>F(I,o[I]).isValid);t.push({isValid:g.length===c.length,isComplete:g.length===c.length,completedFields:g.length,totalFields:c.length});const B=o.program?.filter(I=>I.pieceTitle.trim()&&I.composer.trim())||[];t.push({isValid:B.length>=1,isComplete:B.length>=1,completedFields:B.length,totalFields:Math.max(1,o.program?.length||2)}),h(t)},[o,F]),ae=n.useCallback((t,r,a=!0)=>{const c=F(t,r);W(g=>({...g,[t]:{value:r,isValid:c.isValid,error:c.error,touched:a,isValidating:!1}}))},[F]),V=n.useCallback(t=>v.length>t?v[t].isValid:!1,[v]),ee=n.useCallback(()=>V(i)&&i<T.length-1,[i,V]),le=n.useCallback(()=>i>0,[i]),de=n.useCallback(async()=>{if(ee()){te(!0),await new Promise(r=>setTimeout(r,150));const t=i+1;L(t),te(!1),setTimeout(()=>{const r=z.current[t];r&&r.focus()},100)}},[ee,i]),fe=n.useCallback(()=>{if(le()){const t=i-1;L(t),setTimeout(()=>{const r=z.current[t];r&&r.focus()},100)}},[le,i]),w=n.useCallback((t,r)=>{N(a=>({...a,[t]:r})),ae(t,r),f.general&&k(a=>({...a,general:""})),f[t]&&k(a=>({...a,[t]:""}))},[f,ae]),$=n.useCallback((t,r,a)=>{N(c=>({...c,program:c.program?.map((g,B)=>B===t?{...g,[r]:a}:g)||[]}))},[]),H=n.useCallback(()=>{N(t=>({...t,program:[...t.program||[],{pieceTitle:"",composer:"",duration:""}]}))},[]),me=n.useCallback(t=>{N(r=>({...r,program:r.program?.filter((a,c)=>c!==t)||[]}))},[]),ue=n.useCallback((t,r)=>{N(a=>({...a,accompaniment:{...a.accompaniment,accompanists:[{...a.accompaniment.accompanists[0],[t]:r}]}}))},[]),be=async t=>{t.preventDefault(),D(!0);for(let r=0;r<T.length;r++)if(!V(r)){let a="";switch(r){case 0:a="×™×© ×œ×‘×—×•×¨ ×ª×œ××™×“ ×•××•×¨×”";break;case 1:a="×™×© ×œ×”×©×œ×™× ××ª ×”×’×“×¨×ª ×”×¨×¡×™×˜×œ";break;case 2:a="×™×© ×œ×”×–×™×Ÿ ×œ×¤×—×•×ª ×™×¦×™×¨×” ××—×ª ×‘×ª×•×›× ×™×ª";break}L(r),k({general:a}),setTimeout(()=>{const c=Q.current[r];c&&c.scrollIntoView({behavior:"smooth",block:"center"})},100);return}P(!0);try{const r={studentId:o.studentId,teacherId:o.teacherId,conservatoryName:o.conservatoryName||"××¨×›×– ×”××•×¡×™×§×” ×¨×¢× × ×”",testDate:o.testDate||null,notes:o.notes||"",recitalUnits:o.recitalUnits||5,recitalField:o.recitalField||"×§×œ××¡×™",program:o.program?.filter(a=>a.pieceTitle&&a.composer).map((a,c)=>({pieceNumber:c+1,pieceTitle:a.pieceTitle,composer:a.composer,duration:a.duration||"×œ× ×¦×•×™×Ÿ",movement:a.movement||""}))||[],accompaniment:{type:o.accompaniment?.type||"× ×’×Ÿ ××œ×•×•×”",accompanists:o.accompaniment?.accompanists?.filter(a=>a.name&&a.name.trim()!==""&&a.instrument&&a.instrument.trim()!=="").map(a=>({name:a.name.trim(),instrument:a.instrument.trim(),phone:"0500000000"}))||[]},presentations:[{completed:!1,status:"×œ× × ×‘×—×Ÿ",date:null,review:null,reviewedBy:null,notes:"",recordingLinks:[]},{completed:!1,status:"×œ× × ×‘×—×Ÿ",date:null,review:null,reviewedBy:null,notes:"",recordingLinks:[]},{completed:!1,status:"×œ× × ×‘×—×Ÿ",date:null,review:null,reviewedBy:null,notes:"",recordingLinks:[]},{completed:!1,status:"×œ× × ×‘×—×Ÿ",date:null,review:null,reviewedBy:null,grade:null,gradeLevel:null,recordingLinks:[],detailedGrading:{playingSkills:{grade:"×œ× ×”×•×¢×¨×š",points:null,maxPoints:40,comments:"××™×Ÿ ×”×¢×¨×•×ª"},musicalUnderstanding:{grade:"×œ× ×”×•×¢×¨×š",points:null,maxPoints:30,comments:"××™×Ÿ ×”×¢×¨×•×ª"},textKnowledge:{grade:"×œ× ×”×•×¢×¨×š",points:null,maxPoints:20,comments:"××™×Ÿ ×”×¢×¨×•×ª"},playingByHeart:{grade:"×œ× ×”×•×¢×¨×š",points:null,maxPoints:10,comments:"××™×Ÿ ×”×¢×¨×•×ª"}}}],magenBagrut:{completed:!1,status:"×œ× × ×‘×—×Ÿ",date:null,review:null,reviewedBy:null,grade:null,gradeLevel:null,recordingLinks:[],detailedGrading:{playingSkills:{grade:"×œ× ×”×•×¢×¨×š",points:null,maxPoints:40,comments:"××™×Ÿ ×”×¢×¨×•×ª"},musicalUnderstanding:{grade:"×œ× ×”×•×¢×¨×š",points:null,maxPoints:30,comments:"××™×Ÿ ×”×¢×¨×•×ª"},textKnowledge:{grade:"×œ× ×”×•×¢×¨×š",points:null,maxPoints:20,comments:"××™×Ÿ ×”×¢×¨×•×ª"},playingByHeart:{grade:"×œ× ×”×•×¢×¨×š",points:null,maxPoints:10,comments:"××™×Ÿ ×”×¢×¨×•×ª"}}},finalGrade:null,finalGradeLevel:null,isCompleted:!1};console.log("Submitting bagrut data:",r),await q(r),re(!0)}catch(r){console.error("Error submitting form:",r);const{fieldErrors:a,generalMessage:c,isValidationError:g}=Le(r,"×©×’×™××” ×‘×©××™×¨×ª ×”× ×ª×•× ×™×. ×× × × ×¡×” ×©×•×‘.");k(g?{...a,general:c}:{general:c})}finally{P(!1)}},xe=m.filter(t=>{if(!_)return!0;const r=t.personalInfo?.fullName||"",a=t.academicInfo?.class||"";return r.toLowerCase().includes(_.toLowerCase())||a.toLowerCase().includes(_.toLowerCase())}),s=Y.filter(t=>{if(!M)return!0;const r=t.personalInfo?.fullName||"",a=t.personalInfo?.email||"";return r.toLowerCase().includes(M.toLowerCase())||a.toLowerCase().includes(M.toLowerCase())}),l=m.find(t=>t._id===o.studentId),x=Y.find(t=>t._id===o.teacherId),b=()=>e.jsxs("div",{className:"px-6 py-6 border-b border-gray-200 bg-gray-50",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mb-2",children:[e.jsx("span",{children:"×”×ª×§×“××•×ª"}),e.jsxs("span",{children:[Math.round((i+(v[i]?.isValid?1:0))/T.length*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-primary-500 to-primary-600 h-2 rounded-full transition-all duration-500 ease-out",style:{width:`${(i+(v[i]?.isValid?1:0))/T.length*100}%`}})})]}),e.jsx("div",{className:"flex items-center justify-between",children:T.map((t,r)=>{const a=r<i,c=r===i,g=v[r],B=g?.isValid||!1,I=g?Math.round(g.completedFields/g.totalFields*100):0;return e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:`relative flex items-center justify-center w-12 h-12 rounded-full border-2 transition-all duration-300 ${a?"bg-success-500 border-success-500 text-white shadow-lg scale-105":c?B?"bg-primary-500 border-primary-500 text-white shadow-md":"bg-white border-primary-500 text-primary-500 shadow-md":B?"bg-success-100 border-success-300 text-success-600":"bg-gray-100 border-gray-300 text-gray-400"}`,children:[a?e.jsx(ye,{className:"w-6 h-6"}):c&&J?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent"}):e.jsx(t.icon,{className:"w-5 h-5"}),c&&!a&&g&&e.jsx("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-white rounded-full border border-gray-200 flex items-center justify-center",children:e.jsxs("span",{className:"text-xs font-medium text-gray-600",children:[g.completedFields,"/",g.totalFields]})})]}),e.jsxs("div",{className:"mt-2 text-center",children:[e.jsx("p",{className:`text-xs font-medium transition-colors ${c?"text-primary-600":a?"text-success-600":"text-gray-500"}`,children:t.name}),c&&g&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:B?e.jsxs("span",{className:"flex items-center justify-center gap-1 text-success-600",children:[e.jsx(ye,{className:"w-3 h-3"}),"××•×›×Ÿ"]}):e.jsxs("span",{className:"text-orange-600",children:[I,"% ××•×©×œ×"]})})]})]}),r<T.length-1&&e.jsx("div",{className:`w-16 h-1 mx-4 rounded-full transition-all duration-500 ${a?"bg-success-300":"bg-gray-200"}`})]},t.id)})})]}),p=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs(K,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(oe,{className:"w-5 h-5 text-gray-600"}),"×‘×—×™×¨×ª ×ª×œ××™×“ ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(je,{className:"absolute right-3 top-3 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"×—×™×¤×•×© ×ª×œ××™×“ ×œ×¤×™ ×©× ××• ×›×™×ª×”...",value:_,onChange:t=>{U(t.target.value),A(!0)},onFocus:()=>A(!0),className:"w-full pr-10 pl-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),l&&e.jsx("div",{className:"p-4 bg-primary-50 border border-primary-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:l.personalInfo?.fullName}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{children:["×›×™×ª×”: ",l.academicInfo?.class]}),e.jsxs("p",{children:["×˜×œ×¤×•×Ÿ: ",l.personalInfo?.phone]})]})]}),e.jsx(pe,{className:"w-6 h-6 text-green-600"})]})}),se&&!l&&e.jsx("div",{className:"max-h-48 overflow-y-auto border border-gray-200 rounded-lg",children:xe.length>0?xe.map(t=>e.jsxs("button",{type:"button",onClick:()=>{w("studentId",t._id),U(""),A(!1)},className:`w-full p-3 text-right hover:bg-gray-50 border-b border-gray-100 last:border-b-0 ${o.studentId===t._id?"bg-primary-50":""}`,children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.personalInfo?.fullName}),e.jsxs("div",{className:"text-sm text-gray-600",children:["×›×™×ª×” ",t.academicInfo?.class]})]},t._id)):e.jsx("div",{className:"p-4 text-center text-gray-500",children:"×œ× × ××¦××• ×ª×œ××™×“×™×"})}),!o.studentId&&S&&e.jsx("p",{className:"text-red-600 text-sm mt-2",children:"×™×© ×œ×‘×—×•×¨ ×ª×œ××™×“"})]})]}),e.jsxs(K,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(oe,{className:"w-5 h-5 text-gray-600"}),"×‘×—×™×¨×ª ××•×¨×” ×× ×—×” ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(je,{className:"absolute right-3 top-3 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"×—×™×¤×•×© ××•×¨×” ×œ×¤×™ ×©×...",value:M,onChange:t=>{R(t.target.value),X(!0)},onFocus:()=>X(!0),className:"w-full pr-10 pl-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),x&&e.jsx("div",{className:"p-4 bg-primary-50 border border-primary-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:x.personalInfo?.fullName}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{children:["××™××™×™×œ: ",x.personalInfo?.email]}),e.jsxs("p",{children:["×˜×œ×¤×•×Ÿ: ",x.personalInfo?.phone]})]})]}),e.jsx(pe,{className:"w-6 h-6 text-green-600"})]})}),ce&&!x&&e.jsx("div",{className:"max-h-48 overflow-y-auto border border-gray-200 rounded-lg",children:s.length>0?s.map(t=>e.jsxs("button",{type:"button",onClick:()=>{w("teacherId",t._id),R(""),X(!1)},className:`w-full p-3 text-right hover:bg-gray-50 border-b border-gray-100 last:border-b-0 ${o.teacherId===t._id?"bg-primary-50":""}`,children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.personalInfo?.fullName}),e.jsx("div",{className:"text-sm text-gray-600",children:t.personalInfo?.email})]},t._id)):e.jsx("div",{className:"p-4 text-center text-gray-500",children:"×œ× × ××¦××• ××•×¨×™×"})}),!o.teacherId&&S&&e.jsx("p",{className:"text-red-600 text-sm mt-2",children:"×™×© ×œ×‘×—×•×¨ ××•×¨×” ×× ×—×”"})]})]}),e.jsxs(K,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"×¤×¨×˜×™× × ×•×¡×¤×™×"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©× ×”×§×•× ×¡×¨×‘×˜×•×¨×™×•×Ÿ"}),e.jsx("input",{type:"text",value:o.conservatoryName||"",onChange:t=>w("conservatoryName",t.target.value),placeholder:"×œ×“×•×’××”: ×§×•× ×¡×¨×‘×˜×•×¨×™×•×Ÿ ×™×¨×•×©×œ×™×",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×ª××¨×™×š ××‘×—×Ÿ ××©×•×¢×¨"}),e.jsx("input",{type:"date",value:o.testDate?o.testDate.toISOString().split("T")[0]:"",onChange:t=>w("testDate",t.target.value?new Date(t.target.value):void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×”×¢×¨×•×ª ×¨××©×•× ×™×•×ª"}),e.jsx("textarea",{value:o.notes||"",onChange:t=>w("notes",t.target.value),placeholder:"×”×¢×¨×•×ª ×›×œ×œ×™×•×ª ×¢×œ ×”×ª×œ××™×“ ××• ×”×‘×’×¨×•×ª...",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent resize-vertical"})]})]})]}),C=()=>e.jsx("div",{className:"space-y-6",children:e.jsxs(K,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5 text-gray-600"}),"×”×’×“×¨×ª ×¨×¡×™×˜×œ"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×™×—×™×“×•×ª ×¨×¡×™×˜×œ"}),e.jsxs("select",{value:o.recitalUnits||5,onChange:t=>w("recitalUnits",Number(t.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:3,children:"3 ×™×—×™×“×•×ª"}),e.jsx("option",{value:5,children:"5 ×™×—×™×“×•×ª"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×ª×—×•× ×¨×¡×™×˜×œ"}),e.jsxs("select",{value:o.recitalField||"×§×œ××¡×™",onChange:t=>w("recitalField",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"×§×œ××¡×™",children:"×§×œ××¡×™"}),e.jsx("option",{value:"×’'××–",children:"×’'××–"}),e.jsx("option",{value:"×©×™×¨×”",children:"×©×™×¨×”"}),e.jsx("option",{value:"××•×¡×™×§×” ×™×©×¨××œ×™×ª",children:"××•×¡×™×§×” ×™×©×¨××œ×™×ª"}),e.jsx("option",{value:"××•×¡×™×§×” ×¢×•×œ××™×ª",children:"××•×¡×™×§×” ×¢×•×œ××™×ª"})]})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"××œ×•×•×” ×¨××©×™"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©× ×”××œ×•×•×”"}),e.jsx("input",{type:"text",value:o.accompaniment?.accompanists[0]?.name||"",onChange:t=>ue("name",t.target.value),placeholder:"×©× ×”××œ×•×•×” (××•×¤×¦×™×•× ×œ×™)",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×›×œ×™ × ×’×™× ×”"}),e.jsx("input",{type:"text",value:o.accompaniment?.accompanists[0]?.instrument||"",onChange:t=>ue("instrument",t.target.value),placeholder:"×œ×“×•×’××”: ×¤×¡× ×ª×¨",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})]})]})]})}),G=()=>e.jsx("div",{className:"space-y-6",children:e.jsxs(K,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5 text-gray-600"}),"×ª×•×›× ×™×ª ×‘×¡×™×¡×™×ª"]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"×”×–×Ÿ ×œ×¤×—×•×ª ×™×¦×™×¨×” ××—×ª. × ×™×ª×Ÿ ×œ×”×•×¡×™×£ ×™×¦×™×¨×•×ª × ×•×¡×¤×•×ª ×•×¤×¨×˜×™× ××œ××™× ×‘×“×£ ×”×‘×’×¨×•×ª ×œ××—×¨ ×”×™×¦×™×¨×”."}),S&&!o.program?.some(t=>t.pieceTitle.trim()&&t.composer.trim())&&e.jsx("p",{className:"text-red-600 text-sm mb-4",children:"×™×© ×œ×”×–×™×Ÿ ×œ×¤×—×•×ª ×™×¦×™×¨×” ××—×ª ×¢× ×©× ×”×™×¦×™×¨×” ×•××œ×—×™×Ÿ"}),e.jsxs("div",{className:"space-y-4",children:[o.program?.map((t,r)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"font-medium text-gray-900",children:["×™×¦×™×¨×” ",r+1]}),o.program&&o.program.length>1&&e.jsx("button",{type:"button",onClick:()=>me(r),className:"p-1 text-red-500 hover:text-red-700 hover:bg-red-50 rounded transition-colors",children:e.jsx(ve,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×©× ×”×™×¦×™×¨×” *"}),e.jsx("input",{type:"text",value:t.pieceTitle,onChange:a=>$(r,"pieceTitle",a.target.value),placeholder:"×œ×“×•×’××”: ×¡×•× ×˜×” ××¡' 14",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"××œ×—×™×Ÿ *"}),e.jsx("input",{type:"text",value:t.composer,onChange:a=>$(r,"composer",a.target.value),placeholder:"×œ×“×•×’××”: ×‘×˜×”×•×‘×Ÿ",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"××©×š ×–××Ÿ"}),e.jsx("input",{type:"text",value:t.duration||"",onChange:a=>$(r,"duration",a.target.value),placeholder:"×œ×“×•×’××”: 8 ×“×§×•×ª",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})]})]},r)),e.jsx("div",{className:"flex justify-center pt-2",children:e.jsxs("button",{type:"button",onClick:H,className:"flex items-center px-4 py-2 text-primary-600 border border-primary-300 rounded-lg hover:bg-primary-50 transition-colors",children:[e.jsx(Fe,{className:"w-4 h-4 ml-1"}),"×”×•×¡×£ ×™×¦×™×¨×”"]})})]}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"×©×™× ×œ×‘:"})," ×œ××—×¨ ×™×¦×™×¨×ª ×”×‘×’×¨×•×ª, ×ª×•×›×œ ×œ×”×•×¡×™×£ ×‘×“×£ ×”×¤×¨×˜×™×:"]}),e.jsxs("ul",{className:"mt-2 text-sm text-blue-700 list-disc list-inside",children:[e.jsx("li",{children:"×¤×¨×˜×™ ××¦×’×•×ª ×•×ª××¨×™×›×™×"}),e.jsx("li",{children:"××’×Ÿ ×‘×’×¨×•×ª"}),e.jsx("li",{children:"×¦×™×•× ×™× ×•×”×¢×¨×›×•×ª"}),e.jsx("li",{children:"××¡××›×™× ×•×§×‘×¦×™×"}),e.jsx("li",{children:"×§×™×©×•×¨×™ ×™×•×˜×™×•×‘ ×•×”×§×œ×˜×•×ª"}),e.jsx("li",{children:"×¤×¨×˜×™ ××œ×•×•×™× × ×•×¡×¤×™×"})]})]})]})}),ne=()=>{switch(i){case 0:return p();case 1:return C();case 2:return G();default:return null}},j=()=>O?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",role:"dialog","aria-modal":"true","aria-labelledby":"success-title",children:e.jsx("div",{className:"bg-white rounded-2xl max-w-md w-full p-6 shadow-2xl animate-scale-in",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-success-100 mb-4",children:e.jsx(ye,{className:"w-8 h-8 text-success-600","aria-hidden":"true"})}),e.jsx("h3",{id:"success-title",className:"text-xl font-bold text-gray-900 mb-2",children:"×‘×’×¨×•×ª × ×•×¦×¨×” ×‘×”×¦×œ×—×”!"}),e.jsxs("div",{className:"text-sm text-gray-600 mb-6 space-y-2",children:[e.jsxs("p",{children:["×”×‘×’×¨×•×ª ×¢×‘×•×¨ ",l?.personalInfo?.fullName," × ×•×¦×¨×”."]}),e.jsx("p",{className:"text-success-700 font-medium",children:"×¢×›×©×™×• ×ª×•×›×œ ×œ×”×©×œ×™× ×¤×¨×˜×™× × ×•×¡×¤×™×"})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("button",{onClick:()=>{re(!1),E()},className:"w-full px-4 py-3 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors font-medium",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Ae,{className:"w-4 h-4","aria-hidden":"true"}),"×¢×‘×•×¨ ×œ×“×£ ×”×‘×’×¨×•×ª"]})}),e.jsx("button",{onClick:()=>{re(!1),N({studentId:"",teacherId:"",conservatoryName:"××¨×›×– ×”××•×¡×™×§×” ×¨×¢× × ×”",testDate:void 0,notes:"",recitalUnits:5,recitalField:"×§×œ××¡×™",program:[{pieceTitle:"",composer:"",duration:""},{pieceTitle:"",composer:"",duration:""}],accompaniment:{type:"× ×’×Ÿ ××œ×•×•×”",accompanists:[{name:"",instrument:"×¤×¡× ×ª×¨"}]}}),L(0),k({}),D(!1),W({}),U(""),R("")},className:"w-full px-4 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:"×¦×•×¨ ×‘×’×¨×•×ª ××—×¨×ª"})]})]})})}):null;return e.jsxs("div",{className:"bg-white rounded-lg shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:y?"×¢×¨×™×›×ª ×‘×’×¨×•×ª":"×™×¦×™×¨×ª ×‘×’×¨×•×ª ×—×“×©×”"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["×©×œ×‘ ",i+1," ××ª×•×š ",T.length,": ",T[i].name]})]}),e.jsx("button",{onClick:E,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Ee,{className:"w-6 h-6"})})]}),b(),e.jsxs("form",{onSubmit:be,className:"p-6",children:[f.general&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-3",children:[e.jsx(Te,{className:"w-5 h-5 text-red-500"}),e.jsx("span",{className:"text-red-700",children:f.general})]}),e.jsx("div",{className:"mb-8",children:ne()}),e.jsxs("div",{className:"flex justify-between items-center pt-6 border-t border-gray-200",children:[e.jsxs("button",{type:"button",onClick:fe,disabled:!le()||u,className:"flex items-center px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 min-w-[120px] justify-center","aria-label":"×—×–×¨ ×œ×©×œ×‘ ×”×§×•×“×",children:[e.jsx(Ue,{className:"w-4 h-4 ml-2","aria-hidden":"true"}),"×”×§×•×“×"]}),e.jsx("div",{className:"flex md:hidden items-center gap-1",children:T.map((t,r)=>e.jsx("div",{className:`w-2 h-2 rounded-full transition-all duration-200 ${r<=i?"bg-primary-500":"bg-gray-300"}`,"aria-hidden":"true"},r))}),i===T.length-1?e.jsx("button",{type:"submit",disabled:u||!V(i),className:`flex items-center px-6 py-3 rounded-lg font-medium transition-all duration-200 min-w-[160px] justify-center ${u||!V(i)?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-primary-600 text-white hover:bg-primary-700 hover:shadow-md"}`,"aria-label":y?"×¢×“×›×Ÿ ×‘×’×¨×•×ª":"×¦×•×¨ ×‘×’×¨×•×ª ×—×“×©×”",children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2","aria-hidden":"true"}),"×©×•××¨..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Me,{className:"w-4 h-4 ml-2","aria-hidden":"true"}),y?"×¢×“×›×Ÿ ×‘×’×¨×•×ª":"×¦×•×¨ ×‘×’×¨×•×ª"]})}):e.jsx("button",{type:"button",onClick:de,disabled:!ee()||J,className:`flex items-center px-6 py-3 rounded-lg font-medium transition-all duration-200 min-w-[120px] justify-center ${!ee()||J?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-primary-600 text-white hover:bg-primary-700 hover:shadow-md"}`,"aria-label":"×¢×‘×•×¨ ×œ×©×œ×‘ ×”×‘×",children:J?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2","aria-hidden":"true"}),"×‘×•×“×§..."]}):e.jsxs(e.Fragment,{children:["×”×‘×",e.jsx(Re,{className:"w-4 h-4 mr-2","aria-hidden":"true"})]})})]})]}),j()]})},Qe=Je;function cs(){const m=Ve(),{currentSchoolYear:Y}=Pe(),{user:d}=De(),{bagruts:y,loading:q,error:E,fetchAllBagruts:i,createBagrut:L,deleteBagrut:o,clearError:N}=qe(),[f,k]=n.useState(""),[u,P]=n.useState({status:"",teacherId:"",conservatory:"",isCompleted:""}),[S,D]=n.useState(!1),[v,h]=n.useState("table"),[we,W]=n.useState(!1),[_,U]=n.useState(null),[M,R]=n.useState([]),[se,A]=n.useState([]),[ce,X]=n.useState(!1),[J,te]=n.useState([]),[O,re]=n.useState(!1);n.useEffect(()=>{Q()},[Y]),n.useEffect(()=>{console.log("ğŸ­ Bagruts state updated:",y.length,"bagruts loaded"),y.length>0&&console.log("ğŸ­ First bagrut sample:",y[0])},[y]);const Q=async(s=!1)=>{try{X(!0),console.log("ğŸ”„ Loading bagrut data...",s?"(forced refresh)":""),console.log("ğŸ‘¤ Current user:",d?._id,"Role:",d?.roles?.[0]);const l=d?.roles?.includes("×× ×”×œ")||d?.roles?.includes("admin"),x=(d?.roles?.includes("××•×¨×”")||d?.roles?.includes("teacher"))&&!l;if(re(x),x){console.log("ğŸ“ Teacher role detected, loading student bagruts...");const b=await he.teachers.getTeacher(d._id),p=b.teaching?.studentIds||[];if(console.log("ğŸ‘¥ Teacher has",p.length,"students"),p.length===0){te([]),R([]),A([]);return}const C=await he.students.getBatchStudents(p);console.log("ğŸ“š Loaded",C.length,"students");const G=C.filter(j=>j.academicInfo?.bagrutTracking&&Object.keys(j.academicInfo.bagrutTracking).length>0);console.log("ğŸ¯",G.length,"students have bagrut data");const ne=G.map(j=>({_id:`${j._id}-bagrut`,studentId:j._id,studentName:j.personalInfo?.fullName||"×œ× ×¦×•×™×Ÿ",bagrutTracking:j.academicInfo?.bagrutTracking||{},class:j.personalInfo?.class||j.academicInfo?.class,hasActiveBagrut:j.academicInfo?.bagrutTracking&&Object.values(j.academicInfo.bagrutTracking).some(t=>t.status!=="completed"&&t.status!=="cancelled")}));te(ne),R(C),A([b])}else{await i({showInactive:!1,sortBy:"createdAt",order:"desc"});const[b,p]=await Promise.all([he.students.getStudents(),he.teachers.getTeachers()]);console.log("ğŸ“ Loaded students data:",b?.length,"students"),console.log("ğŸ‘¨â€ğŸ« Loaded teachers data:",p?.length,"teachers"),R(b),A(p)}}catch(l){console.error("Error loading data:",l)}finally{X(!1)}},z=s=>{const l=M.find(x=>x._id===s);return console.log("ğŸ” Looking for student:",s,"Found:",l?.personalInfo?.fullName||"NOT FOUND"),l?.personalInfo?.fullName||"×ª×œ××™×“ ×œ× ×™×“×•×¢"},F=s=>se.find(x=>x._id===s)?.personalInfo?.fullName||"××•×¨×” ×œ× ×™×“×•×¢",Z=s=>{m(`/bagruts/${s}`)},ae=s=>{m(`/bagruts/${s}/edit`)},V=(s,l)=>{const x=z(l);U({id:s,studentName:x}),W(!0)},ee=async()=>{_&&(await o(_.id)&&await Q(),U(null)),W(!1)},le=()=>{U(null),W(!1)},de=async s=>{try{const l=await fetch(`/api/bagrut/${s}/export/pdf`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(l.ok){const x=await l.blob(),b=window.URL.createObjectURL(x),p=document.createElement("a");p.href=b,p.download=`bagrut-${s}.pdf`,p.click(),window.URL.revokeObjectURL(b)}}catch(l){console.error("Error exporting PDF:",l),alert("×©×’×™××” ×‘×™×™×¦×•× ×”××¡××š")}},fe=async s=>{try{console.log("ğŸš€ Creating bagrut with data:",s);const l=await L(s);l?(console.log("âœ… Bagrut created successfully:",l._id),D(!1),setTimeout(async()=>{console.log("ğŸ”„ Refreshing bagrut data..."),await Promise.all([Q(!0),i({showInactive:!1,sortBy:"createdAt",order:"desc"})]),console.log("ğŸ”— Navigating to bagrut details:",l._id),m(`/bagruts/${l._id}`)},200)):console.error("âŒ Failed to create bagrut - no bagrut returned")}catch(l){console.error("âŒ Error in form submission:",l)}},w=O?J:y,$=w.filter(s=>{const l=s.studentName||z(s.studentId),x=F(s.teacherId),b=!f||l.toLowerCase().includes(f.toLowerCase())||x.toLowerCase().includes(f.toLowerCase())||s.conservatoryName?.toLowerCase().includes(f.toLowerCase()),p=!u.status||u.status==="completed"&&s.isCompleted||u.status==="pending"&&!s.isCompleted,C=!u.teacherId||s.teacherId===u.teacherId,G=!u.conservatory||s.conservatoryName===u.conservatory,ne=u.isCompleted===""||u.isCompleted==="true"&&s.isCompleted||u.isCompleted==="false"&&!s.isCompleted;return b&&p&&C&&G&&ne}),H=w.length,me=w.filter(s=>s.isCompleted).length,ue=H-me,be=w.filter(s=>s.finalGrade&&s.finalGrade>=90).length,xe=[{key:"student",header:"×ª×œ××™×“",render:s=>e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(oe,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"font-medium",children:z(s.studentId)})]})},{key:"teacher",header:"××•×¨×”",render:s=>F(s.teacherId)},{key:"conservatory",header:"×§×•× ×¡×¨×‘×˜×•×¨×™×•×Ÿ",render:s=>s.conservatoryName||"×œ× ×¦×•×™×Ÿ"},{key:"progress",header:"×”×ª×§×“××•×ª",align:"center",render:s=>{const l=s.presentations?.filter(G=>G.isCompleted).length||0,x=s.magenBagrut?.isCompleted?1:0;s.program?.length;const b=5,p=l+x,C=Math.round(p/b*100);return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-700",children:[C,"%"]}),e.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2 mt-1",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${C>=80?"bg-green-500":C>=50?"bg-yellow-500":"bg-red-500"}`,style:{width:`${C}%`}})})]})}},{key:"grade",header:"×¦×™×•×Ÿ ×¡×•×¤×™",align:"center",render:s=>{if(!s.finalGrade)return e.jsx("span",{className:"text-gray-400",children:"-"});let l="text-gray-700";return s.finalGrade>=90?l="text-green-600 font-bold":s.finalGrade>=80?l="text-blue-600":s.finalGrade>=70?l="text-yellow-600":s.finalGrade<60&&(l="text-red-600"),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:`text-lg ${l}`,children:s.finalGrade}),s.finalGradeLevel&&e.jsx("span",{className:"text-xs text-gray-500",children:s.finalGradeLevel})]})}},{key:"status",header:"×¡×˜×˜×•×¡",align:"center",render:s=>s.isCompleted?e.jsx(Ce,{status:"completed",children:"×”×•×©×œ×"}):e.jsx(Ce,{status:"pending",children:"×‘×ª×”×œ×™×š"})},{key:"actions",header:"×¤×¢×•×œ×•×ª",align:"center",render:s=>e.jsxs("div",{className:"flex space-x-2 space-x-reverse justify-center",children:[e.jsx("button",{onClick:l=>{l.stopPropagation(),Z(s._id)},className:"p-1.5 text-primary-600 hover:text-primary-900 hover:bg-primary-100 rounded transition-colors",title:"×¦×¤×” ×‘×¤×¨×˜×™×",children:e.jsx(Ie,{className:"w-4 h-4"})}),e.jsx("button",{onClick:l=>{l.stopPropagation(),ae(s._id)},className:"p-1.5 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded transition-colors",title:"×¢×¨×•×š",children:e.jsx(Se,{className:"w-4 h-4"})}),e.jsx("button",{onClick:l=>{l.stopPropagation(),de(s._id)},className:"p-1.5 text-blue-600 hover:text-blue-900 hover:bg-blue-100 rounded transition-colors",title:"×™×™×¦× PDF",children:e.jsx(ke,{className:"w-4 h-4"})}),e.jsx("button",{onClick:l=>{l.stopPropagation(),V(s._id,s.studentId)},className:"p-1.5 text-red-600 hover:text-red-900 hover:bg-red-50 rounded transition-colors",title:"××—×§",children:e.jsx(ve,{className:"w-4 h-4"})})]})}];return q||ce?e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Oe,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-primary-600"}),e.jsx("div",{className:"text-lg text-gray-600",children:"×˜×•×¢×Ÿ × ×ª×•× ×™ ×‘×’×¨×•×™×•×ª..."})]})}):E?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Te,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("div",{className:"text-red-600 text-lg mb-4",children:"×©×’×™××” ×‘×˜×¢×™× ×ª ×”× ×ª×•× ×™×"}),e.jsx("div",{className:"text-gray-600 mb-6",children:E}),e.jsx("button",{onClick:()=>{N(),Q()},className:"px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600",children:"× ×¡×” ×©×•×‘"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"× ×™×”×•×œ ×‘×’×¨×•×™×•×ª"}),e.jsx("p",{className:"text-gray-600 mt-1",children:O?"××¢×§×‘ ××—×¨ ×‘×’×¨×•×™×•×ª ×”×ª×œ××™×“×™× ×©×œ×š":"××¢×§×‘ ××—×¨ ×ª×”×œ×™×›×™ ×‘×’×¨×•×ª, ×¦×™×•× ×™× ×•××¡××›×™×"})]}),!O&&e.jsxs("button",{onClick:()=>D(!0),className:"flex items-center px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[e.jsx(Fe,{className:"w-4 h-4 ml-2"}),"×‘×’×¨×•×ª ×—×“×©×”"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(ge,{title:"×¡×”×´×› ×‘×’×¨×•×™×•×ª",value:H.toString(),subtitle:"×‘×’×¨×•×™×•×ª ×¨×©×•××•×ª ×‘××¢×¨×›×ª",icon:e.jsx(ie,{}),color:"blue"}),e.jsx(ge,{title:"×”×•×©×œ××•",value:me.toString(),subtitle:"×‘×’×¨×•×™×•×ª ×©×”×•×©×œ××•",icon:e.jsx(pe,{}),color:"green"}),e.jsx(ge,{title:"×‘×ª×”×œ×™×š",value:ue.toString(),subtitle:"×‘×’×¨×•×™×•×ª ×¤×¢×™×œ×•×ª",icon:e.jsx(ze,{}),color:"orange"}),e.jsx(ge,{title:"××¦×˜×™×™× ×™×",value:be.toString(),subtitle:"×¦×™×•×Ÿ 90 ×•××¢×œ×”",icon:e.jsx(He,{}),color:"purple"})]}),e.jsx(K,{padding:"md",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(je,{className:"absolute right-3 top-3 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"×—×™×¤×•×© ×œ×¤×™ ×©× ×ª×œ××™×“, ××•×¨×” ××• ×§×•× ×¡×¨×‘×˜×•×¨×™×•×Ÿ...",value:f,onChange:s=>k(s.target.value),className:"w-full pr-10 pl-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})}),e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsxs("select",{value:u.status,onChange:s=>P(l=>({...l,status:s.target.value})),className:"px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"×›×œ ×”×¡×˜×˜×•×¡×™×"}),e.jsx("option",{value:"completed",children:"×”×•×©×œ×"}),e.jsx("option",{value:"pending",children:"×‘×ª×”×œ×™×š"})]}),e.jsxs("select",{value:u.teacherId,onChange:s=>P(l=>({...l,teacherId:s.target.value})),className:"px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"×›×œ ×”××•×¨×™×"}),se.map(s=>e.jsx("option",{value:s._id,children:s.personalInfo?.fullName},s._id))]}),e.jsxs("select",{value:u.conservatory,onChange:s=>P(l=>({...l,conservatory:s.target.value})),className:"px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"×›×œ ×”×§×•× ×¡×¨×‘×˜×•×¨×™×•× ×™×"}),[...new Set(y.map(s=>s.conservatoryName).filter(Boolean))].map(s=>e.jsx("option",{value:s,children:s},s))]})]})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["××¦×™×’ ",$.length," ××ª×•×š ",H," ×‘×’×¨×•×™×•×ª"]}),e.jsxs("div",{className:"flex items-center bg-gray-50 p-1 rounded-lg border border-gray-200",children:[e.jsxs("button",{onClick:()=>h("table"),className:`px-3 py-2 rounded-md text-sm font-medium transition-all flex items-center gap-2 ${v==="table"?"bg-white text-primary-700 shadow-sm border border-gray-200":"text-gray-600 hover:text-gray-800"}`,children:[e.jsx(Ke,{className:"w-4 h-4"}),"×˜×‘×œ×”"]}),e.jsxs("button",{onClick:()=>h("grid"),className:`px-3 py-2 rounded-md text-sm font-medium transition-all flex items-center gap-2 ${v==="grid"?"bg-white text-primary-700 shadow-sm border border-gray-200":"text-gray-600 hover:text-gray-800"}`,children:[e.jsx(Ye,{className:"w-4 h-4"}),"×¨×©×ª"]})]})]}),v==="table"?e.jsx($e,{columns:xe,data:$,onRowClick:s=>Z(s._id),rowClassName:"hover:bg-gray-50 cursor-pointer transition-colors"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:$.map(s=>e.jsx(Xe,{bagrut:s,studentName:z(s.studentId),teacherName:F(s.teacherId),onClick:()=>Z(s._id),onEdit:()=>ae(s._id),onDelete:()=>V(s._id,s.studentId),onExport:()=>de(s._id)},s._id))}),$.length===0&&!q&&!ce&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ie,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-500 text-lg",children:O&&H===0?"××™×Ÿ ×œ×š ×ª×œ××™×“×™× ×¢× ×ª×”×œ×™×›×™ ×‘×’×¨×•×ª ×¤×¢×™×œ×™× ×›×¨×’×¢":"×œ× × ××¦××• ×‘×’×¨×•×™×•×ª ×”×ª×•×××•×ª ×œ×—×™×¤×•×©"}),O&&H===0&&e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"×›××©×¨ ×ª×œ××™×“×™×š ×™×™×¨×©××• ×œ×‘×’×¨×•×™×•×ª, ×”×Ÿ ×™×•×¤×™×¢×• ×›××Ÿ"})]}),S&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto mr-64",children:e.jsx(Qe,{students:M,teachers:se,onSubmit:fe,onCancel:()=>D(!1)})})}),e.jsx(_e,{isOpen:we,title:"××—×™×§×ª ×‘×’×¨×•×ª",message:`×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×”×‘×’×¨×•×ª ×©×œ ${_?.studentName}? ×¤×¢×•×œ×” ×–×• ×œ× × ×™×ª× ×ª ×œ×‘×™×˜×•×œ.`,confirmText:"××—×§",cancelText:"×‘×™×˜×•×œ",onConfirm:ee,onCancel:le,variant:"danger"})]})}export{cs as default};
