import{u as $e,j as e,a as ze}from"../assets/index-CoKafZFz.js";import{r as N,b as Fe}from"./vendor-C9PcmKF2.js";import{S as je}from"./StatsCard-DEtP3a5j.js";import{C as G}from"./Card-1BAWwzNR.js";import{a as F}from"./cascade-deletion-BvQll6O-.js";import{v as we,M as ie,g as fe,w as tt,x as Oe,G as ne,y as Ie,c as K,s as ge,z as st,p as Le,D as de,V as at,f as Re,E as rt,I as nt,J as Ae,K as Pe,a as Xe,X as lt,e as ve,P as Ze,B as oe,N as ct,O as ot,r as it,o as ue,Q as dt,q as Ge,W as mt,Y as Te,Z as Je,_ as xt,$ as ht,d as gt,a0 as ut,U as ft,a1 as pt}from"./ui-DsxFGtGk.js";import{T as yt}from"./teacherDetailsApi-C45WQoYF.js";import"./query-BdHdBeoH.js";import"./utils-x1PSU_OZ.js";function jt(){const{user:s}=$e(),[n,d]=N.useState({totalOrchestras:0,activeMusicians:0,upcomingRehearsals:0,completedConcerts:0,totalMembers:0,weeklyRehearsals:0,bagrutMembers:0,activeBagrutStudents:0}),[x,l]=N.useState([]),[f,c]=N.useState([]),[u,p]=N.useState([]),[C,a]=N.useState([]),[y,j]=N.useState(!0),[S,g]=N.useState(null);N.useEffect(()=>{s?._id&&w()},[s]);const w=async()=>{try{j(!0),g(null);const t=s._id,[i]=await Promise.all([F.teachers.getTeacher(t)]);if(!i)throw new Error("×œ× × ××¦× ×¤×¨×•×¤×™×œ ×× ×¦×—");const r=i?.conducting?.orchestraIds||[];let v=[],I=0,L=[];if(r.length>0){v=await F.orchestras.getBatchOrchestras(r),I=v.reduce(($,b)=>$+(b.memberCount||0),0);try{const $=await F.rehearsals.getRehearsals({groupIds:r.join(","),limit:100});L=Array.isArray($)?$:[]}catch($){console.warn("Error loading rehearsals:",$),L=[]}}const O=new Date,A=new Date(O.getTime()+7*24*60*60*1e3),W=L.filter($=>{const b=new Date($.scheduledDate);return b>=O&&b<=A}).slice(0,5).map($=>{const b=v.find(M=>M._id===$.groupId);return{id:$._id,orchestraName:b?.name||"×ª×–××•×¨×ª",date:new Date($.scheduledDate).toLocaleDateString("he-IL"),time:$.startTime||"19:00",location:$.location||"××•×œ× ××•×–×™×§×”",attendanceRate:Math.floor(Math.random()*20)+80,duration:120,status:"scheduled"}});l(W);const J=L.filter($=>{const b=new Date($.scheduledDate),M=new Date(O);M.setDate(O.getDate()-O.getDay());const h=new Date(M);return h.setDate(M.getDate()+6),b>=M&&b<=h}).length;let Z=[],se=0,Y=0;if(v.length>0){const $=v.flatMap(b=>b?.members?.map(M=>M.studentId)||[]);if($.length>0)try{const[b,M]=await Promise.all([Promise.all($.map(h=>F.bagrut.getBagrutByStudent(h).catch(()=>null))).then(h=>h.filter(Boolean)),F.students.getBatchStudents($)]);Z=$.map(h=>{const P=M.find(X=>X._id===h),q=b.find(X=>X.studentId===h),U=v.flatMap(X=>X.members||[]).find(X=>X.studentId===h),te=v.find(X=>X.members?.some(ae=>ae.studentId===h));let V="none",Q,le,ce;if(q){const X=q.presentations?.filter(ae=>ae.completed).length||0;if(Q=X+1,le=X/4*100,q.isCompleted&&q.finalGrade&&q.finalGrade>=55?V="completed":q.isCompleted&&q.finalGrade&&q.finalGrade<55?V="none":X===0?V="pending":V="active",V==="active"){const ae=new Date,pe=Math.floor(Math.random()*30)+7;ce=new Date(ae),ce.setDate(ae.getDate()+pe)}}return{studentId:h,studentName:P?.personalInfo?.fullName||"×ª×œ××™×“ ×œ× ×™×“×•×¢",instrument:U?.instrument||P?.academicInfo?.primaryInstrument||"×œ× ×¦×•×™×Ÿ",section:U?.section||"×œ× ×¦×•×™×Ÿ",bagrutStatus:V,stage:Q,progress:le,nextExamDate:ce,orchestraName:te?.name||"×ª×–××•×¨×ª"}}),se=Z.filter(h=>h.bagrutStatus!=="none").length,Y=Z.filter(h=>h.bagrutStatus==="active").length}catch(b){console.warn("Error loading Bagrut data:",b)}}a(Z);const ee={totalOrchestras:v.length,activeMusicians:I,upcomingRehearsals:W.length,completedConcerts:Math.floor(Math.random()*5)+2,totalMembers:I,weeklyRehearsals:J,bagrutMembers:se,activeBagrutStudents:Y};d(ee);const k=v.map($=>{const b=L.filter(h=>h.groupId===$._id),M=Math.floor(Math.random()*20)+80;return{orchestraId:$._id,orchestraName:$.name,totalRehearsals:b.length,averageAttendance:M,upcomingConcerts:Math.floor(Math.random()*3)+1,lastRehearsal:b.length>0?new Date(b[b.length-1].scheduledDate).toLocaleDateString("he-IL"):"××™×Ÿ × ×ª×•× ×™×",status:M>=90?"excellent":M>=75?"good":"needs_attention"}});p(k);const T=[];L.slice(0,3).forEach($=>{const b=v.find(M=>M._id===$.groupId);T.push({id:`rehearsal-${$._id}`,type:"rehearsal",title:"×—×–×¨×” ×”×•×©×œ××”",description:`×—×–×¨×” ×©×œ ${b?.name||"×ª×–××•×¨×ª"} - ${$.location||"××•×œ× ××•×–×™×§×”"}`,timestamp:new Date(Date.now()-Math.random()*864e5).toISOString(),orchestraName:b?.name})}),v.slice(0,2).forEach($=>{T.push({id:`enrollment-${$._id}`,type:"enrollment",title:"×¨×™×©×•× ×—×“×©",description:`×ª×œ××™×“ ×—×“×© ×”×¦×˜×¨×£ ×œ${$.name}`,timestamp:new Date(Date.now()-Math.random()*1728e5).toISOString(),orchestraName:$.name})}),c(T.sort(($,b)=>new Date(b.timestamp).getTime()-new Date($.timestamp).getTime()))}catch(t){console.error("Error loading conductor dashboard data:",t),g("×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™ ×œ×•×— ×”×‘×§×¨×”")}finally{j(!1)}},D=Fe(),m=t=>{switch(t){case"scheduleRehearsal":D("/profile",{state:{activeTab:"orchestras"}});break;case"markAttendance":D("/profile",{state:{activeTab:"orchestras"}});break;case"manageOrchestras":D("/profile",{state:{activeTab:"orchestras"}});break;case"viewMusicians":D("/profile",{state:{activeTab:"orchestras"}});break;default:console.log("Action:",t)}},o=t=>{const i=new Date(t),v=new Date().getTime()-i.getTime(),I=Math.floor(v/(1e3*60*60));return I<1?`×œ×¤× ×™ ${Math.floor(v/6e4)} ×“×§×•×ª`:I<24?`×œ×¤× ×™ ${I} ×©×¢×•×ª`:`×œ×¤× ×™ ${Math.floor(I/24)} ×™××™×`};return y?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600 font-reisinger-yonatan",children:"×˜×•×¢×Ÿ ×œ×•×— ×‘×§×¨×” ×œ×× ×¦×—..."})]})}):S?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md",children:e.jsxs("div",{className:"text-red-800 font-reisinger-yonatan text-center",children:[e.jsx(we,{className:"w-12 h-12 mx-auto mb-4 text-red-600"}),e.jsx("h3",{className:"text-lg font-bold mb-2",children:S}),e.jsx("button",{onClick:w,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"× ×¡×” ×©×•×‘"})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 font-reisinger-yonatan",children:["×©×œ×•× ×× ×¦×— ",s?.firstName||"×™×§×¨"," ğŸ¼"]}),e.jsx("p",{className:"text-gray-600 mt-2",children:new Date().toLocaleDateString("he-IL",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-6 mb-8",children:[e.jsx(be,{icon:e.jsx(ie,{className:"w-6 h-6"}),title:"×¡×”×´×› ×ª×–××•×¨×•×ª",value:n.totalOrchestras,bgColor:"bg-blue-50",iconColor:"text-blue-600",borderColor:"border-blue-200"}),e.jsx(be,{icon:e.jsx(fe,{className:"w-6 h-6"}),title:"××•×–×™×§××™× ×¤×¢×™×œ×™×",value:n.activeMusicians,bgColor:"bg-green-50",iconColor:"text-green-600",borderColor:"border-green-200"}),e.jsx(be,{icon:e.jsx(tt,{className:"w-6 h-6"}),title:"×—×–×¨×•×ª ×”×©×‘×•×¢",value:n.weeklyRehearsals,bgColor:"bg-purple-50",iconColor:"text-purple-600",borderColor:"border-purple-200"}),e.jsx(be,{icon:e.jsx(Oe,{className:"w-6 h-6"}),title:"×§×•× ×¦×¨×˜×™× ×”×©× ×”",value:n.completedConcerts,bgColor:"bg-yellow-50",iconColor:"text-yellow-600",borderColor:"border-yellow-200"}),e.jsx(be,{icon:e.jsx(ne,{className:"w-6 h-6"}),title:"×—×‘×¨×™ ×‘×’×¨×•×ª",value:n.bagrutMembers,bgColor:"bg-indigo-50",iconColor:"text-indigo-600",borderColor:"border-indigo-200"}),e.jsx(be,{icon:e.jsx(Ie,{className:"w-6 h-6"}),title:"×‘×’×¨×•×ª ×¤×¢×™×œ×”",value:n.activeBagrutStudents,bgColor:"bg-orange-50",iconColor:"text-orange-600",borderColor:"border-orange-200"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:"×¤×¢×•×œ×•×ª ××”×™×¨×•×ª"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(De,{icon:e.jsx(K,{className:"w-5 h-5"}),label:"×§×‘×¢ ×—×–×¨×”",onClick:()=>m("scheduleRehearsal"),color:"indigo"}),e.jsx(De,{icon:e.jsx(ge,{className:"w-5 h-5"}),label:"×¡××Ÿ × ×•×›×—×•×ª",onClick:()=>m("markAttendance"),color:"green"}),e.jsx(De,{icon:e.jsx(st,{className:"w-5 h-5"}),label:"× ×”×œ ×ª×–××•×¨×•×ª",onClick:()=>m("manageOrchestras"),color:"blue"}),e.jsx(De,{icon:e.jsx(Le,{className:"w-5 h-5"}),label:"×¦×¤×” ×‘××•×–×™×§××™×",onClick:()=>m("viewMusicians"),color:"purple"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×”×—×–×¨×•×ª ×”×§×¨×•×‘×•×ª"}),e.jsxs("button",{onClick:()=>D("/profile",{state:{activeTab:"orchestras"}}),className:"text-indigo-600 hover:text-indigo-700 text-sm font-medium flex items-center gap-1",children:["×¦×¤×” ×‘×›×œ",e.jsx(de,{className:"w-4 h-4"})]})]}),x.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(K,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"××™×Ÿ ×—×–×¨×•×ª ××ª×•×›× × ×•×ª ×”×©×‘×•×¢"})]}):e.jsx("div",{className:"space-y-3",children:x.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-indigo-100 rounded-full flex items-center justify-center",children:e.jsx(at,{className:"w-6 h-6 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:t.orchestraName}),e.jsxs("div",{className:"text-sm text-gray-600 flex items-center gap-2",children:[e.jsx(Re,{className:"w-3 h-3"}),t.location]}),t.attendanceRate&&e.jsxs("div",{className:"text-xs text-gray-500",children:["× ×•×›×—×•×ª ×××•×¦×¢×ª: ",t.attendanceRate,"%"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.date}),e.jsx("div",{className:"text-sm text-gray-600",children:t.time}),e.jsxs("div",{className:"text-xs text-gray-500",children:[e.jsx(rt,{className:"w-3 h-3 inline mr-1"}),t.duration," ×“×§×•×ª"]})]})]},t.id))})]}),C.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×—×‘×¨×™ ×ª×–××•×¨×ª ×¢× ×‘×’×¨×•×ª"}),e.jsx(ne,{className:"w-5 h-5 text-gray-400"})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-blue-600",children:C.filter(t=>t.bagrutStatus==="active").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"×‘×’×¨×•×ª ×¤×¢×™×œ×”"})]}),e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-green-600",children:C.filter(t=>t.bagrutStatus==="completed").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"×”×•×©×œ××”"})]}),e.jsxs("div",{className:"text-center p-3 bg-yellow-50 rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-yellow-600",children:C.filter(t=>t.bagrutStatus==="pending").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"×××ª×™× ×™×"})]}),e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-gray-600",children:C.filter(t=>t.bagrutStatus==="none").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"×œ×œ× ×‘×’×¨×•×ª"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"×ª×œ××™×“×™ ×‘×’×¨×•×ª ×¤×¢×™×œ×™×"}),C.filter(t=>t.bagrutStatus==="active").slice(0,5).map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(ie,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.studentName}),e.jsxs("div",{className:"text-sm text-gray-600",children:[t.instrument," â€¢ ",t.section," â€¢ ",t.orchestraName]})]})]}),e.jsxs("div",{className:"text-right",children:[t.stage&&e.jsxs("div",{className:"text-sm font-medium text-gray-900 mb-1",children:["×”×©××¢×” ",t.stage,"/4"]}),t.progress!==void 0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${t.progress}%`}})}),e.jsxs("span",{className:"text-xs text-gray-500",children:[Math.round(t.progress),"%"]})]}),t.nextExamDate&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["××‘×—×Ÿ ×”×‘×: ",t.nextExamDate.toLocaleDateString("he-IL")]}),e.jsx("button",{className:"mt-2 p-1 text-gray-400 hover:text-blue-600",children:e.jsx(nt,{className:"w-4 h-4"})})]})]},t.studentId)),C.filter(t=>t.bagrutStatus==="active").length>5&&e.jsx("div",{className:"text-center pt-2",children:e.jsxs("button",{onClick:()=>window.location.href="/teacher/bagrut",className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:["×¦×¤×” ×‘×›×œ ×ª×œ××™×“×™ ×”×‘×’×¨×•×ª (",C.filter(t=>t.bagrutStatus==="active").length,")"]})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×‘×™×¦×•×¢×™ ×ª×–××•×¨×•×ª"}),e.jsxs("button",{onClick:()=>D("/profile",{state:{activeTab:"orchestras"}}),className:"text-indigo-600 hover:text-indigo-700 text-sm font-medium flex items-center gap-1",children:["×“×•×— ××¤×•×¨×˜",e.jsx(de,{className:"w-4 h-4"})]})]}),u.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Ae,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"××™×Ÿ × ×ª×•× ×™ ×‘×™×¦×•×¢×™×"})]}):e.jsx("div",{className:"space-y-3",children:u.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${t.status==="excellent"?"bg-green-500":t.status==="good"?"bg-yellow-500":"bg-red-500"}`}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:t.orchestraName}),e.jsxs("div",{className:"text-sm text-gray-600",children:[t.totalRehearsals," ×—×–×¨×•×ª ×”×©× ×” â€¢ ×—×–×¨×” ××—×¨×•× ×”: ",t.lastRehearsal]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ie,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:`font-medium ${t.averageAttendance>=90?"text-green-600":t.averageAttendance>=75?"text-yellow-600":"text-red-600"}`,children:[t.averageAttendance,"%"]})]}),e.jsx("div",{className:"text-xs text-gray-500",children:"× ×•×›×—×•×ª ×××•×¦×¢×ª"})]})]},t.orchestraId))})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×¤×¢×™×œ×•×ª ××—×¨×•× ×”"}),e.jsx(Pe,{className:"w-5 h-5 text-gray-400"})]}),f.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(we,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"××™×Ÿ ×¤×¢×™×œ×•×ª ×œ××—×¨×•× ×”"})]}):e.jsx("div",{className:"space-y-4",children:f.map(t=>e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${t.type==="rehearsal"?"bg-blue-100":t.type==="enrollment"?"bg-green-100":t.type==="performance"?"bg-purple-100":"bg-yellow-100"}`,children:[t.type==="rehearsal"&&e.jsx(ie,{className:"w-4 h-4 text-blue-600"}),t.type==="enrollment"&&e.jsx(Le,{className:"w-4 h-4 text-green-600"}),t.type==="performance"&&e.jsx(Oe,{className:"w-4 h-4 text-purple-600"}),t.type==="attendance"&&e.jsx(ge,{className:"w-4 h-4 text-yellow-600"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 font-reisinger-yonatan",children:t.title}),e.jsx("p",{className:"text-sm text-gray-600 truncate font-reisinger-yonatan",children:t.description}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:o(t.timestamp)})]})]},t.id))})]})]})]})})}function be({icon:s,title:n,value:d,suffix:x,bgColor:l,iconColor:f,borderColor:c}){return e.jsx("div",{className:`${l} border ${c} rounded-lg p-6`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:n}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:[d," ",x&&e.jsx("span",{className:"text-lg font-normal",children:x})]})]}),e.jsx("div",{className:`${f}`,children:s})]})})}function De({icon:s,label:n,onClick:d,color:x}){const l={indigo:"bg-indigo-50 text-indigo-600 hover:bg-indigo-100 border-indigo-200",green:"bg-green-50 text-green-600 hover:bg-green-100 border-green-200",blue:"bg-blue-50 text-blue-600 hover:bg-blue-100 border-blue-200",purple:"bg-purple-50 text-purple-600 hover:bg-purple-100 border-purple-200"};return e.jsxs("button",{onClick:d,className:`flex flex-col items-center justify-center p-4 rounded-lg border transition-colors ${l[x]}`,children:[s,e.jsx("span",{className:"mt-2 text-sm font-medium font-reisinger-yonatan",children:n})]})}function bt(){const{user:s}=$e(),n=Fe(),[d,x]=N.useState({totalStudents:0,todaysLessons:0,weeklyHours:0,activeBagrutStudents:0}),[l,f]=N.useState([]),[c,u]=N.useState([]),[p,C]=N.useState([]),[a,y]=N.useState([]),[j,S]=N.useState(!0),[g,w]=N.useState(null);N.useState(!1),N.useState(!1),N.useState(!1);const[D,m]=N.useState([]),[o,t]=N.useState([]),[i,r]=N.useState(null),[v,I]=N.useState([]),[L,O]=N.useState([]),[A,W]=N.useState([]),[J,Z]=N.useState({days:[]});N.useEffect(()=>{s?._id&&se()},[s]),N.useEffect(()=>{s?._id&&A.length>=0&&k()},[s,A]),N.useEffect(()=>{if(i){const h=setTimeout(()=>r(null),4e3);return()=>clearTimeout(h)}},[i]);const se=()=>{const h=s?.roles||[],P=s?.role,q=s?.allRoles||[];let U=[...h];P&&!U.includes(P)&&U.push(P),U=[...new Set([...U,...q])];const te=U.map(V=>{const Q=V?.toLowerCase();return Q==="conductor"||Q==="×× ×¦×—"?"conductor":Q==="theory-teacher"||Q==="××•×¨×” ×ª×™××•×¨×™×”"||Q==="theory teacher"?"theory-teacher":Q==="teacher"||Q==="××•×¨×”"?"teacher":V});W([...new Set(te)])},Y=async h=>{try{const P=await yt.getTransformedWeeklySchedule(h);if(P)return Z(P),P}catch(P){console.log("Error loading weekly schedule:",P)}return ee()},ee=()=>({days:["×¨××©×•×Ÿ","×©× ×™","×©×œ×™×©×™","×¨×‘×™×¢×™","×—××™×©×™","×©×™×©×™","×©×‘×ª"].map(P=>({dayName:P,lessons:[]}))}),k=async()=>{try{S(!0),w(null);const h=s._id,[P,q]=await Promise.all([F.teachers.getMyProfile(),Y(h)]);if(!P)throw new Error("×œ× × ××¦× ×¤×¨×•×¤×™×œ ××•×¨×”");console.log("Teacher profile loaded:",{name:P?.personalInfo?.fullName,studentIds:P?.teaching?.studentIds,studentCount:P?.teaching?.studentIds?.length||0,timeBlocks:P?.teaching?.timeBlocks?.length||0});const U=P?.teaching?.studentIds||[],te=P?.teaching?.timeBlocks||[];m(te);let V=[];if(U.length>0){console.log("ğŸ¯ Teacher assigned student IDs:",U);const B=await F.students.getBatchStudents(U);if(console.log(`ğŸ“Š API returned ${B.length} students for ${U.length} requested IDs`),V=B.filter(H=>{const _=H._id||H.id,R=U.includes(_);return!R&&B.length>U.length&&console.log(`âš ï¸ Filtering out unassigned student: ${_}`),R}),console.log(`âœ… Showing ${V.length} assigned students (filtered from ${B.length})`),V.length<U.length){const H=V.map(R=>R._id||R.id),_=U.filter(R=>!H.includes(R));console.warn("âš ï¸ Missing students:",_)}}else console.log("No student IDs found in teacher profile");t(V);const Q=new Date,le=["×¨××©×•×Ÿ","×©× ×™","×©×œ×™×©×™","×¨×‘×™×¢×™","×—××™×©×™","×©×™×©×™","×©×‘×ª"][Q.getDay()],ce=q.days.find(B=>B.dayName===le)?.lessons.filter(B=>B.lessonType!=="availability").length||0,X=q.days.reduce((B,H)=>B+H.lessons.filter(_=>_.lessonType!=="availability").reduce((_,R)=>{const me=new Date(`2000-01-01T${R.startTime}`),xe=new Date(`2000-01-01T${R.endTime}`);return _+(xe.getTime()-me.getTime())/(1e3*60*60)},0),0);let ae=[];if(A.includes("conductor"))try{const H=(await F.orchestras.getOrchestras()).filter(_=>_.conductorId===h);I(H),console.log(`ğŸ¼ Loaded ${H.length} orchestras for conductor`)}catch(B){console.log("Error loading orchestras:",B)}if(A.includes("theory-teacher"))try{const B=await F.theory.getTheoryLessons({teacherId:h});O(B||[]),console.log(`ğŸ“š Loaded ${B?.length||0} theory lessons`)}catch(B){console.log("Error loading theory lessons:",B)}const pe=ae.map(B=>{const H=o.find(ye=>ye._id===B.studentId),_=B.presentations?.filter(ye=>ye.completed).length||0,R=4,me=_/R*100;let xe="active";B.isCompleted&&B.finalGrade&&B.finalGrade>=55?xe="completed":B.isCompleted&&B.finalGrade&&B.finalGrade<55?xe="failed":_===0&&(xe="pending");let Be;if(xe==="active"&&_<4){const ye=new Date,et=Math.floor(Math.random()*30)+7;Be=new Date(ye),Be.setDate(ye.getDate()+et)}return{studentId:B.studentId,studentName:H?.personalInfo?.fullName||"×ª×œ××™×“ ×œ× ×™×“×•×¢",instrument:H?.academicInfo?.primaryInstrument||"×œ× ×¦×•×™×Ÿ",stage:_+1,progress:me,nextExamDate:Be,status:xe,finalGrade:B.finalGrade,completedPresentations:_,totalPresentations:R,bagrutId:B._id}});y(pe);const E=pe.filter(B=>B.status==="active").length;x({totalStudents:V.length,todaysLessons:ce,weeklyHours:Math.round(X*10)/10,activeBagrutStudents:E});let z=[];const _e=q.days.find(B=>B.dayName===le);if(_e){const B=`${Q.getHours().toString().padStart(2,"0")}:${Q.getMinutes().toString().padStart(2,"0")}`;z=_e.lessons.filter(_=>_.lessonType!=="availability"&&_.startTime>=B).slice(0,5).map(_=>({id:_.id,studentName:_.studentName||"×ª×œ××™×“",time:_.startTime,instrument:_.instrument||"",duration:parseInt(_.notes?.match(/\d+/)?.[0]||"60"),type:_.lessonType}))}if(z.length===0&&P?.teaching?.timeBlocks){const B=`${Q.getHours().toString().padStart(2,"0")}:${Q.getMinutes().toString().padStart(2,"0")}`,H=[];P.teaching.timeBlocks.forEach(R=>{R.day===le&&(R.assignedLessons||[]).filter(me=>me.isActive!==!1).forEach(me=>{H.push({...me,day:R.day,location:R.location})})}),z=H.filter(R=>R.startTime>=B).slice(0,5).map(R=>({id:R._id||`lesson-${R.studentId}`,studentName:R.studentName||"×ª×œ××™×“",time:R.startTime,instrument:R.instrument||"",duration:R.duration||60,type:"individual"}))}if(z.length===0&&V.length>0){const B=`${Q.getHours().toString().padStart(2,"0")}:${Q.getMinutes().toString().padStart(2,"0")}`;V.forEach(H=>{(H.teacherAssignments?.filter(R=>R.teacherId===s._id&&R.day===le)||[]).forEach(R=>{R.time&&R.time>=B&&z.push({id:`${H._id}-${R.time}`,studentName:H.personalInfo?.fullName||"×ª×œ××™×“",time:R.time,instrument:H.academicInfo?.primaryInstrument||R.instrument||"×›×œ×™ ××•×–×™×§×”",duration:R.duration||60,type:"individual"})})}),z.sort((H,_)=>H.time.localeCompare(_.time))}f(z.slice(0,5)),u([]),C([])}catch(h){console.error("Error loading dashboard data:",h),w("×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™ ×œ×•×— ×”×‘×§×¨×”")}finally{S(!1)}},T=h=>{switch(console.log("handleQuickAction called with:",h),console.log("Teacher time blocks:",D),h){case"addLesson":n("/profile?tab=students&action=addStudent");break;case"markAttendance":n("/profile?tab=attendance");break;case"viewSchedule":n("/profile?tab=schedule");break;case"manageStudents":n("/profile?tab=students");break;case"manageTeachingDays":n("/profile?tab=schedule");break;case"viewOrchestras":n("/profile?tab=orchestras");break;case"viewTheoryLessons":n("/profile?tab=lessons");break;case"addOrchestra":n("/orchestras/new");break;case"addTheoryLesson":n("/theory/new");break;case"manageBagrut":window.location.href="/teacher/bagrut";break;case"scheduleBagrutExam":window.location.href="/teacher/bagrut/schedule";break;case"viewBagrutProgress":window.location.href="/teacher/bagrut/progress";break;case"updateBagrutStatus":window.location.href="/teacher/bagrut/update";break;default:console.log("Action:",h)}},$=h=>{switch(h){case"completed":return"text-green-600 bg-green-50";case"active":return"text-blue-600 bg-blue-50";case"pending":return"text-yellow-600 bg-yellow-50";case"failed":return"text-red-600 bg-red-50";default:return"text-gray-600 bg-gray-50"}},b=h=>{switch(h){case"completed":return"×”×•×©×œ×";case"active":return"×¤×¢×™×œ";case"pending":return"×××ª×™×Ÿ";case"failed":return"× ×›×©×œ";default:return"×œ× ×™×“×•×¢"}},M=h=>{const P=new Date(h),U=new Date().getTime()-P.getTime(),te=Math.floor(U/(1e3*60*60));return te<1?`×œ×¤× ×™ ${Math.floor(U/6e4)} ×“×§×•×ª`:te<24?`×œ×¤× ×™ ${te} ×©×¢×•×ª`:`×œ×¤× ×™ ${Math.floor(te/24)} ×™××™×`};return j?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600 font-reisinger-yonatan",children:"×˜×•×¢×Ÿ ×œ×•×— ×‘×§×¨×”..."})]})}):g?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md",children:e.jsxs("div",{className:"text-red-800 font-reisinger-yonatan text-center",children:[e.jsx(we,{className:"w-12 h-12 mx-auto mb-4 text-red-600"}),e.jsx("h3",{className:"text-lg font-bold mb-2",children:g}),e.jsx("button",{onClick:k,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"× ×¡×” ×©×•×‘"})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[i&&e.jsx("div",{className:`fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ${i.type==="success"?"bg-green-100 border border-green-200 text-green-800":"bg-red-100 border border-red-200 text-red-800"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[i.type==="success"?e.jsx(ge,{className:"w-5 h-5"}):e.jsx(Xe,{className:"w-5 h-5"}),e.jsx("span",{className:"font-reisinger-yonatan",children:i.message}),e.jsx("button",{onClick:()=>r(null),className:"ml-2 text-gray-400 hover:text-gray-600",children:e.jsx(lt,{className:"w-4 h-4"})})]})}),e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"flex items-center gap-4 mb-4",children:e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 font-reisinger-yonatan",children:["×œ×•×— ×‘×§×¨×” - ",s?.personalInfo?.fullName||s?.fullName||"××•×¨×”"]})}),e.jsxs("p",{className:"text-gray-600 mt-2",children:["×©×œ×•× ",s?.firstName||"××•×¨×”"," â€¢ ",new Date().toLocaleDateString("he-IL",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(Ce,{icon:e.jsx(fe,{className:"w-6 h-6"}),title:"×¡×”×´×› ×ª×œ××™×“×™×",value:d.totalStudents,bgColor:"bg-blue-50",iconColor:"text-blue-600",borderColor:"border-blue-200"}),e.jsx(Ce,{icon:e.jsx(K,{className:"w-6 h-6"}),title:"×©×™×¢×•×¨×™× ×”×™×•×",value:d.todaysLessons,bgColor:"bg-green-50",iconColor:"text-green-600",borderColor:"border-green-200"}),e.jsx(Ce,{icon:e.jsx(ve,{className:"w-6 h-6"}),title:"×©×¢×•×ª ×”×©×‘×•×¢",value:d.weeklyHours,suffix:"×©×¢×•×ª",bgColor:"bg-purple-50",iconColor:"text-purple-600",borderColor:"border-purple-200"}),e.jsx(Ce,{icon:e.jsx(ne,{className:"w-6 h-6"}),title:"×ª×œ××™×“×™ ×‘×’×¨×•×ª ×¤×¢×™×œ×™×",value:d.activeBagrutStudents,bgColor:"bg-yellow-50",iconColor:"text-yellow-600",borderColor:"border-yellow-200"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:"×¤×¢×•×œ×•×ª ××”×™×¨×•×ª"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(re,{icon:e.jsx(Ze,{className:"w-5 h-5"}),label:"×”×•×¡×£ ×©×™×¢×•×¨",onClick:()=>T("addLesson"),color:"indigo"}),e.jsx(re,{icon:e.jsx(ge,{className:"w-5 h-5"}),label:"×¡××Ÿ × ×•×›×—×•×ª",onClick:()=>T("markAttendance"),color:"green"}),e.jsx(re,{icon:e.jsx(K,{className:"w-5 h-5"}),label:"×¦×¤×” ×‘×œ×•×´×–",onClick:()=>T("viewSchedule"),color:"blue"}),e.jsx(re,{icon:e.jsx(Le,{className:"w-5 h-5"}),label:"× ×™×”×•×œ ×ª×œ××™×“×™×",onClick:()=>T("manageStudents"),color:"purple"}),A.includes("teacher")&&e.jsx(re,{icon:e.jsx(ve,{className:"w-5 h-5"}),label:"×™××™ ×œ×™××•×“",onClick:()=>T("manageTeachingDays"),color:"orange"}),A.includes("conductor")&&e.jsx(re,{icon:e.jsx(ie,{className:"w-5 h-5"}),label:"×”×ª×–××•×¨×•×ª ×©×œ×™",onClick:()=>T("viewOrchestras"),color:"rose"}),A.includes("theory-teacher")&&e.jsx(re,{icon:e.jsx(oe,{className:"w-5 h-5"}),label:"×©×™×¢×•×¨×™ ×ª×™××•×¨×™×”",onClick:()=>T("viewTheoryLessons"),color:"amber"}),a.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(re,{icon:e.jsx(ne,{className:"w-5 h-5"}),label:"× ×™×”×•×œ ×‘×’×¨×•×ª",onClick:()=>T("manageBagrut"),color:"emerald"}),e.jsx(re,{icon:e.jsx(ct,{className:"w-5 h-5"}),label:"×ª×–××•×Ÿ ××‘×—×Ÿ",onClick:()=>T("scheduleBagrutExam"),color:"orange"}),e.jsx(re,{icon:e.jsx(Ie,{className:"w-5 h-5"}),label:"××¢×§×‘ ×”×ª×§×“××•×ª",onClick:()=>T("viewBagrutProgress"),color:"cyan"}),e.jsx(re,{icon:e.jsx(ot,{className:"w-5 h-5"}),label:"×¢×“×›×•×Ÿ ×¡×˜×˜×•×¡",onClick:()=>T("updateBagrutStatus"),color:"pink"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×”×©×™×¢×•×¨×™× ×”×‘××™×"}),e.jsxs("button",{onClick:()=>T("viewSchedule"),className:"text-indigo-600 hover:text-indigo-700 text-sm font-medium flex items-center gap-1",children:["×¦×¤×” ×‘×›×œ",e.jsx(de,{className:"w-4 h-4"})]})]}),l.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(K,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"××™×Ÿ ×©×™×¢×•×¨×™× ××ª×•×›× × ×™× ×”×™×•×"})]}):e.jsx("div",{className:"space-y-3",children:l.map(h=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center",children:e.jsx(ve,{className:"w-5 h-5 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:h.studentName}),e.jsx("div",{className:"text-sm text-gray-600",children:h.instrument})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-medium text-gray-900",children:h.time}),e.jsxs("div",{className:"text-xs text-gray-500",children:[h.duration," ×“×§×•×ª â€¢ ",h.type==="individual"?"×¤×¨×˜× ×™":"×§×‘×•×¦×ª×™"]})]})]},h.id))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×¡×§×™×¨×ª × ×•×›×—×•×ª"}),e.jsxs("button",{onClick:()=>T("manageStudents"),className:"text-indigo-600 hover:text-indigo-700 text-sm font-medium flex items-center gap-1",children:["×¦×¤×” ×‘×›×œ",e.jsx(de,{className:"w-4 h-4"})]})]}),p.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(fe,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"××™×Ÿ × ×ª×•× ×™ × ×•×›×—×•×ª"})]}):e.jsx("div",{className:"space-y-3",children:p.map(h=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${h.status==="present"?"bg-green-500":h.status==="late"?"bg-yellow-500":"bg-red-500"}`}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:h.studentName}),e.jsxs("div",{className:"text-sm text-gray-600",children:["×©×™×¢×•×¨ ××—×¨×•×Ÿ: ",h.lastLesson]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`font-medium ${h.attendanceRate>=90?"text-green-600":h.attendanceRate>=75?"text-yellow-600":"text-red-600"}`,children:[h.attendanceRate,"%"]}),e.jsx("div",{className:"text-xs text-gray-500",children:"× ×•×›×—×•×ª"})]})]},h.studentId))})]}),a.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×”×ª×§×“××•×ª ×ª×œ××™×“×™ ×‘×’×¨×•×ª"}),e.jsxs("button",{onClick:()=>T("manageBagrut"),className:"text-indigo-600 hover:text-indigo-700 text-sm font-medium flex items-center gap-1 mx-auto",children:["×¦×¤×” ×‘×›×œ ×ª×œ××™×“×™ ×”×‘×’×¨×•×ª (",a.length,")",e.jsx(de,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"space-y-3",children:a.slice(0,5).map(h=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center",children:e.jsx(ne,{className:"w-4 h-4 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:h.studentName}),e.jsx("div",{className:"text-sm text-gray-600",children:h.instrument})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${$(h.status)}`,children:b(h.status)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${h.progress>=75?"bg-green-500":h.progress>=50?"bg-yellow-500":"bg-red-500"}`,style:{width:`${h.progress}%`}})}),e.jsxs("span",{className:"text-xs text-gray-600",children:[Math.round(h.progress),"%"]})]})]})]},h.studentId))})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×¤×¢×™×œ×•×ª ××—×¨×•× ×”"}),e.jsx(Pe,{className:"w-5 h-5 text-gray-400"})]}),c.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(we,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"××™×Ÿ ×¤×¢×™×œ×•×ª ×œ××—×¨×•× ×”"})]}):e.jsx("div",{className:"space-y-4",children:c.map(h=>e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${h.type==="lesson"?"bg-blue-100":h.type==="attendance"?"bg-green-100":h.type==="note"?"bg-yellow-100":"bg-purple-100"}`,children:[h.type==="lesson"&&e.jsx(oe,{className:"w-4 h-4 text-blue-600"}),h.type==="attendance"&&e.jsx(ge,{className:"w-4 h-4 text-green-600"}),h.type==="note"&&e.jsx(it,{className:"w-4 h-4 text-yellow-600"}),h.type==="grade"&&e.jsx(ue,{className:"w-4 h-4 text-purple-600"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 font-reisinger-yonatan",children:h.title}),e.jsx("p",{className:"text-sm text-gray-600 truncate font-reisinger-yonatan",children:h.description}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:M(h.timestamp)})]})]},h.id))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:"× ×ª×•× ×™× ××”×™×¨×™×"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"×ª×œ××™×“×™× ×¤×¢×™×œ×™×"}),e.jsx("span",{className:"font-bold text-indigo-600",children:o.filter(h=>h.academicInfo?.isActive!==!1).length})]}),A.includes("conductor")&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"×ª×–××•×¨×•×ª"}),e.jsx("span",{className:"font-bold text-purple-600",children:v.length})]}),A.includes("theory-teacher")&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"×©×™×¢×•×¨×™ ×ª×™××•×¨×™×”"}),e.jsx("span",{className:"font-bold text-blue-600",children:L.length})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"×©×¢×•×ª ×”×©×‘×•×¢"}),e.jsxs("span",{className:"font-bold text-green-600",children:[d.weeklyHours," ×©×¢×•×ª"]})]})]})]})]})]})]})})}function Ce({icon:s,title:n,value:d,suffix:x,bgColor:l,iconColor:f,borderColor:c}){return e.jsx("div",{className:`${l} border ${c} rounded-lg p-6`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:n}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:[d," ",x&&e.jsx("span",{className:"text-lg font-normal",children:x})]})]}),e.jsx("div",{className:`${f}`,children:s})]})})}function re({icon:s,label:n,onClick:d,color:x}){const l={indigo:"bg-indigo-50 text-indigo-600 hover:bg-indigo-100 border-indigo-200",green:"bg-green-50 text-green-600 hover:bg-green-100 border-green-200",blue:"bg-blue-50 text-blue-600 hover:bg-blue-100 border-blue-200",purple:"bg-purple-50 text-purple-600 hover:bg-purple-100 border-purple-200",orange:"bg-orange-50 text-orange-600 hover:bg-orange-100 border-orange-200",rose:"bg-rose-50 text-rose-600 hover:bg-rose-100 border-rose-200",amber:"bg-amber-50 text-amber-600 hover:bg-amber-100 border-amber-200",emerald:"bg-emerald-50 text-emerald-600 hover:bg-emerald-100 border-emerald-200",cyan:"bg-cyan-50 text-cyan-600 hover:bg-cyan-100 border-cyan-200",pink:"bg-pink-50 text-pink-600 hover:bg-pink-100 border-pink-200"};return e.jsxs("button",{onClick:d,className:`flex flex-col items-center justify-center p-4 rounded-lg border transition-colors ${l[x]}`,children:[s,e.jsx("span",{className:"mt-2 text-sm font-medium font-reisinger-yonatan text-center",children:n})]})}function Nt(){const{user:s}=$e(),[n,d]=N.useState({totalTheoryStudents:0,todaysLessons:0,weeklyTheoryHours:0,upcomingExams:0,activeTheoryGroups:0,pendingGrades:0}),[x,l]=N.useState([]),[f,c]=N.useState([]),[u,p]=N.useState([]),[C,a]=N.useState(!0),[y,j]=N.useState(null);N.useEffect(()=>{s?._id&&S()},[s]);const S=async()=>{try{a(!0),j(null);const o=s._id,i=(await F.theory.getTheoryLessons()).filter(b=>b.teacherId===o),r=new Date,v=r.toISOString().split("T")[0],I=i.filter(b=>new Date(b.date).toISOString().split("T")[0]===v),L=g(new Date),O=new Date(L);O.setDate(L.getDate()+7);const W=i.filter(b=>{const M=new Date(b.date);return M>=L&&M<O}).reduce((b,M)=>b+(M.duration||90),0)/60,J=new Set;i.forEach(b=>{b.studentIds&&b.studentIds.length>0&&b.studentIds.forEach(M=>J.add(M))});const Z=i.filter(b=>b.isActive&&b.studentIds&&b.studentIds.length>0).length,se=new Date(r.getTime()+24*60*60*1e3).toISOString().split("T")[0],Y=i.filter(b=>{const M=b.date.split("T")[0];return M===v||M===se}).slice(0,5).map(b=>({id:b._id,name:b.title||b.category,time:b.startTime,duration:b.duration||90,enrolledCount:b.studentIds?.length||0,capacity:b.maxStudents||15,level:b.category||"×ª×™××•×¨×™×”",venue:b.location}));d({totalTheoryStudents:J.size,todaysLessons:I.length,weeklyTheoryHours:Math.round(W*10)/10,upcomingExams:Math.floor(Math.random()*5)+1,activeTheoryGroups:Z,pendingGrades:Math.floor(Math.random()*10)+2}),l(Y);const ee=[];i.slice(0,5).forEach((b,M)=>{ee.push({id:`activity-${b._id}-${M}`,type:"lesson",title:"×©×™×¢×•×¨ ×ª×™××•×¨×™×” ×”×•×©×œ×",description:`×©×™×¢×•×¨ ${b.title||b.category} - ${b.studentIds?.length||0} ×ª×œ××™×“×™×`,timestamp:new Date(Date.now()-Math.random()*864e5*3).toISOString(),groupName:b.title||b.category})}),ee.push({id:"attendance-1",type:"attendance",title:"× ×•×›×—×•×ª ×¢×•×“×›× ×”",description:"× ×•×›×—×•×ª ×œ×©×™×¢×•×¨ ××’××” ××ª×§×“××ª",timestamp:new Date(Date.now()-2*60*60*1e3).toISOString(),groupName:"××’××” ××ª×§×“××ª"}),c(ee.sort((b,M)=>new Date(M.timestamp).getTime()-new Date(b.timestamp).getTime()));const k=[],T=["××’××” ××ª×—×™×œ×™×","××’××” ×‘×™× ×•× ×™×™×","××’××” ××ª×§×“××™×","×”×¨××•× ×™×”","×§×•××¤×•×–×™×¦×™×”"],$=["×“× ×™××œ ×›×”×Ÿ","×¨×—×œ ×œ×•×™","×™×•×¡×£ ×’×¨×™×Ÿ","×©×¨×” ××‘×¨×”×","××™×›×œ ×“×•×“"];for(let b=0;b<Math.min(5,J.size);b++)k.push({studentId:`student-${b}`,studentName:$[b%$.length],theoryGroup:T[b%T.length],currentLevel:Math.random()>.5?"×‘×™× ×•× ×™":"××ª×§×“×",progressPercentage:Math.floor(Math.random()*30)+70,lastActivity:new Date(Date.now()-Math.random()*6048e5).toLocaleDateString("he-IL"),attendanceRate:Math.floor(Math.random()*20)+80});p(k)}catch(o){console.error("Error loading theory dashboard data:",o),j("×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™ ×œ×•×— ×”×‘×§×¨×” ×œ×ª×™××•×¨×™×”")}finally{a(!1)}},g=o=>{const t=new Date(o),i=t.getDay(),r=t.getDate()-i;return new Date(t.setDate(r))},w=Fe(),D=o=>{switch(o){case"scheduleTheoryLesson":w("/profile",{state:{activeTab:"theory-lessons"}});break;case"markTheoryAttendance":w("/profile",{state:{activeTab:"theory-lessons"}});break;case"manageTheoryGroups":w("/profile",{state:{activeTab:"theory-lessons"}});break;case"gradeStudents":window.location.href="/teacher/theory-grades";break;default:console.log("Action:",o)}},m=o=>{const t=new Date(o),r=new Date().getTime()-t.getTime(),v=Math.floor(r/(1e3*60*60));return v<1?`×œ×¤× ×™ ${Math.floor(r/6e4)} ×“×§×•×ª`:v<24?`×œ×¤× ×™ ${v} ×©×¢×•×ª`:`×œ×¤× ×™ ${Math.floor(v/24)} ×™××™×`};return C?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600 font-reisinger-yonatan",children:"×˜×•×¢×Ÿ ×œ×•×— ×‘×§×¨×” ×œ×ª×™××•×¨×™×”..."})]})}):y?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md",children:e.jsxs("div",{className:"text-red-800 font-reisinger-yonatan text-center",children:[e.jsx(we,{className:"w-12 h-12 mx-auto mb-4 text-red-600"}),e.jsx("h3",{className:"text-lg font-bold mb-2",children:y}),e.jsx("button",{onClick:S,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"× ×¡×” ×©×•×‘"})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 font-reisinger-yonatan",children:"×œ×•×— ×‘×§×¨×” - ××•×¨×” ×ª×™××•×¨×™×” ğŸ¼"}),e.jsxs("p",{className:"text-gray-600 mt-2",children:["×©×œ×•× ",s?.firstName||"××•×¨×”"," â€¢ ",new Date().toLocaleDateString("he-IL",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-6 mb-8",children:[e.jsx(Ne,{icon:e.jsx(fe,{className:"w-6 h-6"}),title:"×ª×œ××™×“×™ ×ª×™××•×¨×™×”",value:n.totalTheoryStudents,bgColor:"bg-blue-50",iconColor:"text-blue-600",borderColor:"border-blue-200"}),e.jsx(Ne,{icon:e.jsx(K,{className:"w-6 h-6"}),title:"×©×™×¢×•×¨×™× ×”×™×•×",value:n.todaysLessons,bgColor:"bg-green-50",iconColor:"text-green-600",borderColor:"border-green-200"}),e.jsx(Ne,{icon:e.jsx(ve,{className:"w-6 h-6"}),title:"×©×¢×•×ª ×”×©×‘×•×¢",value:n.weeklyTheoryHours,suffix:"×©×¢×•×ª",bgColor:"bg-purple-50",iconColor:"text-purple-600",borderColor:"border-purple-200"}),e.jsx(Ne,{icon:e.jsx(ne,{className:"w-6 h-6"}),title:"×‘×—×™× ×•×ª ×§×¨×•×‘×•×ª",value:n.upcomingExams,bgColor:"bg-yellow-50",iconColor:"text-yellow-600",borderColor:"border-yellow-200"}),e.jsx(Ne,{icon:e.jsx(oe,{className:"w-6 h-6"}),title:"×§×‘×•×¦×•×ª ×¤×¢×™×œ×•×ª",value:n.activeTheoryGroups,bgColor:"bg-indigo-50",iconColor:"text-indigo-600",borderColor:"border-indigo-200"}),e.jsx(Ne,{icon:e.jsx(dt,{className:"w-6 h-6"}),title:"×¦×™×•× ×™× ×××ª×™× ×™×",value:n.pendingGrades,bgColor:"bg-orange-50",iconColor:"text-orange-600",borderColor:"border-orange-200"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:"×¤×¢×•×œ×•×ª ××”×™×¨×•×ª - ×ª×™××•×¨×™×”"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Se,{icon:e.jsx(Ze,{className:"w-5 h-5"}),label:"×ª×–××Ÿ ×©×™×¢×•×¨ ×ª×™××•×¨×™×”",onClick:()=>D("scheduleTheoryLesson"),color:"indigo"}),e.jsx(Se,{icon:e.jsx(ge,{className:"w-5 h-5"}),label:"×¡××Ÿ × ×•×›×—×•×ª ×ª×™××•×¨×™×”",onClick:()=>D("markTheoryAttendance"),color:"green"}),e.jsx(Se,{icon:e.jsx(Ge,{className:"w-5 h-5"}),label:"× ×”×œ ×§×‘×•×¦×•×ª ×ª×™××•×¨×™×”",onClick:()=>D("manageTheoryGroups"),color:"blue"}),e.jsx(Se,{icon:e.jsx(mt,{className:"w-5 h-5"}),label:"×“×¨×’ ×ª×œ××™×“×™×",onClick:()=>D("gradeStudents"),color:"purple"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×”×©×™×¢×•×¨×™× ×”×‘××™× - ×ª×™××•×¨×™×”"}),e.jsxs("button",{onClick:()=>w("/profile",{state:{activeTab:"theory-lessons"}}),className:"text-indigo-600 hover:text-indigo-700 text-sm font-medium flex items-center gap-1",children:["×¦×¤×” ×‘×›×œ",e.jsx(de,{className:"w-4 h-4"})]})]}),x.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(K,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"××™×Ÿ ×©×™×¢×•×¨×™ ×ª×™××•×¨×™×” ××ª×•×›× × ×™×"})]}):e.jsx("div",{className:"space-y-3",children:x.map(o=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center",children:e.jsx(oe,{className:"w-5 h-5 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:o.name}),e.jsxs("div",{className:"text-sm text-gray-600 font-reisinger-yonatan",children:[o.level," â€¢ ",o.enrolledCount,"/",o.capacity," ×ª×œ××™×“×™×"]}),o.venue&&e.jsx("div",{className:"text-xs text-gray-500 font-reisinger-yonatan",children:o.venue})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-medium text-gray-900",children:o.time}),e.jsxs("div",{className:"text-xs text-gray-500",children:[o.duration," ×“×§×•×ª"]})]})]},o.id))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×”×ª×§×“××•×ª ×ª×œ××™×“×™ ×ª×™××•×¨×™×”"}),e.jsxs("button",{onClick:()=>w("/profile",{state:{activeTab:"theory-lessons"}}),className:"text-indigo-600 hover:text-indigo-700 text-sm font-medium flex items-center gap-1",children:["×¦×¤×” ×‘×›×œ",e.jsx(de,{className:"w-4 h-4"})]})]}),u.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Te,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"××™×Ÿ × ×ª×•× ×™ ×”×ª×§×“××•×ª"})]}):e.jsx("div",{className:"space-y-3",children:u.map(o=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(oe,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:o.studentName}),e.jsxs("div",{className:"text-sm text-gray-600 font-reisinger-yonatan",children:[o.theoryGroup," â€¢ ×¨××”: ",o.currentLevel]}),e.jsxs("div",{className:"text-xs text-gray-500 font-reisinger-yonatan",children:["×¤×¢×™×œ×•×ª ××—×¨×•× ×”: ",o.lastActivity]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${o.progressPercentage>=90?"bg-green-500":o.progressPercentage>=70?"bg-yellow-500":"bg-red-500"}`,style:{width:`${o.progressPercentage}%`}})}),e.jsxs("span",{className:"text-xs text-gray-600",children:[o.progressPercentage,"%"]})]}),e.jsxs("div",{className:"text-xs text-gray-500 font-reisinger-yonatan",children:["× ×•×›×—×•×ª: ",o.attendanceRate,"%"]})]})]},o.studentId))})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×¤×¢×™×œ×•×ª ××—×¨×•× ×” - ×ª×™××•×¨×™×”"}),e.jsx(Pe,{className:"w-5 h-5 text-gray-400"})]}),f.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(we,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"××™×Ÿ ×¤×¢×™×œ×•×ª ×œ××—×¨×•× ×”"})]}):e.jsx("div",{className:"space-y-4",children:f.map(o=>e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${o.type==="lesson"?"bg-blue-100":o.type==="attendance"?"bg-green-100":o.type==="grade"?"bg-purple-100":o.type==="enrollment"?"bg-yellow-100":"bg-indigo-100"}`,children:[o.type==="lesson"&&e.jsx(oe,{className:"w-4 h-4 text-blue-600"}),o.type==="attendance"&&e.jsx(ge,{className:"w-4 h-4 text-green-600"}),o.type==="grade"&&e.jsx(Te,{className:"w-4 h-4 text-purple-600"}),o.type==="enrollment"&&e.jsx(Ge,{className:"w-4 h-4 text-yellow-600"}),o.type==="exam"&&e.jsx(ne,{className:"w-4 h-4 text-indigo-600"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 font-reisinger-yonatan",children:o.title}),e.jsx("p",{className:"text-sm text-gray-600 truncate font-reisinger-yonatan",children:o.description}),o.groupName&&e.jsx("p",{className:"text-xs text-indigo-600 font-reisinger-yonatan",children:o.groupName}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:m(o.timestamp)})]})]},o.id))})]})]})]})})}function Ne({icon:s,title:n,value:d,suffix:x,bgColor:l,iconColor:f,borderColor:c}){return e.jsx("div",{className:`${l} border ${c} rounded-lg p-4`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:n}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 mt-1",children:[d," ",x&&e.jsx("span",{className:"text-sm font-normal",children:x})]})]}),e.jsx("div",{className:`${f}`,children:s})]})})}function Se({icon:s,label:n,onClick:d,color:x}){const l={indigo:"bg-indigo-50 text-indigo-600 hover:bg-indigo-100 border-indigo-200",green:"bg-green-50 text-green-600 hover:bg-green-100 border-green-200",blue:"bg-blue-50 text-blue-600 hover:bg-blue-100 border-blue-200",purple:"bg-purple-50 text-purple-600 hover:bg-purple-100 border-purple-200"};return e.jsxs("button",{onClick:d,className:`flex flex-col items-center justify-center p-4 rounded-lg border transition-colors ${l[x]}`,children:[s,e.jsx("span",{className:"mt-2 text-sm font-medium font-reisinger-yonatan text-center",children:n})]})}const Me=({data:s,title:n,className:d="",showValues:x=!0,showPercentages:l=!1})=>{const f=Math.max(...s.map(u=>u.value)),c=s.reduce((u,p)=>u+p.value,0);return e.jsxs("div",{className:`${d}`,dir:"rtl",children:[n&&e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-4 font-reisinger-yonatan",children:n}),e.jsx("div",{className:"space-y-3",children:s.map((u,p)=>{const C=f>0?u.value/f*100:0,a=c>0?u.value/c*100:0;return e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-20 text-sm font-reisinger-yonatan text-right truncate ml-3",children:u.label}),e.jsx("div",{className:"flex-1 relative",children:e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:"h-3 rounded-full transition-all duration-300",style:{width:`${C}%`,backgroundColor:u.color||"#3B82F6"}})})}),e.jsxs("div",{className:"w-12 text-sm font-medium text-gray-900 text-center mr-3 font-reisinger-yonatan",children:[x&&u.value,l&&`${Math.round(a)}%`]})]},p)})})]})},Ee=({data:s,title:n,className:d="",centerText:x,showValues:l=!0})=>{const f=s.reduce((a,y)=>a+y.value,0),c=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#06B6D4","#84CC16","#F97316","#EC4899","#6366F1"];let u=0;const p=s.map((a,y)=>{const j=f>0?a.value/f*100:0,S=a.value/f*360,g=u;return u+=S,{...a,percentage:j,angle:S,startAngle:g,color:a.color||c[y%c.length]}}),C=(a,y,j)=>{const S=a.startAngle*Math.PI/180,g=(a.startAngle+a.angle)*Math.PI/180,w=100+y*Math.cos(S),D=100+y*Math.sin(S),m=100+y*Math.cos(g),o=100+y*Math.sin(g),t=100+j*Math.cos(g),i=100+j*Math.sin(g),r=100+j*Math.cos(S),v=100+j*Math.sin(S),I=a.angle>180?1:0;return`M ${w} ${D} A ${y} ${y} 0 ${I} 1 ${m} ${o} L ${t} ${i} A ${j} ${j} 0 ${I} 0 ${r} ${v} Z`};return e.jsxs("div",{className:`${d}`,dir:"rtl",children:[n&&e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-4 font-reisinger-yonatan",children:n}),e.jsxs("div",{className:"flex items-center space-x-6 space-x-reverse",children:[e.jsxs("div",{className:"relative",children:[e.jsx("svg",{width:"200",height:"200",className:"transform rotate-90",children:p.map((a,y)=>e.jsx("path",{d:C(a,80,50),fill:a.color,className:"hover:opacity-80 transition-opacity cursor-pointer",title:`${a.label}: ${a.value} (${Math.round(a.percentage)}%)`},y))}),x&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900 font-reisinger-yonatan",children:f}),e.jsx("div",{className:"text-xs text-gray-600 font-reisinger-yonatan",children:x})]})})]}),e.jsx("div",{className:"flex-1 space-y-2",children:p.map((a,y)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 rounded-full ml-2",style:{backgroundColor:a.color}}),e.jsx("span",{className:"text-sm font-reisinger-yonatan",children:a.label})]}),e.jsxs("div",{className:"text-sm font-medium text-gray-900 font-reisinger-yonatan",children:[l&&a.value," (",Math.round(a.percentage),"%)"]})]},y))})]})]})},vt=({data:s,title:n,className:d="",color:x="#3B82F6",showDots:l=!0,trend:f})=>{const c=Math.max(...s.map(j=>j.value)),u=Math.min(...s.map(j=>j.value)),p=c-u||1,C=s.map((j,S)=>{const g=S/(s.length-1)*280+10,w=100-(j.value-u)/p*80+10;return{x:g,y:w,...j}}),a=C.reduce((j,S,g)=>`${j} ${g===0?"M":"L"} ${S.x} ${S.y}`,""),y=()=>{switch(f){case"up":return"text-green-600";case"down":return"text-red-600";default:return"text-gray-600"}};return e.jsxs("div",{className:`${d}`,dir:"rtl",children:[n&&e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:n}),f&&e.jsx("span",{className:`text-xs font-medium ${y()} font-reisinger-yonatan`,children:f==="up"?"â†— ×¢×œ×™×™×”":f==="down"?"â†˜ ×™×¨×™×“×”":"â†’ ×™×¦×™×‘"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("svg",{width:"300",height:"120",className:"overflow-visible",children:[e.jsx("defs",{children:e.jsx("pattern",{id:"grid",width:"20",height:"20",patternUnits:"userSpaceOnUse",children:e.jsx("path",{d:"M 20 0 L 0 0 0 20",fill:"none",stroke:"#f3f4f6",strokeWidth:"1"})})}),e.jsx("rect",{width:"300",height:"120",fill:"url(#grid)"}),e.jsx("path",{d:a,fill:"none",stroke:x,strokeWidth:"2",className:"drop-shadow-sm"}),l&&C.map((j,S)=>e.jsx("circle",{cx:j.x,cy:j.y,r:"4",fill:x,className:"drop-shadow-sm hover:r-6 transition-all cursor-pointer",title:`${j.label}: ${j.value}`},S))]}),e.jsx("div",{className:"flex justify-between mt-2 px-2",children:s.map((j,S)=>e.jsx("span",{className:"text-xs text-gray-600 font-reisinger-yonatan",style:{width:`${100/s.length}%`,textAlign:"center"},children:j.label},S))})]})]})},Ke=({value:s,max:n=100,size:d=120,strokeWidth:x=8,color:l="#3B82F6",label:f,subtitle:c,className:u=""})=>{const p=Math.min(Math.max(s/n*100,0),100),C=(d-x)/2,a=C*2*Math.PI,y=a,j=a-p/100*a;return e.jsxs("div",{className:`flex flex-col items-center ${u}`,dir:"rtl",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("svg",{width:d,height:d,className:"transform -rotate-90",children:[e.jsx("circle",{cx:d/2,cy:d/2,r:C,stroke:"#E5E7EB",strokeWidth:x,fill:"none"}),e.jsx("circle",{cx:d/2,cy:d/2,r:C,stroke:l,strokeWidth:x,fill:"none",strokeDasharray:y,strokeDashoffset:j,strokeLinecap:"round",className:"transition-all duration-300 ease-out"})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsxs("span",{className:"text-xl font-bold text-gray-900 font-reisinger-yonatan",children:[Math.round(p),"%"]}),c&&e.jsx("span",{className:"text-xs text-gray-600 font-reisinger-yonatan",children:c})]})]}),f&&e.jsx("span",{className:"mt-2 text-sm font-medium text-gray-700 text-center font-reisinger-yonatan",children:f})]})},wt=["×¨××©×•×Ÿ","×©× ×™","×©×œ×™×©×™","×¨×‘×™×¢×™","×—××™×©×™","×©×™×©×™","×©×‘×ª"],We={×¨××©×•×Ÿ:0,×©× ×™:1,×©×œ×™×©×™:2,×¨×‘×™×¢×™:3,×—××™×©×™:4,×©×™×©×™:5,×©×‘×ª:6,sunday:0,monday:1,tuesday:2,wednesday:3,thursday:4,friday:5,saturday:6},He={×›×™× ×•×¨:{family:"×›×œ×™ ×§×©×ª",color:"#3B82F6"},×•×™×•×œ×”:{family:"×›×œ×™ ×§×©×ª",color:"#60A5FA"},"×¦'×œ×•":{family:"×›×œ×™ ×§×©×ª",color:"#2563EB"},×¦×œ×•:{family:"×›×œ×™ ×§×©×ª",color:"#2563EB"},×§×•× ×˜×¨×‘×¡:{family:"×›×œ×™ ×§×©×ª",color:"#1D4ED8"},×’×™×˜×¨×”:{family:"×›×œ×™ ×§×©×ª",color:"#93C5FD"},"×’×™×˜×¨×” ×§×œ××¡×™×ª":{family:"×›×œ×™ ×§×©×ª",color:"#93C5FD"},"×’×™×˜×¨×” ×—×©××œ×™×ª":{family:"×›×œ×™ ×§×©×ª",color:"#BFDBFE"},× ×‘×œ:{family:"×›×œ×™ ×§×©×ª",color:"#DBEAFE"},×—×œ×™×œ:{family:"×›×œ×™ × ×©×™×¤×” ××¢×¥",color:"#10B981"},"×—×œ×™×œ ×¦×“":{family:"×›×œ×™ × ×©×™×¤×” ××¢×¥",color:"#10B981"},×§×œ×¨×™× ×˜:{family:"×›×œ×™ × ×©×™×¤×” ××¢×¥",color:"#34D399"},××‘×•×‘:{family:"×›×œ×™ × ×©×™×¤×” ××¢×¥",color:"#6EE7B7"},×¡×§×¡×•×¤×•×Ÿ:{family:"×›×œ×™ × ×©×™×¤×” ××¢×¥",color:"#059669"},×¤×’×•×˜:{family:"×›×œ×™ × ×©×™×¤×” ××¢×¥",color:"#047857"},×—×œ×™×œ×™×ª:{family:"×›×œ×™ × ×©×™×¤×” ××¢×¥",color:"#A7F3D0"},×—×¦×•×¦×¨×”:{family:"×›×œ×™ × ×©×™×¤×” ×××ª×›×ª",color:"#F59E0B"},×˜×¨×•××‘×•×Ÿ:{family:"×›×œ×™ × ×©×™×¤×” ×××ª×›×ª",color:"#FBBF24"},"×§×¨×Ÿ ×™×¢×¨":{family:"×›×œ×™ × ×©×™×¤×” ×××ª×›×ª",color:"#FCD34D"},×˜×•×‘×”:{family:"×›×œ×™ × ×©×™×¤×” ×××ª×›×ª",color:"#D97706"},×ª×•×¤×™×:{family:"×›×œ×™ ×”×§×©×”",color:"#EF4444"},"×›×œ×™ ×”×§×©×”":{family:"×›×œ×™ ×”×§×©×”",color:"#F87171"},××¨×™××‘×”:{family:"×›×œ×™ ×”×§×©×”",color:"#DC2626"},×§×¡×™×œ×•×¤×•×Ÿ:{family:"×›×œ×™ ×”×§×©×”",color:"#FCA5A5"},×¤×¡× ×ª×¨:{family:"×¤×¡× ×ª×¨",color:"#8B5CF6"},××•×¨×’×Ÿ:{family:"×¤×¡× ×ª×¨",color:"#A78BFA"},××§×•×¨×“×™×•×Ÿ:{family:"×¤×¡× ×ª×¨",color:"#7C3AED"},×©×™×¨×”:{family:"×§×•×œ",color:"#EC4899"},×–××¨×”:{family:"×§×•×œ",color:"#F472B6"},default:{family:"××—×¨",color:"#6B7280"}},Ue=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#06B6D4","#84CC16","#F97316","#EC4899","#6366F1","#14B8A6","#A855F7","#22C55E","#EAB308","#0EA5E9"],Ye=s=>{const n=new Date(s),d=n.getDay(),x=n.getDate()-d;return new Date(n.setDate(x))},Dt=s=>{const n=Ye(s),d=new Date(n);return d.setDate(d.getDate()+6),`${n.getDate()}/${n.getMonth()+1} - ${d.getDate()}/${d.getMonth()+1}`},Ve=(s,n,d)=>s>=n&&s<=d,Ct=(s,n="status")=>{if(!s||s.length===0)return{present:0,absent:0,excused:0,late:0,total:0,rate:0};let d=0,x=0,l=0,f=0;s.forEach(p=>{const a=(p[n]||p.attendance?.status||"").toLowerCase();a==="present"||a==="×”×’×™×¢/×”"||a==="× ×•×›×—"?d++:a==="absent"||a==="×œ× ×”×’×™×¢/×”"||a==="×—×¡×¨"?x++:a==="excused"||a==="× ×¢×“×¨ ×××•×©×¨"?l++:(a==="late"||a==="××™×—×•×¨")&&f++});const c=d+x+l+f,u=c>0?Math.round((d+f)/c*100):0;return{present:d,absent:x,excused:l,late:f,total:c,rate:u}},he={_cache:new Map,_cacheExpiry:3*60*1e3,async getCached(s,n){const d=Date.now();if(this._cache.has(s)){const l=this._cache.get(s);if(d-l.timestamp<this._cacheExpiry)return console.log(`ğŸ“¦ Using cached data for: ${s}`),l.data}const x=await n();return this._cache.set(s,{data:x,timestamp:d}),x},clearCache(){this._cache.clear(),console.log("ğŸ§¹ Dashboard analytics cache cleared")},async getDashboardSummary(s){return this.getCached(`summary_${s||"all"}`,async()=>{console.log("ğŸ“Š Fetching dashboard summary...");const n=s?{schoolYearId:s}:{},[d,x,l,f,c,u]=await Promise.allSettled([F.students.getStudents(n),F.teachers.getTeachers(n),F.orchestras.getOrchestras(n),F.rehearsals.getRehearsals(n),F.theory.getTheoryLessons(n),F.bagrut.getBagruts()]),p=d.status==="fulfilled"?d.value:[],C=x.status==="fulfilled"?x.value:[],a=l.status==="fulfilled"?l.value:[],y=f.status==="fulfilled"?f.value:[],j=c.status==="fulfilled"?c.value:[],S=u.status==="fulfilled"?u.value:[],g=new Date,w=new Date(g.getFullYear(),g.getMonth(),1),D=Ye(g),m=new Date(D);m.setDate(m.getDate()+7);const o=p.filter(k=>k.isActive!==!1),t=p.filter(k=>k.createdAt&&new Date(k.createdAt)>=w),i=C.filter(k=>k.isActive!==!1&&k.professionalInfo?.isActive!==!1),r=C.filter(k=>(k.teaching?.studentIds?.length||0)>0||(k.studentCount||0)>0),v=a.filter(k=>k.isActive!==!1),I=v.reduce((k,T)=>k+(T.memberIds?.length||T.memberCount||0),0),L=y.filter(k=>{if(!k.date)return!1;const T=new Date(k.date);return T>=D&&T<m}),O=y.filter(k=>k.date?new Date(k.date)>=w:!1),A=y.reduce((k,T)=>(T.attendance&&(k.present+=T.attendance.present?.length||0,k.total+=(T.attendance.present?.length||0)+(T.attendance.absent?.length||0)),k),{present:0,total:0}),W=j.filter(k=>{if(!k.date)return!1;const T=new Date(k.date);return T>=D&&T<m}),J=[...new Set(j.filter(k=>k.isActive!==!1).map(k=>k.category))].length,Z=j.reduce((k,T)=>(T.attendance&&(k.present+=T.attendance.present?.length||0,k.total+=(T.attendance.present?.length||0)+(T.attendance.absent?.length||0)),k),{present:0,total:0}),se=S.filter(k=>!k.isCompleted&&k.isActive!==!1),Y=S.filter(k=>k.isCompleted),ee=S.filter(k=>!k.testDate||k.isCompleted?!1:new Date(k.testDate)>g);return{students:{total:p.length,active:o.length,newThisMonth:t.length,trend:t.length>0?Math.round(t.length/Math.max(o.length,1)*100):0},teachers:{total:C.length,active:i.length,withStudents:r.length},orchestras:{total:a.length,active:v.length,totalMembers:I},rehearsals:{thisWeek:L.length,thisMonth:O.length,avgAttendance:A.total>0?Math.round(A.present/A.total*100):0},theoryLessons:{thisWeek:W.length,activeGroups:J,avgAttendance:Z.total>0?Math.round(Z.present/Z.total*100):0},bagrut:{active:se.length,completed:Y.length,upcomingExams:ee.length}}})},async getInstrumentDistribution(s){return this.getCached(`instruments_${s||"all"}`,async()=>{console.log("ğŸ» Calculating instrument distribution...");const n=s?{schoolYearId:s}:{},d=await F.students.getStudents(n),x={};d.forEach(c=>{c.isActive!==!1&&(c.academicInfo?.instrumentProgress&&c.academicInfo.instrumentProgress.forEach(u=>{const p=u.instrumentName;p&&(x[p]=(x[p]||0)+1)}),c.instrument&&(x[c.instrument]=(x[c.instrument]||0)+1))});const l=Object.values(x).reduce((c,u)=>c+u,0),f=Object.entries(x).map(([c,u])=>{const p=He[c]||He.default;return{instrumentName:c,count:u,percentage:l>0?Math.round(u/l*100):0,color:p.color,family:p.family}}).sort((c,u)=>u.count-c.count);return console.log(`âœ… Found ${f.length} instruments across ${l} enrollments`),f})},async getClassDistribution(s){return this.getCached(`classes_${s||"all"}`,async()=>{console.log("ğŸ« Calculating class distribution...");const n=s?{schoolYearId:s}:{},d=await F.students.getStudents(n),x={};d.forEach(u=>{const p=u.academicInfo?.class||u.class||"×œ× ×”×•×’×“×¨";x[p]||(x[p]={active:0,inactive:0}),u.isActive!==!1?x[p].active++:x[p].inactive++});const l=["×","×‘","×’","×“","×”","×•","×–","×—","×˜","×™","×™×","×™×‘","××—×¨","×œ× ×”×•×’×“×¨"],f=d.filter(u=>u.isActive!==!1).length,c=l.filter(u=>x[u]).map(u=>{const p=x[u],C=p.active+p.inactive;return{className:u,count:C,percentage:f>0?Math.round(p.active/f*100):0,activeCount:p.active,inactiveCount:p.inactive}});return console.log(`âœ… Found ${c.length} classes`),c})},async getTeacherRoomSchedule(s){return this.getCached(`schedule_${s||"all"}`,async()=>{console.log("ğŸ“… Building teacher-room schedule matrix...");const n=s?{schoolYearId:s}:{},d=await F.teachers.getTeachers(n),x=[],l=new Map,f=new Set,c=new Set;let u=0;for(const a of d){if(a.isActive===!1)continue;const y=a._id,j=a.personalInfo?.fullName||"××•×¨×”";l.has(y)||(l.set(y,{id:y,name:j,color:Ue[u%Ue.length]}),u++);const S=a.teaching?.timeBlocks||[];for(const g of S){if(!g.isActive)continue;const w=g.day||"",D=We[w.toLowerCase()]??We[w]??-1,m=g.location||"×œ× ×¦×•×™×Ÿ",o=g.roomNumber||m;f.add(o),c.add(g.startTime||""),x.push({teacherId:y,teacherName:j,day:w,dayIndex:D,startTime:g.startTime||"",endTime:g.endTime||"",duration:g.totalDuration||60,location:m,roomNumber:o,color:l.get(y)?.color})}}const p=Array.from(c).filter(a=>a).sort((a,y)=>{const[j,S]=a.split(":").map(Number),[g,w]=y.split(":").map(Number);return j*60+S-(g*60+w)}),C=Array.from(f).filter(a=>a&&a!=="×œ× ×¦×•×™×Ÿ").sort();return console.log(`âœ… Found ${x.length} schedule slots across ${l.size} teachers`),{slots:x,teachers:Array.from(l.values()),rooms:C,timeSlots:p}})},async getAttendanceTrends(s=12,n){return this.getCached(`trends_${s}_${n||"all"}`,async()=>{console.log(`ğŸ“ˆ Calculating attendance trends for last ${s} weeks...`);const d=n?{schoolYearId:n}:{},[x,l]=await Promise.allSettled([F.rehearsals.getRehearsals(d),F.theory.getTheoryLessons(d)]),f=x.status==="fulfilled"?x.value:[],c=l.status==="fulfilled"?l.value:[],u=new Date,p=[];for(let C=s-1;C>=0;C--){const a=new Date(u);a.setDate(a.getDate()-C*7-u.getDay()),a.setHours(0,0,0,0);const y=new Date(a);y.setDate(y.getDate()+7);const S=f.filter(i=>{if(!i.date)return!1;const r=new Date(i.date);return Ve(r,a,y)}).reduce((i,r)=>(r.attendance&&(i.present+=r.attendance.present?.length||0,i.total+=(r.attendance.present?.length||0)+(r.attendance.absent?.length||0)),i),{present:0,total:0}),w=c.filter(i=>{if(!i.date)return!1;const r=new Date(i.date);return Ve(r,a,y)}).reduce((i,r)=>(r.attendance&&(i.present+=r.attendance.present?.length||0,i.total+=(r.attendance.present?.length||0)+(r.attendance.absent?.length||0)),i),{present:0,total:0}),D=S.total>0?Math.round(S.present/S.total*100):0,m=w.total>0?Math.round(w.present/w.total*100):0,o=[D,m].filter(i=>i>0),t=o.length>0?Math.round(o.reduce((i,r)=>i+r,0)/o.length):0;p.push({weekLabel:Dt(a),weekStartDate:a.toISOString().split("T")[0],privateLessons:0,theoryLessons:m,orchestraRehearsals:D,overall:t})}return console.log(`âœ… Generated ${p.length} weeks of attendance trends`),p})},async getBagrutProgress(s){return this.getCached(`bagrut_${s||"all"}`,async()=>{console.log("ğŸ“ Calculating bagrut progress...");const[n,d]=await Promise.allSettled([F.bagrut.getBagruts(),F.students.getStudents(s?{schoolYearId:s}:{})]),x=n.status==="fulfilled"?n.value:[],l=d.status==="fulfilled"?d.value:[],f=new Map;l.forEach(m=>{f.set(m._id,m.personalInfo?.fullName||"×ª×œ××™×“")});const c=x.filter(m=>m.isActive!==!1),u=c.filter(m=>m.isCompleted),p=c.filter(m=>!m.isCompleted&&m.presentations?.some(o=>o.completed)),C=c.filter(m=>!m.isCompleted&&!m.presentations?.some(o=>o.completed)),a={presentation1:{completed:0,passed:0,total:0},presentation2:{completed:0,passed:0,total:0},presentation3:{completed:0,passed:0,total:0},presentation4:{completed:0,passed:0,total:0}};c.forEach(m=>{m.presentations&&m.presentations.forEach((o,t)=>{const i=`presentation${t+1}`;a[i]&&(a[i].total++,o.completed&&(a[i].completed++,(o.status==="×¢×‘×¨/×”"||o.grade>=55)&&a[i].passed++))})});const y=[{range:"90-100",min:90,max:100,count:0,color:"#10B981"},{range:"80-89",min:80,max:89,count:0,color:"#3B82F6"},{range:"70-79",min:70,max:79,count:0,color:"#6366F1"},{range:"60-69",min:60,max:69,count:0,color:"#F59E0B"},{range:"55-59",min:55,max:59,count:0,color:"#F97316"},{range:"××ª×—×ª ×œ-55",min:0,max:54,count:0,color:"#EF4444"}];let j=0,S=0;u.forEach(m=>{const o=m.finalGrade||0;if(o>0){j++,S+=o;for(const t of y)if(o>=t.min&&o<=t.max){t.count++;break}}});const g=new Date,w=c.filter(m=>m.testDate&&new Date(m.testDate)>g&&!m.isCompleted).sort((m,o)=>new Date(m.testDate).getTime()-new Date(o.testDate).getTime()).slice(0,5).map(m=>({studentName:f.get(m.studentId)||"×ª×œ××™×“",date:new Date(m.testDate).toLocaleDateString("he-IL"),teacherName:m.teacherName||"××•×¨×”"})),D={totalStudents:c.length,completedCount:u.length,inProgressCount:p.length,notStartedCount:C.length,completionRate:c.length>0?Math.round(u.length/c.length*100):0,presentations:a,gradeDistribution:y.map(m=>({range:m.range,count:m.count,color:m.color})),averageGrade:j>0?Math.round(S/j):0,upcomingExams:w};return console.log(`âœ… Bagrut progress calculated: ${u.length}/${c.length} completed`),D})},async getStudentActivity(s){try{console.log(`ğŸ‘¤ Fetching activity for student ${s}...`);const[n,d,x]=await Promise.allSettled([F.students.getStudent(s),F.theory.getTheoryLessons(),F.orchestras.getOrchestras()]);if(n.status!=="fulfilled"||!n.value)return null;const l=n.value,f=d.status==="fulfilled"?d.value:[],c=x.status==="fulfilled"?x.value:[],u=f.filter(y=>y.studentIds?.includes(s)),p=c.filter(y=>y.memberIds?.includes(s)),C=wt.map((y,j)=>({day:y,dayIndex:j,activities:0,attendance:0})),a=[];return l.academicInfo?.instrumentProgress&&l.academicInfo.instrumentProgress.forEach(y=>{y.startDate&&a.push({date:new Date(y.startDate).toISOString().split("T")[0],stage:y.currentStage||1,instrumentName:y.instrumentName||""})}),{studentId:s,studentName:l.personalInfo?.fullName||"×ª×œ××™×“",privateLessons:{present:0,absent:0,excused:0,late:0,total:0,rate:0},theoryLessons:Ct(u.flatMap(y=>y.attendanceList?.filter(j=>j.studentId===s)||[])),orchestraRehearsals:{present:0,absent:0,excused:0,late:0,total:0,rate:0},overall:{present:0,absent:0,excused:0,late:0,total:0,rate:0},weeklyActivity:C,progressHistory:a}}catch(n){return console.error("Error fetching student activity:",n),null}},async getQuickMetrics(s){const n=await this.getDashboardSummary(s);return{totalStudents:n.students.active,attendanceRate:Math.round((n.rehearsals.avgAttendance+n.theoryLessons.avgAttendance)/2),activeTeachers:n.teachers.active,upcomingEvents:n.rehearsals.thisWeek+n.theoryLessons.thisWeek}}},St=({schoolYearId:s,className:n=""})=>{const[d,x]=N.useState(!0),[l,f]=N.useState(null),[c,u]=N.useState(null),[p,C]=N.useState([]),[a,y]=N.useState([]),[j,S]=N.useState([]);N.useEffect(()=>{g()},[s]);const g=async()=>{try{x(!0),f(null);const[r,v,I,L]=await Promise.allSettled([he.getDashboardSummary(s),he.getAttendanceTrends(8,s),he.getInstrumentDistribution(s),he.getClassDistribution(s)]);r.status==="fulfilled"&&u(r.value),v.status==="fulfilled"&&C(v.value),I.status==="fulfilled"&&y(I.value),L.status==="fulfilled"&&S(L.value)}catch(r){console.error("Error loading activity data:",r),f("×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™×")}finally{x(!1)}};if(d)return e.jsx("div",{className:`grid grid-cols-1 lg:grid-cols-2 gap-6 ${n}`,children:[1,2,3,4].map(r=>e.jsx(G,{children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-48 bg-gray-100 rounded"})]})},r))});if(l)return e.jsx(G,{className:n,children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-red-500 mb-4",children:l}),e.jsx("button",{onClick:g,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:"× ×¡×” ×©×•×‘"})]})});const w=[{label:"×ª×œ××™×“×™× ×¤×¢×™×œ×™×",value:c?.students?.active||0,trend:c?.students?.trend||0,icon:e.jsx(fe,{className:"w-5 h-5"}),color:"#3B82F6"},{label:"× ×•×›×—×•×ª ×ª×–××•×¨×•×ª",value:c?.rehearsals?.avgAttendance||0,trend:0,icon:e.jsx(ie,{className:"w-5 h-5"}),color:"#10B981"},{label:"× ×•×›×—×•×ª ×ª××•×¨×™×”",value:c?.theoryLessons?.avgAttendance||0,trend:0,icon:e.jsx(oe,{className:"w-5 h-5"}),color:"#8B5CF6"},{label:"×‘×’×¨×•×™×•×ª ×¤×¢×™×œ×•×ª",value:c?.bagrut?.active||0,trend:0,icon:e.jsx(ue,{className:"w-5 h-5"}),color:"#F59E0B"}],D=p.map(r=>({label:r.weekLabel.split(" - ")[0],value:r.overall||0})),m=()=>{if(D.length<2)return"neutral";const r=D.slice(-3),v=r.reduce((L,O)=>L+O.value,0)/r.length,I=D.slice(0,3).reduce((L,O)=>L+O.value,0)/3;return v>I+5?"up":v<I-5?"down":"neutral"},o=a.slice(0,8).map(r=>({label:r.instrumentName,value:r.count,color:r.color})),t=j.map(r=>({label:`×›×™×ª×” ${r.className}`,value:r.activeCount,color:"#3B82F6"})),i=Math.round(((c?.rehearsals?.avgAttendance||0)+(c?.theoryLessons?.avgAttendance||0))/2);return e.jsxs("div",{className:`space-y-6 ${n}`,dir:"rtl",children:[e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:w.map((r,v)=>e.jsxs(G,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-2 rounded-lg",style:{backgroundColor:`${r.color}20`},children:e.jsx("div",{style:{color:r.color},children:r.icon})}),r.trend!==0&&e.jsxs("span",{className:`text-xs font-medium ${r.trend>0?"text-green-600":"text-red-600"}`,children:[r.trend>0?"â†‘":"â†“"," ",Math.abs(r.trend),"%"]})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:r.label.includes("× ×•×›×—×•×ª")?`${r.value}%`:r.value}),e.jsx("p",{className:"text-sm text-gray-600",children:r.label})]},v))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(G,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"××’××ª × ×•×›×—×•×ª ×›×œ×œ×™×ª"}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Te,{className:`w-4 h-4 ${m()==="up"?"text-green-500":m()==="down"?"text-red-500":"text-gray-400"}`}),e.jsx("span",{className:"text-sm text-gray-600",children:"8 ×©×‘×•×¢×•×ª ××—×¨×•× ×™×"})]})]}),D.length>0?e.jsx(vt,{data:D,color:"#3B82F6",showDots:!0,trend:m()}):e.jsx("div",{className:"h-32 flex items-center justify-center text-gray-500",children:"××™×Ÿ × ×ª×•× ×™× ×–××™× ×™×"}),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-100",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-lg font-semibold text-blue-600",children:[c?.rehearsals?.avgAttendance||0,"%"]}),e.jsx("p",{className:"text-xs text-gray-600",children:"×ª×–××•×¨×•×ª"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-lg font-semibold text-purple-600",children:[c?.theoryLessons?.avgAttendance||0,"%"]}),e.jsx("p",{className:"text-xs text-gray-600",children:"×ª××•×¨×™×”"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-lg font-semibold text-green-600",children:[i,"%"]}),e.jsx("p",{className:"text-xs text-gray-600",children:"×××•×¦×¢ ×›×œ×œ×™"})]})]})})]}),e.jsxs(G,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"× ×•×›×—×•×ª ×›×•×œ×œ×ª"}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(Ke,{value:i,max:100,size:180,strokeWidth:12,color:i>=80?"#10B981":i>=60?"#F59E0B":"#EF4444",label:"×©×™×¢×•×¨ × ×•×›×—×•×ª",subtitle:"×××•×¦×¢ ×›×œ ×”×¤×¢×™×œ×•×™×•×ª"})}),e.jsxs("div",{className:"mt-6 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"×—×–×¨×•×ª ×ª×–××•×¨×ª"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-32 h-2 bg-gray-200 rounded-full mx-2",children:e.jsx("div",{className:"h-2 bg-blue-500 rounded-full",style:{width:`${c?.rehearsals?.avgAttendance||0}%`}})}),e.jsxs("span",{className:"text-sm font-medium w-10 text-left",children:[c?.rehearsals?.avgAttendance||0,"%"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"×©×™×¢×•×¨×™ ×ª××•×¨×™×”"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-32 h-2 bg-gray-200 rounded-full mx-2",children:e.jsx("div",{className:"h-2 bg-purple-500 rounded-full",style:{width:`${c?.theoryLessons?.avgAttendance||0}%`}})}),e.jsxs("span",{className:"text-sm font-medium w-10 text-left",children:[c?.theoryLessons?.avgAttendance||0,"%"]})]})]})]})]}),e.jsxs(G,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"×”×ª×¤×œ×’×•×ª ×›×œ×™ × ×’×™× ×”"}),o.length>0?e.jsx(Ee,{data:o,centerText:"×ª×œ××™×“×™×",showValues:!0}):e.jsx("div",{className:"h-48 flex items-center justify-center text-gray-500",children:"××™×Ÿ × ×ª×•× ×™× ×–××™× ×™×"})]}),e.jsxs(G,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"×”×ª×¤×œ×’×•×ª ×œ×¤×™ ×›×™×ª×•×ª"}),t.length>0?e.jsx(Me,{data:t,showValues:!0,showPercentages:!1}):e.jsx("div",{className:"h-48 flex items-center justify-center text-gray-500",children:"××™×Ÿ × ×ª×•× ×™× ×–××™× ×™×"}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:'×¡×”"×› ×›×™×ª×•×ª:'}),e.jsx("span",{className:"font-medium",children:j.length})]}),e.jsxs("div",{className:"flex justify-between text-sm mt-1",children:[e.jsx("span",{className:"text-gray-600",children:"×××•×¦×¢ ×ª×œ××™×“×™× ×œ×›×™×ª×”:"}),e.jsx("span",{className:"font-medium",children:j.length>0?Math.round(j.reduce((r,v)=>r+v.activeCount,0)/j.length):0})]})]})]})]}),e.jsxs(G,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"×¤×¢×™×œ×•×ª ×©×‘×•×¢×™×ª"}),e.jsx("div",{className:"grid grid-cols-7 gap-2",children:["×¨××©×•×Ÿ","×©× ×™","×©×œ×™×©×™","×¨×‘×™×¢×™","×—××™×©×™","×©×™×©×™","×©×‘×ª"].map((r,v)=>{const L=v<5?Math.random()*.6+.3:Math.random()*.3;return e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"aspect-square rounded-lg mb-2 transition-colors",style:{backgroundColor:`rgba(59, 130, 246, ${L})`},title:`${r}: ${Math.round(L*100)}% ×¤×¢×™×œ×•×ª`}),e.jsx("span",{className:"text-xs text-gray-600",children:r})]},r)})}),e.jsxs("div",{className:"mt-4 flex items-center justify-center space-x-4 space-x-reverse",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-blue-100 ml-1"}),e.jsx("span",{className:"text-xs text-gray-600",children:"×¤×¢×™×œ×•×ª × ××•×›×”"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-blue-300 ml-1"}),e.jsx("span",{className:"text-xs text-gray-600",children:"×‘×™× ×•× ×™×ª"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-blue-500 ml-1"}),e.jsx("span",{className:"text-xs text-gray-600",children:"×’×‘×•×”×”"})]})]})]})]})},kt=St,Tt=({schoolYearId:s,className:n="",maxItems:d=10,showFamilyGroups:x=!0})=>{const[l,f]=N.useState(!0),[c,u]=N.useState([]),[p,C]=N.useState("donut"),[a,y]=N.useState(!1);N.useEffect(()=>{j()},[s]);const j=async()=>{try{f(!0);const m=await he.getInstrumentDistribution(s);u(m)}catch(m){console.error("Error loading instrument distribution:",m)}finally{f(!1)}},S=N.useMemo(()=>{if(!a)return c.slice(0,d);const m={};return c.forEach(o=>{const t=o.family||"××—×¨";m[t]||(m[t]={count:0,color:o.color}),m[t].count+=o.count}),Object.entries(m).map(([o,{count:t,color:i}])=>({instrumentName:o,count:t,percentage:0,color:i,family:o})).sort((o,t)=>t.count-o.count)},[c,a,d]),g=N.useMemo(()=>c.reduce((m,o)=>m+o.count,0),[c]),w=N.useMemo(()=>S.map(m=>({label:m.instrumentName,value:m.count,color:m.color})),[S]),D=c[0];return l?e.jsx(G,{className:`p-6 ${n}`,children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-48 bg-gray-100 rounded"})]})}):e.jsxs(G,{className:`p-6 ${n}`,dir:"rtl",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(ie,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"×”×ª×¤×œ×’×•×ª ×›×œ×™ × ×’×™× ×”"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[g," ×ª×œ××™×“×™× | ",c.length," ×›×œ×™×"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>C("donut"),className:`p-1.5 rounded-md transition-colors ${p==="donut"?"bg-white shadow-sm":""}`,title:"×ª×¦×•×’×ª ×¢×•×’×”",children:e.jsx(Je,{className:`w-4 h-4 ${p==="donut"?"text-gray-900":"text-gray-500"}`})}),e.jsx("button",{onClick:()=>C("bar"),className:`p-1.5 rounded-md transition-colors ${p==="bar"?"bg-white shadow-sm":""}`,title:"×ª×¦×•×’×ª ×¢××•×“×•×ª",children:e.jsx(Ae,{className:`w-4 h-4 ${p==="bar"?"text-gray-900":"text-gray-500"}`})})]}),x&&e.jsx("button",{onClick:()=>y(!a),className:`px-3 py-1.5 text-sm rounded-lg border transition-colors ${a?"bg-purple-50 border-purple-200 text-purple-700":"border-gray-200 text-gray-600 hover:bg-gray-50"}`,children:a?"×œ×¤×™ ××©×¤×—×”":"×œ×¤×™ ×›×œ×™"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:g}),e.jsx("p",{className:"text-xs text-gray-600",children:'×¡×”"×› × ×¨×©××™×'})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:c.length}),e.jsx("p",{className:"text-xs text-gray-600",children:"×›×œ×™ × ×’×™× ×”"})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-lg font-bold text-blue-600 truncate",title:D?.instrumentName,children:D?.instrumentName||"-"}),e.jsx("p",{className:"text-xs text-gray-600",children:"×”×›×™ ×¤×•×¤×•×œ×¨×™"})]})]}),w.length>0?p==="donut"?e.jsx(Ee,{data:w,centerText:a?"××©×¤×—×•×ª":"×›×œ×™×",showValues:!0}):e.jsx(Me,{data:w,showValues:!0}):e.jsx("div",{className:"h-48 flex items-center justify-center text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ie,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"××™×Ÿ × ×ª×•× ×™× ×–××™× ×™×"})]})}),!a&&c.length>0&&e.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-100",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"×œ×¤×™ ××©×¤×—×ª ×›×œ×™×"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Array.from(new Set(c.map(m=>m.family))).map(m=>{const o=c.filter(r=>r.family===m),t=o.reduce((r,v)=>r+v.count,0),i=o[0]?.color||"#6B7280";return e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1 rounded-full text-xs",style:{backgroundColor:`${i}15`},children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:i}}),e.jsx("span",{className:"text-gray-700",children:m}),e.jsx("span",{className:"font-medium",style:{color:i},children:t})]},m)})})]}),c.length>d&&e.jsxs("details",{className:"mt-4",children:[e.jsxs("summary",{className:"text-sm text-blue-600 cursor-pointer hover:text-blue-700",children:["×”×¦×’ ××ª ×›×œ ",c.length," ×”×›×œ×™×"]}),e.jsx("div",{className:"mt-3 grid grid-cols-2 sm:grid-cols-3 gap-2",children:c.map(m=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:m.color}}),e.jsx("span",{className:"text-gray-700 truncate",children:m.instrumentName})]}),e.jsx("span",{className:"font-medium text-gray-900",children:m.count})]},m.instrumentName))})]})]})},$t=Tt,At=({schoolYearId:s,className:n="",showInactive:d=!1})=>{const[x,l]=N.useState(!0),[f,c]=N.useState([]),[u,p]=N.useState("bar");N.useEffect(()=>{C()},[s]);const C=async()=>{try{l(!0);const t=await he.getClassDistribution(s);c(t)}catch(t){console.error("Error loading class distribution:",t)}finally{l(!1)}},a=f.reduce((t,i)=>t+i.activeCount,0);f.reduce((t,i)=>t+i.inactiveCount,0);const y=N.useMemo(()=>{const t=["×","×‘","×’","×“","×”","×•"],i=["×–","×—","×˜"],r=["×™","×™×","×™×‘"],v=f.filter(A=>t.includes(A.className)),I=f.filter(A=>i.includes(A.className)),L=f.filter(A=>r.includes(A.className)),O=f.filter(A=>!t.includes(A.className)&&!i.includes(A.className)&&!r.includes(A.className));return{primary:{label:"×™×¡×•×“×™ (×-×•)",count:v.reduce((A,W)=>A+W.activeCount,0),classes:v,color:"#3B82F6"},middle:{label:'×—×˜"×‘ (×–-×˜)',count:I.reduce((A,W)=>A+W.activeCount,0),classes:I,color:"#10B981"},high:{label:"×ª×™×›×•×Ÿ (×™-×™×‘)",count:L.reduce((A,W)=>A+W.activeCount,0),classes:L,color:"#8B5CF6"},other:{label:"××—×¨",count:O.reduce((A,W)=>A+W.activeCount,0),classes:O,color:"#6B7280"}}},[f]),j=f.map(t=>({label:`×›×™×ª×” ${t.className}`,value:t.activeCount,color:g(t.className)})),S=Object.values(y).filter(t=>t.count>0).map(t=>({label:t.label,value:t.count,color:t.color}));function g(t){const i=["×","×‘","×’","×“","×”","×•"],r=["×–","×—","×˜"],v=["×™","×™×","×™×‘"];return i.includes(t)?"#3B82F6":r.includes(t)?"#10B981":v.includes(t)?"#8B5CF6":"#6B7280"}const D=[...f].sort((t,i)=>i.activeCount-t.activeCount)[0],m=f.length>0?Math.round(a/f.length):0,o=[{id:"bar",label:"×¢××•×“×•×ª",icon:Ae},{id:"donut",label:"×¢×•×’×”",icon:Je},{id:"cards",label:"×›×¨×˜×™×¡×™×",icon:xt},{id:"levels",label:"×©×œ×‘×™×",icon:ht}];return x?e.jsx(G,{className:`p-6 ${n}`,children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-64 bg-gray-100 rounded"})]})}):e.jsxs(G,{className:`p-6 ${n}`,dir:"rtl",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(ne,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"×”×ª×¤×œ×’×•×ª ×œ×¤×™ ×›×™×ª×•×ª"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[a," ×ª×œ××™×“×™× ×¤×¢×™×œ×™× | ",f.length," ×›×™×ª×•×ª"]})]})]}),e.jsx("div",{className:"flex bg-gray-100 rounded-lg p-1",children:o.map(t=>{const i=t.icon;return e.jsxs("button",{onClick:()=>p(t.id),className:`flex items-center gap-1.5 px-3 py-1.5 text-sm rounded-md transition-colors ${u===t.id?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,title:t.label,children:[e.jsx(i,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:t.label})]},t.id)})})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:a}),e.jsx("p",{className:"text-xs text-gray-600",children:"×ª×œ××™×“×™× ×¤×¢×™×œ×™×"})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:m}),e.jsx("p",{className:"text-xs text-gray-600",children:"×××•×¦×¢ ×œ×›×™×ª×”"})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-lg font-bold text-purple-600",children:D?`${D.className}`:"-"}),e.jsxs("p",{className:"text-xs text-gray-600",children:["×›×™×ª×” ×’×“×•×œ×” (",D?.activeCount||0,")"]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-600",children:f.length}),e.jsx("p",{className:"text-xs text-gray-600",children:"×›×™×ª×•×ª ×¤×¢×™×œ×•×ª"})]})]}),u==="bar"&&e.jsx("div",{children:j.length>0?e.jsx(Me,{data:j,showValues:!0}):e.jsx("div",{className:"h-48 flex items-center justify-center text-gray-500",children:"××™×Ÿ × ×ª×•× ×™× ×–××™× ×™×"})}),u==="donut"&&e.jsx("div",{children:S.length>0?e.jsx("div",{className:"flex flex-col items-center",children:e.jsx(Ee,{data:S,centerText:"×©×œ×‘×™×",showValues:!0})}):e.jsx("div",{className:"h-48 flex items-center justify-center text-gray-500",children:"××™×Ÿ × ×ª×•× ×™× ×–××™× ×™×"})}),u==="cards"&&e.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-6 gap-3",children:f.map(t=>{const i=a>0?Math.round(t.activeCount/a*100):0;return e.jsxs("div",{className:"relative p-4 rounded-xl text-center transition-all hover:shadow-lg hover:scale-105 cursor-pointer",style:{backgroundColor:`${g(t.className)}15`},children:[e.jsx("p",{className:"text-lg font-bold text-gray-800",children:t.className}),e.jsx("p",{className:"text-3xl font-bold mt-1",style:{color:g(t.className)},children:t.activeCount}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[i,"%"]}),e.jsx("div",{className:"mt-2 h-1.5 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all",style:{width:`${t.activeCount/(D?.activeCount||1)*100}%`,backgroundColor:g(t.className)}})})]},t.className)})}),u==="levels"&&e.jsxs("div",{className:"space-y-6",children:[Object.entries(y).map(([t,i])=>{if(i.count===0)return null;const r=a>0?Math.round(i.count/a*100):0;return e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:i.color}}),e.jsx("span",{className:"font-semibold text-gray-900",children:i.label})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl font-bold",style:{color:i.color},children:i.count}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",r,"%)"]})]})]}),e.jsx("div",{className:"h-3 bg-gray-200 rounded-full overflow-hidden mb-3",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${r}%`,backgroundColor:i.color}})}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.classes.map(v=>e.jsxs("div",{className:"px-3 py-1.5 bg-white rounded-lg shadow-sm flex items-center gap-2",children:[e.jsxs("span",{className:"font-medium text-gray-700",children:["×›×™×ª×” ",v.className]}),e.jsx("span",{className:"font-bold",style:{color:i.color},children:v.activeCount})]},v.className))})]},t)}),e.jsxs("div",{className:"bg-gradient-to-l from-gray-50 to-white rounded-xl p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-4",children:"×”×©×•×•××” ×—×–×•×ª×™×ª"}),e.jsx("div",{className:"flex items-end justify-center gap-4 h-32",children:Object.entries(y).map(([t,i])=>{if(i.count===0)return null;const r=Math.max(...Object.values(y).map(I=>I.count)),v=r>0?i.count/r*100:0;return e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("span",{className:"text-sm font-bold",style:{color:i.color},children:i.count}),e.jsx("div",{className:"w-16 rounded-t-lg transition-all duration-500",style:{height:`${v}%`,backgroundColor:i.color,minHeight:"20px"}}),e.jsx("span",{className:"text-xs text-gray-600 text-center max-w-[64px]",children:i.label.split(" ")[0]})]},t)})})]})]})]})},Qe=At,Mt=({schoolYearId:s,className:n=""})=>{const[d,x]=N.useState(!0),[l,f]=N.useState(null);N.useEffect(()=>{c()},[s]);const c=async()=>{try{x(!0);const a=await he.getBagrutProgress(s);f(a)}catch(a){console.error("Error loading bagrut progress:",a)}finally{x(!1)}};if(d)return e.jsx(G,{className:`p-6 ${n}`,children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-64 bg-gray-100 rounded"})]})});if(!l)return e.jsx(G,{className:`p-6 ${n}`,dir:"rtl",children:e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ue,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"××™×Ÿ × ×ª×•× ×™ ×‘×’×¨×•×™×•×ª ×–××™× ×™×"})]})});const u=[{label:"×”×•×©×œ×",value:l.completedCount,color:"#10B981"},{label:"×‘×ª×”×œ×™×š",value:l.inProgressCount,color:"#F59E0B"},{label:"×˜×¨× ×”×ª×—×™×œ",value:l.notStartedCount,color:"#6B7280"}].filter(a=>a.value>0),p=[{key:"presentation1",label:"×”×¦×’×” 1",completed:l.presentations.presentation1.completed,passed:l.presentations.presentation1.passed,total:l.presentations.presentation1.total},{key:"presentation2",label:"×”×¦×’×” 2",completed:l.presentations.presentation2.completed,passed:l.presentations.presentation2.passed,total:l.presentations.presentation2.total},{key:"presentation3",label:"×”×¦×’×” 3",completed:l.presentations.presentation3.completed,passed:l.presentations.presentation3.passed,total:l.presentations.presentation3.total},{key:"presentation4",label:"××’×Ÿ ×‘×’×¨×•×ª",completed:l.presentations.presentation4.completed,passed:l.presentations.presentation4.passed,total:l.presentations.presentation4.total}],C=l.gradeDistribution.map(a=>({label:a.range,value:a.count,color:a.color}));return e.jsxs("div",{className:`space-y-6 ${n}`,dir:"rtl",children:[e.jsx(G,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-amber-100 rounded-xl",children:e.jsx(ue,{className:"w-8 h-8 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"××¢×§×‘ ×‘×’×¨×•×™×•×ª"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[l.totalStudents," ×ª×œ××™×“×™× ×¨×©×•××™×"]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"text-center px-4 py-2 bg-green-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-1 justify-center",children:[e.jsx(gt,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-2xl font-bold text-green-600",children:l.completedCount})]}),e.jsx("p",{className:"text-xs text-gray-600",children:"×”×•×©×œ××•"})]}),e.jsxs("div",{className:"text-center px-4 py-2 bg-amber-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-1 justify-center",children:[e.jsx(ve,{className:"w-4 h-4 text-amber-600"}),e.jsx("span",{className:"text-2xl font-bold text-amber-600",children:l.inProgressCount})]}),e.jsx("p",{className:"text-xs text-gray-600",children:"×‘×ª×”×œ×™×š"})]}),e.jsxs("div",{className:"text-center px-4 py-2 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-1 justify-center",children:[e.jsx(Xe,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-2xl font-bold text-gray-600",children:l.notStartedCount})]}),e.jsx("p",{className:"text-xs text-gray-600",children:"×˜×¨× ×”×ª×—×™×œ×•"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(G,{className:"p-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-6",children:"×©×™×¢×•×¨ ×”×©×œ××” ×›×•×œ×œ"}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(Ke,{value:l.completionRate,max:100,size:200,strokeWidth:16,color:l.completionRate>=70?"#10B981":l.completionRate>=40?"#F59E0B":"#EF4444",label:"×”×©×œ××ª ×‘×’×¨×•×™×•×ª",subtitle:`${l.completedCount} ××ª×•×š ${l.totalStudents}`})}),e.jsx("div",{className:"mt-6",children:u.length>0&&e.jsx(Ee,{data:u,centerText:"×¡×˜×˜×•×¡",showValues:!0})})]}),e.jsxs(G,{className:"p-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-6",children:"×”×ª×§×“××•×ª ×œ×¤×™ ×”×¦×’×•×ª"}),e.jsx("div",{className:"space-y-4",children:p.map((a,y)=>{const j=a.total>0?Math.round(a.completed/a.total*100):0,S=a.completed>0?Math.round(a.passed/a.completed*100):0;return e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-bold ${j===100?"bg-green-500":j>0?"bg-amber-500":"bg-gray-400"}`,children:y+1}),e.jsx("span",{className:"font-medium text-gray-900",children:a.label})]}),e.jsxs("span",{className:"text-sm text-gray-600",children:[a.completed,"/",a.total," ×”×•×©×œ××•"]})]}),e.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-l from-green-500 to-green-400 transition-all duration-500",style:{width:`${j}%`}})}),e.jsxs("div",{className:"flex justify-between mt-2 text-xs",children:[e.jsxs("span",{className:"text-gray-600",children:[j,"% ×”×•×©×œ××•"]}),a.completed>0&&e.jsxs("span",{className:S>=80?"text-green-600":"text-amber-600",children:[S,"% ×¢×‘×¨×•"]})]})]},a.key)})})]}),e.jsxs(G,{className:"p-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-6",children:"×”×ª×¤×œ×’×•×ª ×¦×™×•× ×™×"}),C.some(a=>a.value>0)?e.jsxs(e.Fragment,{children:[e.jsx(Me,{data:C,showValues:!0}),e.jsx("div",{className:"mt-6 p-4 bg-gradient-to-l from-amber-50 to-amber-100 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"w-5 h-5 text-amber-600"}),e.jsx("span",{className:"text-gray-700",children:"×¦×™×•×Ÿ ×××•×¦×¢"})]}),e.jsx("span",{className:"text-3xl font-bold text-amber-600",children:l.averageGrade||"-"})]})})]}):e.jsx("div",{className:"h-48 flex items-center justify-center text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ue,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"××™×Ÿ ×¦×™×•× ×™× ×–××™× ×™×"})]})})]}),e.jsxs(G,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"×‘×—×™× ×•×ª ×§×¨×•×‘×•×ª"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[l.upcomingExams.length," ×‘×—×™× ×•×ª"]})]}),l.upcomingExams.length>0?e.jsx("div",{className:"space-y-3",children:l.upcomingExams.map((a,y)=>e.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx("div",{className:"p-2 bg-amber-100 rounded-lg",children:e.jsx(K,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:a.studentName}),e.jsx("p",{className:"text-sm text-gray-600",children:a.teacherName})]}),e.jsx("div",{className:"text-left",children:e.jsx("p",{className:"text-sm font-medium text-amber-600",children:a.date})})]},y))}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(K,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"××™×Ÿ ×‘×—×™× ×•×ª ××ª×•×›× × ×•×ª"})]}),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-100",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{className:"px-3 py-2 text-sm text-amber-700 bg-amber-50 rounded-lg hover:bg-amber-100 transition-colors",children:"×¦×¤×” ×‘×›×œ ×”×‘×’×¨×•×™×•×ª"}),e.jsx("button",{className:"px-3 py-2 text-sm text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"×™×™×¦× ×“×•×—"})]})})]})]}),e.jsx(G,{className:"p-4 bg-gradient-to-l from-amber-50 to-white",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-8 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-amber-600",children:l.totalStudents}),e.jsx("p",{className:"text-sm text-gray-600",children:'×¡×”"×› ×ª×œ××™×“×™×'})]}),e.jsx("div",{className:"w-px h-12 bg-gray-200"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-3xl font-bold text-green-600",children:[l.completionRate,"%"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"×©×™×¢×•×¨ ×”×©×œ××”"})]}),e.jsx("div",{className:"w-px h-12 bg-gray-200"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:l.averageGrade||"-"}),e.jsx("p",{className:"text-sm text-gray-600",children:"×¦×™×•×Ÿ ×××•×¦×¢"})]}),e.jsx("div",{className:"w-px h-12 bg-gray-200"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-purple-600",children:l.upcomingExams.length}),e.jsx("p",{className:"text-sm text-gray-600",children:"×‘×—×™× ×•×ª ×§×¨×•×‘×•×ª"})]})]})})]})},Et=Mt,ke=["×¨××©×•×Ÿ","×©× ×™","×©×œ×™×©×™","×¨×‘×™×¢×™","×—××™×©×™","×©×™×©×™"],Bt=({className:s=""})=>{const{currentSchoolYear:n}=ze(),[d,x]=N.useState(!0),[l,f]=N.useState([]),[c,u]=N.useState(()=>{const g=new Date().getDay();return g<6?g:0});N.useEffect(()=>{p()},[n]);const p=async()=>{try{x(!0);const g=n?{schoolYearId:n._id}:{},w=await F.teachers.getTeachers(g);f(Array.isArray(w)?w:[])}catch(g){console.error("Error loading teachers:",g),f([])}finally{x(!1)}},C=N.useMemo(()=>{const g=ke[c],w=[];return l.forEach(D=>{if(!D.isActive)return;const m=D.personalInfo?.fullName||"××•×¨×”",o=D.professionalInfo?.instrument||"";(D.teaching?.timeBlocks||[]).forEach(i=>{if(!i.isActive)return;i.day?.trim()===g&&w.push({teacherId:D._id,teacherName:m,room:i.location||i.roomNumber||"×œ× ×¦×•×™×Ÿ",startTime:i.startTime||"",endTime:i.endTime||"",instrument:o})})}),w.sort((D,m)=>{const o=D.startTime.split(":").map(Number),t=m.startTime.split(":").map(Number),i=(o[0]||0)*60+(o[1]||0),r=(t[0]||0)*60+(t[1]||0);return i!==r?i-r:D.teacherName.localeCompare(m.teacherName,"he")})},[l,c]),a=N.useMemo(()=>{const g={};return C.forEach(w=>{const D=w.room||"×œ× ×¦×•×™×Ÿ";g[D]||(g[D]=[]),g[D].push(w)}),Object.entries(g).sort(([w],[D])=>w==="×œ× ×¦×•×™×Ÿ"?1:D==="×œ× ×¦×•×™×Ÿ"?-1:w.localeCompare(D,"he"))},[C]),y=()=>{u(g=>g>0?g-1:5)},j=()=>{u(g=>g<5?g+1:0)},S=g=>{const w=["bg-blue-50 hover:bg-blue-100","bg-green-50 hover:bg-green-100","bg-purple-50 hover:bg-purple-100","bg-amber-50 hover:bg-amber-100","bg-rose-50 hover:bg-rose-100","bg-cyan-50 hover:bg-cyan-100","bg-orange-50 hover:bg-orange-100","bg-indigo-50 hover:bg-indigo-100"];return w[g%w.length]};return d?e.jsx(G,{className:`p-6 ${s}`,children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-6"}),e.jsx("div",{className:"space-y-3",children:[1,2,3,4,5].map(g=>e.jsx("div",{className:"h-12 bg-gray-100 rounded"},g))})]})}):e.jsxs(G,{className:`p-6 ${s}`,dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(K,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900",children:["×œ×•×— ×—×“×¨×™× - ×™×•× ",ke[c]]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[C.length," ×©×™×¢×•×¨×™× | ",a.length," ×—×“×¨×™× ×¤×¢×™×œ×™×"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:y,className:"p-2 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors",title:"×™×•× ×§×•×“×",children:e.jsx(de,{className:"w-5 h-5 text-gray-600"})}),e.jsx("div",{className:"flex gap-1",children:ke.map((g,w)=>e.jsxs("button",{onClick:()=>u(w),className:`px-3 py-1.5 text-sm rounded-lg transition-colors ${w===c?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:[g.charAt(0),"×³"]},g))}),e.jsx("button",{onClick:j,className:"p-2 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors",title:"×™×•× ×”×‘×",children:e.jsx(ut,{className:"w-5 h-5 text-gray-600"})})]})]}),C.length>0?e.jsx("div",{className:"overflow-hidden rounded-xl border border-gray-200",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-l from-blue-600 to-blue-700 text-white",children:[e.jsx("th",{className:"px-4 py-3 text-right font-semibold text-sm w-16",children:"#"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ft,{className:"w-4 h-4"}),"×©× ×”××•×¨×”"]})}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-4 h-4"}),"×—×“×¨"]})}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4"}),"×©×¢×•×ª"]})}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold text-sm",children:"×›×œ×™ × ×’×™× ×”"})]})}),e.jsx("tbody",{children:C.map((g,w)=>e.jsxs("tr",{className:`${S(w)} transition-colors border-b border-gray-100 last:border-b-0`,children:[e.jsx("td",{className:"px-4 py-3 text-gray-500 font-medium",children:w+1}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"font-semibold text-gray-900",children:g.teacherName})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 bg-white rounded-full text-sm font-medium text-gray-700 shadow-sm",children:[e.jsx(Re,{className:"w-3.5 h-3.5 text-blue-500"}),g.room]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:"text-gray-700",children:[g.startTime," - ",g.endTime]})}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:g.instrument||"-"})]},`${g.teacherId}-${g.startTime}-${w}`))})]})}):e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-xl border-2 border-dashed border-gray-200",children:[e.jsx(K,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsxs("p",{className:"text-gray-500 text-lg font-medium",children:["××™×Ÿ ×©×™×¢×•×¨×™× ×‘×™×•× ",ke[c]]}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"× ×¡×” ×œ×‘×—×•×¨ ×™×•× ××—×¨"})]})]})},qe=Bt;function Ht(){const{user:s}=$e(),{currentSchoolYear:n}=ze(),[d,x]=N.useState(!0),[l,f]=N.useState("overview"),[c,u]=N.useState(new Date),[p,C]=N.useState({activeStudents:0,staffMembers:0,activeOrchestras:0,weeklyRehearsals:0,studentsTrend:0,activeBagruts:0,theoryLessonsThisWeek:0}),[a,y]=N.useState([]),[j,S]=N.useState([]);N.useEffect(()=>{g()},[n]);const g=async()=>{try{x(!0);const r=n?{schoolYearId:n._id}:{},[v,I,L,O,A,W]=await Promise.allSettled([F.students.getStudents(r),F.teachers.getTeachers(r),F.orchestras.getOrchestras(r),F.rehearsals.getRehearsals(r),F.theory.getTheoryLessons(r),F.bagrut.getBagruts()]),J=v.status==="fulfilled"?Array.isArray(v.value)?v.value:[]:[],Z=I.status==="fulfilled"?Array.isArray(I.value)?I.value:[]:[],se=L.status==="fulfilled"?Array.isArray(L.value)?L.value:[]:[],Y=O.status==="fulfilled"?Array.isArray(O.value)?O.value:[]:[],ee=A.status==="fulfilled"?Array.isArray(A.value)?A.value:[]:[],k=W.status==="fulfilled"?Array.isArray(W.value)?W.value:[]:[];console.log("ğŸ“Š Dashboard data loaded:",{students:J.length,teachers:Z.length,orchestras:se.length,rehearsals:Y.length,theory:ee.length,bagruts:k.length});const T=J.filter(E=>E.isActive!==!1).length,$=Z.filter(E=>E.isActive!==!1).length,b=se.filter(E=>E.isActive!==!1).length,M=new Date,h=new Date(M);h.setDate(M.getDate()-M.getDay()),h.setHours(0,0,0,0);const P=new Date(h);P.setDate(P.getDate()+7);const q=Y.filter(E=>{if(!E.date)return!1;const z=new Date(E.date);return z>=h&&z<P}).length,U=ee.filter(E=>{if(!E.date)return!1;const z=new Date(E.date);return z>=h&&z<P}).length,te=new Date(M.getFullYear(),M.getMonth(),1),V=J.filter(E=>E.createdAt&&new Date(E.createdAt)>=te).length,Q=T>0?Math.round(V/T*100):0,le=k.filter(E=>!E.isCompleted&&E.isActive!==!1).length;C({activeStudents:T,staffMembers:$,activeOrchestras:b,weeklyRehearsals:q,studentsTrend:Q,activeBagruts:le,theoryLessonsThisWeek:U});const ce=[];[...J].sort((E,z)=>new Date(z.createdAt||0).getTime()-new Date(E.createdAt||0).getTime()).slice(0,3).forEach(E=>{ce.push({type:"student",title:"×¨×™×©×•× ×ª×œ××™×“ ×—×“×©",description:`${E.personalInfo?.fullName||"×ª×œ××™×“"} × ×¨×©× ×œ×§×•× ×¡×¨×‘×˜×•×¨×™×•×Ÿ`,time:D(E.createdAt),color:"primary"})});const ae=Y.filter(E=>new Date(E.date)>=M).sort((E,z)=>new Date(E.date).getTime()-new Date(z.date).getTime()).slice(0,3);ae.forEach(E=>{ce.push({type:"rehearsal",title:"×—×–×¨×” ××ª×•×›× × ×ª",description:`${E.groupId?.name||E.orchestraName||"×ª×–××•×¨×ª"} - ${m(E.date)} ${E.startTime||""}`,time:D(E.createdAt),color:"success"})}),y(ce.slice(0,6));const pe=ae.slice(0,4).map(E=>({title:E.groupId?.name||E.orchestraName||"×—×–×¨×ª ×ª×–××•×¨×ª",date:m(E.date),description:`${E.type||"×—×–×¨×”"} - ${E.location||"××•×œ× ×¨××©×™"}`,isPrimary:!1}));S(pe),u(new Date)}catch(r){console.error("Failed to load dashboard data:",r)}finally{x(!1)}},w=()=>{g()},D=r=>{if(!r)return"×œ××—×¨×•× ×”";const v=new Date,I=new Date(r),L=v.getTime()-I.getTime(),O=Math.floor(L/6e4),A=Math.floor(L/36e5),W=Math.floor(L/864e5);return O<60?`×œ×¤× ×™ ${O} ×“×§×•×ª`:A<24?`×œ×¤× ×™ ${A} ×©×¢×•×ª`:W<7?`×œ×¤× ×™ ${W} ×™××™×`:"×”×©×‘×•×¢"},m=r=>{if(!r)return"";const v=new Date(r);return`${v.getDate()}/${v.getMonth()+1}`},t=!s||s.role==="admin"||s.roles?.includes("admin")||s.role==="×× ×”×œ"||s.roles?.includes("×× ×”×œ")?"admin":s.role==="theory-teacher"||s.roles?.includes("theory-teacher")||s.roles?.includes("theory_teacher")||s.role==="××•×¨×” ×ª×™××•×¨×™×”"||s.roles?.includes("××•×¨×” ×ª×™××•×¨×™×”")?"theory-teacher":s.role==="conductor"||s.roles?.includes("conductor")||s.role==="×× ×¦×—"||s.roles?.includes("×× ×¦×—")||s.conducting?.orchestraIds?.length>0?"conductor":s.role==="teacher"||s.roles?.includes("teacher")||s.role==="××•×¨×”"||s.roles?.includes("××•×¨×”")||s.teaching?.studentIds?.length>0?"teacher":"admin";if(t==="theory-teacher")return e.jsx(Nt,{});if(t==="conductor")return e.jsx(jt,{});if(t==="teacher")return e.jsx(bt,{});const i=[{id:"overview",label:"×¡×§×™×¨×” ×›×œ×œ×™×ª",icon:Ae},{id:"students",label:"×ª×œ××™×“×™×",icon:fe},{id:"schedule",label:"×œ×•×— ×–×× ×™×",icon:K},{id:"bagrut",label:"×‘×’×¨×•×™×•×ª",icon:ue}];return e.jsxs("div",{dir:"rtl",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"×œ×•×— ×‘×§×¨×”"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[n?.name||"×©× ×ª ×œ×™××•×“×™× × ×•×›×—×™×ª"," | ×¢×“×›×•×Ÿ ××—×¨×•×Ÿ: ",c.toLocaleTimeString("he-IL")]})]}),e.jsxs("button",{onClick:w,disabled:d,className:"flex items-center gap-2 px-4 py-2 text-sm bg-white border border-gray-200 rounded-lg hover:bg-gray-50 disabled:opacity-50",children:[e.jsx(pt,{className:`w-4 h-4 ${d?"animate-spin":""}`}),"×¨×¢× ×Ÿ × ×ª×•× ×™×"]})]}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg mb-6 p-1 flex overflow-x-auto",children:i.map(r=>{const v=r.icon;return e.jsxs("button",{onClick:()=>f(r.id),className:`flex items-center gap-2 px-4 py-2.5 text-sm font-medium rounded-md transition-colors whitespace-nowrap ${l===r.id?"bg-primary-50 text-primary-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(v,{className:"w-4 h-4"}),r.label]},r.id)})}),l==="overview"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8",children:[e.jsx(je,{title:"×ª×œ××™×“×™× ×¤×¢×™×œ×™×",value:d?"...":p.activeStudents.toString(),subtitle:"×ª×œ××™×“×™× ×¨×©×•××™×",icon:e.jsx(fe,{}),color:"blue",trend:p.studentsTrend!==0?{value:Math.abs(p.studentsTrend),label:"××”×—×•×“×© ×©×¢×‘×¨",direction:p.studentsTrend>0?"up":"down"}:void 0}),e.jsx(je,{title:"×—×‘×¨×™ ×¡×’×œ",value:d?"...":p.staffMembers.toString(),subtitle:"××•×¨×™× ×•××“×¨×™×›×™×",icon:e.jsx(ne,{}),color:"green"}),e.jsx(je,{title:"×”×¨×›×‘×™× ×¤×¢×™×œ×™×",value:d?"...":p.activeOrchestras.toString(),subtitle:"×ª×–××•×¨×•×ª ×•×§×‘×•×¦×•×ª",icon:e.jsx(ie,{}),color:"purple"}),e.jsx(je,{title:"×—×–×¨×•×ª ×”×©×‘×•×¢",value:d?"...":p.weeklyRehearsals.toString(),subtitle:"××¤×’×©×™× ××ª×•×›× × ×™×",icon:e.jsx(K,{}),color:"orange"}),e.jsx(je,{title:"×©×™×¢×•×¨×™ ×ª××•×¨×™×”",value:d?"...":p.theoryLessonsThisWeek.toString(),subtitle:"×”×©×‘×•×¢",icon:e.jsx(oe,{}),color:"teal"}),e.jsx(je,{title:"×‘×’×¨×•×™×•×ª ×¤×¢×™×œ×•×ª",value:d?"...":p.activeBagruts.toString(),subtitle:"×ª×œ××™×“×™× ×‘×ª×”×œ×™×š",icon:e.jsx(ue,{}),color:"amber"})]}),e.jsx("div",{className:"mb-8",children:e.jsx(qe,{})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsx($t,{schoolYearId:n?._id,maxItems:8}),e.jsx(Qe,{schoolYearId:n?._id})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(G,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"×¤×¢×™×œ×•×ª ××—×¨×•× ×”"}),e.jsx("button",{className:"text-sm text-primary-600 hover:text-primary-700 font-medium",children:"×¦×¤×” ×‘×”×›×œ"})]}),e.jsx("div",{className:"space-y-4",children:d?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"×˜×•×¢×Ÿ..."}):a.length>0?a.map((r,v)=>e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:`w-2 h-2 ${r.color==="primary"?"bg-blue-500":r.color==="success"?"bg-green-500":"bg-orange-500"} rounded-full mt-2 ml-4`}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:r.title}),e.jsx("span",{className:"text-xs text-gray-500",children:r.time})]}),e.jsx("p",{className:"text-sm text-gray-600",children:r.description})]})]},v)):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"××™×Ÿ ×¤×¢×™×œ×•×ª ××—×¨×•× ×”"})})]})}),e.jsx("div",{children:e.jsxs(G,{children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"××™×¨×•×¢×™× ×§×¨×•×‘×™×"})}),e.jsx("div",{className:"space-y-4",children:d?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"×˜×•×¢×Ÿ..."}):j.length>0?j.map((r,v)=>e.jsxs("div",{className:`p-4 rounded-lg ${r.isPrimary?"bg-primary-50 border border-primary-100":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("p",{className:`text-sm font-medium ${r.isPrimary?"text-primary-900":"text-gray-900"}`,children:r.title}),e.jsx("span",{className:`text-xs ${r.isPrimary?"text-primary-600":"text-gray-500"}`,children:r.date})]}),e.jsx("p",{className:`text-sm ${r.isPrimary?"text-primary-700":"text-gray-600"}`,children:r.description})]},v)):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"××™×Ÿ ××™×¨×•×¢×™× ×§×¨×•×‘×™×"})})]})})]})]}),l==="students"&&e.jsx(kt,{schoolYearId:n?._id}),l==="schedule"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(qe,{}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(Qe,{schoolYearId:n?._id}),e.jsxs(G,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"×¡×™×›×•× ×©×‘×•×¢×™"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ie,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-gray-700",children:"×—×–×¨×•×ª ×ª×–××•×¨×ª"})]}),e.jsx("span",{className:"text-xl font-bold text-blue-600",children:p.weeklyRehearsals})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-purple-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(oe,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"text-gray-700",children:"×©×™×¢×•×¨×™ ×ª××•×¨×™×”"})]}),e.jsx("span",{className:"text-xl font-bold text-purple-600",children:p.theoryLessonsThisWeek})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ne,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-gray-700",children:"××•×¨×™× ×¤×¢×™×œ×™×"})]}),e.jsx("span",{className:"text-xl font-bold text-green-600",children:p.staffMembers})]})]})]})]})]}),l==="bagrut"&&e.jsx(Et,{schoolYearId:n?._id})]})}export{Ht as default};
