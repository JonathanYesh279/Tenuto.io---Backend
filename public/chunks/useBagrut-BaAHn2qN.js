import{r as s}from"./vendor-C9PcmKF2.js";import{g as b}from"./cascade-deletion-BvQll6O-.js";import{k as x,l as S}from"../assets/index-CoKafZFz.js";const v="/bagrut",B={async getAllBagruts(t={}){try{console.log("ğŸŒ BagrutService: Fetching bagruts with params:",t);const e=await b.get(v,t);console.log("ğŸ“¨ BagrutService: Raw API response:",e),console.log("ğŸ“¨ BagrutService: Response type:",typeof e),console.log("ğŸ“¨ BagrutService: Is array?",Array.isArray(e));let i=[];return Array.isArray(e)?i=e:e&&(console.warn("Unexpected response format (expected array):",e),i=[]),console.log("âœ… BagrutService: Returning bagruts:",i.length,"items"),i}catch(e){throw console.error("âŒ BagrutService: Error fetching bagruts:",e),new Error("×©×’×™××” ×‘×˜×¢×™× ×ª ×¨×©×™××ª ×‘×’×¨×•×™×•×ª")}},async getBagrutById(t){try{console.log("ğŸ” BagrutService: Fetching bagrut by ID:",t);const e=await b.get(`${v}/${t}`);return console.log("ğŸ“¦ BagrutService: getBagrutById response:",e),e}catch(e){throw console.error("Error fetching bagrut:",e),new Error("×©×’×™××” ×‘×˜×¢×™× ×ª ×‘×’×¨×•×ª")}},async getBagrutByStudentId(t){try{console.log("ğŸ” BagrutService: Fetching bagrut by student ID:",t);const e=await b.get(`${v}/student/${t}`);return console.log("ğŸ“¦ BagrutService: getBagrutByStudentId response:",e),e}catch(e){throw console.error("Error fetching student bagrut:",e),new Error("×©×’×™××” ×‘×˜×¢×™× ×ª ×‘×’×¨×•×ª ×”×ª×œ××™×“")}},async createBagrut(t){try{this.validateBagrutData(t);const e=await b.post(v,t);if(console.log("ğŸ“ Create Bagrut Response:",e),e&&e._id)return e;throw console.error("Unexpected response format:",e),new Error("×ª×’×•×‘×” ×œ× ×¦×¤×•×™×” ××”×©×¨×ª")}catch(e){throw console.error("Error creating bagrut:",e),e instanceof Error?e:new Error("×©×’×™××” ×‘×™×¦×™×¨×ª ×‘×’×¨×•×ª ×—×“×©×”")}},async updateBagrut(t,e){try{return this.validateUpdateData(e),await b.put(`${v}/${t}`,e)}catch(i){throw console.error("Error updating bagrut:",i),new Error("×©×’×™××” ×‘×¢×“×›×•×Ÿ ×‘×’×¨×•×ª")}},async updateBagrutProgram(t,e){try{return await b.put(`${v}/${t}/program`,{program:e})}catch(i){throw console.error("Error updating bagrut program:",i),new Error("×©×’×™××” ×‘×¢×“×›×•×Ÿ ×ª×›× ×™×ª ×”×‘×’×¨×•×ª")}},async updatePresentation(t,e,i){try{return this.validatePresentationData(i),await b.put(`${v}/${t}/presentation/${e}`,i)}catch(E){throw console.error("Error updating presentation:",E),new Error("×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”××¦×’×ª")}},async updateDirectorEvaluation(t,e){try{return this.validateDirectorEvaluation(e),await b.put(`${v}/${t}/director-evaluation`,e)}catch(i){throw console.error("Error updating director evaluation:",i),new Error("×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”×¢×¨×›×ª ×”×× ×”×œ")}},async setRecitalConfiguration(t,e){try{return this.validateRecitalConfiguration(e),await b.put(`${v}/${t}/recital-config`,e)}catch(i){throw console.error("Error setting recital configuration:",i),new Error("×©×’×™××” ×‘×”×’×“×¨×ª ×ª×¦×•×¨×ª ×”×¨×¡×™×˜×œ")}},async calculateFinalGrade(t){try{return await b.post(`${v}/${t}/calculate-grade`)}catch(e){throw console.error("Error calculating final grade:",e),new Error("×©×’×™××” ×‘×—×™×©×•×‘ ×”×¦×™×•×Ÿ ×”×¡×•×¤×™")}},async deleteBagrut(t){try{return console.log("ğŸ—‘ï¸ BagrutService: Deleting bagrut:",t),await b.delete(`${v}/${t}`),console.log("âœ… BagrutService: Bagrut deleted successfully"),!0}catch(e){throw console.error("âŒ BagrutService: Error deleting bagrut:",e),new Error("×©×’×™××” ×‘××—×™×§×ª ×”×‘×’×¨×•×ª")}},getDefaultDetailedGrading(){return{playingSkills:{points:0,maxPoints:40,comments:""},musicalUnderstanding:{points:0,maxPoints:30,comments:""},textKnowledge:{points:0,maxPoints:20,comments:""},playingByHeart:{points:0,maxPoints:10,comments:""}}},validateBagrutData(t){if(!t.studentId)throw new Error("××–×”×” ×ª×œ××™×“ × ×“×¨×©");if(!t.teacherId)throw new Error("××–×”×” ××•×¨×” × ×“×¨×©");if(t.recitalUnits&&![3,5].includes(t.recitalUnits))throw new Error("××¡×¤×¨ ×™×—×™×“×•×ª ×—×™×™×‘ ×œ×”×™×•×ª 3 ××• 5");if(t.recitalField&&!["×§×œ××¡×™","×’'××–","×©×™×¨×”","××•×¡×™×§×” ×™×©×¨××œ×™×ª","××•×¡×™×§×” ×¢×•×œ××™×ª"].includes(t.recitalField))throw new Error("×ª×—×•× ×”×¨×¡×™×˜×œ ×œ× ×ª×§×™×Ÿ")},validateUpdateData(t){if(t.recitalUnits&&![3,5].includes(t.recitalUnits))throw new Error("××¡×¤×¨ ×™×—×™×“×•×ª ×—×™×™×‘ ×œ×”×™×•×ª 3 ××• 5");if(t.recitalField&&!["×§×œ××¡×™","×’'××–","×©×™×¨×”","××•×¡×™×§×” ×™×©×¨××œ×™×ª","××•×¡×™×§×” ×¢×•×œ××™×ª"].includes(t.recitalField))throw new Error("×ª×—×•× ×”×¨×¡×™×˜×œ ×œ× ×ª×§×™×Ÿ")},validatePresentationData(t){if(t.detailedGrading){const e=t.detailedGrading;if(e.playingSkills?.points>40)throw new Error("×›×™×©×•×¨×™ × ×’×™× ×” ×œ× ×™×›×•×œ×™× ×œ×¢×œ×•×ª ×¢×œ 40 × ×§×•×“×•×ª");if(e.musicalUnderstanding?.points>30)throw new Error("×”×‘× ×” ××•×–×™×§×œ×™×ª ×œ× ×™×›×•×œ×” ×œ×¢×œ×•×ª ×¢×œ 30 × ×§×•×“×•×ª");if(e.textKnowledge?.points>20)throw new Error("×™×“×¢ ×‘×˜×§×¡×˜ ×œ× ×™×›×•×œ ×œ×¢×œ×•×ª ×¢×œ 20 × ×§×•×“×•×ª");if(e.playingByHeart?.points>10)throw new Error("× ×’×™× ×” ×‘×¢×œ ×¤×” ×œ× ×™×›×•×œ×” ×œ×¢×œ×•×ª ×¢×œ 10 × ×§×•×“×•×ª");if((e.playingSkills?.points||0)+(e.musicalUnderstanding?.points||0)+(e.textKnowledge?.points||0)+(e.playingByHeart?.points||0)>100)throw new Error("×¡×š ×›×œ ×”× ×§×•×“×•×ª ×œ× ×™×›×•×œ ×œ×¢×œ×•×ª ×¢×œ 100")}},validateDirectorEvaluation(t){if(typeof t.points!="number")throw new Error("× ×§×•×“×•×ª ×”×× ×”×œ ×—×™×™×‘×•×ª ×œ×”×™×•×ª ××¡×¤×¨");if(t.points<0||t.points>100)throw new Error("× ×§×•×“×•×ª ×”×× ×”×œ ×—×™×™×‘×•×ª ×œ×”×™×•×ª ×‘×™×Ÿ 0 ×œ-100")},validateRecitalConfiguration(t){if(![3,5].includes(t.recitalUnits))throw new Error("××¡×¤×¨ ×™×—×™×“×•×ª ×—×™×™×‘ ×œ×”×™×•×ª 3 ××• 5");if(!["×§×œ××¡×™","×’'××–","×©×™×¨×”"].includes(t.recitalField))throw new Error("×ª×—×•× ×”×¨×¡×™×˜×œ ×—×™×™×‘ ×œ×”×™×•×ª ×§×œ××¡×™, ×’'××– ××• ×©×™×¨×”")}};function X(){const{state:t,actions:e}=x(),i=s.useCallback(async f=>{e.setLoading(!0),e.clearValidationErrors();try{console.log("ğŸ” Fetching bagruts with params:",f);const a=await B.getAllBagruts(f||{});console.log("ğŸ“‹ Raw bagruts from service:",a);const r=Array.isArray(a)?a:[];console.log("âœ… Setting bagruts in context:",r.length,"items"),e.setBagruts(r),setTimeout(()=>{console.log("ğŸ” Context state after setBagruts:",t.bagruts?.length||0)},100)}catch(a){console.error("âŒ Error fetching bagruts:",a);const r=a instanceof Error?a.message:"×©×’×™××” ×‘×˜×¢×™× ×ª ×‘×’×¨×•×™×•×ª";e.setError(r)}finally{e.setLoading(!1)}},[e,t.bagruts]),E=s.useCallback(async f=>{e.setLoading(!0),e.clearValidationErrors();try{console.log("ğŸ” fetchBagrutById: Fetching bagrut with ID:",f);const a=await B.getBagrutById(f);console.log("âœ… fetchBagrutById: Bagrut fetched successfully:",a),e.setCurrentBagrut(a),console.log("âœ… fetchBagrutById: CurrentBagrut set in context")}catch(a){console.error("âŒ fetchBagrutById: Error:",a);const r=a instanceof Error?a.message:"×©×’×™××” ×‘×˜×¢×™× ×ª ×‘×’×¨×•×ª";e.setError(r)}finally{e.setLoading(!1)}},[e]),P=s.useCallback(async f=>{e.setLoading(!0),e.clearValidationErrors();try{const a=await B.getBagrutByStudentId(f);e.setCurrentBagrut(a),a?._id&&e.recalculateGrade(a._id)}catch(a){const r=a instanceof Error?a.message:"×©×’×™××” ×‘×˜×¢×™× ×ª ×‘×’×¨×•×ª ×”×ª×œ××™×“";e.setError(r)}finally{e.setLoading(!1)}},[e]),G=s.useCallback(async f=>{e.setLoading(!0),e.clearValidationErrors();try{console.log("ğŸš€ Creating bagrut with data:",f);const a=await B.createBagrut(f);return console.log("âœ… Bagrut created successfully:",a),a&&(a._id||a.id)?(e.setCurrentBagrut(a),await i(),console.log("âœ… Context updated with new bagrut"),a):(console.error("âŒ Invalid bagrut object returned:",a),e.setError("×‘×’×¨×•×ª × ×•×¦×¨×” ××š ×œ× × ×™×ª×Ÿ ×”×™×” ×œ×˜×¢×•×Ÿ ××•×ª×”"),null)}catch(a){console.error("âŒ Error in createBagrut:",a);const r=a instanceof Error?a.message:"×©×’×™××” ×‘×™×¦×™×¨×ª ×‘×’×¨×•×ª";return e.setError(r),null}finally{e.setLoading(!1)}},[e,i]),M=s.useCallback(async(f,a)=>{e.setLoading(!0),e.clearValidationErrors();try{const r=await B.updateBagrut(f,a);return r?(e.setCurrentBagrut(r),e.recalculateGrade(f),r):null}catch(r){const n=r instanceof Error?r.message:"×©×’×™××” ×‘×¢×“×›×•×Ÿ ×‘×’×¨×•×ª";return e.setError(n),null}finally{e.setLoading(!1)}},[e]),h=s.useCallback(async f=>{e.setLoading(!0),e.clearValidationErrors();try{await B.deleteBagrut(f);const a=t.bagruts.filter(r=>r._id!==f);return e.setBagruts(a),t.currentBagrut?._id===f&&e.setCurrentBagrut(null),!0}catch(a){const r=a instanceof Error?a.message:"×©×’×™××” ×‘××—×™×§×ª ×‘×’×¨×•×ª";return e.setError(r),!1}finally{e.setLoading(!1)}},[e,t.bagruts,t.currentBagrut]),I=s.useCallback(async(f,a,r)=>{if(a<3&&t.currentBagrut&&!e.validateSequentialPresentation(a,t.currentBagrut.presentations||[])||a===3&&r.detailedGrading&&!e.validatePointTotal(r.detailedGrading))return!1;e.setLoading(!0);try{return await B.updatePresentation(f,a,r)?(e.updatePresentation(f,a,r),!0):!1}catch(n){const u=n instanceof Error?n.message:"×©×’×™××” ×‘×¢×“×›×•×Ÿ ××¦×’×ª";return e.setError(u),!1}finally{e.setLoading(!1)}},[e,t.currentBagrut]),m=s.useCallback(async(f,a)=>{if(a.points<0||a.points>100)return e.setValidationError("directorEvaluation","×”×¢×¨×›×ª ×× ×”×œ ×—×™×™×‘×ª ×œ×”×™×•×ª ×‘×™×Ÿ 0 ×œ-100"),!1;e.setLoading(!0);try{return await B.updateDirectorEvaluation(f,a)?(e.updateDirectorEvaluation(f,{points:a.points,percentage:a.points/100*100,comments:a.comments}),!0):!1}catch(r){const n=r instanceof Error?r.message:"×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”×¢×¨×›×ª ×× ×”×œ";return e.setError(n),!1}finally{e.setLoading(!1)}},[e]),A=s.useCallback(async(f,a)=>{if(a.recitalUnits!==3&&a.recitalUnits!==5)return e.setValidationError("recitalUnits","×™×—×™×“×•×ª ×¨×¡×™×˜×œ ×—×™×™×‘×•×ª ×œ×”×™×•×ª 3 ××• 5"),!1;if(!["×§×œ××¡×™","×’'××–","×©×™×¨×”"].includes(a.recitalField))return e.setValidationError("recitalField","×ª×—×•× ×¨×¡×™×˜×œ ×œ× ×—×•×§×™"),!1;e.setLoading(!0);try{return await B.setRecitalConfiguration(f,a)?(e.updateRecitalConfig(f,a),!0):!1}catch(n){const u=n instanceof Error?n.message:"×©×’×™××” ×‘×”×’×“×¨×ª ×ª×¦×•×¨×ª ×¨×¡×™×˜×œ";return e.setError(u),!1}finally{e.setLoading(!1)}},[e]),L=s.useCallback(async f=>{e.setLoading(!0);try{e.recalculateGrade(f);const a=await B.calculateFinalGrade(f);return a?(e.setCurrentBagrut(a),!0):!1}catch(a){const r=a instanceof Error?a.message:"×©×’×™××” ×‘×—×™×©×•×‘ ×¦×™×•×Ÿ ×¡×•×¤×™";return e.setError(r),!1}finally{e.setLoading(!1)}},[e]),V=s.useCallback(async(f,a)=>{if(!a.pieceTitle?.trim()||!a.composer?.trim()||!a.duration?.trim())return e.setValidationError("programPiece","× ×“×¨×©×™× ×›×•×ª×¨×ª ×™×¦×™×¨×”, ××œ×—×™×Ÿ ×•××©×š ×–××Ÿ"),!1;e.setLoading(!0);try{return await B.addProgramPiece(f,a)?(await E(f),!0):!1}catch(r){const n=r instanceof Error?r.message:"×©×’×™××” ×‘×”×•×¡×¤×ª ×™×¦×™×¨×”";return e.setError(n),!1}finally{e.setLoading(!1)}},[e,E]),U=s.useCallback(f=>{const a=t.bagruts.find(n=>n._id===f)||t.currentBagrut;if(!a)return!1;const r=[];a.program?.length||r.push("× ×“×¨×©×ª ×œ×¤×—×•×ª ×™×¦×™×¨×” ××—×ª ×‘×ª×›× ×™×ª");for(let n=0;n<3;n++)a.presentations?.[n]?.completed||r.push(`××¦×’×ª ${n+1} ×œ× ×”×•×©×œ××”`);if(!a.presentations?.[3]?.detailedGrading)r.push("××¦×’×ª ×‘×™×¦×•×¢ ×œ× ×”×•×©×œ××”");else{const n=a.presentations[3].detailedGrading;(n.playingSkills?.points||0)+(n.musicalUnderstanding?.points||0)+(n.textKnowledge?.points||0)+(n.playingByHeart?.points||0)===0&&r.push("× ×“×¨×© ×¦×™×•×Ÿ ×‘×™×¦×•×¢")}return a.directorEvaluation?.points||r.push("× ×“×¨×©×ª ×”×¢×¨×›×ª ×× ×”×œ"),(!a.recitalConfiguration?.units||!a.recitalConfiguration?.field)&&r.push("× ×“×¨×©×ª ×”×’×“×¨×ª ×ª×¦×•×¨×ª ×¨×¡×™×˜×œ"),r.length>0?(e.setValidationError("completion",r.join(", ")),!1):(e.clearValidationErrors(),!0)},[t.bagruts,t.currentBagrut,e]),F=s.useCallback(f=>{const a=t.bagruts.find(c=>c._id===f)||t.currentBagrut;if(!a)return null;const r=a.computedValues?.completionStatus||{presentations:[!1,!1,!1,!1],directorEvaluation:!1,recitalConfig:!1,program:!1},n=7,u=r.presentations.filter(Boolean).length+(r.directorEvaluation?1:0)+(r.recitalConfig?1:0)+(r.program?1:0);return{completedSteps:u,totalSteps:n,percentageComplete:Math.round(u/n*100),isComplete:u===n,missingSteps:[...r.presentations.map((c,l)=>c?null:`××¦×’×ª ${l+1}`).filter(Boolean),r.directorEvaluation?null:"×”×¢×¨×›×ª ×× ×”×œ",r.recitalConfig?null:"×ª×¦×•×¨×ª ×¨×¡×™×˜×œ",r.program?null:"×ª×›× ×™×ª"].filter(Boolean)}},[t.bagruts,t.currentBagrut]);return{state:t,fetchAllBagruts:i,fetchBagrutById:E,fetchBagrutByStudentId:P,createBagrut:G,updateBagrut:M,deleteBagrut:h,updatePresentation:I,updateDirectorEvaluation:m,setRecitalConfiguration:A,calculateFinalGrade:L,addProgramPiece:V,validateBagrutCompletion:U,getValidationSummary:F,clearError:()=>e.setError(null),clearValidationErrors:e.clearValidationErrors,recalculateGrade:e.recalculateGrade}}function Y(){const{state:t}=x(),e=s.useMemo(()=>S.getCurrentBagrut(t),[t]),i=s.useMemo(()=>{const r=S.getAllBagruts(t);return console.log("ğŸ” useBagrutSelectors: allBagruts selector:",r?.length||0,"items"),console.log("ğŸ” Raw state.bagruts:",t.bagruts?.length||0,"items"),r},[t]),E=s.useMemo(()=>S.getLoadingState(t),[t]),P=s.useMemo(()=>S.getError(t),[t]),G=s.useMemo(()=>S.getValidationErrors(t),[t]),M=s.useMemo(()=>r=>S.getBagrutById(t,r),[t]),h=s.useMemo(()=>r=>S.getCompletedPresentations(t,r),[t]),I=s.useMemo(()=>r=>S.getTotalPerformancePoints(t,r),[t]),m=s.useMemo(()=>r=>S.getWeightedFinalGrade(t,r),[t]),A=s.useMemo(()=>r=>S.getCompletionStatus(t,r),[t]),L=s.useMemo(()=>{const r=i,n=r.length,u=r.filter(y=>y.isCompleted).length,c=r.filter(y=>!y.isCompleted&&y.isActive).length,l=r.filter(y=>!y.isActive).length,d=r.filter(y=>y.finalGrade!==void 0).reduce((y,w)=>{const k=w.finalGrade;return k>=95?y.excellent++:k>=85?y.veryGood++:k>=75?y.good++:k>=65?y.almostGood++:k>=55?y.sufficient++:y.insufficient++,y},{excellent:0,veryGood:0,good:0,almostGood:0,sufficient:0,insufficient:0});return{total:n,completed:u,inProgress:c,inactive:l,completionRate:n>0?Math.round(u/n*100):0,gradeDistribution:d,averageGrade:r.length>0&&Math.round(r.filter(y=>y.finalGrade!==void 0).reduce((y,w)=>y+w.finalGrade,0)/r.filter(y=>y.finalGrade!==void 0).length)||0}},[i]),V=s.useMemo(()=>{const r=i.filter(l=>l.presentations?.length),n=[0,1,2,3].map(l=>{const d=r.filter(w=>w.presentations?.[l]?.completed).length,y=r.length;return{index:l,name:l<3?`××¦×’×ª ${l+1}`:"××¦×’×ª ×‘×™×¦×•×¢",completed:d,total:y,completionRate:y>0?Math.round(d/y*100):0}}),u=r.filter(l=>l.presentations?.[3]?.detailedGrading).map(l=>{const d=l.presentations[3].detailedGrading;return{bagrutId:l._id,studentId:l.studentId,playingSkills:d.playingSkills?.points||0,musicalUnderstanding:d.musicalUnderstanding?.points||0,textKnowledge:d.textKnowledge?.points||0,playingByHeart:d.playingByHeart?.points||0,total:(d.playingSkills?.points||0)+(d.musicalUnderstanding?.points||0)+(d.textKnowledge?.points||0)+(d.playingByHeart?.points||0)}}),c=u.length>0?{playingSkills:Math.round(u.reduce((l,d)=>l+d.playingSkills,0)/u.length),musicalUnderstanding:Math.round(u.reduce((l,d)=>l+d.musicalUnderstanding,0)/u.length),textKnowledge:Math.round(u.reduce((l,d)=>l+d.textKnowledge,0)/u.length),playingByHeart:Math.round(u.reduce((l,d)=>l+d.playingByHeart,0)/u.length),total:Math.round(u.reduce((l,d)=>l+d.total,0)/u.length)}:{playingSkills:0,musicalUnderstanding:0,textKnowledge:0,playingByHeart:0,total:0};return{presentationStats:n,performancePresentations:u,averagePerformanceScores:c}},[i]),U=s.useMemo(()=>{const r=i.filter(c=>c.directorEvaluation?.points!==void 0).map(c=>({bagrutId:c._id,studentId:c.studentId,points:c.directorEvaluation.points,hasComments:!!c.directorEvaluation.comments?.trim()})),n=r.length>0?Math.round(r.reduce((c,l)=>c+l.points,0)/r.length):0,u=r.reduce((c,l)=>{const d=l.points;return d>=95?c.excellent++:d>=85?c.veryGood++:d>=75?c.good++:d>=65?c.almostGood++:d>=55?c.sufficient++:c.insufficient++,c},{excellent:0,veryGood:0,good:0,almostGood:0,sufficient:0,insufficient:0});return{totalEvaluations:r.length,averageScore:n,scoreDistribution:u,withComments:r.filter(c=>c.hasComments).length,commentsRate:r.length>0?Math.round(r.filter(c=>c.hasComments).length/r.length*100):0}},[i]),F=s.useMemo(()=>{const r=i.filter(c=>c.recitalConfiguration?.units&&c.recitalConfiguration?.field).map(c=>({bagrutId:c._id,studentId:c.studentId,units:c.recitalConfiguration.units,field:c.recitalConfiguration.field})),n=r.reduce((c,l)=>(l.units===3?c.three++:l.units===5&&c.five++,c),{three:0,five:0}),u=r.reduce((c,l)=>(l.field==="×§×œ××¡×™"?c.classical++:l.field==="×’'××–"?c.jazz++:l.field==="×©×™×¨×”"&&c.vocal++,c),{classical:0,jazz:0,vocal:0});return{totalConfigurations:r.length,unitDistribution:n,fieldDistribution:u,configurationRate:i.length>0?Math.round(r.length/i.length*100):0}},[i]),f=s.useMemo(()=>{const n=i.filter(l=>l.computedValues?.totalPerformancePoints!==void 0&&l.computedValues?.weightedFinalGrade!==void 0&&l.directorEvaluation?.points!==void 0).map(l=>{const d=l.computedValues.totalPerformancePoints,y=l.directorEvaluation.points,w=l.computedValues.weightedFinalGrade;return{bagrutId:l._id,studentId:l.studentId,performancePoints:d,performanceGrade:d,directorPoints:y,directorGrade:y,performanceContribution:w*.9,directorContribution:w*.1,finalGrade:w,gradeLevel:l.computedValues.gradeLevel}}),u=n.length>0?Math.round(n.reduce((l,d)=>l+d.performanceContribution,0)/n.length):0,c=n.length>0?Math.round(n.reduce((l,d)=>l+d.directorContribution,0)/n.length):0;return{totalCalculatedGrades:n.length,gradeBreakdown:n,averagePerformanceContribution:u,averageDirectorContribution:c,calculationRate:i.length>0?Math.round(n.length/i.length*100):0}},[i]),a=s.useMemo(()=>({byStatus:r=>{switch(r){case"completed":return i.filter(n=>n.isCompleted);case"inProgress":return i.filter(n=>!n.isCompleted&&n.isActive);case"inactive":return i.filter(n=>!n.isActive);default:return i}},byGradeRange:(r,n)=>i.filter(u=>u.finalGrade!==void 0&&u.finalGrade>=r&&u.finalGrade<=n),byRecitalUnits:r=>i.filter(n=>n.recitalConfiguration?.units===r),byRecitalField:r=>i.filter(n=>n.recitalConfiguration?.field===r),byCompletionPercentage:r=>i.filter(n=>{if(!n.computedValues?.completionStatus)return!1;const u=n.computedValues.completionStatus;return(u.presentations.filter(Boolean).length+(u.directorEvaluation?1:0)+(u.recitalConfig?1:0)+(u.program?1:0))/7*100>=r}),needingAttention:()=>{const r=new Date,n=new Date(r.getTime()-7*24*60*60*1e3);return i.filter(u=>{if(u.isCompleted||!u.isActive)return!1;const l=new Date(u.updatedAt)<n,d=u.computedValues?.completionStatus,y=d?d.presentations.filter(Boolean).length+(d.directorEvaluation?1:0)+(d.recitalConfig?1:0)+(d.program?1:0)<4:!0;return l||y})}}),[i]);return{currentBagrut:e,allBagruts:i,loading:E,error:P,validationErrors:G,getBagrutById:M,getCompletedPresentations:h,getTotalPerformancePoints:I,getWeightedFinalGrade:m,getCompletionStatus:A,bagrutStatistics:L,presentationAnalytics:V,directorEvaluationAnalytics:U,recitalConfigAnalytics:F,gradeCalculationInsights:f,filterBagruts:a}}function re(){let t,e;try{t=X(),e=Y(),console.log("ğŸ”— Using BagrutContext for state management")}catch(g){console.log("âš ï¸ BagrutContext not available, falling back to local state:",g)}const[i,E]=s.useState(null),[P,G]=s.useState([]),[M,h]=s.useState(!1),[I,m]=s.useState(null),[A,L]=s.useState(null),V=e?.currentBagrut??i,U=e?.allBagruts??P,F=e?.loading??M,f=e?.error??I,a=s.useCallback(()=>{t?t.clearError():m(null)},[t]),r=s.useCallback(()=>{},[]),n=s.useCallback(async g=>{if(t)return t.fetchAllBagruts(g);h(!0),m(null);try{const o=await B.getAllBagruts(g||{});G(Array.isArray(o)?o:[]),L(null)}catch(o){const p=o instanceof Error?o.message:"×©×’×™××” ×œ× ×™×“×•×¢×”";m(p),console.error("Error fetching bagruts:",o)}finally{h(!1)}},[t]),u=s.useCallback(async g=>{if(t)return t.fetchBagrutById(g);h(!0),m(null);try{const o=await B.getBagrutById(g);E(o||null)}catch(o){const p=o instanceof Error?o.message:"×©×’×™××” ×œ× ×™×“×•×¢×”";m(p),console.error("Error fetching bagrut:",o)}finally{h(!1)}},[t]),c=s.useCallback(async g=>{if(t)return t.fetchBagrutByStudentId(g);h(!0),m(null);try{const o=await B.getBagrutByStudentId(g);E(o||null)}catch(o){const p=o instanceof Error?o.message:"×©×’×™××” ×œ× ×™×“×•×¢×”";m(p),console.error("Error fetching student bagrut:",o)}finally{h(!1)}},[t]),l=s.useCallback(async g=>{if(t)return t.createBagrut(g);h(!0),m(null);try{const o=await B.createBagrut(g);if(E(o||null),o){const p=await B.getAllBagruts({});G(Array.isArray(p)?p:[])}return o}catch(o){const p=o instanceof Error?o.message:"×©×’×™××” ×œ× ×™×“×•×¢×”";return m(p),console.error("Error creating bagrut:",o),null}finally{h(!1)}},[t]),d=s.useCallback(async(g,o)=>{if(t)return t.updateBagrut(g,o);h(!0),m(null);try{const p=await B.updateBagrut(g,o);return E(p||null),p}catch(p){const C=p instanceof Error?p.message:"×©×’×™××” ×œ× ×™×“×•×¢×”";return m(C),console.error("Error updating bagrut:",p),null}finally{h(!1)}},[t]),y=s.useCallback(async g=>{if(t)return t.deleteBagrut(g);h(!0),m(null);try{return await B.deleteBagrut(g),G(o=>o.filter(p=>p._id!==g)),i?._id===g&&E(null),!0}catch(o){const p=o instanceof Error?o.message:"×©×’×™××” ×‘××—×™×§×ª ×”×‘×’×¨×•×ª";return m(p),console.error("Error deleting bagrut:",o),!1}finally{h(!1)}},[t,i]),w=s.useCallback(async(g,o,p)=>{if(t)return t.updatePresentation(g,o,p);h(!0),m(null);try{const C=await B.updatePresentation(g,o,p);return E(C||null),!0}catch(C){const Q=C instanceof Error?C.message:"×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”××¦×’×ª";return m(Q),!1}finally{h(!1)}},[t]),k=s.useCallback(async(g,o)=>(m("×¢×“×›×•×Ÿ ××’×Ÿ ×‘×’×¨×•×ª ×œ× ××•×©×œ× ×¢×“×™×™×Ÿ"),!1),[]),R=s.useCallback(async(g,o)=>{try{return m(null),await apiService.bagrutApi.updateGradingDetails(g,o),console.log(`âœ… Updated grading details for bagrut: ${g}`),!0}catch(p){return console.error("âŒ Error updating grading details:",p),m("×©×’×™××” ×‘×¢×“×›×•×Ÿ ×¤×¨×˜×™ ×”×¦×™×•× ×™×"),!1}},[]),$=s.useCallback(async g=>{if(t)return t.calculateFinalGrade(g);h(!0),m(null);try{const o=await B.calculateFinalGrade(g);return E(o||null),!0}catch(o){const p=o instanceof Error?o.message:"×©×’×™××” ×‘×—×™×©×•×‘ ×”×¦×™×•×Ÿ ×”×¡×•×¤×™";return m(p),!1}finally{h(!1)}},[t]),_=s.useCallback(async(g,o)=>(m("×”×©×œ××ª ×‘×’×¨×•×ª ×œ× ××•×©×œ××ª ×¢×“×™×™×Ÿ"),!1),[]),D=s.useCallback(async(g,o,p,C)=>(m("×”×¢×œ××ª ××¡××›×™× ×œ× ××•×©×œ××ª ×¢×“×™×™×Ÿ"),!1),[]),H=s.useCallback(async(g,o)=>(m("××—×™×§×ª ××¡××›×™× ×œ× ××•×©×œ××ª ×¢×“×™×™×Ÿ"),!1),[]),K=s.useCallback(async(g,o)=>(m("×”×•×¨×“×ª ××¡××›×™× ×œ× ××•×©×œ××ª ×¢×“×™×™×Ÿ"),null),[]),T=s.useCallback(async(g,o)=>(m("×”×•×¡×¤×ª ×™×¦×™×¨×•×ª ×œ× ××•×©×œ××ª ×¢×“×™×™×Ÿ"),!1),[]),W=s.useCallback(async(g,o)=>(m("×¢×“×›×•×Ÿ ×ª×›× ×™×ª ×œ× ××•×©×œ× ×¢×“×™×™×Ÿ"),!1),[]),j=s.useCallback(async(g,o)=>(m("××—×™×§×ª ×™×¦×™×¨×•×ª ×œ× ××•×©×œ××ª ×¢×“×™×™×Ÿ"),!1),[]),z=s.useCallback(async(g,o)=>(m("×”×•×¡×¤×ª ××œ×•×•×™× ×œ× ××•×©×œ××ª ×¢×“×™×™×Ÿ"),!1),[]),q=s.useCallback(async(g,o)=>(m("××—×™×§×ª ××œ×•×•×™× ×œ× ××•×©×œ××ª ×¢×“×™×™×Ÿ"),!1),[]),J=s.useCallback(async(g,o)=>{if(t)return t.updateDirectorEvaluation(g,o);h(!0),m(null);try{const p=await B.updateDirectorEvaluation(g,o);return E(p||null),!0}catch(p){const C=p instanceof Error?p.message:"×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”×¢×¨×›×ª ×”×× ×”×œ";return m(C),!1}finally{h(!1)}},[t]),N=s.useCallback(async(g,o)=>{if(t)return t.setRecitalConfiguration(g,o);h(!0),m(null);try{const p=await B.setRecitalConfiguration(g,o);return E(p||null),!0}catch(p){const C=p instanceof Error?p.message:"×©×’×™××” ×‘×”×’×“×¨×ª ×ª×¦×•×¨×ª ×”×¨×¡×™×˜×œ";return m(C),!1}finally{h(!1)}},[t]),O=s.useCallback(()=>B.getDefaultDetailedGrading(),[]);return{bagrut:V,bagruts:U,loading:F,error:f,pagination:A,fetchAllBagruts:n,fetchBagrutById:u,fetchBagrutByStudentId:c,createBagrut:l,updateBagrut:d,deleteBagrut:y,updatePresentation:w,updateMagenBagrut:k,updateGradingDetails:R,calculateFinalGrade:$,completeBagrut:_,uploadDocument:D,removeDocument:H,downloadDocument:K,addProgramPiece:T,updateProgram:W,removeProgramPiece:j,addAccompanist:z,removeAccompanist:q,updateDirectorEvaluation:J,setRecitalConfiguration:N,getDefaultDetailedGrading:O,clearError:a,refreshCache:r}}export{re as u};
