import{V as T,j as e,h as Ie,u as Se,a as ke}from"../assets/index-CoKafZFz.js";import{r as m,b as Me}from"./vendor-C9PcmKF2.js";import{C as J}from"./Card-1BAWwzNR.js";import{T as De}from"./Table-AhthNN5h.js";import{X as se,M as z,f as te,U as G,g as B,h as Oe,O as ce,T as re,c as oe,e as de,a as me,q as ee,S as H,F as xe,af as Ae,G as _e,a2 as Ee,a7 as $e,ag as Pe,A as Re,P as ie,J as Te,_ as Fe,a6 as Le}from"./ui-DsxFGtGk.js";import{S as Z}from"./StatsCard-DEtP3a5j.js";import{o as F,f as ue,t as he,r as Ve}from"./cascade-deletion-BvQll6O-.js";import"./query-BdHdBeoH.js";import"./utils-x1PSU_OZ.js";const ae=["×”×¨×›×‘","×ª×–××•×¨×ª"],le=s=>{switch(s){case"×ª×–××•×¨×ª":return{text:"×ª×–××•×¨×ª",colorClass:"bg-blue-100 text-blue-800",icon:""};case"×”×¨×›×‘":return{text:"×”×¨×›×‘",colorClass:"bg-green-100 text-green-800",icon:""};default:return{text:s,colorClass:"bg-gray-100 text-gray-800",icon:""}}},ne=s=>{if(!s.isActive)return{text:"×œ× ×¤×¢×™×œ",colorClass:"bg-gray-100 text-gray-800"};const a=s.memberIds?.length||0;return a===0?{text:"×œ×œ× ×—×‘×¨×™×",colorClass:"bg-yellow-100 text-yellow-800"}:a<5?{text:"×”×¨×›×‘ ×§×˜×Ÿ",colorClass:"bg-orange-100 text-orange-800"}:a>=15?{text:"×”×¨×›×‘ ×’×“×•×œ",colorClass:"bg-purple-100 text-purple-800"}:{text:"×¤×¢×™×œ",colorClass:"bg-green-100 text-green-800"}},ge=s=>{const a=s.memberIds?.length||0,i=s.rehearsalIds?.length||0,o=!!s.conductorId;let c=0;if(s.rehearsals&&s.rehearsals.length>0){const x=s.rehearsals.slice(-5).map(p=>{const d=p.attendance?.present?.length||0,j=a;return j>0?d/j*100:0});c=x.length>0?Math.round(x.reduce((p,d)=>p+d,0)/x.length):0}return{memberCount:a,rehearsalCount:i,hasConductor:o,averageAttendance:c,isFullyConfigured:o&&a>0,orchestraSize:a>=15?"×’×“×•×œ":a>=5?"×‘×™× ×•× ×™":"×§×˜×Ÿ"}},qe=(s,a)=>s.filter(i=>{if(a.searchQuery){const o=a.searchQuery.toLowerCase(),c=W(i);if(!(i.name?.toLowerCase().includes(o)||c.toLowerCase().includes(o)||i.location?.toLowerCase().includes(o)))return!1}return!(a.type&&i.type!==a.type||a.conductorId&&i.conductorId!==a.conductorId||a.location&&i.location!==a.location||a.isActive!==void 0&&i.isActive!==a.isActive||a.hasMembers!==void 0&&(i.memberIds?.length||0)>0!==a.hasMembers)}),ze=(s,a="name",i="asc")=>[...s].sort((c,u)=>{let x=0;switch(a){case"name":x=c.name.localeCompare(u.name,"he");break;case"type":x=c.type.localeCompare(u.type,"he");break;case"conductor":const p=W(c),d=W(u);x=p.localeCompare(d,"he");break;case"memberCount":x=(c.memberIds?.length||0)-(u.memberIds?.length||0);break;case"location":x=c.location.localeCompare(u.location,"he");break;case"rehearsalCount":x=(c.rehearsalIds?.length||0)-(u.rehearsalIds?.length||0);break;default:x=0}return i==="desc"?-x:x}),pe=s=>s===0?"××™×Ÿ ×—×‘×¨×™×":s===1?"×—×‘×¨ ××—×“":s===2?"×©× ×™ ×—×‘×¨×™×":`${s} ×—×‘×¨×™×`,be=s=>s===0?"××™×Ÿ ×—×–×¨×•×ª":s===1?"×—×–×¨×” ××—×ª":s===2?"×©×ª×™ ×—×–×¨×•×ª":`${s} ×—×–×¨×•×ª`,W=s=>s.conductor?.personalInfo?.fullName?s.conductor.personalInfo.fullName:s.conductorInfo?.name?s.conductorInfo.name:s.conductorDetails?.personalInfo?.fullName?s.conductorDetails.personalInfo.fullName:s.conductorId?"×˜×•×¢×Ÿ × ×ª×•× ×™ ×× ×¦×—...":"×œ× ×”×•×§×¦×” ×× ×¦×—",Be=s=>{const a={};return s.name?.trim()?s.name.length<2?a.name="×©× ×”×ª×–××•×¨×ª ×—×™×™×‘ ×œ×”×›×™×œ ×œ×¤×—×•×ª 2 ×ª×•×•×™×":s.name.length>100&&(a.name="×©× ×”×ª×–××•×¨×ª ×œ× ×™×›×•×œ ×œ×¢×œ×•×ª ×¢×œ 100 ×ª×•×•×™×"):a.name="×©× ×”×ª×–××•×¨×ª × ×“×¨×©",s.type?ae.includes(s.type)||(a.type="×¡×•×’ ×”×¨×›×‘ ×œ× ×ª×§×™×Ÿ"):a.type="×¡×•×’ ×”×¨×›×‘ × ×“×¨×©",s.location?T.includes(s.location)||(a.location="××™×§×•× ×œ× ×ª×§×™×Ÿ"):a.location="××™×§×•× × ×“×¨×©",s.conductorId?.trim()||(a.conductorId="×× ×¦×— × ×“×¨×©"),{isValid:Object.keys(a).length===0,errors:a}},fe=s=>{const a={},i=[];return!s||s.length===0?{instrumentCounts:a,totalInstruments:0,primaryInstruments:i}:(s.forEach(o=>{o.academicInfo?.instrumentProgress&&o.academicInfo.instrumentProgress.forEach(c=>{const u=c.instrumentName;a[u]=(a[u]||0)+1,c.isPrimary&&!i.includes(u)&&i.push(u)})}),{instrumentCounts:a,totalInstruments:Object.keys(a).length,primaryInstruments:i.sort()})},Qe=s=>{const a=[],i=[];let o=0;s.conductorId?(o+=25,i.push("×™×© ×× ×¦×— ××•×§×¦×”")):a.push("××™×Ÿ ×× ×¦×— ××•×§×¦×”");const c=s.memberIds?.length||0;c>=8?(o+=25,i.push(`${c} ×—×‘×¨×™× ×‘×”×¨×›×‘`)):c>=4?(o+=15,i.push(`${c} ×—×‘×¨×™× ×‘×”×¨×›×‘`)):c>0?(o+=5,a.push("××¢×˜ ×—×‘×¨×™× ×‘×”×¨×›×‘")):a.push("××™×Ÿ ×—×‘×¨×™× ×‘×”×¨×›×‘"),s.location&&s.location!=="×—×“×¨ 1"?(o+=10,i.push(`××™×§×•× ××•×’×“×¨: ${s.location}`)):(o+=5,a.push("××™×§×•× ×‘×¨×™×¨×ª ××—×“×œ"));const u=s.rehearsalIds?.length||0;return u>=3?(o+=25,i.push(`${u} ×—×–×¨×•×ª ××ª×•×›× × ×•×ª`)):u>=1?(o+=15,i.push(`${u} ×—×–×¨×•×ª ××ª×•×›× × ×•×ª`)):a.push("××™×Ÿ ×—×–×¨×•×ª ××ª×•×›× × ×•×ª"),s.isActive?(o+=15,i.push("×”×¨×›×‘ ×¤×¢×™×œ")):a.push("×”×¨×›×‘ ×œ× ×¤×¢×™×œ"),{isReady:o>=75,score:Math.min(100,o),issues:a,strengths:i}};function Ue({orchestra:s,teachers:a,onSubmit:i,onCancel:o}){const[c,u]=m.useState({name:"",type:"×ª×–××•×¨×ª",conductorId:"",memberIds:[],location:"×—×“×¨ 1",isActive:!0}),[x,p]=m.useState(!1),[d,j]=m.useState({});m.useEffect(()=>{s&&u({name:s.name||"",type:s.type||"×ª×–××•×¨×ª",conductorId:s.conductorId||"",memberIds:s.memberIds||[],location:s.location||"×—×“×¨ 1",isActive:s.isActive!==void 0?s.isActive:!0})},[s]);const f=(t,b)=>{u(l=>({...l,[t]:b})),d[t]&&j(l=>{const h={...l};return delete h[t],h})},N=async t=>{t.preventDefault();const b=Be(c);if(!b.isValid){j(b.errors);return}p(!0);try{const{memberIds:l,...h}=c;await i(h)}catch(l){console.error("Error submitting orchestra form:",l);const{fieldErrors:h,generalMessage:S,isValidationError:k}=Ie(l,"×©×’×™××” ×‘×©××™×¨×ª ×”×ª×–××•×¨×ª");j(k?{...h,general:S}:{general:S})}finally{p(!1)}},D=a.filter(t=>t.roles?.includes("×× ×¦×—")||t.professionalInfo?.instrument==="×× ×”×™×’×•×ª ××•×–×™×§×œ×™×ª"||t.conducting?.orchestraIds?.length>0);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:s?"×¢×¨×™×›×ª ×ª×–××•×¨×ª":"×ª×–××•×¨×ª ×—×“×©×”"}),e.jsx("button",{onClick:o,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(se,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("form",{onSubmit:N,className:"p-6 space-y-6",children:[d.general&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-800 text-sm",children:d.general})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(z,{className:"w-4 h-4 inline ml-1"}),"×©× ×”×ª×–××•×¨×ª *"]}),e.jsx("input",{type:"text",value:c.name,onChange:t=>f("name",t.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${d.name?"border-red-300":"border-gray-300"}`,placeholder:"×”×–×Ÿ ×©× ×œ×ª×–××•×¨×ª",required:!0}),d.name&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:d.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×¡×•×’ ×”×¨×›×‘ *"}),e.jsx("select",{value:c.type,onChange:t=>f("type",t.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${d.type?"border-red-300":"border-gray-300"}`,required:!0,children:ae.map(t=>e.jsx("option",{value:t,children:t},t))}),d.type&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:d.type})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(te,{className:"w-4 h-4 inline ml-1"}),"××™×§×•× ×—×–×¨×•×ª *"]}),e.jsxs("select",{value:c.location,onChange:t=>f("location",t.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${d.location?"border-red-300":"border-gray-300"}`,required:!0,children:[e.jsx("optgroup",{label:"××•×œ××•×ª",children:T.filter(t=>t.includes("××•×œ×")).map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx("optgroup",{label:"×¡×˜×•×“×™×•××™×",children:T.filter(t=>t.includes("×¡×˜×•×“×™×•")).map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx("optgroup",{label:"×—×“×¨×™ ×—×–×¨×•×ª",children:T.filter(t=>t.includes("×—×“×¨ ×—×–×¨×•×ª")).map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx("optgroup",{label:"×—×“×¨×™ ×œ×™××•×“",children:T.filter(t=>t.startsWith("×—×“×¨")&&!t.includes("×—×–×¨×•×ª")&&!t.includes("×ª××•×¨×™×”")).map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx("optgroup",{label:"×—×“×¨×™ ×ª×™××•×¨×™×”",children:T.filter(t=>t.includes("×ª××•×¨×™×”")).map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx("optgroup",{label:"××—×¨",children:T.filter(t=>!t.includes("××•×œ×")&&!t.includes("×¡×˜×•×“×™×•")&&!t.includes("×—×“×¨")).map(t=>e.jsx("option",{value:t,children:t},t))})]}),d.location&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:d.location})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(G,{className:"w-4 h-4 inline ml-1"}),"×× ×¦×— *"]}),e.jsxs("select",{value:c.conductorId,onChange:t=>f("conductorId",t.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent ${d.conductorId?"border-red-300":"border-gray-300"}`,required:!0,children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×× ×¦×—"}),D.map(t=>e.jsxs("option",{value:t._id,children:[t.personalInfo?.fullName,t.professionalInfo?.instrument&&e.jsxs("span",{className:"text-gray-500",children:[" - ",t.professionalInfo.instrument]})]},t._id))]}),d.conductorId&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:d.conductorId}),D.length===0&&e.jsx("p",{className:"text-orange-600 text-xs mt-1",children:"âš ï¸ ×œ× × ××¦××• ××•×¨×™× ×¢× ×ª×¤×§×™×“ ×× ×¦×—. × ×™×ª×Ÿ ×œ×”×•×¡×™×£ ××•×¨×™× ×—×“×©×™× ×‘×¢××•×“ ×”××•×¨×™×."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(B,{className:"w-4 h-4 inline ml-1"}),"×—×‘×¨×™ ×”×ª×–××•×¨×ª"]}),c.memberIds.length>0?e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[c.memberIds.length," ×—×‘×¨×™× ×‘×ª×–××•×¨×ª"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"× ×™×”×•×œ ×—×‘×¨×™× ×™×”×™×” ×–××™×Ÿ ×‘×¢××•×“ ×”×¤×¨×˜×™× ×©×œ ×”×ª×–××•×¨×ª"})]}):e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsx("p",{className:"text-blue-800 text-sm",children:"ğŸ“ ×œ××—×¨ ×™×¦×™×¨×ª ×”×ª×–××•×¨×ª, ×ª×•×›×œ ×œ×”×•×¡×™×£ ×—×‘×¨×™× ×‘×¢××•×“ ×”×¤×¨×˜×™×"})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:c.isActive,onChange:t=>f("isActive",t.target.checked),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsx("span",{className:"mr-2 text-sm text-gray-700",children:"×ª×–××•×¨×ª ×¤×¢×™×œ×”"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"×ª×–××•×¨×•×ª ×œ× ×¤×¢×™×œ×•×ª ×œ× ×™×•×¦×’×• ×‘×¨×©×™××•×ª ×”×¨××©×™×•×ª"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:o,className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",disabled:x,children:"×‘×™×˜×•×œ"}),e.jsxs("button",{type:"submit",disabled:x,className:"flex items-center px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors disabled:opacity-50",children:[x?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white ml-2"}):e.jsx(Oe,{className:"w-4 h-4 ml-2"}),s?"×¢×“×›×Ÿ ×ª×–××•×¨×ª":"×¦×•×¨ ×ª×–××•×¨×ª"]})]})]})]})})}function Ye({orchestra:s,onEdit:a,onDelete:i,onViewDetails:o}){const c=le(s.type),u=ne(s),x=ge(s),p=fe(s.members),d=()=>{o&&o(s._id)},j=()=>{a&&a(s)},f=()=>{i&&i(s._id)};return e.jsxs("div",{className:`bg-white rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-all duration-200 group hover:border-blue-300 ${o?"cursor-pointer":""}`,onClick:o?d:void 0,children:[e.jsx("div",{className:"p-4 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded-full bg-gray-100 text-gray-700 group-hover:bg-blue-50 group-hover:text-blue-700 transition-colors",children:c.text}),e.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded-full bg-gray-100 text-gray-700 group-hover:bg-blue-50 group-hover:text-blue-700 transition-colors",children:u.text})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1 leading-tight group-hover:text-blue-900 transition-colors",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600 flex items-center group-hover:text-blue-600 transition-colors",children:[e.jsx(G,{className:"w-3 h-3 ml-1"}),W(s)]})]}),e.jsxs("div",{className:"flex items-center gap-1 mr-2",children:[a&&e.jsx("button",{onClick:N=>{N.stopPropagation(),j()},className:"p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors opacity-0 group-hover:opacity-100",title:"×¢×¨×•×š ×ª×–××•×¨×ª",children:e.jsx(ce,{className:"w-4 h-4"})}),i&&e.jsx("button",{onClick:N=>{N.stopPropagation(),f()},className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors opacity-0 group-hover:opacity-100",title:"××—×§ ×ª×–××•×¨×ª",children:e.jsx(re,{className:"w-4 h-4"})})]})]})}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(te,{className:"w-4 h-4 ml-2 text-gray-400"}),e.jsx("span",{className:"font-medium text-gray-900 ml-1",children:"××™×§×•×:"}),s.location]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(B,{className:"w-4 h-4 ml-2 text-gray-400"}),e.jsx("span",{className:"font-medium text-gray-900 ml-1",children:"×—×‘×¨×™×:"}),pe(x.memberCount)]}),e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(oe,{className:"w-4 h-4 ml-2 text-gray-400"}),e.jsx("span",{className:"font-medium text-gray-900 ml-1",children:"×—×–×¨×•×ª:"}),be(x.rehearsalCount)]})]}),p.totalInstruments>0&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[e.jsx(z,{className:"w-4 h-4 inline ml-1"}),"×›×œ×™ × ×’×™× ×”"]}),e.jsxs("span",{className:"text-xs text-gray-500",children:[p.totalInstruments," ×¡×•×’×™×"]})]}),p.primaryInstruments.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1",children:[p.primaryInstruments.slice(0,4).map(N=>e.jsxs("span",{className:"text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded-full",children:[N,e.jsxs("span",{className:"mr-1 text-gray-600",children:["(",p.instrumentCounts[N],")"]})]},N)),p.primaryInstruments.length>4&&e.jsxs("span",{className:"text-xs text-gray-500 px-2 py-1",children:["+",p.primaryInstruments.length-4," × ×•×¡×¤×™×"]})]})]}),x.averageAttendance>0&&e.jsx("div",{className:"flex items-center bg-gray-50 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(de,{className:"w-4 h-4 ml-2 text-gray-400"}),e.jsx("span",{className:"font-medium text-gray-900 ml-1",children:"× ×•×›×—×•×ª ×××•×¦×¢×ª:"}),e.jsxs("span",{className:"text-gray-600",children:[x.averageAttendance,"%"]})]})}),e.jsxs("div",{className:"text-xs text-gray-500 text-center pt-2 border-t border-gray-100 flex justify-between",children:[e.jsxs("span",{children:["×”×¨×›×‘ ",x.orchestraSize]}),e.jsx("span",{children:x.isFullyConfigured?"××•×’×“×¨ ×‘××œ×•××•":"×“×•×¨×© ×”×©×œ××”"})]})]})]})}function Ge({onViewDetails:s,onEditOrchestra:a,onManageMembers:i,onDeleteOrchestra:o}){const[c,u]=m.useState([]),[x,p]=m.useState(!0),[d,j]=m.useState(null),[f,N]=m.useState("all");m.useEffect(()=>{D()},[]);const D=async()=>{try{p(!0),j(null);const[l,h,S,k]=await Promise.all([F.getOrchestras(),ue.getStudents(),he.getTeachers(),Ve.getRehearsals().catch(()=>[])]),v=new Date,P=l.map(O=>{const Q=h.filter(w=>O.memberIds?.includes(w._id)),A=S.find(w=>w._id===O.conductorId),_=k.filter(w=>w.orchestraId===O._id),L=_.length,U=_.filter(w=>new Date(w.date)>=v).sort((w,E)=>new Date(w.date).getTime()-new Date(E.date).getTime()).slice(0,3);return{...O,memberDetails:Q,conductorDetails:A,rehearsalCount:L,upcomingRehearsals:U}});u(P)}catch(l){console.error("Error loading orchestra data:",l),j("×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™ ×ª×–××•×¨×•×ª")}finally{p(!1)}},t=c.filter(l=>{switch(f){case"active":return l.isActive;case"inactive":return!l.isActive;case"×ª×–××•×¨×ª":case"×”×¨×›×‘":return l.type===f;default:return!0}}),b={total:c.length,active:c.filter(l=>l.isActive).length,totalMembers:c.reduce((l,h)=>l+(h.memberIds?.length||0),0),withConductor:c.filter(l=>l.conductorId).length,avgMembersPerOrchestra:c.length>0?Math.round(c.reduce((l,h)=>l+(h.memberIds?.length||0),0)/c.length):0,typeDistribution:{×ª×–××•×¨×ª:c.filter(l=>l.type==="×ª×–××•×¨×ª").length,×”×¨×›×‘:c.filter(l=>l.type==="×”×¨×›×‘").length}};return x?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[...Array(4)].map((l,h)=>e.jsx("div",{className:"h-24 bg-gray-200 rounded"},h))}),e.jsx("div",{className:"h-64 bg-gray-200 rounded"})]})}):e.jsxs("div",{className:"space-y-6",children:[d&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-center",children:[e.jsx(me,{className:"w-5 h-5 text-red-600 ml-2"}),e.jsx("span",{className:"text-red-800",children:d})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx(Z,{title:"×¡×”×´×› ×ª×–××•×¨×•×ª",value:b.total.toString(),subtitle:`${b.active} ×¤×¢×™×œ×•×ª`,icon:e.jsx(z,{}),color:"blue",trend:{value:b.typeDistribution.×ª×–××•×¨×ª,label:"×ª×–××•×¨×•×ª",direction:"up"}}),e.jsx(Z,{title:"×¡×”×´×› ××‘×¦×¢×™×",value:b.totalMembers.toString(),subtitle:`×××•×¦×¢ ${b.avgMembersPerOrchestra} ×œ×ª×–××•×¨×ª`,icon:e.jsx(B,{}),color:"green",trend:{value:b.typeDistribution.×”×¨×›×‘,label:"×”×¨×›×‘×™×",direction:"up"}}),e.jsx(Z,{title:"×× ×¦×—×™× ××•×§×¦×™×",value:`${b.withConductor}/${b.total}`,subtitle:`${Math.round(b.withConductor/Math.max(b.total,1)*100)}% ×”×§×¦××”`,icon:e.jsx(G,{}),color:"purple"})]}),e.jsx("div",{className:"flex items-center gap-2 border-b border-gray-200",children:[{key:"all",label:"×”×›×œ",count:b.total},{key:"active",label:"×¤×¢×™×œ×•×ª",count:b.active},{key:"inactive",label:"×œ× ×¤×¢×™×œ×•×ª",count:b.total-b.active},{key:"×ª×–××•×¨×ª",label:"×ª×–××•×¨×•×ª",count:b.typeDistribution.×ª×–××•×¨×ª},{key:"×”×¨×›×‘",label:"×”×¨×›×‘×™×",count:b.typeDistribution.×”×¨×›×‘}].map(l=>e.jsxs("button",{onClick:()=>N(l.key),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${f===l.key?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[l.label," (",l.count,")"]},l.key))}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:t.map(l=>{const h=le(l.type),S=ne(l),k=fe(l.memberDetails||[]);return Qe(l),e.jsx(J,{className:"hover:shadow-lg transition-shadow cursor-pointer hover:border-primary-300 p-5",onClick:()=>s?.(l._id),children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-lg mb-2",children:l.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full bg-gray-100 text-gray-700",children:h.text}),e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full bg-gray-100 text-gray-700",children:S.text})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(G,{className:"w-4 h-4 text-gray-400"}),l.conductorDetails?e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900",children:l.conductorDetails.personalInfo.fullName}),l.conductorDetails.professionalInfo?.instrument&&e.jsx("span",{className:"text-gray-500 text-xs block",children:l.conductorDetails.professionalInfo.instrument})]}):e.jsx("span",{className:"text-gray-500",children:"×œ× ×”×•×§×¦×” ×× ×¦×—"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(te,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:l.location})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(B,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-600",children:[l.memberDetails?.length||0," ×—×‘×¨×™×",k.totalInstruments>0&&e.jsxs("span",{className:"text-gray-500 text-xs",children:[" ","â€¢ ",k.totalInstruments," ×›×œ×™ × ×’×™× ×”"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(oe,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-600",children:[l.rehearsalCount||0," ×—×–×¨×•×ª",l.upcomingRehearsals&&l.upcomingRehearsals.length>0&&e.jsxs("span",{className:"text-green-600 text-xs",children:[" ","â€¢ ",l.upcomingRehearsals.length," ×¢×ª×™×“×•×ª"]})]})]})]}),l.upcomingRehearsals&&l.upcomingRehearsals.length>0&&e.jsxs("div",{className:"border-t border-gray-100 pt-3",children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-2",children:"×—×–×¨×•×ª ×§×¨×•×‘×•×ª:"}),e.jsx("div",{className:"space-y-1",children:l.upcomingRehearsals.slice(0,2).map(v=>e.jsxs("div",{className:"text-xs text-gray-600 flex items-center gap-2",children:[e.jsx(de,{className:"w-3 h-3"}),e.jsxs("span",{children:[new Date(v.date).toLocaleDateString("he-IL")," â€¢ ",v.startTime]})]},v._id))})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-3 border-t border-gray-100",children:[e.jsxs("button",{onClick:v=>{v.stopPropagation(),i?.(l._id)},className:"flex items-center gap-1 px-3 py-2 text-xs bg-green-50 text-green-700 rounded-lg hover:bg-green-100 transition-colors",children:[e.jsx(ee,{className:"w-3 h-3"}),"×—×‘×¨×™×"]}),e.jsxs("button",{onClick:v=>{v.stopPropagation(),a?.(l)},className:"flex items-center gap-1 px-3 py-2 text-xs bg-gray-50 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx(ce,{className:"w-3 h-3"}),"×¢×¨×™×›×”"]}),e.jsx("button",{onClick:v=>{v.stopPropagation(),o?.(l._id)},className:"flex items-center gap-1 px-3 py-2 text-xs bg-red-50 text-red-700 rounded-lg hover:bg-red-100 transition-colors",children:e.jsx(re,{className:"w-3 h-3"})})]})]})},l._id)})}),t.length===0&&!x&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(z,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:f==="all"?"××™×Ÿ ×ª×–××•×¨×•×ª":`××™×Ÿ ×ª×–××•×¨×•×ª ${f==="active"?"×¤×¢×™×œ×•×ª":f==="inactive"?"×œ× ×¤×¢×™×œ×•×ª":f==="×ª×–××•×¨×ª"?"××¡×•×’ ×ª×–××•×¨×ª":f==="×”×¨×›×‘"?"××¡×•×’ ×”×¨×›×‘":""}`}),e.jsx("p",{className:"text-gray-600",children:f==="all"?"×”×ª×—×œ ×¢×œ ×™×“×™ ×™×¦×™×¨×ª ×”×ª×–××•×¨×ª ×”×¨××©×•× ×”":"×©× ×” ××ª ×”××¡× ×Ÿ ×œ×¨××•×ª ×ª×–××•×¨×•×ª ××—×¨×•×ª"})]})]})}function We({orchestraId:s,isOpen:a,onClose:i,onUpdate:o}){const[c,u]=m.useState(null),[x,p]=m.useState([]),[d,j]=m.useState([]),[f,N]=m.useState([]),[D,t]=m.useState(!0),[b,l]=m.useState(null),[h,S]=m.useState(""),[k,v]=m.useState(""),[P,O]=m.useState(""),[Q,A]=m.useState(null);m.useEffect(()=>{a&&s&&_()},[a,s]);const _=async()=>{try{t(!0),l(null);const[n,y]=await Promise.all([F.getOrchestra(s),ue.getStudents()]);u(n),p(y);const M=new Set(n.memberIds||[]),I=y.filter(R=>M.has(R._id)),Y=y.filter(R=>!M.has(R._id)&&R.isActive);j(I),N(Y)}catch(n){console.error("Error loading data:",n),l("×©×’×™××” ×‘×˜×¢×™× ×ª ×”× ×ª×•× ×™×")}finally{t(!1)}},L=async n=>{try{A(n),await F.addMember(s,n),await _(),o?.()}catch(y){console.error("Error adding member:",y),l("×©×’×™××” ×‘×”×•×¡×¤×ª ×—×‘×¨ ×œ×ª×–××•×¨×ª")}finally{A(null)}},U=async n=>{if(window.confirm("×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×”×¡×™×¨ ××ª ×”×—×‘×¨ ××”×ª×–××•×¨×ª?"))try{A(n),await F.removeMember(s,n),await _(),o?.()}catch(y){console.error("Error removing member:",y),l("×©×’×™××” ×‘×”×¡×¨×ª ×—×‘×¨ ××”×ª×–××•×¨×ª")}finally{A(null)}},w=n=>n.filter(y=>{if(h){const M=h.toLowerCase();if(!y.personalInfo.fullName.toLowerCase().includes(M))return!1}return!(k&&y.academicInfo?.class!==k||P&&!y.academicInfo?.instrumentProgress?.some(I=>I.instrumentName===P))}),E=w(d),V=w(f),q=[...new Set(x.map(n=>n.academicInfo?.class).filter(Boolean))].sort(),X=[...new Set(x.flatMap(n=>n.academicInfo?.instrumentProgress?.map(y=>y.instrumentName)||[]).filter(Boolean))].sort();if(!a)return null;const C=n=>{n.target===n.currentTarget&&i()};if(D)return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:C,children:e.jsx("div",{className:"bg-white rounded-lg p-8",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 ml-2"}),e.jsx("span",{className:"text-gray-700",children:"×˜×•×¢×Ÿ × ×ª×•× ×™ ×—×‘×¨×™×..."})]})})});if(b||!c)return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:C,children:e.jsxs("div",{className:"bg-white rounded-lg p-8 max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(me,{className:"w-6 h-6 text-red-600 ml-2"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"×©×’×™××”"})]}),e.jsx("p",{className:"text-gray-600 mb-6",children:b||"×œ× × ×™×ª×Ÿ ×œ×˜×¢×•×Ÿ × ×ª×•× ×™ ×”×ª×–××•×¨×ª"}),e.jsx("button",{onClick:i,className:"w-full px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"×¡×’×•×¨"})]})});const $=({student:n,isMember:y})=>{const M=n.academicInfo?.instrumentProgress?.find(Y=>Y.isPrimary),I=Q===n._id;return e.jsx(J,{className:"hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-gray-100 to-gray-200 rounded-full flex items-center justify-center",children:e.jsx(G,{className:"w-5 h-5 text-gray-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900 mb-1",children:n.personalInfo.fullName}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-2",children:[n.academicInfo?.class&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_e,{className:"w-3 h-3"}),e.jsxs("span",{children:["×›×™×ª×” ",n.academicInfo.class]})]}),M&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(z,{className:"w-3 h-3"}),e.jsx("span",{children:M.instrumentName}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(×©×œ×‘ ",M.currentStage,")"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[n.personalInfo.phone&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ee,{className:"w-3 h-3"}),e.jsx("span",{children:n.personalInfo.phone})]}),n.personalInfo.studentEmail&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx($e,{className:"w-3 h-3"}),e.jsx("span",{children:n.personalInfo.studentEmail})]})]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:y?e.jsxs("button",{onClick:()=>U(n._id),disabled:I,className:`flex items-center gap-1 px-3 py-2 text-xs rounded-lg transition-colors ${I?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-red-50 text-red-700 hover:bg-red-100"}`,children:[I?e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border border-gray-400 border-t-transparent"}):e.jsx(Pe,{className:"w-3 h-3"}),"×”×¡×¨"]}):e.jsxs("button",{onClick:()=>L(n._id),disabled:I,className:`flex items-center gap-1 px-3 py-2 text-xs rounded-lg transition-colors ${I?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-green-50 text-green-700 hover:bg-green-100"}`,children:[I?e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border border-gray-400 border-t-transparent"}):e.jsx(ee,{className:"w-3 h-3"}),"×”×•×¡×£"]})})]})},n._id)};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:C,children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-6xl max-h-[90vh] m-4 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"× ×™×”×•×œ ×—×‘×¨×™ ×”×ª×–××•×¨×ª"}),e.jsx("p",{className:"text-gray-600 mt-1",children:c.name})]}),e.jsx("button",{onClick:i,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(se,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-6 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"×—×™×¤×•×© ×ª×œ××™×“×™×...",value:h,onChange:n=>S(n.target.value),className:"w-full pr-10 pl-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})}),e.jsx("div",{className:"w-32",children:e.jsxs("select",{value:k,onChange:n=>v(n.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"×›×œ ×”×›×™×ª×•×ª"}),q.map(n=>e.jsxs("option",{value:n,children:["×›×™×ª×” ",n]},n))]})}),e.jsx("div",{className:"w-40",children:e.jsxs("select",{value:P,onChange:n=>O(n.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"×›×œ ×”×›×œ×™×"}),X.map(n=>e.jsx("option",{value:n,children:n},n))]})}),e.jsx("button",{onClick:()=>{S(""),v(""),O("")},className:"px-3 py-2 text-sm text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx(xe,{className:"w-4 h-4"})})]})}),e.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col md:flex-row",children:[e.jsxs("div",{className:"flex-1 border-b md:border-b-0 md:border-l border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 bg-blue-50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(B,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"×—×‘×¨×™× × ×•×›×—×™×™×"}),e.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs font-medium px-2 py-1 rounded-full",children:E.length})]}),d.length!==E.length&&e.jsxs("p",{className:"text-sm text-gray-600",children:["××¦×™×’ ",E.length," ××ª×•×š ",d.length," ×—×‘×¨×™×"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:E.length>0?e.jsx("div",{className:"space-y-3",children:E.map(n=>e.jsx($,{student:n,isMember:!0},n._id))}):d.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(B,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"××™×Ÿ ×—×‘×¨×™× ×‘×ª×–××•×¨×ª"}),e.jsx("p",{className:"text-gray-600",children:"×”×ª×—×œ ×¢×œ ×™×“×™ ×”×•×¡×¤×ª ×ª×œ××™×“×™× ××”×¨×©×™××” ×”×–××™× ×”"})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(H,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"××™×Ÿ ×ª×•×¦××•×ª"}),e.jsx("p",{className:"text-gray-600",children:"× ×¡×” ×œ×©× ×•×ª ××ª ×§×¨×™×˜×¨×™×•× ×™ ×”×—×™×¤×•×©"})]})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 bg-green-50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ee,{className:"w-5 h-5 text-green-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"×ª×œ××™×“×™× ×–××™× ×™×"}),e.jsx("span",{className:"bg-green-100 text-green-800 text-xs font-medium px-2 py-1 rounded-full",children:V.length})]}),f.length!==V.length&&e.jsxs("p",{className:"text-sm text-gray-600",children:["××¦×™×’ ",V.length," ××ª×•×š ",f.length," ×ª×œ××™×“×™×"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:V.length>0?e.jsx("div",{className:"space-y-3",children:V.map(n=>e.jsx($,{student:n,isMember:!1},n._id))}):f.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ae,{className:"w-16 h-16 text-green-400 mx-auto mb-4"}),e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"×›×œ ×”×ª×œ××™×“×™× ×›×‘×¨ ×—×‘×¨×™×"}),e.jsx("p",{className:"text-gray-600",children:"×›×œ ×”×ª×œ××™×“×™× ×”×¤×¢×™×œ×™× ×›×‘×¨ ×—×‘×¨×™× ×‘×ª×–××•×¨×ª"})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(H,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"××™×Ÿ ×ª×•×¦××•×ª"}),e.jsx("p",{className:"text-gray-600",children:"× ×¡×” ×œ×©× ×•×ª ××ª ×§×¨×™×˜×¨×™×•× ×™ ×”×—×™×¤×•×©"})]})})]})]}),e.jsx("div",{className:"p-6 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["×¡×š ×”×›×œ: ",d.length," ×—×‘×¨×™× â€¢ ",f.length," ×ª×œ××™×“×™× ×–××™× ×™×"]}),e.jsx("button",{onClick:i,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"×¡×’×•×¨"})]})})]})})}const He=({isOpen:s,title:a="××™×©×•×¨ ××—×™×§×”",message:i,itemName:o,confirmText:c="××—×§",cancelText:u="×‘×™×˜×•×œ",onConfirm:x,onCancel:p,isLoading:d=!1})=>s?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md animate-in fade-in zoom-in duration-200",role:"dialog","aria-modal":"true","aria-labelledby":"confirm-delete-title",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(Re,{className:"w-6 h-6 text-red-600"})}),e.jsx("h2",{id:"confirm-delete-title",className:"text-xl font-bold text-gray-900",children:a})]}),e.jsx("button",{onClick:p,disabled:d,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors disabled:opacity-50","aria-label":"×¡×’×•×¨",children:e.jsx(se,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-gray-800 text-center leading-relaxed",children:i}),o&&e.jsxs("p",{className:"text-center mt-2 font-bold text-red-700",children:['"',o,'"']})]}),e.jsx("p",{className:"text-center text-gray-600 text-sm",children:"×¤×¢×•×œ×” ×–×• ××™× ×” × ×™×ª× ×ª ×œ×‘×™×˜×•×œ."})]}),e.jsxs("div",{className:"flex gap-3 p-6 bg-gray-50 border-t border-gray-200 rounded-b-2xl",children:[e.jsx("button",{onClick:p,disabled:d,className:"flex-1 px-4 py-3 bg-white border-2 border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 hover:border-gray-400 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 disabled:opacity-50",children:u}),e.jsx("button",{onClick:x,disabled:d,className:"flex-1 px-4 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg font-bold hover:from-red-600 hover:to-red-700 transition-all shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 disabled:opacity-50 flex items-center justify-center gap-2",children:d?e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"w-4 h-4"}),c]})})]})]})}):null,Je=He;function ns(){const s=Me();Se();const{currentSchoolYear:a}=ke(),[i,o]=m.useState([]),[c,u]=m.useState([]),[x,p]=m.useState(!0),[d,j]=m.useState(null),[f,N]=m.useState(!1),[D,t]=m.useState(null),[b,l]=m.useState(""),[h,S]=m.useState("dashboard"),[k,v]=m.useState(!1),[P,O]=m.useState(null),[Q,A]=m.useState(!1),[_,L]=m.useState(null),[U,w]=m.useState(!1),[E,V]=m.useState("name"),[q,X]=m.useState("asc"),[C,$]=m.useState({type:"",conductorId:"",location:"",isActive:!0,hasMembers:void 0});m.useEffect(()=>{n()},[]);const n=async()=>{try{p(!0),j(null);const[r,g]=await Promise.all([F.getOrchestras(),he.getTeachers({role:"×× ×¦×—"})]);o(r),u(g)}catch(r){console.error("Error loading data:",r),j("×©×’×™××” ×‘×˜×¢×™× ×ª ×”× ×ª×•× ×™×")}finally{p(!1)}},y=ze(qe(i,{searchQuery:b,type:C.type,conductorId:C.conductorId,location:C.location,isActive:C.isActive,hasMembers:C.hasMembers}),E,q);i.length,i.filter(r=>r.isActive).length,i.reduce((r,g)=>r+(g.memberIds?.length||0),0),i.filter(r=>r.conductorId).length,i.filter(r=>ge(r).isFullyConfigured).length,i.filter(r=>r.type==="×ª×–××•×¨×ª").length,i.filter(r=>r.type==="×”×¨×›×‘").length;const M=()=>{t(null),N(!0)},I=r=>{t(r),N(!0)},Y=async r=>{try{const g={...r,schoolYearId:a?._id||""};if(D)await F.updateOrchestra(D._id,g);else{if(!a?._id)throw new Error("×œ× ×”×•×’×“×¨×” ×©× ×ª ×œ×™××•×“×™× × ×•×›×—×™×ª. ×× × ×”×’×“×¨ ×©× ×ª ×œ×™××•×“×™× ×œ×¤× ×™ ×™×¦×™×¨×ª ×ª×–××•×¨×ª.");await F.createOrchestra(g)}N(!1),t(null),await n()}catch(g){throw console.error("Error saving orchestra:",g),g}},R=r=>{const g=i.find(Ce=>Ce._id===r);g&&(L(g),A(!0))},ye=async()=>{if(_){w(!0);try{await F.deleteOrchestra(_._id),A(!1),L(null),await n()}catch(r){console.error("Error deleting orchestra:",r),j("×©×’×™××” ×‘××—×™×§×ª ×”×ª×–××•×¨×ª")}finally{w(!1)}}},je=()=>{A(!1),L(null)},K=r=>{s(`/orchestras/${r}`)},Ne=r=>{O(r),v(!0)},ve=()=>{v(!1),O(null)},we=[{key:"name",label:"×©×",render:r=>{const g=le(r.type);return e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-lg ml-2",children:g.icon}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:r.name}),e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full bg-gray-100 text-gray-700",children:g.text})]})]})}},{key:"conductor",label:"×× ×¦×—",render:r=>W(r)},{key:"members",label:"×—×‘×¨×™×",render:r=>pe(r.memberIds?.length||0)},{key:"rehearsals",label:"×—×–×¨×•×ª",render:r=>be(r.rehearsalIds?.length||0)},{key:"location",label:"××™×§×•×",render:r=>r.location},{key:"status",label:"×¡×˜×˜×•×¡",render:r=>{const g=ne(r);return e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full bg-gray-100 text-gray-700",children:g.text})}}];return x?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"×˜×•×¢×Ÿ ×ª×–××•×¨×•×ª..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-end items-center",children:e.jsxs("button",{onClick:M,className:"flex items-center px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[e.jsx(ie,{className:"w-4 h-4 ml-2"}),"×ª×–××•×¨×ª ×—×“×©×”"]})}),d&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-800",children:d})}),h!=="dashboard"&&e.jsx(J,{children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"×—×™×¤×•×© ×ª×–××•×¨×•×ª...",value:b,onChange:r=>l(r.target.value),className:"w-full pr-10 pl-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})}),e.jsx("div",{className:"md:w-48",children:e.jsxs("select",{value:C.type,onChange:r=>$(g=>({...g,type:r.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"×›×œ ×”×¡×•×’×™×"}),ae.map(r=>e.jsx("option",{value:r,children:r},r))]})}),e.jsx("div",{className:"md:w-48",children:e.jsxs("select",{value:C.conductorId,onChange:r=>$(g=>({...g,conductorId:r.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"×›×œ ×”×× ×¦×—×™×"}),c.map(r=>e.jsx("option",{value:r._id,children:r.personalInfo?.fullName},r._id))]})}),e.jsx("div",{className:"md:w-48",children:e.jsxs("select",{value:C.location,onChange:r=>$(g=>({...g,location:r.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"×›×œ ×”××™×§×•××™×"}),T.map(r=>e.jsx("option",{value:r,children:r},r))]})})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:C.isActive===!0,onChange:r=>$(g=>({...g,isActive:r.target.checked?!0:void 0})),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsx("span",{className:"mr-2 text-sm text-gray-700",children:"×¨×§ ×¤×¢×™×œ×•×ª"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:C.hasMembers===!0,onChange:r=>$(g=>({...g,hasMembers:r.target.checked?!0:void 0})),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsx("span",{className:"mr-2 text-sm text-gray-700",children:"×¢× ×—×‘×¨×™×"})]}),e.jsxs("button",{onClick:()=>{$({type:"",conductorId:"",location:"",isActive:void 0,hasMembers:void 0}),l("")},className:"px-3 py-1 text-sm text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(xe,{className:"w-4 h-4 inline ml-1"}),"× ×§×” ××¡× × ×™×"]})]})]})}),h!=="dashboard"&&e.jsxs(J,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["×ª×–××•×¨×•×ª ×•×”×¨×›×‘×™× (",y.length,")"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center border border-gray-300 rounded-lg overflow-hidden",children:[e.jsx("button",{onClick:()=>S("dashboard"),className:`p-2 ${h==="dashboard"?"bg-primary-500 text-white":"bg-white text-gray-600 hover:bg-gray-50"}`,title:"×œ×•×— ×‘×§×¨×”",children:e.jsx(Te,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>S("grid"),className:`p-2 ${h==="grid"?"bg-primary-500 text-white":"bg-white text-gray-600 hover:bg-gray-50"}`,title:"×ª×¦×•×’×ª ×›×¨×˜×™×¡×™×",children:e.jsx(Fe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>S("table"),className:`p-2 ${h==="table"?"bg-primary-500 text-white":"bg-white text-gray-600 hover:bg-gray-50"}`,title:"×ª×¦×•×’×ª ×˜×‘×œ×”",children:e.jsx(Le,{className:"w-4 h-4"})})]}),e.jsxs("select",{value:E,onChange:r=>V(r.target.value),className:"px-3 py-1 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"name",children:"××™×•×Ÿ ×œ×¤×™ ×©×"}),e.jsx("option",{value:"type",children:"××™×•×Ÿ ×œ×¤×™ ×¡×•×’"}),e.jsx("option",{value:"conductor",children:"××™×•×Ÿ ×œ×¤×™ ×× ×¦×—"}),e.jsx("option",{value:"memberCount",children:"××™×•×Ÿ ×œ×¤×™ ××¡×¤×¨ ×—×‘×¨×™×"}),e.jsx("option",{value:"location",children:"××™×•×Ÿ ×œ×¤×™ ××™×§×•×"}),e.jsx("option",{value:"rehearsalCount",children:"××™×•×Ÿ ×œ×¤×™ ×—×–×¨×•×ª"})]}),e.jsx("button",{onClick:()=>X(q==="asc"?"desc":"asc"),className:"px-3 py-1 text-sm border border-gray-300 rounded-lg hover:bg-gray-50",title:q==="asc"?"××™×•×Ÿ ×™×•×¨×“":"××™×•×Ÿ ×¢×•×œ×”",children:q==="asc"?"â†‘":"â†“"}),e.jsx("button",{onClick:n,className:"text-sm text-primary-600 hover:text-primary-700 font-medium",children:"×¨×¢× ×Ÿ"})]})]}),y.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(z,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"××™×Ÿ ×ª×–××•×¨×•×ª"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"×”×ª×—×œ ×¢×œ ×™×“×™ ×™×¦×™×¨×ª ×”×ª×–××•×¨×ª ×”×¨××©×•× ×”"}),e.jsxs("button",{onClick:M,className:"inline-flex items-center px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[e.jsx(ie,{className:"w-4 h-4 ml-2"}),"×¦×•×¨ ×ª×–××•×¨×ª ×¨××©×•× ×”"]})]}):h==="table"?e.jsx(De,{data:y,columns:we,onEdit:I,onDelete:r=>R(r._id),onView:r=>K(r._id),actions:!0}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:y.map(r=>e.jsx(Ye,{orchestra:r,onEdit:I,onDelete:R,onViewDetails:K},r._id))})]}),h==="dashboard"&&e.jsx(Ge,{onViewDetails:K,onEditOrchestra:I,onManageMembers:Ne,onDeleteOrchestra:R}),f&&e.jsx(Ue,{orchestra:D,teachers:c,onSubmit:Y,onCancel:()=>{N(!1),t(null)}}),k&&P&&e.jsx(We,{orchestraId:P,isOpen:k,onClose:ve,onUpdate:n}),e.jsx(Je,{isOpen:Q,title:"××—×™×§×ª ×ª×–××•×¨×ª",message:"×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×”×ª×–××•×¨×ª?",itemName:_?.name,confirmText:"××—×§ ×ª×–××•×¨×ª",onConfirm:ye,onCancel:je,isLoading:U})]})}export{ns as default};
